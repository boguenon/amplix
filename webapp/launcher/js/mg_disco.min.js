IG$.mg_disco=$s.extend(IG$.v$pnl,{layout:"fit",_module:"com.amplix.migration.discoverer.DiscoMigration",iconCls:"icon-ing-docdef",autoScroll:!0,initapp:function(){var e=this,t=e.down("[name=d_file]").el.dom,a=$(".m_fileupload",t),i=e.down("[name=d_upfiles]");a.empty(),fileupload=$("<input type='file' name='files[]' data-url='upload' multiple></input>").appendTo(a),dropzone=$("<div class='filedropzone fade well'>Drop files here</div>").appendTo(a),d_progress=$("<div class='file-progress'><div class='bar' style='width: 0%;'></div></div>").appendTo(a),fileupload.fileupload({url:ig$.servlet+"/upload",dataType:"json",formData:{_mts_:IG$._g$a||""},done:function(t,a){var o,l,n,d,s=a.result||{errorcode:"0xffff",errormsg:"Server incorrect responding"},r=[];if(s.errorcode)IG$.ShowErrorMessage(s,e,null);else if(s.result)for(o=s.result.length?s.result:[s.result],l=0;l<o.length;l++)n=o[l],r.push(n);if(r&&r.length)for(i.show(),l=0;l<r.length;l++)d=i.store.add(r[l]),i.selModel.select(d,!0)},progressall:function(e,t){var a=parseInt(t.loaded/t.total*100,10),i=$(".bar",d_progress);i.css("width",a+"%"),i.text("Loaded "+t.loaded+" / "+t.total)},dropZone:dropzone}).bind("fileuploadsubmit",(function(e,t){})),fileupload.fileupload("option","url",ig$.servlet+"/upload"),e.load_dbpool()},updateSchemas:function(e){var t=this,a=t.down("[name=eul_schema]");if(e){var i=new IG$._rpc$;i.init(t,{ack:"tablecontent",payload:{uid:e},mbody:{option:"standard"}},t,(function(e){var t=e.schemas;a.store.loadData(t)})),i.send()}else a.store.loadData([])},toolbarHandler:function(e){var t,a,i=this,o=i.down("[name=d_upfiles]"),l=i.down("[name=d_bas]"),n=i.down("[name=d_doc]"),d=i.down("[name=eul_metadb]"),s=i.down("[name=eul_schema]"),r=[];switch(e){case"cmd_c_files":for(a=0;a<o.store.data.items.length;a++)o.store.data.items[a].data.selected&&r.push(o.store.data.items[a]);if(i.file_lists=r,!i.checkRequired())return;r.length&&(i.setLoading(!0),i.migrate_eex());break;case"cmd_r_doc":if(t=new IG$._rpc$,!i.checkRequired())return;t.init(i,{ack:"migration",payload:{module:i._module},mbody:{option:"list_doc",eul_meta:d.getValue(),eul_schema:s.getValue(),bobj:i._bobj.uid},meta_type:"object"},i,(function(e){n.store.loadData(e)})),t.send();break;case"cmd_c_doc":for(a=0;a<n.store.data.items.length;a++)n.store.data.items[a].data.selected&&r.push(n.store.data.items[a]);if(i.doc_lists=r,!i.checkRequired())return;r.length&&(i.setLoading(!0),i.migrate_doc());break;case"cmd_r_bas":if(t=new IG$._rpc$,!i.checkRequired())return;t.init(i,{ack:"migration",payload:{module:i._module},mbody:{option:"list_bas",eul_meta:d.getValue(),eul_schema:s.getValue(),bobj:i._bobj.uid},meta_type:"object"},i,(function(e){l.store.loadData(e)})),t.send();break;case"cmd_c_bas":for(a=0;a<l.store.data.items.length;a++)l.store.data.items[a].data.selected&&r.push(l.store.data.items[a]);if(i.bas_lists=r,!i.checkRequired())return;r.length&&(i.setLoading(!0),i.migrate_bas())}},checkRequired:function(){var e=this,t=!0,a=e.down("[name=eul_metadb]"),i=e.down("[name=eul_schema]"),o=e.down("[name=tbobject]");return a.clearInvalid(),i.clearInvalid(),o.clearInvalid(),a.getValue()||(a.markInvalid("Required field"),t=!1),i.getValue()||(i.markInvalid("Required field"),t=!1),e._bobj||(o.markInvalid("Required field"),t=!1),t},load_dbpool:function(){var e=new IG$._rpc$;e.init(this,{ack:"tablecontent",payload:{address:"/"},mbody:{option:"standard"}},this,(function(e){var t,a,i=[],o=this.down("[name=eul_metadb]");if(i.push({name:"-- Select Database --",uid:""}),e&&e.length)for(a=0;a<e.length;a++)(t=e[a]).name=t.disp||t.name,i.push(t);o.store.loadData(i),o.setValue("")}),!1),e.send()},migrate_eex:function(){var e=this,t=e.down("[name=d_upfiles]");if(e.file_lists&&e.file_lists.length){var a=e.file_lists.splice(0,1)[0],i=new IG$._rpc$;i.stoploading=!1,i.init(e,{ack:"migration",payload:{module:e._module},mbody:{option:"migrate_eex",eul_meta:e.down("[name=eul_metadb]").getValue(),eul_schema:e.down("[name=eul_schema]").getValue(),bobj:e._bobj.uid,items:[a.data]},meta_type:"object"},e,(function(i){t.store.remove(a),e.migrate_eex()})),i.send()}else e.setLoading(!1)},migrate_doc:function(){var e=this,t=e.down("[name=d_doc]");if(e.doc_lists&&e.doc_lists.length){var a=e.doc_lists.splice(0,1)[0],i=new IG$._rpc$;i.stoploading=!1,i.init(e,{ack:"migration",payload:{module:e._module},mbody:{option:"migrate_doc",eul_meta:e.down("[name=eul_metadb]").getValue(),eul_schema:e.down("[name=eul_schema]").getValue(),bobj:e._bobj.uid,items:[a.data]},meta_type:"object"},e,(function(i){t.selModel.select(a,!1),e.migrate_doc()})),i.send()}else e.setLoading(!1)},migrate_bas:function(){var e=this,t=e.down("[name=d_bas]");if(e.bas_lists&&e.bas_lists.length){var a=e.bas_lists.splice(0,1)[0],i=new IG$._rpc$;i.stoploading=!1,i.init(e,{ack:"migration",payload:{module:e._module},mbody:{option:"migrate_bas",eul_meta:e.down("[name=eul_metadb]").getValue(),eul_schema:e.down("[name=eul_schema]").getValue(),bobj:e._bobj.uid,items:[a.data]},meta_type:"object"},e,(function(i){t.selModel.select(a,!1),e.migrate_bas()})),i.send()}else e.setLoading(!1)},initComponent:function(){var e=this;$s.apply(e,{items:[{xtype:"container",padding:ig$.padding,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Options",items:[{xtype:"combobox",fieldLabel:"EUL metadatabase",name:"eul_metadb",displayField:"name",labelField:"name",valueField:"uid",store:{fields:["uid","name","disp"]},listeners:{change:function(e){this.updateSchemas(e.getValue())},scope:this}},{xtype:"combobox",fieldLabel:"EUL Schema",name:"eul_schema",displayField:"name",labelField:"name",valueField:"name",store:{fields:["uid","name","disp"]}}]},{xtype:"container",width:20},{xtype:"fieldset",flex:1,title:"Target Meta",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:"Target Business Object",items:[{xtype:"textfield",flex:1,name:"tbobject",emptyText:IRm$.r1("M_SEL_ITEM"),readOnly:!0},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){var t=new IG$.metaSelectDlg({instance:e.instance,visibleItems:"folder;bobject",tree_options:{cubebrowse:!0,rootuid:null},callback:new IG$.callBackObj(e,(function(t){e.down("[name=tbobject]").setValue(t.name),e._bobj=t}))});IG$.checkLogin(this,t)},scope:this}]}]}]},{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"EEX file upload",items:[{html:"<div class='m_fileupload'></div>",name:"d_file",height:120,bodyPadding:10},{name:"d_upfiles",xtype:"gridpanel",height:320,hidden:!0,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["uid","filename","fileext"]},columns:[{text:IRm$.r1("L_FILENAME"),dataIndex:"filename_org",flex:1},{text:IRm$.r1("L_FILEEXT"),dataIndex:"fileext",flex:1},{xtype:"actioncolumn",width:20,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,a){var i=e.store.getAt(t);e.store.remove(i)}}]}],bbar:["->",{xtype:"button",text:"Commit All Files",handler:function(){this.toolbarHandler("cmd_c_files")},scope:this},{xtype:"button",text:"Cancel All Files",handler:function(){var e=this.down("[name=d_upfiles]");e.store.removeAll(),e.hide(),this.down("[name=d_file]").hide()},scope:this}]}]},{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Documents",items:[{name:"d_doc",xtype:"gridpanel",height:300,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["name","id","description"]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",flex:1},{text:IRm$.r1("B_DESC"),dataIndex:"description",flex:1}],bbar:[{xtype:"button",text:"Refresh",handler:function(){this.toolbarHandler("cmd_r_doc")},scope:this},"->",{xtype:"button",text:"Commit All Files",handler:function(){this.toolbarHandler("cmd_c_doc")},scope:this}]}]},{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Business Area",items:[{name:"d_bas",xtype:"gridpanel",height:300,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["name","id","description"]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",flex:1},{text:IRm$.r1("B_DESC"),dataIndex:"description",flex:1}],bbar:[{xtype:"button",text:"Refresh",handler:function(){this.toolbarHandler("cmd_r_bas")},scope:this},"->",{xtype:"button",text:"Commit All Files",handler:function(){this.toolbarHandler("cmd_c_bas")},scope:this},{xtype:"button",text:"Cancel All Files",handler:function(){var e=this.down("[name=d_upfiles]");e.store.removeAll(),e.hide(),this.down("[name=d_file]").hide()},scope:this}]}]}]}]}),IG$.mg_disco.superclass.initComponent.call(this)},listeners:{afterrender:function(e){e.initapp()}}});