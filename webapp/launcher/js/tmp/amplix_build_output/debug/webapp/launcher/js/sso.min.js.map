{"version":3,"sources":["sso_client.js"],"names":["IG$","showLogin","callback","rs","__encrypt","nmts","$","hide","window","$sso_try_count","_g$a","url_params","_parse_url","params","dlgLogin","callBackObj","this","showLoginProc","call","hist","addHistory","mc","lf","sform","lform","login_container","progress","browser","bowser","useLocale","ig$","appInfo","licensed","length","appendTo","css","zIndex","msie","position","top","left","right","bottom","width","height","margin","padding","show","do_session","fkey","sessionUtils","sess","req","_rpc$","encpwd","init","ack","payload","userid","passwd","sso_module","$sso_module_name","encrypt","keyvar","rsa_kinfo","mbody","lang","mts","app","session_expire","rdoStartSession","xdoc","r","execute","send","getKeyPair","$sso_config","html","sso_fail_msg","lurl","thash","newhash","nhash","bproc","location_hash","location","href","thashmap","retrycount","indexOf","substring","split","each","i","tstr","Number","push","join","setTimeout","reload","sso_fail_handler","apply","doStartSession","fadeOut","fadeIn","$session_key","lreq","item","p1","p2","rsaPublicKeyModules","rsaPublicKeyExpoenent","p3","logout_msg"],"mappings":"AAiBAA,IAAIC,UAAY,SAASC,EAAUC,EAAIC,GAItC,IAAIC,EAIJ,GANAC,EAAE,gBAAgBC,OAIlBC,OAAOC,eAAiBD,OAAOC,gBAAkB,GAE5CT,IAAIU,KACT,CACC,IAAIC,EAAaX,IAAIY,aAAaC,OAClCR,EAAOM,EAAgB,KAAK,OAGzBX,IAAIc,WAEPd,IAAIc,SAASZ,SAAW,IAAIF,IAAIe,YAAYC,MAAM,WACjDV,EAAE,gBAAgBC,OAClBP,IAAIiB,cAAcC,KAAKF,UAIrBR,OAAOW,MAEVX,OAAOW,KAAKC,WAAW,IAGxB,IAECC,EAEAC,EAAIC,EAJDC,EAAQlB,EAAE,gBACbmB,EAAkBnB,EAAE,mBAAoBkB,GAExCE,EAAWpB,EAAE,kBAAmBkB,GAEhCG,EAAUnB,OAAOoB,OAElBN,EAAK,uIAIW,SAAbO,UAAuB,gBAAkB,KAC5B,SAAbA,UAAuB,yBAA2B,IALhD,+CAOoCC,IAAIC,QAAUD,IAAIC,QAAQC,UAAY,MAAQ,OAAS,SAC/FV,GAAM,gBAEPC,EAAQjB,EAAE,aAAckB,IAEbS,SAEVV,EAAQjB,EAAEgB,GAAIY,SAAST,GAAiBlB,QAGzCc,EAAKf,EAAE,YAAakB,GAEpBA,EAAMW,IAAI,CAACC,OAAQ,KACfT,EAAQU,MAEXb,EAAMW,IAAI,CAACG,SAAU,WAAYC,IAAK,EAAGC,KAAM,EAAGC,MAAO,EAAGC,OAAQ,EAAGC,MAAO,OAAQC,OAAQ,OAAQC,OAAQ,EAAGC,QAAS,IAE3HtB,EAAMuB,OAEN,IAAIC,EAAa,SAASC,GACzB,GAAIjD,IAAIkD,aACR,CACC,IAAIC,EAAOnD,IAAIc,SAEf,GAAiB,GAAbV,EACJ,CACC,IAAIgD,EAAM,IAAIpD,IAAIqD,MAEdC,EAAS,CAACL,EAAM,IAEpBG,EAAIG,KAAKJ,EACR,CACCK,IAAK,QACLC,QAAS,CAACC,OAAQJ,EAAO,GAAIK,OAAQL,EAAO,GAAIM,WAAY9B,IAAI+B,kBAAoB,SAAUC,QAAS,KAAMC,OAAQ/D,IAAIgE,WACzHC,MAAO,CAACC,KAAMrC,UAAWsC,IAAKnE,IAAIU,MAAQ,GAAI0D,IAAK,GAAIC,eAAiB,GAAKvC,IAAIuC,gBAAmB,MAClGlB,EAAMA,EAAKmB,iBAAiB,SAASC,GACvC,IAAIC,EAUJ,OARItE,IACHsE,EAAItE,EAASuE,QAAQF,IAElB7C,GAEHA,EAASnB,OAGHiE,IACL9C,GACJ0B,EAAIsB,YAIJvB,EAAKwB,WAAW1B,EAAM,GAAIvB,EAAU1B,IAAIU,KAEvC,IAAIV,IAAIe,YAAYC,MAAM,SAASuD,GAMlChD,EAAMwB,OACN1B,EAAGd,OAEHuB,IAAI8C,YAAc9C,IAAI8C,aAAe,GAErCtE,EAAE,iBAAkBiB,GAAOsD,KAAK/C,IAAI8C,YAAYE,cAAgB,6EAChEpD,EAASnB,OAET,IACCwE,EACAC,EACAC,EACAC,EAGAC,EAPGC,EAAgB5E,OAAO6E,SAASC,KAKnCC,EAAW,GACXC,EAAa,EA0Dd,OAtDIJ,GAAiBA,EAAcK,QAAQ,KAAO,IAEjDV,EAAOK,EAAcM,UAAU,EAAGN,EAAcK,QAAQ,MAExDT,GADAI,EAAgBA,EAAcM,UAAUN,EAAcK,QAAQ,KAAO,IAC/CE,MAAM,KAC5BH,EAAa,EAEblF,EAAEsF,KAAKZ,GAAO,SAASa,EAAGC,GACrBA,EAAKL,QAAQ,KAAO,IAEvBF,EAASO,EAAKJ,UAAU,EAAGI,EAAKL,QAAQ,OAASK,EAAKJ,UAAUI,EAAKL,QAAQ,KAAO,OAItFD,EAAaO,OAAOR,EAAgB,OAAK,MAAQ,EAEjDA,EAAgB,MAAI,MAAQC,EAExBhF,OAAOC,eAAiB,GAAK+E,EAAahF,OAAOC,iBAEpDyE,EAAQ,GAER5E,EAAEsF,KAAKL,GAAU,SAASM,EAAGC,GAC5BZ,EAAMc,KAAUH,EAAI,IAAMC,MAG3Bb,EAAUC,EAAMe,KAAK,KAErBd,EAAQ,EAERe,YAAW,WACV1F,OAAO6E,SAASC,KAAOP,EAAO,IAAME,IAClC,QAIAE,GAASH,GAASxE,OAAOC,eAAiB,GAAK+E,EAAahF,OAAOC,gBAEvE0E,EAAQ,EAERe,YAAW,WACV1F,OAAO6E,SAASc,QAAO,KACrB,MAEMhB,IAETrD,IAAI8C,YAAc9C,IAAI8C,aAAe,GAEjC9C,IAAI8C,YAAYwB,kBAEnBtE,IAAI8C,YAAYwB,iBAAiBC,MAAM,QAIlC,KAEPvE,IAAI+B,kBAAoB,eAK3B7D,IAAIsG,eAAerD,EAAM,GAAIvB,EAAU,KAAM,IAAI1B,IAAIe,YAAYC,MAAM,SAASuD,GAE/EhD,EAAMgF,UACN7E,EAASnB,OACTc,EAAGmF,cASI,GAANrG,GAEHoB,EAAMwB,OACN1B,EAAGd,OACHmB,EAASqB,OAETmD,YAAW,WACV,IAAIjD,EAAOzC,OAAOiG,cAAgB,oCAElC,GAAIpG,GAAQA,EAAK4B,OACjB,CACC,IAAIyE,EAAO,IAAI1G,IAAIqD,MAGnBqD,EAAKnD,KAFIvC,KAGR,CACCwC,IAAK,WACLC,QAAS,CAACU,IAAK9D,GACf4D,MAAO,IANAjD,MAOE,SAAS2F,GAClB,IAAIC,EAAKD,EAAKC,GACbC,EAAKF,EAAKE,GAEPD,GAAMC,GAET7G,IAAI8G,oBAAsBF,EAC1B5G,IAAI+G,sBAAwBF,EAC5B7G,IAAIgE,UAAY2C,EAAKK,GACrBhH,IAAIU,KAAOiG,EAAKxC,IAEhBnB,EAAWC,IAIXD,EAAWC,MAEV,WACFD,EAAWC,MAGbyD,EAAKhC,YAIL1B,EAAWC,KAEV,MAIHnB,IAAI8C,YAAc9C,IAAI8C,aAAe,GAIrCrD,EAAMwB,OACN1B,EAAGd,OACHD,EAAE,iBAAkBiB,GAAOsD,KAAK/C,IAAI8C,YAAYqC,YAAc,yEAC9DvF,EAASnB","file":"../../../../../../sso.min.js","sourcesContent":["/**\r\n * @module framework/login/custom/sso_client\r\n * @desc sso login loader\r\n */\r\n\r\n\r\n/**\r\n * override show login\r\n * rs: 0 (first page load)\r\n * rs: 1 (logout button clicked)\r\n * rs: 2 (session expired)\r\n * rs: 3 (print page login)\r\n *\r\n * ig$.$sso_module_name : module short name to specify single sign on server class\r\n * @param rs {integer} login source\r\n * @memberof module:framework/login/custom/sso_client\r\n */\r\nIG$.showLogin = function(callback, rs, __encrypt) // show login screen\r\n{\r\n\t$(\"#idv-mnu-pnl\").hide();\r\n\r\n\tvar nmts;\r\n\t\r\n\twindow.$sso_try_count = window.$sso_try_count || 0;\r\n\r\n\tif (!IG$._g$a)\r\n\t{\r\n\t\tvar url_params = IG$._parse_url().params;\r\n\t\tnmts = url_params[\"mts\"] || \"ROOT\";\r\n\t}\r\n\t\r\n\tif (IG$.dlgLogin)\r\n\t{\r\n\t\tIG$.dlgLogin.callback = new IG$.callBackObj(this, function() {\r\n\t\t\t$(\"#loginWindow\").hide();\r\n\t\t\tIG$.showLoginProc.call(this);\r\n\t\t});\r\n\t}\r\n\t\r\n\tif (window.hist)\r\n\t{\r\n\t\twindow.hist.addHistory(\"\");\r\n\t}\r\n\t\r\n\tvar lform = $(\"#loginWindow\"),\r\n\t\tlogin_container = $(\".login-container\", lform),\r\n\t\tmc,\r\n\t\tprogress = $(\"#login-progress\", lform),\r\n\t\tlf, sform,\r\n\t\tbrowser = window.bowser;\r\n\t\t\r\n\tlf = \"<div class='login-smc'>\"\r\n\t\t+ \"<div class='login-ic'>\"\r\n\t\t+ \"<img class='login-logo' src='./images/logo_7186.png'>\"\r\n\t\t+ \"<div class='login-sso-msg'><span>\" + \r\n\t\t\t(useLocale == \"ko_KR\" ? \"잠시만 기다려 주십시오.\" : \"\") + \r\n\t\t\t(useLocale == \"en_US\" ? \"Please Wait a minutes.\" : \"\")\r\n\t\t\t+ \"<span></div>\"\r\n\t\t\t+ \"<div id='license'>Licensed to: \" + (ig$.appInfo ? ig$.appInfo.licensed || \"xxx\" : \"...\") + \"</div>\";\r\n\t\tlf += \"</div></div>\";\r\n\t\t  \r\n\tsform = $(\".login-smc\", lform);\r\n\t\r\n\tif (!sform.length)\r\n\t{\r\n\t\tsform = $(lf).appendTo(login_container).hide();\r\n\t}\r\n\t\r\n\tmc = $(\".login-mc\", lform);\r\n\t\r\n\tlform.css({zIndex: 99});\r\n\tif (browser.msie)\r\n\t{\r\n\t\tlform.css({position: \"absolute\", top: 0, left: 0, right: 0, bottom: 0, width: \"100%\", height: \"100%\", margin: 0, padding: 0});\r\n\t}\r\n\tlform.show();\r\n\r\n\tvar do_session = function(fkey) {\r\n\t\tif (IG$.sessionUtils)\r\n\t\t{\r\n\t\t\tvar sess = IG$.dlgLogin;\r\n\t\t\t\r\n\t\t\tif (__encrypt == false)\r\n\t\t\t{\r\n\t\t\t\tvar req = new IG$._rpc$();\r\n\t\t\t\t\r\n\t\t\t\tvar encpwd = [fkey, \"\"];\r\n\t\t\t\t// passwd = encpwd.toString(CryptoJS.enc.Hex);\r\n\t\t\t\treq.init(sess, \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tack: \"login\",\r\n\t\t\t\t\t\tpayload: {userid: encpwd[0], passwd: encpwd[1], sso_module: ig$.$sso_module_name || \"dbsync\", encrypt: \"no\", keyvar: IG$.rsa_kinfo},\r\n\t\t\t\t\t\tmbody: {lang: useLocale, mts: IG$._g$a || \"\", app: '', session_expire: (\"\" + ig$.session_expire) || \"0\"}\r\n\t\t\t\t\t}, sess, sess.rdoStartSession, function(xdoc) {\r\n\t\t\t\t\t\tvar r;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (callback)\r\n\t\t\t\t\t\t\tr = callback.execute(xdoc);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (progress)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tprogress.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn r;\r\n\t\t\t\t\t}, progress);\r\n\t\t\t\treq.send();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tsess.getKeyPair(fkey, \"\", progress, IG$._g$a, \r\n\t\t\t\t\t// login error handler\r\n\t\t\t\t\tnew IG$.callBackObj(this, function(xdoc) {\r\n\t\t\t\t\t\t// move to portal login page if necessary\r\n\t\t\t\t\t\t// sform.fadeOut();\r\n\t\t\t\t\t\t// progress.hide();\r\n\t\t\t\t\t\t// mc.fadeIn();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsform.show();\r\n\t\t\t\t\t\tmc.hide();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tig$.$sso_config = ig$.$sso_config || {};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$(\".login-sso-msg\", sform).html(ig$.$sso_config.sso_fail_msg || \"<span>Session key expired! Please refresh browser and login again!</span>\");\r\n\t\t\t\t\t\tprogress.hide();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar location_hash = window.location.href,\r\n\t\t\t\t\t\t\tlurl,\r\n\t\t\t\t\t\t\tthash,\r\n\t\t\t\t\t\t\tnewhash,\r\n\t\t\t\t\t\t\tnhash,\r\n\t\t\t\t\t\t\tthashmap = {},\r\n\t\t\t\t\t\t\tretrycount = 0,\r\n\t\t\t\t\t\t\tbproc,\r\n\t\t\t\t\t\t\ti;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (location_hash && location_hash.indexOf(\"?\") > 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlurl = location_hash.substring(0, location_hash.indexOf(\"?\"));\r\n\t\t\t\t\t\t\tlocation_hash = location_hash.substring(location_hash.indexOf(\"?\") + 1);\r\n\t\t\t\t\t\t\tthash = location_hash.split(\"&\");\r\n\t\t\t\t\t\t\tretrycount = 0;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t$.each(thash, function(i, tstr) {\r\n\t\t\t\t\t\t\t\tif (tstr.indexOf(\"=\") > 0)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tthashmap[tstr.substring(0, tstr.indexOf(\"=\"))] = tstr.substring(tstr.indexOf(\"=\") + 1);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tretrycount = Number(thashmap[\"retry\"] || \"0\") || 0;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthashmap[\"retry\"] = \"\" + (++retrycount);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (window.$sso_try_count > 0 && retrycount < window.$sso_try_count)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tnhash = [];\r\n\t\r\n\t\t\t\t\t\t\t\t$.each(thashmap, function(i, tstr) {\r\n\t\t\t\t\t\t\t\t\tnhash.push(\"\" + i + \"=\" + tstr);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tnewhash = nhash.join(\"&\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tbproc = 1;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = lurl + \"?\" + newhash;\r\n\t\t\t\t\t\t\t\t}, 5000);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (!bproc && thash && window.$sso_try_count > 0 && retrycount < window.$sso_try_count)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tbproc = 1;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\twindow.location.reload(false);\r\n\t\t\t\t\t\t\t}, 5000);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (!bproc)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tig$.$sso_config = ig$.$sso_config || {};\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (ig$.$sso_config.sso_fail_handler)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tig$.$sso_config.sso_fail_handler.apply(null);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t})\r\n\t\t\t\t, ig$.$sso_module_name || \"dbsync\");\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tIG$.doStartSession(fkey, \"\", progress, null, new IG$.callBackObj(this, function(xdoc) {\r\n\t\t\t\t// move to portal login page if necessary\r\n\t\t\t\tsform.fadeOut();\r\n\t\t\t\tprogress.hide();\r\n\t\t\t\tmc.fadeIn();\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\t\r\n\t// rs: 0 (first page load)\r\n\t// rs: 1 (logout button clicked)\r\n\t// rs: 2 (session expired)\r\n\t// rs: 3 (print page login)\r\n\tif (rs != 1) \r\n\t{\r\n\t\tsform.show();\r\n\t\tmc.hide();\r\n\t\tprogress.show();\r\n\t\t// request automatic login\r\n\t\tsetTimeout(function() {\r\n\t\t\tvar fkey = window.$session_key || \"sso_sim_b6118e61573e4aaa_key_map:\";\r\n\r\n\t\t\tif (nmts && nmts.length)\r\n\t\t\t{\r\n\t\t\t\tvar lreq = new IG$._rpc$(),\r\n\t\t\t\t\tpanel = this;\r\n\t\t\t\t\r\n\t\t\t\tlreq.init(panel,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tack: \"security\",\r\n\t\t\t\t\t\tpayload: {mts: nmts},\r\n\t\t\t\t\t\tmbody: {}\r\n\t\t\t\t\t}, panel, function(item) {\r\n\t\t\t\t\t\tvar p1 = item.p1,\r\n\t\t\t\t\t\t\tp2 = item.p2;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (p1 && p2)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tIG$.rsaPublicKeyModules = p1;\r\n\t\t\t\t\t\t\tIG$.rsaPublicKeyExpoenent = p2;\r\n\t\t\t\t\t\t\tIG$.rsa_kinfo = item.p3;\r\n\t\t\t\t\t\t\tIG$._g$a = item.mts;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdo_session(fkey);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdo_session(fkey);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\tdo_session(fkey);\r\n\t\t\t\t\t});\r\n\t\t\t\r\n\t\t\t\tlreq.send();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdo_session(fkey);\r\n\t\t\t}\r\n\t\t}, 10);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tig$.$sso_config = ig$.$sso_config || {};\r\n\t\t\r\n\t\t// sform.hide();\r\n\t\t// mc.show();\r\n\t\tsform.show();\r\n\t\tmc.hide();\r\n\t\t$(\".login-sso-msg\", sform).html(ig$.$sso_config.logout_msg || \"<span>Session expired! Please refresh browser and login again!</span>\");\r\n\t\tprogress.hide();\r\n\t}\r\n}"]}