IG$.mongoJobs=$s.extend(IG$.v$pnl,{scroll:!1,closable:!0,layout:"border",_ld:function(){var t="MongoJobs",e=new IG$._rpc$;e.init(this,{ack:"helpcontent",payload:{uid:"/"+t,name:t,type:"Folder",post:"create",duty:"everyone",mode:"s"},mbody:{option:"translate"}},this,(function(t){var e=t&&t.length?t[0].uid:null;e&&(this._tuid=e,this._ldc())})),e.send()},_ldc:function(){var t=this._tuid;if(t){var e=new IG$._rpc$;e.init(this,{ack:"content",payload:{uid:t},mbody:{option:""}},this,(function(t){var e=t?t.children:null;this.down("[name=g1]").store.loadData(e)}),!1),e.send()}},_add:function(){var t=this,e=t._tuid;e&&IG$._createMetaObject.call(t,"MongoMR",e,null,null,new IG$.callBackObj(t,(function(){t._ldc()})))},_edit:function(t){var e=this,n=new IG$.mongoJobEdt({instance:e.instance,titem:t,callback:new IG$.callBackObj(e,(function(){e._ldc()}))});IG$.checkLogin(e,n)},_exec:function(){var t=this.down("[name=g1]").getSelectionModel().selected;t&&t.items.length},initComponent:function(){this.title=IRm$.r1("L_MONGO_DPROC"),$s.apply(this,{items:[{xtype:"panel",region:"center",flex:1,title:IRm$.r1("L_MONGO_DPROC"),layout:"fit",tbar:[{iconCls:"icon-toolbar-add",text:IRm$.r1("B_ADD"),handler:function(){this._add()},scope:this},{iconCls:"icon-toolbar-refresh",text:IRm$.r1("L_REFRESH"),handler:function(){this._ldc()},scope:this},"-",{text:IRm$.r1("L_RUN"),handler:function(){this._exec()},scope:this}],items:[{xtype:"gridpanel",name:"g1",store:{xtype:"store",fields:[]},selType:"checkboxmodel",selModel:{mode:"MULTI",checkSelector:".x-grid-cell"},columns:[{text:IRm$.r1("B_NAME"),flex:1,tdCls:"igc-td-link",sortable:!1,hideable:!1,dataIndex:"name",xtype:"templatecolumn",renderer:function(t,e,n){var i=n.get("locale_name")||n.get("name");return n.get("locale_name")&&(i+="("+n.get("locale_name")+")"),i+="\n==>"+(n.get("nodepath")||""),"<span title='"+IG$.hEE(i)+"'>"+IG$.hEE(n.get("locale_name")||n.get("name"))+"</span>"+(n.data.attributes&&"T"==n.data.attributes.attrb1?"  <span class='db_writable'></span>":"")}},{text:IRm$.r1("B_OWNER"),width:120,dataIndex:"owner"},{text:IRm$.r1("B_MODI"),width:120,dataIndex:"modifier"},{text:IRm$.r1("B_LASTUPD"),width:150,dataIndex:"updatedatefm"},{xtype:"actioncolumn",width:60,items:[{iconCls:"icon-grid-dbicon",handler:function(t,e,n){var i=t.store.data.items[e];this._edit(i)},scope:this},{iconCls:"igc-share",tooltip:IRm$.r1("L_OBJECT_AUTH"),hidden:!1!==ig$.features.ig_n_oauth,handler:function(t,e,n){var i=t.store.data.items[e];this.openDSLayer("cmd_object_auth",i)},scope:this},{iconCls:"icon-grid-delete",tooltip:IRm$.r1("L_REMOVE"),handler:function(t,e,n){var i=t.store,o=i.getAt(e);IG$.deleteMetaObject(o.get("uid"),o,new IG$.callBackObj(this,(function(){i.removeAt(e)})))},scope:this}]}],listeners:{cellclick:function(t,e,n,i,o,a){1==n&&this._edit(i)},scope:this}}]}]}),IG$.mongoJobs.superclass.initComponent.call(this)},listeners:{afterrender:function(){this._ld()}}});
IG$.mongoJobAct=$s.extend($s.window,{width:650,height:580,layout:"fit",_init:function(){var t=this.ditem||{};this.setAllValues(t)},_confirm:function(t){var e=this,n=e.ditem||{};e.getAllValues(n)||(e.callback&&e.callback.execute(n),e.close())},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_DB_CON"),padding:ig$.padding,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:ig$.padding,autoScroll:!0,items:[{xtype:"fieldset",title:IRm$.r1("B_SOURCE"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("B_NAME"),required:!0,name:"name"},{xtype:"combobox",fieldLabel:IRm$.r1("L_ACTION"),required:!0,valueField:"value",displayField:"name",editable:!1,autoSelect:!0,name:"action_type",store:{data:[{name:"increment",value:"increment"},{name:"add",value:"add"}]}},{xtype:"textarea",fieldLabel:"Catalog",name:"catalog"}]}]}],buttons:[{xtype:"button",text:IRm$.r1("B_DELETE"),hidden:!this.dbinfo,handler:function(){this._confirm("delete")},scope:this},"->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm("confirm")},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}]}),IG$.mongoJobAct.superclass.initComponent.call(this)},listeners:{afterrender:function(t){t._init()}}}),IG$.mongoJobEdt=$s.extend($s.window,{width:650,height:580,layout:"fit",_init:function(){var t=this,e=t.titem,n=new IG$._rpc$;e&&(n.init(t,{ack:"content",payload:{uid:e.get("uid")},mbody:{option:""}},t,(function(e){t.titem_d=e;var n=e.content=e.content||{};t.setAllValues(n),n.sql_ds&&t.down("[name=ds_name]").setValue(n.sql_ds.name),t.down("[name=g1]").store.loadData(n.mr_actions)}),!1),n.send())},_confirm:function(t){var e,n,i,a=this,o=(a.titem,{}),l=a.down("[name=g1]"),s=a.titem_d;if(!a.getAllValues(o)){for(s.name=o.name,s.description=o.description,o.meta_type="MongoMR",o.mr_actions=e=[],a.sql_ds&&(o.sql_ds=a.sql_ds),n=0;n<l.store.data.items.length;n++)i=l.store.data.items[n],e.push({name:i.get("name"),action_type:i.get("action_type"),catalog:i.get("catalog")});var c=new IG$._rpc$;c.init(a,{ack:"writecontent",payload:{name:s.name,description:s.description,uid:s.uid},mbody:o,meta_type:"MongoMR"},a,(function(t){a.callback&&a.callback.execute(),a.close()})),c.send()}},_act:function(t){var e=t?t.data:null,n=this,i=n.down("[name=g1]"),a=new IG$.mongoJobAct({instance:n.instance,ditem:e,callback:new IG$.callBackObj(n,(function(e){t||i.store.add(e)}))});IG$.checkLogin(n,a)},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_DB_CON"),padding:ig$.padding,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:ig$.padding,autoScroll:!0,items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",required:!0,fieldLabel:IRm$.r1("B_NAME"),name:"name"},{xtype:"textarea",fieldLabel:IRm$.r1("B_DESC"),name:"description"}]},{xtype:"fieldset",title:IRm$.r1("B_SOURCE"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DS"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"ds_name",readOnly:!0,flex:1},{xtype:"button",text:"..",handler:function(){var t,e=this;t=new IG$.dlg_select_ds({instance:e.instance,sel_mode:1,callback:new IG$.callBackObj(e,(function(t){var e=this;e.sql_ds=t.data,e.down("[name=ds_name]").setValue(e.sql_ds.name)}))}),IG$.checkLogin(e,t)},scope:this}]},{xtype:"textarea",fieldLabel:IRm$.r1("B_SQL"),required:!0,name:"sql_query"}]},{xtype:"fieldset",title:IRm$.r1("B_TARGET"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"gridpanel",name:"g1",height:300,store:{xtype:"store",fields:[]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name"}],listeners:{cellclick:function(t,e,n,i,a,o){0==n&&this._act(i)},scope:this},tbar:[{iconCls:"icon-toolbar-add",text:IRm$.r1("B_ADD"),handler:function(){this._act()},scope:this},{iconCls:"icon-toolbar-remove",text:IRm$.r1("B_DELETE"),handler:function(){this._ldc()},scope:this},"-",{iconCls:"icon-toolbar-up",text:IRm$.r1("B_UP"),handler:function(){this._ldc()},scope:this},{iconCls:"icon-toolbar-down",text:IRm$.r1("B_DOWN"),handler:function(){this._ldc()},scope:this}]}]}]}],buttons:[{xtype:"button",text:IRm$.r1("B_DELETE"),hidden:!this.dbinfo,handler:function(){this._confirm("delete")},scope:this},"->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm("confirm")},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}]}),IG$.mongoJobEdt.superclass.initComponent.call(this)},listeners:{afterrender:function(t){t._init()}}});
IG$.dlg_select_ds||(IG$.dlg_select_ds=$s.extend($s.window,{width:500,height:520,layout:"fit",_init:function(){var e,t=this,l=new IG$._rpc$,i=t.datasource;i&&t.down("[name=opt_dbtype]").setValue("db"),l.init(t,{ack:"userdb",payload:{address:"/Connections",option:"list"},mbody:{}},t,(function(t){var l,n=t.children,d=this.down("[name=dsource]"),o=[];if(n&&n.length)for(l=0;l<n.length;l++)(1==this.sel_mode||n[l].attributes&&"T"==n[l].attributes.attrb1)&&(i&&i.uid==n[l].uid&&(e=n[l]),o.push(n[l]));if(d.store.loadData(o),e){var s=d.store._pull[e.id];s&&d.getSelectionModel().select(s,!0)}}),!1),l.send()},_confirm:function(e){var t=this,l=t.down("[name=dsource]"),i=t.down("[name=opt_dbtype]").getValue().cb_dbtype,n=e?null:l.getSelectionModel().selected;"db"==i||1==t.sel_mode?e?(t.callback&&t.callback.execute(e),t.close()):n&&n.length?(t.callback&&t.callback.execute(n.items[0]),t.close()):IG$.ShowError(IRm$.r1("E_SEL_DC"),t):(t.callback&&t.callback.execute(),t.close())},initComponent:function(){var e=this;$s.apply(e,{title:IRm$.r1("T_SEL_DB"),padding:ig$.padding,items:[{xtype:"panel",bodyPadding:ig$.padding,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("L_STORAGE_OPTIONS"),hidden:1==e.sel_mode,layout:{type:"vbox",align:"stretch"},items:[{xtype:"radiogroup",name:"opt_dbtype",fieldLabel:IRm$.r1("L_DATA_STORAGE"),plain:!0,items:[{boxLabel:IRm$.r1("L_USE_TEMP"),name:"cb_dbtype",inputValue:"h2",checked:!0},{boxLabel:IRm$.r1("L_USE_STG"),name:"cb_dbtype",inputValue:"db"}],listeners:{change:function(e,t,l){this.down("[name=mview]").setDisabled(!t||!t.cb_dbtype||"db"!=t.cb_dbtype)},scope:this}}]},{xtype:"fieldset",name:"mview",title:IRm$.r1("L_STAGING_DB"),flex:1,layout:{type:"vbox",align:"stretch"},disabled:1!=e.sel_mode,items:[{xtype:"gridpanel",name:"dsource",flex:1,selType:"checkboxmodel",selModel:{mode:"SINGLE",checkSelector:".x-grid-cell"},store:{fields:[]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",tdCls:"igc-td-link"},{text:IRm$.r1("B_DESC"),dataIndex:"description"}],listeners:{cellclick:function(e,t,l,i,n,d){var o=this,s=o.down("[name=opt_dbtype]").getValue();1!=o.sel_mode&&1==l&&(s&&"db"==s.cb_dbtype?o._confirm(i):IG$.ShowError(IRm$.r1("E_CHECK_DTYPE"),o))},scope:this}}]}]}],buttons:["->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){e._init()}}}),IG$.dlg_select_ds.superclass.initComponent.call(this)}}));