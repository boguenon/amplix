IG$.mongoJobs=$s.extend(IG$.v$pnl,{scroll:!1,closable:!0,layout:"border",iconCls:"icon-mgr-db",_ld:function(){var e="MongoJobs",t=new IG$._rpc$;t.init(this,{ack:"helpcontent",payload:{uid:"/"+e,name:e,type:"Folder",post:"create",duty:"everyone",mode:"s"},mbody:{option:"translate"}},this,(function(e){var t=e&&e.length?e[0].uid:null;t&&(this._tuid=t,this._ldc())})),t.send()},_ldc:function(){var e=this._tuid;if(e){var t=new IG$._rpc$;t.init(this,{ack:"content",payload:{uid:e},mbody:{option:""}},this,(function(e){var t=e?e.children:null;this.down("[name=g1]").store.loadData(t)}),!1),t.send()}},_add:function(){var e=this,t=e._tuid;t&&IG$._createMetaObject.call(e,"MongoMR",t,null,null,new IG$.callBackObj(e,(function(){e._ldc()})))},_edit:function(e){var t=this,n=new IG$.mongoJobEdt({instance:t.instance,titem:e,callback:new IG$.callBackObj(t,(function(){t._ldc()}))});IG$.checkLogin(t,n)},_exec:function(){var e=this,t=e.down("[name=g1]").getSelectionModel().selected;if(t&&t.items.length){var n=e.getRequests(t),i=new IG$.d$RegSch({instance:e.instance,objtype:"mongomr",req:n,callback:new IG$.callBackObj(e,(function(e){}))});IG$.checkLogin(e,i)}},getRequests:function(e){var t,n,i,o,a=[];for(t=0;t<e.items.length;t++)i={uid:(n=e.items[t]).get("uid"),name:n.get("name"),type:n.get("type")},o={option:"execute"},a.push({ack:"mapreduce",payload:i,mbody:o});return a},initComponent:function(){this.title=IRm$.r1("L_MONGO_DPROC"),$s.apply(this,{items:[{xtype:"panel",region:"center",flex:1,title:IRm$.r1("L_MONGO_DPROC"),layout:"fit",tbar:[{iconCls:"icon-toolbar-add",text:IRm$.r1("B_ADD"),handler:function(){this._add()},scope:this},{iconCls:"icon-toolbar-refresh",text:IRm$.r1("L_REFRESH"),handler:function(){this._ldc()},scope:this},"-",{text:IRm$.r1("L_RUN"),handler:function(){this._exec()},scope:this}],items:[{xtype:"gridpanel",name:"g1",store:{xtype:"store",fields:[]},selType:"checkboxmodel",selModel:{mode:"MULTI",checkSelector:".x-grid-cell"},columns:[{text:IRm$.r1("B_NAME"),flex:1,tdCls:"igc-td-link",sortable:!1,hideable:!1,dataIndex:"name",xtype:"templatecolumn",renderer:function(e,t,n){var i=n.get("locale_name")||n.get("name");return n.get("locale_name")&&(i+="("+n.get("locale_name")+")"),i+="\n==>"+(n.get("nodepath")||""),"<span title='"+IG$.hEE(i)+"'>"+IG$.hEE(n.get("locale_name")||n.get("name"))+"</span>"+(n.data.attributes&&"T"==n.data.attributes.attrb1?"  <span class='db_writable'></span>":"")}},{text:IRm$.r1("B_OWNER"),width:120,dataIndex:"owner"},{text:IRm$.r1("B_MODI"),width:120,dataIndex:"modifier"},{text:IRm$.r1("B_LASTUPD"),width:150,dataIndex:"updatedatefm"},{xtype:"actioncolumn",width:60,items:[{iconCls:"icon-grid-dbicon",handler:function(e,t,n){var i=e.store.data.items[t];this._edit(i)},scope:this},{iconCls:"igc-share",tooltip:IRm$.r1("L_OBJECT_AUTH"),hidden:!1!==ig$.features.ig_n_oauth,handler:function(e,t,n){var i=e.store.data.items[t];this.openDSLayer("cmd_object_auth",i)},scope:this},{iconCls:"icon-grid-delete",tooltip:IRm$.r1("L_REMOVE"),handler:function(e,t,n){var i=e.store,o=i.getAt(t);IG$.deleteMetaObject(o.get("uid"),o,new IG$.callBackObj(this,(function(){i.removeAt(t)})))},scope:this}]}],listeners:{cellclick:function(e,t,n,i,o,a){1==n&&this._edit(i)},scope:this}}]}]}),IG$.mongoJobs.superclass.initComponent.call(this)},listeners:{afterrender:function(){this._ld()}}});
IG$.mongoJobAct=$s.extend($s.window,{width:650,height:580,layout:"fit",_init:function(){var e=this.ditem||{};this.setAllValues(e)},_confirm:function(e){var t=this,n=t.ditem||{};t.getAllValues(n)||(t.callback&&t.callback.execute(n),t.close())},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_DB_CON"),padding:ig$.padding,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:ig$.padding,autoScroll:!0,items:[{xtype:"fieldset",title:IRm$.r1("L_MR_TGT"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("B_NAME"),required:!0,name:"name"},{xtype:"combobox",fieldLabel:IRm$.r1("B_ACTION"),required:!0,valueField:"value",displayField:"name",editable:!1,autoSelect:!0,name:"action_type",store:{data:[{name:"increment",value:"increment"},{name:"set",value:"set"},{name:"numeric add",value:"add"},{name:"array push",value:"push"},{name:"delete",value:"delete"}]}},{xtype:"textarea",fieldLabel:"Catalog",name:"catalog"}]}]}],buttons:[{xtype:"button",text:IRm$.r1("B_DELETE"),hidden:!this.dbinfo,handler:function(){this._confirm("delete")},scope:this},"->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm("confirm")},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}]}),IG$.mongoJobAct.superclass.initComponent.call(this)},listeners:{afterrender:function(e){e._init()}}}),IG$.mongoJobEdt=$s.extend($s.window,{width:650,height:580,layout:"fit",_init:function(){var e=this,t=e.titem,n=new IG$._rpc$;t&&(n.init(e,{ack:"content",payload:{uid:t.get("uid")},mbody:{option:""}},e,(function(t){e.titem_d=t;var n=t.content=t.content||{};e.setAllValues(n),n.sql_ds&&(e.down("[name=ds_name]").setValue(n.sql_ds.name),e.sql_ds=n.sql_ds),n.sql_dt&&(e.down("[name=dt_name]").setValue(n.sql_dt.name),e.sql_dt=n.sql_dt),e.down("[name=g1]").store.loadData(n.mr_actions)}),!1),n.send())},_confirm:function(e){var t,n,i,a=this,l=(a.titem,{}),o=a.down("[name=g1]"),s=a.titem_d;if(!a.getAllValues(l)){for(s.name=l.name,s.description=l.description,l.meta_type="MongoMR",l.mr_actions=t=[],a.sql_ds&&(l.sql_ds=a.sql_ds),a.sql_dt&&(l.sql_dt=a.sql_dt),n=0;n<o.store.data.items.length;n++)i=o.store.data.items[n],t.push({name:i.get("name"),action_type:i.get("action_type"),catalog:i.get("catalog")});var d=new IG$._rpc$;d.init(a,{ack:"writecontent",payload:{name:s.name,description:s.description,uid:s.uid},mbody:l,meta_type:"MongoMR"},a,(function(e){a.callback&&a.callback.execute(),a.close()})),d.send()}},_act:function(e){var t=e?e.data:null,n=this,i=n.down("[name=g1]"),a=new IG$.mongoJobAct({instance:n.instance,ditem:t,callback:new IG$.callBackObj(n,(function(t){e||i.store.add(t)}))});IG$.checkLogin(n,a)},_ldc:function(){var e=this.down("[name=g1]"),t=e.store,n=e.getSelectionModel().selected;n&&n.length&&IG$.confirmMessages(ig$.appname,IRm$.r1("M_CONFIRM_DELETE"),(function(e){"yes"==e&&t.remove(n.items[0])}))},_ldcm:function(e){var t=this.down("[name=g1]");IG$._moveG.call(this,t,e)},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_DB_CON"),padding:ig$.padding,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:ig$.padding,autoScroll:!0,items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",required:!0,fieldLabel:IRm$.r1("B_NAME"),name:"name"},{xtype:"textarea",fieldLabel:IRm$.r1("B_DESC"),name:"description"}]},{xtype:"fieldset",title:IRm$.r1("L_MR_SRC"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",fieldLabel:IRm$.r1("B_ACTION"),required:!0,valueField:"value",displayField:"name",editable:!1,autoSelect:!0,name:"source_type",store:{data:[{name:IRm$.r1("B_SELECT"),value:""},{name:"sql",value:"sql"},{name:"file",value:"file"}]},listeners:{change:function(e,t,n){var i=this;$.each(["sql","file"],(function(e,n){i.down("[name=src_"+n+"]").setVisible(n==t)}))},scope:this}},{xtype:"container",hidden:!0,name:"src_sql",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATASOURCE"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"ds_name",readOnly:!0,flex:1},{xtype:"button",text:"..",handler:function(){var e,t=this;e=new IG$.dlg_select_ds({instance:t.instance,sel_mode:1,callback:new IG$.callBackObj(t,(function(e){var t=this;t.sql_ds=e.data,t.down("[name=ds_name]").setValue(t.sql_ds.name)}))}),IG$.checkLogin(t,e)},scope:this}]},{xtype:"textarea",fieldLabel:IRm$.r1("B_SQL"),required:!0,name:"sql_query"}]},{xtype:"container",hidden:!0,name:"src_file",layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("L_TARGET_FOLDER"),name:"src_work_folder"},{xtype:"textfield",fieldLabel:IRm$.r1("L_FILENAME"),name:"src_filenames"}]}]},{xtype:"fieldset",title:IRm$.r1("L_MR_TGT"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATASOURCE"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"dt_name",readOnly:!0,flex:1},{xtype:"button",text:"..",handler:function(){var e,t=this;e=new IG$.dlg_select_ds({instance:t.instance,sel_mode:1,dbtype:"mongodb",callback:new IG$.callBackObj(t,(function(e){var t=this;t.sql_dt=e.data,t.down("[name=dt_name]").setValue(t.sql_dt.name)}))}),IG$.checkLogin(t,e)},scope:this}]},{xtype:"gridpanel",name:"g1",height:300,selType:"checkboxmodel",selModel:{mode:"MULTI",checkSelector:".x-grid-cell"},store:{xtype:"store",fields:[]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name"}],listeners:{cellclick:function(e,t,n,i,a,l){1==n&&this._act(i)},scope:this},tbar:[{iconCls:"icon-toolbar-add",text:IRm$.r1("B_ADD"),handler:function(){this._act()},scope:this},{iconCls:"icon-toolbar-remove",text:IRm$.r1("B_DELETE"),handler:function(){this._ldc()},scope:this},"-",{iconCls:"icon-toolbar-up",text:IRm$.r1("B_UP"),handler:function(){this._ldcm(-1)},scope:this},{iconCls:"icon-toolbar-down",text:IRm$.r1("B_DOWN"),handler:function(){this._ldcm(1)},scope:this}]}]}]}],buttons:[{xtype:"button",text:IRm$.r1("B_DELETE"),hidden:!this.dbinfo,handler:function(){this._confirm("delete")},scope:this},"->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm("confirm")},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}]}),IG$.mongoJobEdt.superclass.initComponent.call(this)},listeners:{afterrender:function(e){e._init()}}});
IG$.dlg_select_ds||(IG$.dlg_select_ds=$s.extend($s.window,{width:500,height:520,layout:"fit",_init:function(){var e,t=this,i=new IG$._rpc$,l=t.datasource;l&&t.down("[name=opt_dbtype]").setValue("db"),i.init(t,{ack:"userdb",payload:{address:"/Connections",option:"list"},mbody:{}},t,(function(t){var i,n,d=this,o=t.children,s=d.down("[name=dsource]"),a=d.dbtype,c=[];if(o&&o.length)for(i=0;i<o.length;i++)if(n=o[i],1==d.sel_mode||n.attributes&&"T"==n.attributes.attrb1){if(l&&l.uid==n.uid&&(e=n),a&&n.attributes&&n.attributes.attrb2!=a)continue;c.push(n)}(s.store.loadData(c),e)&&((n=s.store._pull[e.id])&&s.getSelectionModel().select(n,!0))}),!1),i.send()},_confirm:function(e){var t=this,i=t.down("[name=dsource]"),l=t.down("[name=opt_dbtype]").getValue().cb_dbtype,n=e?null:i.getSelectionModel().selected;"db"==l||1==t.sel_mode?e?(t.callback&&t.callback.execute(e),t.close()):n&&n.length?(t.callback&&t.callback.execute(n.items[0]),t.close()):IG$.ShowError(IRm$.r1("E_SEL_DC"),t):(t.callback&&t.callback.execute(),t.close())},initComponent:function(){var e=this;$s.apply(e,{title:IRm$.r1("T_SEL_DB"),padding:ig$.padding,items:[{xtype:"panel",bodyPadding:ig$.padding,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("L_STORAGE_OPTIONS"),hidden:1==e.sel_mode,layout:{type:"vbox",align:"stretch"},items:[{xtype:"radiogroup",name:"opt_dbtype",fieldLabel:IRm$.r1("L_DATA_STORAGE"),plain:!0,items:[{boxLabel:IRm$.r1("L_USE_TEMP"),name:"cb_dbtype",inputValue:"h2",checked:!0},{boxLabel:IRm$.r1("L_USE_STG"),name:"cb_dbtype",inputValue:"db"}],listeners:{change:function(e,t,i){this.down("[name=mview]").setDisabled(!t||!t.cb_dbtype||"db"!=t.cb_dbtype)},scope:this}}]},{xtype:"fieldset",name:"mview",title:IRm$.r1("L_STAGING_DB"),flex:1,layout:{type:"vbox",align:"stretch"},disabled:1!=e.sel_mode,items:[{xtype:"gridpanel",name:"dsource",flex:1,selType:"checkboxmodel",selModel:{mode:"SINGLE",checkSelector:".x-grid-cell"},store:{fields:[]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",tdCls:"igc-td-link"},{text:IRm$.r1("B_DESC"),dataIndex:"description"}],listeners:{cellclick:function(e,t,i,l,n,d){var o=this,s=o.down("[name=opt_dbtype]").getValue();1!=o.sel_mode&&1==i&&(s&&"db"==s.cb_dbtype?o._confirm(l):IG$.ShowError(IRm$.r1("E_CHECK_DTYPE"),o))},scope:this}}]}]}],buttons:["->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){e._init()}}}),IG$.dlg_select_ds.superclass.initComponent.call(this)}}));