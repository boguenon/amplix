IG$.mg_meta=$s.extend(IG$.v$pnl,{layout:"fit",_module:"com.amplix.migration.upgrade_v3.MetaMigration",autoScroll:!0,initapp:function(){var e=this,t=e.down("[name=d_file]").el.dom,i=$(".m_fileupload",t),o=e.down("[name=d_upfiles]");i.empty(),fileupload=$("<input type='file' name='files[]' data-url='upload' multiple></input>").appendTo(i),dropzone=$("<div class='filedropzone fade well'>Drop files here</div>").appendTo(i),d_progress=$("<div class='file-progress'><div class='bar' style='width: 0%;'></div></div>").appendTo(i),fileupload.fileupload({url:ig$.servlet,dataType:"json",done:function(t,i){var l,d,n,s,a=i.result||{errorcode:"0xffff",errormsg:"Server incorrect responding"},r=[];if(a.errorcode)IG$.ShowErrorMessage(a,e,null);else if(a.result)for(l=a.result.length?a.result:[a.result],d=0;d<l.length;d++)n=l[d],r.push(n);if(r&&r.length)for(o.show(),d=0;d<r.length;d++)s=o.store.add(r[d]),o.selModel.select(s,!0)},progressall:function(e,t){var i=parseInt(t.loaded/t.total*100,10),o=$(".bar",d_progress);o.css("width",i+"%"),o.text("Loaded "+t.loaded+" / "+t.total)},dropZone:dropzone}).bind("fileuploadsubmit",(function(e,t){})),fileupload.fileupload("option","url",ig$.servlet)},toolbarHandler:function(e){var t,i=this,o=i.down("[name=d_upfiles]"),l=i.down("[name=d_doc]"),d=[];switch(e){case"cmd_c_files":for(t=0;t<o.store.data.items.length;t++)d.push(o.store.data.items[t]);if(i.file_lists=d,!i.checkRequired())return;d.length&&(i.setLoading(!0),i.$imp_cnts=[],i.migrate_import());break;case"cmd_c_doc":var n=l.getSelectionModel().selected;if(i.doc_lists=d,!i.checkRequired())return;n&&n.length&&(i.setLoading(!0),i.execute_upgrade())}},checkRequired:function(){return!0},migrate_import:function(){var e=this;e.down("[name=d_upfiles]");if(e.file_lists&&e.file_lists.length){var t=e.file_lists.splice(0,1)[0],i=new IG$._rpc$;i.stoploading=!1,i.init(e,{ack:"migration",payload:{module:e._module},mbody:{option:"migrate_import",items:[t.data]},meta_type:"object"},e,(function(e){this.$imp_cnts=this.$imp_cnts.concat(e),this.migrate_import()})),i.send()}else{e.setLoading(!1);var o,l=e.down("[name=d_doc]"),d={5:"Missing",9:"Exists",10:"Node Exists"};for(o=0;o<e.$imp_cnts.length;o++)e.$imp_cnts[o].status_desc=d[e.$imp_cnts[o].status];l.store.loadData(e.$imp_cnts)}},execute_upgrade:function(){var e,t=this,i=t.down("[name=d_doc]"),o=t.down("[name=d_upfiles]"),l=i.getSelectionModel().selected,d=[],n=[];for(e=0;e<l.length;e++)s=l.items[e],n.push(s.get("uid"));for(e=0;e<o.store.data.items.length;e++)s=o.store.data.items[e],d.push(s.data);var s=t.file_lists.splice(0,1)[0],a=new IG$._rpc$;a.stoploading=!1,a.init(t,{ack:"migration",payload:{module:t._module},mbody:{option:"execute_migrate",files:d,selections:n},meta_type:"object"},t,(function(e){})),a.send()},initComponent:function(){$s.apply(this,{items:[{xtype:"container",padding:5,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Meta file upload",items:[{html:"<div class='m_fileupload'></div>",name:"d_file",height:120,bodyPadding:10},{name:"d_upfiles",xtype:"gridpanel",height:320,hidden:!0,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["uid","filename","fileext"]},columns:[{text:IRm$.r1("L_FILENAME"),dataIndex:"filename",flex:1},{text:IRm$.r1("L_FILEEXT"),dataIndex:"fileext",flex:1},{xtype:"actioncolumn",width:20,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,i){var o=e.store.getAt(t);e.store.remove(o)}}]}],bbar:["->",{xtype:"button",text:"Load Meta Informations",handler:function(){this.toolbarHandler("cmd_c_files")},scope:this},{xtype:"button",text:"Cancel All Files",handler:function(){var e=this.down("[name=d_upfiles]");e.store.removeAll(),e.hide(),this.down("[name=d_file]").hide()},scope:this}]}]},{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Backup Items",items:[{name:"d_doc",xtype:"gridpanel",height:500,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["name","id","description"]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",minWidth:180,flex:1},{text:"Node Path",dataIndex:"nodepath_name",minWidth:300,flex:1},{text:"Status",dataIndex:"status_desc",width:80},{text:IRm$.r1("B_DESC"),dataIndex:"description",minWidth:100,flex:1}],tbar:["->",{xtype:"button",text:"Migrate Selected Items",handler:function(){this.toolbarHandler("cmd_c_doc")},scope:this}]}]}]}]}),IG$.mg_meta.superclass.initComponent.call(this)},listeners:{afterrender:function(e){e.initapp()}}});
IG$.MgrManual=$s.extend(IG$.v$pnl,{layout:"fit",_init_app:function(){var e=this,t=e.down("[name=t_note_editor]");setTimeout((function(){var n=$("#manual_editor_main",t.body.dom).summernote({tabsize:4,maxHeight:t.getHeight()-80});e._note_editor=n}),100),e._load_menu()},_load_menu:function(){var e=this,t=new IG$._rpc$,n="en";"ko_KR"==(window.useLocale||"en_US")&&(n="ko"),e._lang=n,t.init(e,{ack:"manual",payload:{lang:n},mbody:{option:"menu"}},e,(function(t){var n=e.down("[name=menus]"),o={name:"Root",children:t.children||[]};n.store.setRootNode(o),n.store.getRootNode().expand(!0)}),!1),t.send()},_save_menus:function(){var e=this,t=e.down("[name=menus]").getRootNode(),n={name:"root",children:[]},o=e._lang,i=new IG$._rpc$;e._upd_menus(t.childNodes,n.children),i.init(e,{ack:"manual",payload:{option:"save_menu",lang:o},mbody:n,meta_type:"object"},e,(function(e){})),i.send()},_upd_menus:function(e,t){var n=this;e&&$.each(e,(function(e,o){var i={name:o.get("name"),dockey:o.get("dockey"),visible:o.get("visible")};t.push(i),o.childNodes&&o.childNodes.length&&(i.children=[],n._upd_menus(o.childNodes,i.children))}))},save_content:function(){var e,t=this,n=t._note_editor,o=new IG$._rpc$,i=t._lang;t._sel_content&&(e={html:n.summernote("code")},o.init(t,{ack:"manual",payload:{uid:t._sel_content.get("dockey"),lang:i,option:"save"},mbody:e,meta_type:"object"},t,(function(e){}),null),o.send())},_load_content:function(){var e=(t=this)._note_editor;if(t._sel_content){var t=this,n=new IG$._rpc$,o=t._lang;n.init(t,{ack:"manual",payload:{lang:o,uid:t._sel_content.get("dockey")},mbody:{option:"get"}},t,(function(t){t.html?e.summernote("code",t.html):e.summernote("code","")}),!1),n.send()}},initComponent:function(){var e=this;$s.apply(e,{items:[{xtype:"panel",layout:"border",split:!0,items:[{xtype:"panel",region:"north",width:350,height:420,layout:"fit",title:"Menu Structures",items:[{xtype:"treepanel",name:"menus",enableDragDrop:!0,enableDD:!0,useArrows:!0,ddGroup:"_I$RD_G_",store:{xtype:"treestore"},columns:[{xtype:"treecolumn",text:IRm$.r1("B_NAME"),dataIndex:"name",flex:1,editor:{xtype:"textfield"}},{xtype:"gridcolumn",dataIndex:"dockey",text:"KEY",editor:{xtype:"textfield"}},{xtype:"checkcolumn",dataIndex:"visible",text:"Visible",width:40},{xtype:"actioncolumn",width:60,items:[{iconCls:"icon-grid-delete",tooltip:IRm$.r1("L_REMOVE"),handler:function(e,t,n,o){o.parentNode.removeChild(o)},scope:this}]}],tbar:[{text:"Save",name:"btn_save",iconCls:"icon-toolbar-save",handler:function(){this._save_menus()},scope:this},{text:"Add",handler:function(){var e,t=this.down("[name=menus]").getSelectionModel().selected,n=0;t&&t.length&&((e=t.items[0]).childNodes&&e.childNodes.length&&(n=e.childNodes.length),e.insertChild(n,{}))},scope:this}],listeners:{cellclick:function(e,t,n,o,i,a){0==n&&o.childNodes&&o.childNodes.length&&o.expand(!0),this._sel_content=o,this._load_content()},scope:this}}]},{xtype:"panel",region:"center",flex:1,title:"Manual Content Editor",layout:"fit",items:[{name:"t_note_editor",html:"<div id='manual_editor_main'></div>"}],tbar:[{text:"Save",handler:function(){this.save_content()},scope:this},{text:"Refresh",handler:function(){e._sel_content&&this._load_content()},scope:this}]}]}]}),IG$.MgrManual.superclass.initComponent.call(this)},listeners:{afterrender:function(){this._init_app()}}});