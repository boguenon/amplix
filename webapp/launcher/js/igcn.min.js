IG$.$expr=$s.extend($s.window,{modal:!0,layout:"fit",closable:!1,resizable:!1,width:500,autoHeight:!0,init_view:function(){var e,t;for(e=0;e<10;e++)(t=this.down("[name=op"+(e+1)+"]"))&&t.addEventListener("click",(function(){}))},commit_f:function(){this.validate_expression()&&(this.callback&&this.callback.execute(),this.close())},validate_expression:function(){return 0},initComponent:function(){$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},items:[{xtype:"tabpanel",flex:1,items:[{xtype:"treepanel",title:IRm$.r1("L_FIELDS"),store:{fields:["name","value"]}},{xtype:"treepanel",title:IRm$.r1("L_FUNCTIONS"),store:{fields:["name","value"]}}]},{xtype:"textarea",hidezoom:!0,name:"expression",flex:1,tbar:[{text:"+",name:"op1"},{text:"-",name:"op2"},{text:"*",name:"op3"},{text:"/",name:"op4"},{text:"%",name:"op5"},{text:"()",name:"op6"},{text:"//(comment)",name:"op7"},{xtype:"combobox",width:50,store:{fields:["name","value"]}}]}]}],buttons:[{text:IRm$.r1("L_VALIDATE"),handler:function(){this.validate_expression()},scope:this},{text:IRm$.r1("B_CONFIRM"),handler:function(){this.commit_f()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.init_view()},scope:this}}),IG$.$expr.superclass.initComponent.call(this)}});
IG$.datemetric=$s.extend($s.window,{modal:!1,region:"center",closable:!1,resizable:!1,width:580,height:480,callback:null,init_f:function(){var e,t=this,a=t.down("[name=datediv]");for(t.setTitle(IRm$.r1("T_DM")+(t.name?" ("+t.name+")":"")),IG$.datemetric._datetypes||(IG$.datemetric._datetypes=[{label:IRm$.r1("B_YEAR"),name:"YYYY"},{label:IRm$.r1("B_QUARTER"),name:"QUARTER"},{label:IRm$.r1("B_MONTH"),name:"MM"},{label:IRm$.r1("B_DAY"),name:"DD"},{label:IRm$.r1("B_WEEKMONTH"),name:"WM"},{label:IRm$.r1("B_WEEK"),name:"WEEK"},{label:IRm$.r1("B_AMPM"),name:"AMPM"},{label:IRm$.r1("B_HOUR"),name:"HH"},{label:IRm$.r1("B_MINUTE"),name:"MI"}]),t.datetypes=[],e=0;e<IG$.datemetric._datetypes.length;e++)t.datetypes.push({name:IG$.datemetric._datetypes[e].name,label:IG$.datemetric._datetypes[e].label});a.store.loadData(t.datetypes),t.uid?t.procLoadContent():t.rs_procLoadContent({content:{meta_type:"date_dimension"}})},procLoadContent:function(){var e=new IG$._rpc$;e.init(this,{ack:"content",payload:{uid:this.uid},mbody:{option:"diagnostics"}},this,this.rs_procLoadContent,null),e.send()},rs_procLoadContent:function(e){var t,a,n=this;n.down("[name=itemname]").setValue(e.name),n.down("[name=description]").setValue(e.description),a=(t=n.mobj=e.content).rel_items,n.down("[name=rg_dateformatting]").setValue({dateformatting:t.issql?"sqlfunc":"formatting"}),n.down("[name=dateformat]").setValue(t.dateformat||""),n.down("[name=fieldname]").setValue(a&&a.length?a[0].name:""),t.cubeuid?n.uid&&n.loadSubCnt():n.getCubeInfo()},getCubeInfo:function(){var e=this;IG$.getParentCube.call(e,e.uid,e.parentuid,new IG$.callBackObj(e,(function(t){e.rs_getCubeInfo(t)})))},rs_getCubeInfo:function(e){var t=e&&e.length?e[0]:null;this.mobj.cubeuid=t.uid,this.uid&&this.loadSubCnt()},loadSubCnt:function(){var e=new IG$._rpc$;e.init(this,{ack:"content",payload:{uid:this.uid},mbody:{subfolder:"T",itemtype:"CustomMetric",readcontent:"T"}},this,this.rs_loadSubCnt,null),e.send()},rs_loadSubCnt:function(e){var t,a,n,i,o=e.children||[],d=(this.mobj,this.down("[name=datediv]")),l=d.getSelectionModel(),m={};for(l.clear(),t=0;t<o.length;t++)o[t],(a=o[t].content)&&(m[a.datedivision]=a,"CUSTOM"==a.datedivision&&this.down("[name=customdatetype]").setValue(a.customdatetype));for(this.custominfo=m,t=0;t<d.store.data.items.length;t++)(i=m[(n=d.store.data.items[t]).get("name")])&&(l.select(n,!0),n.set("itemname",i.name),n.set("syntax",i.expression))},closedlg:function(){this.close(),this.callback&&this.callback.execute()},_confirm:function(){var e=this,t=e.down("[name=fieldname]");if(t.clearInvalid(),e.mobj)if(t.getValue()){if(IG$.checkFields(e,["itemname"])){e.mobj.name=e.down("[name=itemname]").getValue(),e.mobj.description=e.down("[name=description]").getValue();var a=e.down("[name=dateformat]"),n=e.down("[name=dateformatting]"),i=(a=e.down("[name=dateformat]"),"sqlfunc"==n.getGroupValue()),o=e.mobj;if(o.issql=i,o.dateformat=a.getValue(),o.database_type="auto",a.clearInvalid(),i||o.dateformat){var d=new IG$._rpc$;e.setLoading(!0),d.init(e,{ack:"writecontent",payload:{uid:e.uid,pid:e.parentuid,name:o.name,description:o.description,type:e.itemtype||o.type,nodepath:e.parentnodepath?e.parentnodepath+"/"+o.name:null},mbody:o,meta_type:"date_dimension"},e,e.rs_writeCnt),d.send()}else a.markInvalid(IRm$.r1("B_REQ"))}}else t.markInvalid(IRm$.r1("B_REQ"))},rs_writeCnt:function(e){var t,a,n,i,o=this,d=IG$.majorDateformat,l=(o.down("[name=dateformat]"),o.down("[name=datediv]")),m={},s=[],r=[],c=0,u=o.mobj,p=o.custominfo,f="sqlfunc"==o.down("[name=dateformatting]").getGroupValue();for(o.uid||(o.uid=e.uid),p=o.custominfo=o.custominfo||{},n=0;n<d.length;n++)d[n].rname=d[n].rname||d[n].name,d[n].dname=IRm$.r1("B_"+d[n].rname);for(n=0;n<l.store.data.items.length;n++)m[l.store.data.items[n].get("name")]=l.store.data.items[n];for(n=0;n<d.length;n++)t=d[n].name,a=d[n].dname||t,cdatetype="",m[t]&&m[t].get("checked")?(i=p[t],a=m[t].get("itemname")||i&&i.name||a,"CUSTOM"==t&&(cdatetype=o.down("[name=customdatetype]").getValue()),s.push({uid:i&&i.uid?i.uid:u.nodepath+"/"+a,pid:o.uid,name:a,type:"CustomMetric",meta_type:"custom_dimension",overwrite:"T"}),i={uid:i&&i.uid?i.uid:u.nodepath+"/"+a,pid:o.uid,name:a,type:"CustomMetric",meta_type:"custom_dimension",rel_items:[]},r.push(i),u.rel_items&&u.rel_items.length?i.rel_items.push({uid:u.rel_items[0].uid,name:u.rel_items[0].name,nodepath:u.rel_items[0].nodepath||"",type:"Metric"}):i.rel_items.push({uid:u.uid,name:u.name,nodepath:u.nodepath,type:u.type}),$s.defaults(i,{datedivision:t.toUpperCase(),dateformat:u.dateformat,predefinetype:1==f?"DATE":"",custom_type:1==f?"CUSTOM_FIELD":"PREDEFINED_FIELD",customdatetype:cdatetype,sorttype:"NUMBER",meta_type:"custom_dimension"}),m[t].set("itemname",i.name),f&&(i.expression=o.getCustExpr(t),m[t].set("syntax",i.expression)),c++):p[t]&&(i=p[t],s.push({uid:i.uid,name:i.name,nodepath:i.nodepath,option:"delete"}),r.push({}),c++);if(c>0){var h=new IG$._rpc$;h.init(o,{ack:"batchcontent",payload:s,mbody:{items:r}},o,o.rs_updateDateCnt),h.send()}else o.setLoading(!1),o.close()},rs_updateDateCnt:function(e){var t=this;t.setLoading(!1),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success"),t.callback&&t.callback.execute(t.mobj),t.close()},getCustExpr:function(e){var t="",a=e.toLowerCase(),n=IG$.sqlDateFormat,i=this.down("[name=dateformat]").getValue(),o="";return n&&n[a]&&(t=n[a],o="["+this.mobj.rel_items[0].name+"]","EPOCH"==i&&(o="FROM_UNIXTIME("+o+")"),t=t.replace(/_date_/g,o)),t},selectField:function(){var e=this,t=e.mobj,a=new IG$.metaSelectDlg({instance:e.instance,visibleItems:"folder;metric;table;custommetric;measuregroupdimension",tree_options:{cubebrowse:!0,rootuid:t.cubeuid},callback:new IG$.callBackObj(e,e.cubeSelectedHandler)});IG$.checkLogin(e,a)},cubeSelectedHandler:function(e){this.mobj.rel_items=[{uid:e.uid,name:e.name}],this.down("[name=fieldname]").setValue(e.name)},initComponent:function(){var e=this;e.title=IRm$.r1("T_DM"),$s.apply(this,{layout:"fit",items:[{xtype:"panel",layout:"fit",border:0,padding:10,autoScroll:!0,items:[{xtype:"panel",padding:10,border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME"),required:!0},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC")}]},{xtype:"fieldset",title:IRm$.r1("L_DATE_TYPE"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"radiogroup",name:"rg_dateformatting",fieldLabel:"",vertical:!0,items:[{boxLabel:IRm$.r1("L_DATE_FORMATTING"),name:"dateformatting",inputValue:"formatting"},{boxLabel:IRm$.r1("L_SQL_FUNC"),name:"dateformatting",inputValue:"sqlfunc"}]}]},{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},title:IRm$.r1("L_INPUT_FORMAT"),items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:IRm$.r1("L_DATE_METRIC"),items:[{xtype:"textfield",name:"fieldname",emptyText:IRm$.r1("M_SEL_ITEM"),flex:1,readOnly:!0},{xtype:"button",name:"btn_search",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectField()},scope:this}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATE_FORMAT"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"dateformat",flex:1},{xtype:"button",text:IRm$.r1("B_EXAMPLE"),handler:function(){var e="sqlfunc"==this.down("[name=dateformatting]").getGroupValue();IG$.show_tmpl_hlp(this,"dateformat","dateformat",e)},scope:this}]},{xtype:"container",fieldLabel:IRm$.r1("L_GROUP_LEVEL"),name:"datedivision",layout:{type:"vbox",align:"stretch"},defaults:{border:0},border:0,items:[{xtype:"gridpanel",name:"datediv",store:{fields:["name","label"]},selType:"checkboxmodel",selModel:{mode:"MULTI"},plugins:[{ptype:"cellediting",clicksToEdit:!1}],height:230,columns:[{text:IRm$.r1("B_NAME"),dataIndex:"label",tdCls:"igc-td-link",flex:1},{text:IRm$.r1("B_ITEMNAME"),dataIndex:"itemname",editor:{allowBlank:!1},flex:1},{text:IRm$.r1("L_SYNTAX"),dataIndex:"syntax",editor:{allowBlank:!1},flex:1}],listeners:{cellclick:function(e,t,a,n,i,o){if(1==a){var d,l=this.instance,m=this.custominfo;if(m&&m[n.get("name")]&&(d=m[n.get("name")]).uid){var s=l.mainPanel,r=d.type.toLowerCase();s&&d.writable&&s.navigateApp.call(s,d.uid,r,d.name,d.nodepath,!0,d.writable)}}},scope:this}}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("B_CUSTOM"),name:"customdatetypecontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"customdatetype"},{xtype:"button",text:IRm$.r1("B_EXAMPLE"),handler:function(){IG$.show_tmpl_hlp(this,"dateformat","dateformat",!1)},scope:this}]}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.init_f()},scope:this}}),IG$.datemetric.superclass.initComponent.apply(this,arguments)}});
IG$.customMetricInner=$s.extend($s.formpanel,{bodyBorder:!1,layout:"fit",loadedItem:{},changeDateFormat:function(){var e=this.down("[name=optdateformat]"),t=this.down("[name=dateformat]"),a=e.getValue();t.setValue(a)},_upd_ui:function(e){var t,a=1;if(e){switch(e){case"CUSTOM_FIELD":a=1;break;case"GROUP_FIELD":a=2;break;case"PREDEFINED_FIELD":a=3,this.updateDateFormat();break;case"GEO_FIELD":a=4;break;case"RANGE_FIELD":a=5;break;case"LINK_FIELD":a=6;break;case"PARENT_CHILD_NODES":a=7;break;case"SUB_QUERY":a=8}for(t=1;t<9;t++)this.down("[name=pconfig"+t+"]")[t==a||6==a&&1==t||8==a&&1==t?"show":"hide"]()}},init_f:function(){var e=this,t=e.dmode,a=new IG$._rpc$,n=e.down("[name=optdateformat]"),l=e.down("[name=custom_type]");n.on("change",(function(t,a,n,l){e.changeDateFormat.call(e)})),l.on("change",(function(t,a,n){var l=e.down("[name=custom_type]").getValue();e._upd_ui(l)})),t?(e.dmode_cnt.meta_type="custom_dimension",e.rs_procLoadContent({content:e.dmode_cnt})):e.uid?(a.init(e,{ack:"content",payload:{uid:e.uid},mbody:{option:"diagnostics"}},e,e.rs_procLoadContent,null),a.send()):e.parentuid&&(a.init(e,{ack:"helpcontent",payload:{uid:e.parentuid},mbody:{option:"cube_style_info"}},e,(function(t){e.rs_procLoadContent({writable:!0,content:{writable:!0,cubeinfo:t,meta_type:"custom_dimension"}})}),null),a.send())},rs_procLoadContent:function(e){var t=this,a=[],n=e.content,l=n.cubeinfo,i=t.down("[name=optsortdir]"),o=t.down("[name=optsorttype]"),d=t.down("[name=optstyle]");l||(l=n.cubeinfo={app_style:{default_styles:[],custom_styles:[]}}),t.clItem=n,t.wd&&t.wd.down("[name=b_confirm]")&&t.wd.down("[name=b_confirm]").setVisible(n.writable||t.dmode),t.down("[name=itemname]").setValue(n.name),t.down("[name=description]").setValue(n.description),i.setValue({cb_sortdir:[n.sortorder||""]}),o.setValue({cb_sorttype:[n.sorttype||""]}),t.down("[name=optremoveblank]").setValue(n.removeblank),t.down("[name=isdatetype]").setValue(n.isdatetype),t.down("[name=dateformat]").setValue(n.dateformat),t.down("[name=opt_dateformat]").setValue(n.dateformat),t.down("[name=t_dateformat]").setValue(n.datecustom),n.rel_items=n.rel_items||[],n.grouping=n.grouping||{},n.link_option=n.link_option||{},$s.defaults(n.grouping,{groupmin:0,groupmax:0,stepinterval:10,groupminlabel:"Under %MIN",groupmaxlabel:"Over %MAX",grouplabel:"%MIN - %MAX",groupformat:"#,###"}),$s.defaults(n.link_option,{l_tp:"DRILL",l_nm:null,l_elnk:null,l_elnk_tgt:null,l_rpt_name:null,l_rpt_uid:null,l_rpt_tmpl:null}),a.push({disp:"--- select ---",name:"",type:""}),t.styles=a,l=n.cubeinfo,delete n.cubeinfo,$.each([{arr:l.app_style.default_styles,n:"appbase"},{arr:l.app_style.custom_styles,n:"appcustom"},{arr:l.cube_style?l.cube_style.custom_styles:null,n:"cubecustom"}],(function(e,t){var n,l,i=t.arr;if(i)for(n=0;n<i.length;n++)l=i[n],a.push({disp:l.name,name:l.name,type:t.n})})),d.store.loadData(a),d.setValue(n.stylename||""),t.dmode?t.rs_getParentcube():t.getParentCube(),n.link_option.l_rpt_uid&&t.loadTemplate(n.link_option.l_rpt_uid)},loadTemplate:function(e){var t=this.clItem,a=new IG$._rpc$;a.init(this,{ack:"content",payload:{uid:e},mbody:{option:"diagnostics"}},this,(function(e){var a,n,l=e.content&&e.content.export_option?e.content.export_option.otmpl:null,i=this.down("[name=l_rpt_tmpl]"),o=[{disp:"Select Item",seq:""}];if(l)for(a=0;a<l.length;a++)(n=l[a]).disp=n.name+(n.description?"-"+n.description+" ":" ")+(n.export_type?"("+n.export_type+")":""),n.seq=""+a,o.push(n);i.store.loadData(o),i.setValue(t&&t.link_option&&t.link_option.l_rpt_tmpl||"")}),null),a.send()},updateDateFormat:function(){var e=this,t=e.clItem?e.clItem.fields:null,a=e.down("[name=custom_type]").getValue(),n=new IG$._rpc$;t&&t.length>0&&a&&"PREDEFINED_FIELD"==a&&(e.loadedItem&&e.loadedItem[t[0].uid]?e.applyDateFormat(e.loadedItem[t[0].uid]):(n.init(e,{ack:"content",payload:{uid:t[0].uid,type:t[0].type,nodepath:t[0].nodepath},mbody:{}},e,e.rs_updateDateFormat,null),n.send()))},rs_updateDateFormat:function(e){var t,a;e&&(a=e.uid,t=e.content.dateformat,this.loadedItem[a]={uid:a,dateformat:t},this.applyDateFormat(this.loadedItem[a]))},applyDateFormat:function(e){var t=this.down("[name=dateformat]"),a=t.getValue();""==e.dateformat||""!=a&&a==e.dateformat||t.setValue(e.dateformat)},getParentCube:function(){var e=this;IG$.getParentCube.call(e,e.uid,e.parentuid,new IG$.callBackObj(e,(function(t){e.rs_getParentcube(t)})))},rs_getParentcube:function(e){var t,a=this,n=e&&e.length?e[0]:null,l=a.clItem;n&&(a.cubeuid=n.uid),a.down("[name=custom_type]").setValue(l.custom_type||"CUSTOM_FIELD"),IG$.setFieldValue(a,"expression","s",l.expression||""),IG$.setFieldValue(a,"datagrid","dg",l.rel_items),IG$.setFieldValue(a,"groupfielditem","s",l.rel_items.length>0?l.rel_items[0].name:""),IG$.setFieldValue(a,"predefinefield","s",l.rel_items.length>0?l.rel_items[0].name:""),IG$.setFieldValue(a,"rangefield","s",l.rel_items.length>0?l.rel_items[0].name:""),IG$.setFieldValue(a,"dim_child","s",l.rel_items.length>0?l.rel_items[0].name:"");var i,o=a.down("[name=dateformat]"),d=a.down("[name=optdateformat]"),r=a.down("[name=datedivision]"),m=a.down("[name=customdatetype]"),s=a.down("[name=othergroupvalue]"),p=a.down("[name=groupdatagrid]"),u=[];if(l.groupfilter&&l.groupfilter.children){for(t=0;t<l.groupfilter.children.length;t++)i=l.groupfilter.children[t],u.push({name:i.name,values:i.values,operator:i.operator});p.store.loadData(u)}d.setValue(l.dateformat||""),o.setValue(l.dateformat||""),a.down("[name=opt_dateformat]").setValue(l.dateformat),r.setValue({datediv:l.datedivision}),m.setValue(l.customdatetype||""),s.setValue(l.othergroupvalue),a.down("[name=geolat]").setValue(l.geolat?l.geolat.name:""),a.down("[name=geolng]").setValue(l.geolng?l.geolng.name:""),a.down("[name=cmap_disp]").setValue(l.cmap_disp||""),a.down("[name=dim_parent]").setValue(l.dim_parent?l.dim_parent.name:""),a.down("[name=dim_disp]").setValue(l.dim_disp?l.dim_disp.name:""),a.f_="groupmin;groupmax;stepinterval;groupminlabel;groupmaxlabel;grouplabel;groupformat".split(";"),$.each(a.f_,(function(e,t){a.down("[name="+t+"]").setValue(l.grouping[t])})),l.link_option&&$.each(["l_tp","l_nm","l_nm_dim","l_rpt_tmpl","l_elnk","l_elnk_tgt","l_rpt_name","l_rpt_uid"],(function(e,t){a.down("[name="+t+"]").setValue(l.link_option[t])})),a.down("[name=l_par_option]").setValue(l.l_par_option),a.down("[name=l_par_disp_option]").setValue(l.l_par_disp_option)},_confirm:function(){var e,t,a,n,l,i=this,o=i.clItem,d=i.down("[name=groupdatagrid]"),r=i.down("[name=datagrid]"),m=d.store;if(IG$.checkFields(i,["itemname"])){var s=i.down("[name=cb_sortdir]").getGroupValue(),p=(i.down("[name=cb_sorttype]"),i.down("[name=cb_sorttype]").getGroupValue());for(o.name=i.down("[name=itemname]").getValue(),o.description=i.down("[name=description]").getValue(),o.sortorder=""==s?null:s,o.sorttype=""==p?null:p,o.expression=i.down("[name=expression]").getValue(),o.custom_type=i.down("[name=custom_type]").getValue(),o.dateformat=i.down("[name=dateformat]").getValue(),o.datedivision=i.down("[name=datedivision]").getValue().datediv,o.othergroupvalue=i.down("[name=othergroupvalue]").getValue(),o.customdatetype=i.down("[name=customdatetype]").getValue(),o.stylename=i.down("[name=optstyle]").getValue(),o.removeblank=i.down("[name=optremoveblank]").getValue(),o.isdatetype=i.down("[name=isdatetype]").getValue(),"PREDEFINED_FIELD"!=o.custom_type&&(o.datecustom=i.down("[name=t_dateformat]").getValue(),o.dateformat=i.down("[name=opt_dateformat]").getValue()),o.groupfilter={ftype:"group",children:[]},e=0;e<m.data.items.length;e++)(a={ftype:"condition",name:(t=m.data.items[e]).get("name"),values:[]}).operator=t.get("operator"),a.values=t.data.values,o.groupfilter.children.push(a);if("CUSTOM_FIELD"==o.custom_type||"LINK_FIELD"==o.custom_type)for(o.rel_items=[],e=0;e<r.store.data.items.length;e++)l={uid:(n=r.store.data.items[e].data).uid,name:n.name,nodepath:n.nodepath,memo:n.memo,type:n.type},o.rel_items.push(l);$.each(i.f_,(function(e,t){var a=i.down("[name="+t+"]");o.grouping[t]=a.getValue()})),i.clItem.link_option=i.clItem.link_option||{},$.each(["l_tp","l_nm","l_nm_dim","l_rpt_tmpl","l_elnk","l_elnk_tgt","l_rpt_name","l_rpt_uid"],(function(e,t){var a=i.down("[name="+t+"]");o.link_option[t]=a.getValue()})),o.l_par_option=i.down("[name=l_par_option]").getValue(),o.l_par_disp_option=i.down("[name=l_par_disp_option]").getValue(),i.dmode?(i.callback&&i.callback.execute(i.clItem),i.wd.closedlg.call(i.wd)):i.saveContent(i.uid,o)}},saveContent:function(e,t){var a=this,n=new IG$._rpc$;n.init(a,{ack:"writecontent",payload:{uid:a.uid,pid:a.parentuid,name:t.name,description:t.description,type:a.itemtype,nodepath:a.parentnodepath?a.parentnodepath+"/"+t.name:null},mbody:t,meta_type:"custom_dimension"},a,a.rs_saveContent,null),n.send()},rs_saveContent:function(e){var t=this;IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success"),t.wd.callback&&t.wd.callback.execute(t.clItem),t.wd.closedlg.call(t.wd)},selectItem:function(e){var t=this,a=new IG$.metaSelectDlg({instance:t.instance,multiselect:"customfield"==e?1:0,visibleItems:"codemap"==e?"folder;codemap":"userdb;table;dataset;inlineview;metric;custommetric",tree_options:{cubebrowse:!0,rootuid:"codemap"==e?"/SYS_Lookup":t.cubeuid},callback:new IG$.callBackObj(t,t.cubeSelectedHandler,e)});IG$.checkLogin(t,a)},selectReport:function(e){var t=new IG$.metaSelectDlg({instance:this.instance,multiselect:0,visibleItems:"folder;report",tree_options:{rootuid:null},callback:new IG$.callBackObj(this,(function(t){"l_rpt"==e&&(this.down("[name=l_rpt_uid]").setValue(t.uid),this.down("[name=l_rpt_name]").setValue(t.name),this.loadTemplate(t.uid))}))});IG$.checkLogin(this,t)},cubeSelectedHandler:function(e,t){var a=this,n="customfield"==t?null:e,l=a.clItem;if("geolat"==t||"geolng"==t)"geolat"==t?(l.geolat={uid:n.uid,name:n.name},a.down("[name=geolat]").setValue(n.name)):"geolng"==t&&(l.geolng={uid:n.uid,name:n.name},a.down("[name=geolng]").setValue(n.name));else if("customfield"==t){var i=a.down("[name=datagrid]");$.each(e,(function(e,t){var a,n=!1;for(a=0;a<i.store.data.items.length;a++)if(i.store.data.items[a].get("uid")==t.uid){n=!0;break}0==n&&i.store.add(t)}))}else"codemap"==t?(l.cmap_uid=n.uid,l.cmap_disp=n.name,a.down("[name=cmap_disp]").setValue(n.name)):"dim_parent"==t?(l.dim_parent=n,a.down("[name=dim_parent]").setValue(n.name)):"dim_disp"==t?(l.dim_disp=n,a.down("[name=dim_disp]").setValue(n.name)):(l.rel_items=[n],IG$.setFieldValue(a,t,"s",n.name),a.updateDateFormat())},addBlankCondition:function(){this.down("[name=groupdatagrid]").store.add({})},editFilter:function(e,t){var a=this.clItem;if(a.rel_items.length>0){var n=a.rel_items[0];new IG$.valueSelectWindow({field:n,callback:new IG$.callBackObj(this,this.rs_editFilter,[e,t])}).show()}},rs_editFilter:function(e,t){var a,n=t[0],l=t[1],i="";for(n.values=e,a=0;a<e.length;a++)i+=0==a?e[a].text||e[a].code:", "+(e[a].text||e[a].code);l.set("value",i)},editorItemName:function(e){var t=this.down("[name=expression]");IG$._inpEdt$(t,e)},initComponent:function(){var e=this;$s.apply(this,{padding:5,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:5,items:[{xtype:"tabpanel",autoScroll:!0,items:[{xtype:"form",layout:{type:"vbox",align:"stretch"},title:IRm$.r1("B_GENERAL"),autoScroll:!0,bodyStyle:"padding: 5px",items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME"),required:!0},{xtype:"textarea",name:"description",height:60,fieldLabel:IRm$.r1("B_DESC")},{name:"custom_type",xtype:"combobox",fieldLabel:IRm$.r1("B_TYPE"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,hidden:ig$.$l_>5,store:{xtype:"store",fields:["name","value"],data:[{name:IRm$.r1("L_CUSTOM_FIELD"),value:"CUSTOM_FIELD"},{name:IRm$.r1("L_GROUP_FIELD"),value:"GROUP_FIELD"},{name:IRm$.r1("L_PREDEFINED_FIELD"),value:"PREDEFINED_FIELD"},{name:IRm$.r1("L_GEO_FIELD"),value:"GEO_FIELD"},{name:IRm$.r1("L_RANGE_FIELD"),value:"RANGE_FIELD"},{name:IRm$.r1("L_LINK_FIELD"),value:"LINK_FIELD"},{name:IRm$.r1("L_PARENT_CHILD_NODES"),value:"PARENT_CHILD_NODES"},{name:IRm$.r1("L_SUB_QUERY"),value:"SUB_QUERY"}]}}]},{xtype:"fieldset",title:IRm$.r1("L_LINK_OPTION"),name:"pconfig6",layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",name:"l_tp",fieldLabel:IRm$.r1("L_LNK_TP"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:IRm$.r1("L_LNK_DRILL"),value:"DRILL"},{name:IRm$.r1("L_LNK_DOC"),value:"DOC"},{name:IRm$.r1("L_LNK_EXT"),value:"EXTERNAL"}]},listeners:{change:function(e){var t=this,a=(t.down("[name=l_nm]"),t.down("[name=l_tr]")),n=t.down("[name=l_elnk]"),l=t.down("[name=l_elnk_tgt]"),i=t.down("[name=l_rpt_tmpl]"),o=e.getValue(),d="EXTERNAL"==o;a.setVisible(!d),i.setVisible("DOC"==o),n.setVisible(d),l.setVisible(d)},scope:this}},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"l_nm",flex:1,fieldLabel:IRm$.r1("L_DISP_NAME")},{xtype:"checkbox",name:"l_nm_dim",labelWidth:10,width:140,boxLabel:IRm$.r1("L_USE_EXPRESSION"),listeners:{change:function(e){var t=e.getValue();this.down("[name=l_nm]").setDisabled(t)},scope:this}}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_TARGET_REPORT"),name:"l_tr",hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",hidden:!0,name:"l_rpt_uid"},{xtype:"textfield",name:"l_rpt_name",flex:1},{xtype:"button",name:"..",handler:function(){this.selectReport("l_rpt")},scope:this}]},{xtype:"combobox",name:"l_rpt_tmpl",fieldLabel:IRm$.r1("L_LNK_TMPL"),queryMode:"local",displayField:"disp",valueField:"seq",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["disp","seq"]}},{xtype:"textfield",name:"l_elnk_tgt",fieldLabel:IRm$.r1("L_LNK_TGT"),hidden:!0},{xtype:"textarea",fieldLabel:IRm$.r1("L_LNK_URL"),anchor:"100%",hidden:!0,name:"l_elnk"}]},{xtype:"fieldset",border:!1,title:IRm$.r1("L_CUSTOM_FIELD"),name:"pconfig1",layout:{type:"vbox",align:"stretch"},fieldDefaults:{labelWidth:60},items:[{name:"expression",labelWidth:60,fieldLabel:IRm$.r1("L_SYNTAX"),xtype:"textarea"},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"displayfield",anchor:"100%",autowidth:!1,value:IRm$.r1("L_CM_DISP_1")},{xtype:"container",flex:1}]},{xtype:"gridpanel",flex:1,store:{fields:[{name:"name"},{name:"type"},{name:"delete"},{name:"nodepath"},{name:"uid"},{name:"memo"}]},name:"datagrid",height:120,columns:[{text:IRm$.r1("B_NAME"),flex:1,sortable:!1,dataIndex:"name"},{text:IRm$.r1("B_TYPE"),flex:1,sortable:!1,dataIndex:"type"},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,a){var n=e.store;n.getAt(t);n.removeAt(t)}}]}],viewConfig:{stripeRows:!0,plugins:{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_"},listeners:{beforedrop:function(e,t,a,n,l){var i,o=this,d=!1,r=t.records&&t.records.length>0?t.records[0]:null,m=r?r.get("type"):null;if(o==t.view?t.copy=!1:t.copy=!0,a?o.panel.store.indexOf(a):0,"Metric"==m){for(i=0;i<o.store.data.items.length;i++)if(o.store.data.items[i].get("uid")==r.data.uid){d=!0;break}0==d&&o.store.add(r.data)}return!1},drop:function(e,t,a,n){a&&a.get("name");return!1}}},listeners:{itemdblclick:function(e,t,a,n,l,i){this.editorItemName(t.data.name)},scope:this}},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"displayfield",autowidth:!1,flex:1,readOnly:!0,value:IRm$.r1("L_CD_DISP_2")},{xtype:"container",flex:1},{xtype:"button",text:IRm$.r1("B_ADD"),handler:function(){this.selectItem("customfield")},scope:this}]}]},{xtype:"fieldset",border:!1,title:IRm$.r1("L_GROUP_FIELD"),name:"pconfig2",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:IRm$.r1("L_BASE_METRIC"),items:[{xtype:"textfield",hideLabel:!0,readOnly:!0,flex:1,emptyText:IRm$.r1("M_SEL_ITEM"),name:"groupfielditem",allowBlack:!1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectItem("groupfielditem")},scope:this}]},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"grid",flex:1,store:{fields:["name","operator","opname","value","values","delete"]},name:"groupdatagrid",stateful:!0,plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{text:IRm$.r1("B_NAME"),flex:1,sortable:!1,dataIndex:"name",editor:{clickToEdit:!1,allowBlank:!1}},{text:IRm$.r1("L_CONDITION"),flex:1,sortable:!1,dataIndex:"operator",editor:{xtype:"combobox",queryMode:"local",displayField:"name",labelField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:"Like",value:"like"},{name:"=",value:"eq"},{name:">",value:"gt"},{name:"<",value:"lt"},{name:">=",value:"gte"},{name:"<=",value:"lte"},{name:"In",value:"in"},{name:"Except",value:"except"}]}}},{text:IRm$.r1("B_VALUE"),flex:1,sortable:!1,dataIndex:"value",editor:{clickToEdit:!1,isvalue:!0}},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-delete",tooltip:IRm$.r1("L_REMOVE"),handler:function(e,t,a){var n=e.store;n.getAt(t);n.removeAt(t)},scope:this},{iconCls:"icon-grid-config",tooltip:IRm$.r1("L_EDIT"),handler:function(e,t,a){var n=e.store.getAt(t);this.editFilter(n.data,n)},scope:this}]}],viewConfig:{stripeRows:!0},listeners:{itemdblclick:function(e,t,a,n,l){var i=t.data,o=t.get("operator");!i||"in"!=o&&"except"!=o||this.editFilter(i,t)},edit:function(e,t){e.grid;var a,n,l,i=t.record;if("value"==e.column)for(i.data.values=[],l=t.value.split(","),a=0;a<l.length;a++)(n=IG$.trim12(l[a]))&&i.data.values.push({code:n,text:n})},scope:this}},{xtype:"fieldcontainer",layout:{type:"vbox",pack:"center"},items:[{xtype:"button",iconCls:"icon-toolbar-add",tooltip:IRm$.r1("L_ADD_CONDITION"),handler:function(){this.addBlankCondition()},scope:this},{xtype:"button",iconCls:"icon-toolbar-moveup",tooltip:"Move Up",handler:function(){var e,t,a=this.down("[name=groupdatagrid]"),n=a.getSelectionModel().getSelection();n&&1==n.length&&(e=n[0],(t=a.store.indexOf(e))>0&&(a.store.remove(e),e=a.store.insert(t-1,e)))},scope:this},{xtype:"button",iconCls:"icon-toolbar-movedown",tooltip:"Move Down",handler:function(){var e,t,a=this.down("[name=groupdatagrid]"),n=a.getSelectionModel().getSelection();n&&1==n.length&&(e=n[0],(t=a.store.indexOf(e))+1<a.store.data.items.length&&(a.store.remove(e),e=a.store.insert(t+1,e)))},scope:this}]}]},{xtype:"textfield",name:"othergroupvalue",fieldLabel:IRm$.r1("L_OTHER_VALUE")}]},{xtype:"fieldset",border:!1,title:IRm$.r1("L_PREDEFINED_FIELD"),name:"pconfig3",defaultType:"textfield",layout:{type:"vbox",align:"stretch"},defaults:{anchor:"100%"},items:[{xtype:"fieldcontainer",layout:{type:"hbox"},fieldLabel:IRm$.r1("L_BASE_METRIC"),items:[{xtype:"textfield",hideLabel:!0,name:"predefinefield",readOnly:!0,emptyText:IRm$.r1("M_SEL_ITEM"),allowBlack:!1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectItem("predefinefield")},scope:this}]},{xtype:"fieldcontainer",layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",name:"optdateformat",fieldLabel:IRm$.r1("L_DATE_FORMAT_EX"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:IRm$.r1("B_SELECT"),value:""},{name:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss"},{name:"2001-07-04 12:08:56",value:"yyyy-MM-dd HH:mm:ss"},{name:"2001-07-04 AM 12:08",value:"yyyy-MM-dd a HH:mm"},{name:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy"},{name:"20010704120856",value:"yyyyMMddHHmmss"}]}},{name:"dateformat",fieldLabel:IRm$.r1("L_DATE_FORMAT"),xtype:"textfield",value:""},{fieldLabel:IRm$.r1("L_GROUP_LEVEL"),name:"datedivision",xtype:"radiogroup",columns:3,$h:120,plain:!0,items:[{boxLabel:IRm$.r1("B_YEAR"),name:"datediv",inputValue:"YYYY",checked:!0},{boxLabel:IRm$.r1("B_QUARTER"),name:"datediv",inputValue:"QUARTER"},{boxLabel:IRm$.r1("B_MONTH"),name:"datediv",inputValue:"MM"},{boxLabel:IRm$.r1("B_DAY"),name:"datediv",inputValue:"DD"},{boxLabel:IRm$.r1("B_WEEKMONTH"),name:"datediv",inputValue:"WM"},{boxLabel:IRm$.r1("B_WEEK"),name:"datediv",inputValue:"WEEK"},{boxLabel:IRm$.r1("B_AMPM"),name:"datediv",inputValue:"AMPM"},{boxLabel:IRm$.r1("B_HOUR"),name:"datediv",inputValue:"HH"},{boxLabel:IRm$.r1("B_MINUTE"),name:"datediv",inputValue:"MI"},{boxLabel:IRm$.r1("B_CUSTOM"),name:"datediv",inputValue:"CUSTOM"}],listeners:{change:function(e,t,a,n){var l=e.getValue().datediv;this.down("[name=customdatetype]").setVisible("CUSTOM"==l)},scope:this}},{fieldLabel:IRm$.r1("B_CUSTOM"),name:"customdatetype",xtype:"textfield",hidden:!0}]}]},{xtype:"fieldset",name:"pconfig4",border:!1,title:IRm$.r1("L_GEO_FIELD"),defaultType:"textfield",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_LATITUDE"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,emptyText:IRm$.r1("M_SEL_ITEM"),readOnly:!0,name:"geolat"},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectItem("geolat")},scope:this}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_LONGITUDE"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,emptyText:IRm$.r1("M_SEL_ITEM"),readOnly:!0,name:"geolng"},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectItem("geolng")},scope:this}]}]},{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},name:"pconfig5",title:IRm$.r1("L_RANGE_FIELD"),items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:IRm$.r1("L_BASE_METRIC"),items:[{xtype:"textfield",hideLabel:!0,name:"rangefield",readOnly:!0,emptyText:IRm$.r1("M_SEL_ITEM"),allowBlack:!1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectItem("rangefield")},scope:this}]},{name:"groupmin",fieldLabel:IRm$.r1("L_START_MIN"),xtype:"numberfield",value:-1,minValue:-1,maxValue:1e8,allowDecimals:!0,decimalPrecision:2,step:1},{name:"groupmax",fieldLabel:IRm$.r1("L_END_MAX"),xtype:"numberfield",value:-1,minValue:-1,maxValue:1e8,allowDecimals:!0,decimalPrecision:2,step:1},{name:"stepinterval",fieldLabel:IRm$.r1("L_STEP_INT"),xtype:"numberfield",value:-1,minValue:-1,maxValue:10,allowDecimals:!0,decimalPrecision:2,step:1},{name:"groupminlabel",fieldLabel:IRm$.r1("L_UNDER_MIN"),xtype:"textfield"},{name:"groupmaxlabel",fieldLabel:IRm$.r1("L_OVER_MAX"),xtype:"textfield"},{name:"grouplabel",fieldLabel:IRm$.r1("L_LABEL_TEXT"),xtype:"textfield"},{xtype:"displayfield",value:"Use keyword %MIN %MAX for range labeling"},{xtype:"textfield",name:"groupformat",fieldLabel:IRm$.r1("L_NUMERIC_FORMAT")}]},{xtype:"fieldset",title:IRm$.r1("L_PARENT_CHILD_OPTIONS"),name:"pconfig7",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox"},fieldLabel:IRm$.r1("L_BASE_METRIC"),items:[{xtype:"textfield",hideLabel:!0,name:"dim_child",readOnly:!0,emptyText:IRm$.r1("M_SEL_ITEM"),allowBlack:!1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectItem("dim_child")},scope:this}]},{xtype:"fieldcontainer",layout:{type:"hbox"},fieldLabel:IRm$.r1("L_PARENT_METRIC"),items:[{xtype:"textfield",hideLabel:!0,name:"dim_parent",readOnly:!0,emptyText:IRm$.r1("M_SEL_ITEM"),allowBlack:!1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectItem("dim_parent")},scope:this}]},{xtype:"fieldcontainer",layout:{type:"hbox"},fieldLabel:IRm$.r1("B_DESC"),items:[{xtype:"textfield",hideLabel:!0,name:"dim_disp",readOnly:!0,emptyText:IRm$.r1("M_SEL_ITEM"),allowBlack:!0,readOnly:!0},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectItem("dim_disp")},scope:this},{xtype:"button",text:"Clear",handler:function(){this.clItem.dim_disp=null,this.down("[name=dim_disp]").setValue("")},scope:this}]},{xtype:"combobox",name:"l_par_option",fieldLabel:IRm$.r1("L_PRIOR_START_WITH"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:"NULL Value",value:"NULL"},{name:"Parent-Child same value",value:"SAME"}]}},{xtype:"combobox",name:"l_par_disp_option",fieldLabel:IRm$.r1("L_DISPLAY_OPTION"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:"Indent characters 4",value:"INDENT4"},{name:"Indent characters 8",value:"INDENT8"},{name:"Expand Collapse",value:"TREE"},{name:"Unchanged",value:"UNCHANGED"}]}}]},{xtype:"fieldset",name:"pconfig8",title:IRm$.r1("L_SUB_QUERY_OPTIONS"),layout:{type:"vbox",align:"stretch"},items:[]}]},{xtype:"panel",title:IRm$.r1("B_ADVANCED"),autoScroll:!0,padding:5,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("L_SORT_SEL"),layout:{type:"vbox",align:"stretch"},padding:5,items:[{xtype:"radiogroup",name:"optsortdir",fieldLabel:IRm$.r1("L_SORT_ORD"),padding:"0 5",plain:!0,items:[{boxLabel:IRm$.r1("B_DEFAULT"),name:"cb_sortdir",inputValue:"",checked:!0},{boxLabel:IRm$.r1("B_ASC"),name:"cb_sortdir",inputValue:"asc"},{boxLabel:IRm$.r1("B_DSC"),name:"cb_sortdir",inputValue:"desc"}]},{xtype:"radiogroup",name:"optsorttype",fieldLabel:IRm$.r1("L_SORT_TP"),padding:"0 5",plain:!0,items:[{boxLabel:IRm$.r1("B_DEFAULT"),name:"cb_sorttype",inputValue:"",checked:!0},{boxLabel:IRm$.r1("B_STRING"),name:"cb_sorttype",inputValue:"VARCHAR"},{boxLabel:IRm$.r1("B_NUMERIC"),name:"cb_sorttype",inputValue:"NUMBER"}]}]},{xtype:"fieldset",title:IRm$.r1("L_OTHER_OPTION"),layout:"anchor",padding:"3 5",hidden:ig$.$l_>5,defaults:{anchor:"100%"},items:[{xtype:"checkbox",name:"optremoveblank",boxLabel:IRm$.r1("L_REM_BLK")},{xtype:"checkbox",name:"isdatetype",boxLabel:IRm$.r1("L_DATE_TYPE"),listeners:{change:function(e,t,a,n){var l=e.getValue(),i=this.down("[name=t_format]"),o=this.down("[name=d_format]");this.down("[name=customdatetypecontainer]");i.setVisible(l),o.setVisible(l)},scope:this}},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATE_FORMAT_SRC"),name:"d_format",labelWidth:130,hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"opt_dateformat",flex:1},{xtype:"button",text:IRm$.r1("B_EXAMPLE"),menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){e.down("[name=opt_dateformat]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){e.down("[name=opt_dateformat]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){e.down("[name=opt_dateformat]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){e.down("[name=opt_dateformat]").setValue(this.value)}}]}}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATE_FORMAT_TGT"),name:"t_format",labelWidth:130,hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"t_dateformat",flex:1},{xtype:"button",text:IRm$.r1("B_EXAMPLE"),menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){e.down("[name=t_dateformat]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){e.down("[name=t_dateformat]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){e.down("[name=t_dateformat]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){e.down("[name=t_dateformat]").setValue(this.value)}}]}}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:IRm$.r1("L_CODE_FIELD"),items:[{xtype:"textfield",name:"cmap_disp",readOnly:!0,emptyText:IRm$.r1("M_SEL_ITEM"),flex:1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.selectItem("codemap")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){this.down("[name=cmap_disp]").setValue(""),this.clItem.objectinfo.cmap_disp="",this.clItem.objectinfo.cmap_uid=""},scope:this}]}]},{xtype:"fieldset",title:IRm$.r1("L_STYLE_OPTION"),layout:{type:"vbox",align:"stretch"},padding:"3 5",hidden:ig$.$l_>5,items:[{xtype:"combobox",name:"optstyle",fieldLabel:IRm$.r1("L_BASE_STYLE"),queryMode:"local",displayField:"disp",valueField:"name",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["disp","name","type"]}}]},{xtype:"fieldset",title:IRm$.r1("L_MEASURES"),hidden:this.dmode,layout:{type:"vbox",align:"stretch"},hidden:ig$.$l_>5,items:[{xtype:"gridpanel",height:160,name:"grd_measures",tbar:[{text:IRm$.r1("B_REFRESH"),handler:function(){this.getMeasures()},scope:this},"->",{text:IRm$.r1("L_ADD_FORMULA"),handler:function(){var e=this,t=new IG$.multiMeasure({instance:e.instance,uid:e.uid,mitem:e.item,vmode:2,callback:new IG$.callBackObj(e,e.reg_measures)});IG$.checkLogin(e,t)},scope:this}],store:{fields:["name"]},columns:[{text:IRm$.r1("B_NAME"),width:220,dataIndex:"name"},{text:IRm$.r1("B_FORMULA"),flex:1},{xtype:"actioncolumn",width:80,items:[{iconCls:"icon-grid-config",handler:function(e,t,a,n){this.edit_customfield(n)},scope:this},{iconCls:"icon-grid-delete",handler:function(e,t,a,n){e.store.remove(n)},scope:this}]}]}]}]}]}]}]}),IG$.customMetricInner.superclass.initComponent.apply(this)},listeners:{afterrender:function(e){var t=this;setTimeout((function(){t.init_f.call(t)}),100)}}}),IG$.custommetric=$s.extend($s.window,{modal:!1,isWindow:!0,region:"center",layout:{type:"fit",align:"stretch"},closable:!1,resizable:!1,width:500,height:480,callback:null,closedlg:function(){this.close()},_confirm:function(){this.mainpanel._confirm.call(this.mainpanel)},initComponent:function(){var e=this;e.mainpanel=new IG$.customMetricInner({instance:e.instance,uid:e.uid,cubeuid:e.cubeuid,cubepath:e.cubepath,writable:e.writable,parentuid:e.parentuid,parentnodepath:e.parentnodepath,itemtype:e.itemtype,wd:e,dmode:e.dmode,dmode_cnt:e.dmode_cnt,callback:e.callback}),e.title=IRm$.r1("T_CUSTOM_METRIC"),$s.apply(e,{defaults:{bodyStyle:"padding:10px"},items:[e.mainpanel],buttons:[{text:IRm$.r1("B_CONFIRM"),name:"b_confirm",handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]}),IG$.custommetric.superclass.initComponent.apply(this,arguments)}});
IG$.p$DbMeta=$s.extend($s.window,{modal:!0,closable:!1,resizable:!0,width:820,height:520,iconCls:"icon-doc-table",layout:"fit",bodyPadding:5,_init:function(){this._loadDbMeta("F")},_loadDbMeta:function(e){var t=new IG$._rpc$;t.init(this,{ack:"userdb",payload:{uid:this.uid,option:"extract_dbmeta",refresh:e||"T"},mbody:{}},this,(function(e){this.down("[name=tbsrc]").store.loadData(e)}),!1),t.send()},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_BO_EXTRACT_META"),items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},border:0,padding:5,items:[{xtype:"panel",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",title:IRm$.r1("L_SRC_TABLES"),flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,emptyText:IRm$.r1("L_SEARCH_KWD")},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH")}]},{xtype:"grid",name:"tbsrc",flex:1,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",flex:1}],store:{fields:[]},listeners:{cellclick:function(e,t,i,l,a,n){var o=this.down("[name=tbfield]"),s=this.down("[name=ttbname]");o.store.loadData(l.get("fields")),s.setValue(l.get("name").toLowerCase())},scope:this}}]},{xtype:"container",width:5},{xtype:"panel",title:IRm$.r1("L_FIELD_MAPPING"),flex:2,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("L_TGT_TBL_NAME"),name:"ttbname"},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,emptyText:IRm$.r1("L_SEARCH_KWD"),fieldLabel:IRm$.r1("B_SEARCH")},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH")}]},{xtype:"grid",flex:1,name:"tbfield",plugins:[{ptype:"cellediting",clicksToEdit:!1}],columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",flex:1},{text:IRm$.r1("L_DB_NAME"),dataIndex:"physical_name",flex:1},{text:IRm$.r1("L_DATA_TYPE"),dataIndex:"fieldtype"},{text:IRm$.r1("B_LENGTH"),dataIndex:"length"}],store:{fields:[]}}]}]}]}],buttons:[{iconCls:"icon-toolbar-schedule",text:IRm$.r1("B_SCHEDULE"),handler:function(){var e,t,i,l=this,a=[],n=l.down("[name=tbsrc]").getSelectionModel().selected,o={};for(e={ack:"userdb",payload:{uid:l.uid,target_folder:l.target_folder.get("uid"),option:"sync_dbmeta"},mbody:{tables:[]},jobkey:"0",meta_type:"metatables"},o.name="",t=0;t<n.length;t++)i=n.items[t].data,e.mbody.tables.push(i),t<3?o.name+=(t>0?",":"")+i.name:3==t&&(o.name+=" and ("+n.length+")");a.push(e),IG$.showScheduler(l,l.uid,l.itemtype,a,o)},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()},scope:this}}),IG$.p$DbMeta.superclass.initComponent.call(this)}});
IG$.tableManager=$s.extend(IG$.v$pnl,{iconCls:"icon-bobject",closable:!0,layout:"fit",bodyPadding:5,_init:function(){var e,t=this;t.uid?t.getLCnt():(e={},t._ds&&t._ds.uid&&(e.datasource={uid:t._ds.uid,name:t._ds.name}),t.refLCnt(e))},getLCnt:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"content",payload:{uid:e.uid},mbody:{option:"content"}},e,(function(t){t.content||(t.content={name:t.name,uid:t.uid,nodepath:t.nodepath,type:t.type,meta_type:"business_object"}),e.refLCnt(t.content)}),!1),t.send()},refLCnt:function(e){var t=this;t._mc=e,t._mc.highlight=t._mc.highlight||[],t._mc.datasource?t.getCnt():t.sel_db(),t._mc.uid&&t.refRoot()},refRoot:function(){var e,t=this._mc,n=this.down("[name=cube_tree]");e={type:"ROOT",name:t.name,uid:t.uid,nodepath:t.nodepath,leaf:!1,children:[{type:"load",name:"Loading..."}]},n.__stagingdb=this.__stagingdb,n.setRootNode(e),setTimeout((function(){n.getRootNode().expand()}),10)},getCnt:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"content",payload:{uid:e._mc.datasource.uid},mbody:{}},e,(function(t){e.refCnt(t.content)}),!1),t.send()},refCnt:function(e){var t=this,n=t._mc.datasource;t.dbo=e,n.uid=e.uid,n.nodepath=e.nodepath,n.name=e.name,t.down("[name=tbdsname]").setText(e.name+" ("+t.dbo.dbtype+")"),"sforce"==t.dbo.dbtype||"pardot"==t.dbo.dbtype?(t.down("[name=btn_extr]").show(),t.targetdb=t.dbo.options.sf_targetdb):"essbase"==t.dbo.dbtype?(t.down("[name=btn_extr]").show(),t.targetdb=t.dbo.options.essbase_targetdb):"sapbw"==t.dbo.dbtype?(t.down("[name=btn_extr]").show(),t.targetdb=t.dbo.options.sapbw_targetdb):"soap"!=t.dbo.dbtype&&"rest"!=t.dbo.dbtype||(t.down("[name=btn_extr]").show(),t.targetdb=t.dbo.options.ws_targetdb),t.__stagingdb=!1,t.targetdb?t.__stagingdb="T"==t.targetdb.excel_loader:t.__stagingdb="T"==t.dbo.excel_loader},custom_click_func:function(e,t){var n=this,a=!1,i=e.get("type");return i=i?i.toLowerCase():null,n._s1=null,"folder"!=i&&"dataset"!=i&&"bobject"!=i&&"datemetric"!=i||(n._s1=e,e.get("open")||e.expand(),n.load_fields(e)),"table"==i||"inlineview"==i?(n._s1=e,e.get("open")||e.expand(),n.load_fields(e),a=!0):"folder"==i&&1==e.get("subitem")?(n.load_fields(e),a=!0):"cubemodel"==i&&(a=n._load_cubemodel(e)),a},custom_expand_func:function(e){var t=this,n=!1,a=e.get("type");return e.isRoot()||"Folder"==a||"DataSet"==a?t._s1||(t._s1=e):"Table"!=a&&"InlineView"!=a||(e.childNodes.length>0&&"load"==e.childNodes[0].get("type")&&(e.removeAll(),t._s1&&t._s1.get("uid")==e.get("uid")&&t.load_fields(e)),n=!0),n},_load_dataset:function(e){var t=this.instance.mainPanel;return t&&e&&t.navigateApp.call(t,e.get("uid"),"dataset",e.get("name"),e.get("nodepath"),!1,e.get("writable"),{}),!0},_load_cubemodel:function(e){var t=this.instance.mainPanel,n={};return t&&(n={obj_uid:this.uid,cubemodel:e?null:new IG$.m$CubeModel(null)},e?t.navigateApp.call(t,e.get("uid"),"cubemodel",e.get("name"),e.get("nodepath"),!1,e.get("writable"),n):t.navigateApp.call(t,null,"cubemodel","new model",null,!1,!0,n)),!0},load_fields_grid:function(e,t,n){var a=this,i=(e.type.toLowerCase(),new IG$._rpc$);i.init(a,{ack:"content",payload:{uid:e.uid,nodepath:e.nodepath,name:e.name,type:e.type},mbody:{option:"folder"}},a,(function(t){var i,d,o,s=[],l=[{name:IRm$.r1("B_SELECT"),value:""}],c=[],r=a.down("[name=file_field]"),m=a.down("[name=seq_field]"),u=a.down("[name=allow_insert]"),_=a.down("[name=grdfields]");for(o=t.children||[],i=0;i<o.length;i++)(d=o[i]).iconcls=IG$.get_metatype_icon(d.type.toLowerCase(),d),"Folder"==d.type?(d.children=[{type:"load",name:"Loading..."}],d.subitem=!0,s.push(d)):(d.dispname=d.name,d.physical_name=d.attributes.attrb3,"Dimension"!=d.type&&"Metric"!=d.type||(d.datatype=IG$.get_datatype(d.attributes.attrb4)),d.iconcls=IG$.get_metatype_icon(d.type?d.type.toLowerCase():"metric",d),l.push({name:d.name,value:d.physical_name}),c.push(d));IG$.sortMeta(c),IG$.sortMeta(s),s.length&&0==n.childNodes.length&&n.appendChild(s),_.store.loadData(c),u.setValue("Table"==e.type&&e.allow_insert),u.setDisabled("Table"!=e.type),r.store.loadData(l),r.setValue(e.file_field||""),m.store.loadData(l),m.setValue(e.seq_field||"")}),!1),i.send()},load_fields:function(e,t){var n=this,a=n.down("[name=cube_tree]"),i=new IG$._rpc$,d=e.get("type").toLowerCase(),o=n.down("[name=tb_info]");n.down("[name=mviewer]").getLayout().setActiveItem(1),n.down("[name=t_btn]").setVisible(ig$.$l_<5&&("folder"==d||"table"==d||"inlineview"==d)),n.down("[name=t_btn2]").setVisible(ig$.$l_<5&&("table"==d||"inlineview"==d)),n.down("[name=t_btn3]").setVisible(ig$.$l_<5&&("folder"==d||"bobject"==d)),n.down("[name=t_btn_pv]").setVisible("table"==d||"inlineview"==d),n.down("[name=b_opt_4]").setVisible("dataset"==d),"folder"==d||"bobject"==d?(o.hide(),n.down("[name=b_opt_1]").hide(),n.down("[name=b_opt_1a]").hide(),n.down("[name=b_opt_2]").hide(),n.down("[name=b_opt_3]").hide(),n.load_fields_grid(e.data,t,e)):"dataset"==d?(n.down("[name=b_opt_4]").setText(IRm$.r1("L_EDIT_ITEM",e.get("locale_name")||e.get("name"))),n.down("[name=b_opt_4]").setDisabled(!e.get("writable")),n.down("[name=b_opt_1]").hide(),n.down("[name=b_opt_1a]").hide(),n.down("[name=b_opt_2]").hide(),n.down("[name=b_opt_3]").hide(),n.load_fields_grid(e.data,t,e)):(o.show(),ig$.$l_<5&&(n.down("[name=b_opt_1]").show(),n.down("[name=b_opt_1a]").show()),n.down("[name=b_opt_2]").show(),n.down("[name=b_opt_3]").show(),i.init(a,{ack:"content",payload:{uid:e.get("uid")},mbody:{option:"diagnostics"}},a,(function(a){var i=a&&a.content?a.content:"Folder"==a.type?a:null;n._s1c=i,i&&("Folder"!=i.type&&(n.down("[name=external_name]").setValue(i.external_name||i.name),n.down("[name=schema_name]").setValue(i.attributes?i.attributes.attrb2:"")),n.down("[name=edit_sql]").setVisible("InlineView"==i.type),n.load_fields_grid(i,t,e))})),i.send())},edit_dimension:function(e){var t=this.instance.mainPanel,n=e.get("type").toLowerCase();"link"==n&&(n=e.get("rawtype").toLowerCase()),t&&"folder"!=n&&"table"!=n&&"inlineview"!=n&&t.navigateApp.call(t,e.get("uid"),n,e.get("name"),e.get("nodepath"),!0,1==e.get("writable"),{cubeuid:this.uid,obj_uid:this.uid,callback:new IG$.callBackObj(this,(function(t){t&&e.set("name",t.name)}))})},createItem:function(e,t){var n=this,a=(n.down("[name=mtree]"),n._s1);t&&!a&&(a=n.down("[name=cube_tree]").getRootNode()),a&&IG$._createMetaObject.call(n,e,a.get("uid"),a.get("nodepath"),a,new IG$.callBackObj(n,(function(e,t){n._s1&&n.load_fields(n._s1)})))},tbarHndlr:function(e,t){var n,a=this,i=a.instance,d=i.mainPanel,o=a._s1?a._s1.get("type").toLowerCase():null;switch(e){case"cmd_save":a.saveCnt();break;case"cmd_extract_dbmeta":a.extrDbMeta();break;case"import_object":if(!a.checkTargetFolder())return;c=new IG$.cube_object_select({instance:a.instance,uid:a.uid,dbo:a.dbo,targetdb:a.targetdb||a.dbo.uid,callback:new IG$.callBackObj(a,(function(e){a.registerSelectedTable(e)}))}),IG$.checkLogin(a,c);break;case"cmd_inlineview":if(!t&&!a.checkTargetFolder())return;n=t&&"InlineView"==t.type?t:{dbpool:a.dbo.uid},c=new IG$.sqlcube_wizard({instance:a.instance,wmode:"inlineview",sheetoption:n,columns:[],callback:new IG$.callBackObj(a,a.rsInlineView)}),IG$.checkLogin(this,c);break;case"cmd_dataset":if(!t&&!a.checkTargetFolder())return;var s=i.mainPanel;s&&s.navigateApp.call(s,null,"dataset","new dataset",null,!1,!0,{bobj_datasource:a._mc.datasource,bobj_uid:a.uid});break;case"cmd_report":d&&d.navigateApp.call(d,null,"report","New Report",null,!0,!0,{cubeuid:a.uid});break;case"cmd_export_meta":var l=a.dbo,c=new IG$.metaExpDlg({instance:a.instance,meta:{uid:l.uid,nodepath:l.nodepath,name:l.name,type:l.type}});IG$.checkLogin(this,c);break;case"cmd_build_model":a.build_model();break;case"cmd_regmeasures":a.reg_measures();break;case"cmd_rename_tool":a.rename_tool();break;case"cmd_rel_field":if(o&&("table"==o||"inlineview"==o)){c=new IG$.relationMgr({instance:a.instance,uid:a._s1.get("uid"),type:a._s1.get("type"),isdown:!0});IG$.checkLogin(a,c)}break;case"cmd_preview":if(o&&("table"==o||"inlineview"==o)){c=new IG$.dlgLoadPreview({instance:a.instance,table:{_mc:a._s1.data}});IG$.checkLogin(a,c)}break;case"cmd_reglinks":a.reg_links();break;case"cmd_change_schema":a.batchUpdateSchema();break;case"cmd_save_field":a.saveFields();break;case"cmd_refresh_field":c=new IG$.dlg_compare_field({instance:a.instance,_s1:a._s1,schema:a.down("[name=schema_name]").getValue()||"none",table:a.down("[name=external_name]").getValue()||"none",callback:new IG$.callBackObj(a,(function(e){var t,n,a,i=this,d=i.down("[name=grdfields]").store,o={},s={},l=[];if(e&&e.length){for(t=0;t<e.length;t++)"CHANGED"==e[t].status?o[e[t].uid]=e[t]:"REMOVED"==e[t].status&&(s[e[t].uid]=e[t]);for(t=d.data.items.length-1;t>=0;t--)(a=o[(n=d.data.items[t]).get("uid")])?n.set("changedprop",a.changedprop):s[n.get("uid")]&&l.push({uid:n.get("uid"),option:"delete"});if(l.length){var c=new IG$._rpc$;c.init(i,{ack:"batchcontent",payload:l,mbody:{}},i,(function(n){for(t=0;t<e.length;t++)"NEW"==e[t].status&&(e[t].physical_name=e[t].fieldname,d.add(e[t]));i.saveFields()})),c.send()}else{for(t=0;t<e.length;t++)"NEW"==e[t].status&&(e[t].physical_name=e[t].fieldname,d.add(e[t]));i.saveFields()}}}))});IG$.checkLogin(a,c);break;case"cmd_delete_field":a.deleteFields();break;case"cmd_hl_option":a.showHighlightOptions();break;case"cmd_sec_filter":a.showSecurityFilter();break;case"cmd_add_bobj":var r=new IG$.metaSelectDlg({instance:a.instance,visibleItems:"folder;bobject;cubemodel;",targetobj:"cubemodel",multiselect:!1,tree_options:{cubebrowse:!1}});r.callback=new IG$.callBackObj(a,(function(e){var t,n,i,d=e.name,o=[],s={items:[]};d.indexOf("/")>-1&&(d=(d=d.split("/")).join("&#x2044;")),t={rawuid:e.uid,rawtype:e.type,name:d,type:"Link",pid:a.uid,address:a.nodepath+"/"+d},n={meta_type:"link",rawuid:e.uid,rawtype:e.type,name:d},o.push(t),s.items.push(n),(i=new IG$._rpc$).init(a,{ack:"batchcontent",payload:o,mbody:s},a,(function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}),null),i.send()})),IG$.checkLogin(this,r)}},showSecurityFilter:function(){var e,t,n=this,a=n._mc;a.securityfilter=a.securityfilter||[],(e=a.securityfilter)&&e.length>0?(t=new IG$.securityFilter({instance:n.instance,modal:!1,uid:n.uid,securityfilter:e}),IG$.checkLogin(n,t)):(t=new IG$.mgrUserDuty({instance:n.instance,modal:!1,callback:new IG$.callBackObj(n,(function(e){var t,a,i=[];for(t=0;t<e.length;t++){var d={sid:e[t].get("sid"),name:e[t].get("name")};i.push(d)}if(i.length>0){for((a=new IG$.clFilterGroup(null)).auth=[],t=0;t<i.length;t++)a.auth.push({name:i[t].name,sid:i[t].sid});a.active=!0,n.showSecurityFilterEditor(a,!0)}}))}),IG$.checkLogin(n,t))},showSecurityFilterEditor:function(e,t){var n=this,a=new IG$.filterEditorWindow({instance:n.instance,modal:!1,sheetoption:{model:{filter:e,cube_object:{uid:n.uid}}},reportoption:{},callback:new IG$.callBackObj(n,(function(e){if(1==t){var a=e.model.filter;a&&n._mc.securityfilter.push(a)}}))});IG$.checkLogin(n,a)},batchUpdateSchema:function(){var e=this;IG$.confirmMessages(ig$.appname,IRm$.r1("M_CONFIRM_TB_BATCH"),(function(t){if("yes"==t){var n=new IG$.dlg_schemaname({instance:e.instance,callback:new IG$.callBackObj(e,(function(e){var t,n,a=new IG$._rpc$,i=this.down("[name=grdfields]").store,d=[];for(t=0;t<i.data.items.length;t++)"Table"==(n=i.data.items[t]).get("type")&&n.get("attributes").attrb2==e.pvalue&&d.push({uid:n.get("uid")});0!=d.length?(a.init(this,{ack:"tablecontent",payload:{option:"rename_schema",pvalue:e.pvalue,nvalue:e.nvalue},mbody:{children:d},meta_type:"metrics"},this,(function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")})),a.send()):IG$.alertmsg(ig$.appname,"No schema named with "+e.pvalue,null,null,0,"error")}))});IG$.checkLogin(e,n)}}))},showHighlightOptions:function(){var e=new IG$.$d_hlconfig({instance:this.instance,_piobj:this,callback:new IG$.callBackObj(this,(function(e){}))});IG$.checkLogin(this,e)},saveCnt:function(){var e=new IG$._rpc$;e.init(this,{ack:"writecontent",payload:{uid:this._mc.uid},mbody:this._mc,meta_type:"business_object"},this,(function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")})),e.send()},sel_db:function(){var e,t=this;e=new IG$.dlg_select_ds({instance:t.instance,sel_mode:1,callback:new IG$.callBackObj(t,(function(e){var n=0,a=t._mc.attributes;(!t._mc.datasource||t._mc.datasource&&t._mc.datasource.uid!=e.data.uid)&&(n=1),t._mc.datasource={uid:e.data.uid,name:e.data.name},a&&(a.attrb1=t._mc.datasource.uid),n&&t.saveCnt(),t.getCnt()}))}),t._mc.datasource&&t._mc.datasource.uid?IG$.confirmMessages(ig$.appname,t._mc.name+" "+IRm$.r1("M_CONFIRM_DS_CHANGE"),(function(n){"yes"==n&&IG$.checkLogin(t,e)})):IG$.checkLogin(t,e)},saveFields:function(){var e,t,n,a,i,d=this,o=(d._s1,d._s1c),s=d.down("[name=grdfields]"),l=new IG$._rpc$;for(o.schemaname=d.down("[name=schema_name]").getValue(),o.external_name=d.down("[name=external_name]").getValue(),o.attributes.attrb2=o.schemaname,o.attributes.attrb3=o.external_name,o.allow_insert=d.down("[name=allow_insert]").getValue(),o.file_field=d.down("[name=file_field]").getValue(),o.seq_field=d.down("[name=seq_field]").getValue(),o.columns=[],i=0;i<s.store.data.items.length;i++)a=(t=(e=s.store.data.items[i]).data).changedprop,(n=e.data.dimension?t.dimension:{uid:t.uid,name:t.name,description:t.description,meta_type:"dimension"}).fieldname=t.physical_name,n.tablename=o.external_name,n.changedprop=a,n.attributes={attrb1:o.external_name,attrb2:o.uid,attrb3:t.physical_name,attrb4:t.db_datatype},o.columns.push(n);l.init(d,{ack:"tablecontent",payload:{uid:o.uid,option:"updatetable"},mbody:o,meta_type:"table"},d,(function(e){d._refresh_grid()}),!1),l.send()},rsInlineView:function(e){var t=this,n=e.sheetoption,a=t._s1,i=new IG$._rpc$,d=n.uid;n.uid||(n.type="InlineView",n.pid=a.get("uid"),n.nodepath=a.get("nodepath")+"/"+n.name,d=n.nodepath),i.init(t,{ack:"writecontent",payload:{uid:d,type:"InlineView",name:n.name},mbody:n,meta_type:"inlineview"},t,(function(e){n.uid?(t.refreshAll(),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")):(n.uid=e.uid,t._updIV(e))})),i.send()},_updIV:function(e){var t=this,n=new IG$._rpc$,a={uid:e.uid,option:"updateview"};n.init(t,{ack:"tablecontent",payload:a,mbody:{option:"updateview"}},t,(function(e){t.refreshAll(),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}),!1),n.send()},_refresh_grid:function(){var e=this._s1;"DataSet"==e.get("type")?this._load_dataset(e):this.load_fields(e)},deleteFields:function(){var e,t=this,n=t.down("[name=grdfields]").getSelectionModel().selected;n&&n.length?IG$.confirmMessages(ig$.appname,IRm$.r1("M_CONFIRM_DELETE"),(function(a){if("yes"==a){var i=[],d=new IG$._rpc$;for(e=0;e<n.length;e++)i.push({uid:n.items[e].get("uid"),option:"delete"});d.init(t,{ack:"batchcontent",payload:i,mbody:{}},t,(function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_DELETED"),null,t,0,"success"),t._refresh_grid()})),d.send()}})):IG$.ShowError(IRm$.r1("M_SELECT_ITEM"),t)},checkTargetFolder:function(){var e=this._s1;if(!e||"Folder"==e.get("type")||"Bobject"==e.get("type"))return e||(this._s1=e=this.down("[name=cube_tree]").getRootNode()),e;IG$.alertmsg(ig$.appname,IRm$.r1("B_SELECT_FOLDER"),null,null,0,"")},extrDbMeta:function(){var e,t,n=this;(t=n.checkTargetFolder())&&n.dbo&&n.dbo.uid&&(e=new IG$.p$DbMeta({instance:n.instance,uid:n.dbo.uid,dbo:n.dbo,target_folder:t,callback:new IG$.callBackObj(n,(function(){}))}),IG$.checkLogin(this,e))},reg_links:function(){var e,t,n,a=this,i=[],d=a.down("[name=grdfields]").store.data.items;for(e=0;e<d.length;e++)1==(t=d[e]).get("selected")&&t.get("uid")&&(n={},IG$.CopyObject(t.data,n,"uid;name;type;memo;nodepath","s"),i.push(n));if(i.length){var o=new IG$.metaSelectDlg({instance:a.instance,mode:"select",targetobj:"folder",tree_options:{rootuid:a.uid},callback:new IG$.callBackObj(a,(function(e){var t,n,d,o,s,l,c=[],r={items:[]};if(e){for(n=0;n<i.length;n++)(l=(s=i[n]).name).indexOf("/")>-1&&(l=(l=l.split("/")).join("&#x2044;")),d={rawuid:s.uid,rawtype:s.type,name:l,type:"Link",pid:e.uid,address:e.nodepath+"/"+l},o={meta_type:"link",rawuid:s.uid,rawtype:s.type,name:l},c.push(d),r.items.push(o);(t=new IG$._rpc$).init(a,{ack:"batchcontent",payload:c,mbody:r},a,(function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}),null),t.send()}}))});IG$.checkLogin(a,o)}else IG$.alertmsg(ig$.appname,IRm$.r1("L_SELECT_FIELD"),null,null,0,"warning")},reg_measures:function(){var e,t,n,a=this,i=[],d=a.down("[name=grdfields]").store.data.items;for(e=0;e<d.length;e++)1==(t=d[e]).get("selected")&&t.get("uid")&&(n={},IG$.CopyObject(t.data,n,"uid;name;type;memo;nodepath","s"),n.formula=IG$.isNumericType(t.get("datatype"))?"SUM":"COUNT",n.formula_desc="SUM"==n.formula?"Total":"Count",i.push(n));if(i.length>0){var o=new IG$.multiMeasure({instance:a.instance,metaitems:i,mfolder:a.mfolder,pcube:a,nodepath:a._mc.nodepath,callback:new IG$.callBackObj(a,a.rs_reg_measures)});IG$.checkLogin(a,o)}else IG$.alertmsg(ig$.appname,IRm$.r1("L_SELECT_FIELD"),null,null,0,"warning")},rename_tool:function(){var e,t,n,a=this,i=[],d=a.down("[name=grdfields]").store.data.items;for(e=0;e<d.length;e++)1==(t=d[e]).get("selected")&&t.get("uid")&&(n={},IG$.CopyObject(t.data,n,"uid;name;type;memo;nodepath;physical_name","s"),i.push(n));if(i.length>0){var o=new IG$.multiRename({instance:a.instance,metaitems:i,mfolder:a.mfolder,pcube:a,nodepath:a._mc.nodepath,callback:new IG$.callBackObj(a,(function(){a._refresh_grid()}))});IG$.checkLogin(a,o)}else IG$.alertmsg(ig$.appname,IRm$.r1("L_SELECT_FIELD"),null,null,0,"warning")},rs_saveRegMeasures:function(e,t){t[0];var n,a,i,d,o,s,l,c=t[1],r=[];for(d=0;d<c.length;d++)"DateMetric"==(o=c[d]).ctype&&tnodes[d]&&(o.cuid=IG$.XGetAttr(tnodes[d],"uid"),r.push(o));if(r.length){for(s=[],l=[],d=0;d<r.length;d++)$.each([{name:"YYYY",rname:"YEAR"},{name:"QUARTER"},{name:"MM"},{name:"DD",rname:"DAY"},{name:"WM",rname:"WEEKMONTH"},{name:"WEEK"}],(function(e,t){a=IRm$.r1("B_"+t.rname),i=t.name,s.push({uid:c[d].cloc+"/"+r[d].measurename+"/"+a,pid:r[d].cuid,name:a,type:"CustomMetric"}),l.push({meta_type:"custom_dimension",uid:c[d].cloc+"/"+r[d].measurename+"/"+a,pid:r[d].cuid,name:a,type:"CustomMetric",rel_items:[{uid:r[d].uid,name:r[d].uid,nodepath:"",type:"Metric"}],datedivision:i,dateformat:"DATE",predefinetype:"DATE",custom_type:"CUSTOM_FIELD",customdatetype:"",expression:"$DATE_YYYY(["+r[d].name+"])$"})}));(n=new IG$._rpc$).init(this,{ack:"batchcontent",payload:s,mbody:l},this,(function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")})),n.send()}else IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},build_model:function(){var e,t,n,a,i=this,d=i.instance,o=i.down("[name=grdfields]").getSelectionModel().selected,s={tables:[]};for(n=0;n<o.length;n++)"table"!=(a=(t=o.items[n]).get("type").toLowerCase())&&"inlineview"!=a||s.tables.push({name:t.get("name"),uid:t.get("uid")});s.pool=[{uid:i.uid}],(e=new IG$._rpc$).init(i,{ack:"cubecontent",payload:{option:"build_model"},mbody:s,meta_type:"tables"},i,(function(e){var t=d.mainPanel;t&&t.navigateApp.call(t,null,"cubemodel".toLowerCase(),"new model",null,!1,!0,{obj_uid:i.uid,_c$:e})}),!1),e.send()},registerSelectedTable:function(e){var t,n=this,a={option:"register"},i={tables:[]},d=new IG$._rpc$,o=n._s1;if(0!=e.length){for(t=0;t<e.length;t++)s=e[t],i.tables.push({dbpool:n.targetdb||n.dbo.uid,pid:o.get("uid"),name:s.name,schemaname:s.schemaname,product_code:s.product_code,external_name:s.external_name||s.name,object_type:s.object_type}),s.product_code&&(a.product_code=s.product_code);d.init(n,{ack:"tablecontent",payload:a,mbody:i,meta_type:"tables"},n,(function(e){n.refreshAll(),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}),!1),d.send()}},refreshAll:function(){this.down("[name=cube_tree]").refreshTree()},initComponent:function(){var e=this;ig$.$l_=ig$.$l_||0,$s.apply(e,{items:[{xtype:"panel",flex:1,border:1,layout:"border",split:!0,items:[new IG$.naviTree({instance:e.instance,showtoolbar:!1,cubebrowse:!0,ddGroup:"_I$RD_G_",name:"cube_tree",rootuid:e.uid,region:"west",width:300,border:0,split:!0,title:IRm$.r1("L_FOLDER_AND_TABLES"),visibleItems:"folder;table;inlineview;cubemodel;dataset;datemetric;",enabledrag:!0,_search:!0,custom_click_func:new IG$.callBackObj(e,e.custom_click_func),custom_expand_func:new IG$.callBackObj(e,e.custom_expand_func),isdatasource:!0,listeners:{toolbar:function(e,t,n){this._s1=t,this.tbarHndlr(e)},scope:this}}),{xtype:"panel",region:"center",name:"mviewer",flex:1,border:1,layout:"card",items:[{xtype:"panel",html:'<div style="padding: 10px">'+IRm$.r1("M_SELECT_ITEM")+"</div>"},{xtype:"panel",layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",layout:"anchor",name:"tb_info",hidden:!0,border:0,items:[{xtype:"container",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("L_TABLE_NAME"),name:"schema_name",width:220},{xtype:"textfield",name:"external_name"},{xtype:"button",text:IRm$.r1("L_EDIT_SQL"),name:"edit_sql",hidden:!0,handler:function(){this._s1c||IG$.alertmsg(ig$.appname,IRm$.r1("B_SELECT_TARGET"),null,null,0,""),this.tbarHndlr("cmd_inlineview",this._s1c)},scope:this},{xtype:"container",flex:1}]},{xtype:"checkbox",fieldLabel:IRm$.r1("L_ALLOW_INSERT"),name:"allow_insert",border:0,hidden:ig$.$l_>5||!e.__stagingdb,labelAlign:"right",boxLabel:IRm$.r1("B_ENABLE"),disabled:!0,listeners:{change:function(e){this.down("[name=t2]").setVisible(e.getValue())},scope:this}},{xtype:"panel",border:0,name:"t2",hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"combobox",name:"file_field",labelAlign:"right",fieldLabel:IRm$.r1("L_FILE_FIELD"),valueField:"value",displayField:"name",queryMode:"local",editable:!1,store:{fields:["name","value"]}},{xtype:"combobox",name:"seq_field",labelAlign:"right",fieldLabel:IRm$.r1("L_UNIQUE_FIELD"),valueField:"value",displayField:"name",queryMode:"local",editable:!1,store:{fields:["name","value"]}},{xtype:"container",flex:1}]}]},{xtype:"gridpanel",title:IRm$.r1("L_FIELDS"),name:"grdfields",flex:1,border:0,store:{fields:["name","datatype","datasize","decimaldigits","tablename","type","iskey","iconcls","physical_name"]},selType:"checkboxmodel",selModel:{mode:"MULTI"},viewConfig:{plugins:[{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_",enableDrop:!1,enableDrag:!0}],listeners:{}},plugins:[{ptype:"cellediting",clicksToEdit:!1}],defaults:{sortable:!1,hideable:!1},columns:[{header:"",dataIndex:"iconcls",menuDisabled:!0,width:30,renderer:function(e){return"<div class='igc_g_icon "+e+"'></div>"}},{header:IRm$.r1("B_NAME"),dataIndex:"name",flex:1},{header:IRm$.r1("B_PHY_NAME"),dataIndex:"physical_name",flex:1},{header:IRm$.r1("B_DATATYPE"),dataIndex:"datatype",width:80},{xtype:"actioncolumn",width:30,items:[{iconCls:"icon-grid-delete",tooltip:IRm$.r1("L_REMOVE"),handler:function(e,t,n){var a=e.store,i=a.getAt(t);IG$.deleteMetaObject(i.get("uid"),i,new IG$.callBackObj(this,(function(){a.removeAt(t)})))},scope:this}]}],listeners:{beforeedit:function(e,t,n){var a=1==this.__dbtype,i=!0;return 0!=t.colIdx||a||(i=!1),i},cellclick:function(e,t,n,a,i,d){"Field"!=a.get("type")&&2==n&&this.edit_dimension(a)},scope:this},dockedItems:[{xtype:"toolbar",dock:"top",items:[{iconCls:"icon-toolbar-save",tooltip:IRm$.r1("L_SAVE_FIELD"),name:"b_opt_1",hidden:!0,handler:function(){this.tbarHndlr("cmd_save_field")},scope:this},{iconCls:"icon-refresh",tooltip:IRm$.r1("B_REFRESH"),hidden:!0,name:"b_opt_1a",handler:function(){this.tbarHndlr("cmd_refresh_field")},scope:this},{iconCls:"icon-toolbar-remove",tooltip:IRm$.r1("B_DELETE"),hidden:ig$.$l_>5,handler:function(){this.tbarHndlr("cmd_delete_field")},scope:this},{xtype:"textfield",flex:1,name:"_filter",enableKeyEvents:!0,emptyText:IRm$.r1("L_SEARCH_KWD"),listeners:{keyup:function(e,t,n){13==t.keyCode&&IG$._dofilter(this,"grdfields",["name","physical_name"])},scope:this}},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){IG$._dofilter(this,"grdfields",["name","physical_name"])},scope:this},"-",{xtype:"button",name:"t_btn_pv",iconCls:"icon-tb-preview",text:IRm$.r1("B_DATA"),tooltip:"Preview",hidden:!0,handler:function(){this.tbarHndlr("cmd_preview")},scope:this},{xtype:"button",name:"t_btn2",hidden:!0,text:IRm$.r1("L_OPTIONS"),hidden:ig$.$l_>5,menu:{xtype:"menu",items:[{text:IRm$.r1("B_RELATIONS"),handler:function(){this.tbarHndlr("cmd_rel_field")},scope:this},{iconCls:"icon-measure",text:IRm$.r1("L_REG_MEASURES"),name:"b_opt_2",handler:function(){this.tbarHndlr("cmd_regmeasures")},scope:this},"-",{iconCls:"icon-link",text:IRm$.r1("L_REG_LINK"),name:"b_opt_3",handler:function(){this.tbarHndlr("cmd_reglinks")},scope:this},{text:IRm$.r1("L_RENAME_TOOL"),name:"b_opt_5",handler:function(){this.tbarHndlr("cmd_rename_tool")},scope:this}]}},{xtype:"button",name:"t_btn3",hidden:!0,text:IRm$.r1("L_OPTIONS"),menu:{xtype:"menu",items:[{text:IRm$.r1("L_BATCH_UPD_SCH"),handler:function(){this.tbarHndlr("cmd_change_schema")},scope:this}]}},"->",{text:IRm$.r1("L_EDIT_ITEM"),name:"b_opt_4",hidden:!0,handler:function(){this._s1&&"DataSet"==this._s1.get("type")&&this._load_dataset(this._s1)},scope:this},{xtype:"button",name:"t_btn",text:IRm$.r1("L_CREATE_ITEM"),hidden:!0,menu:{xtype:"menu",items:[{text:IRm$.r1("D_FOLDER"),hidden:!1!==ig$.features.ig_n_f_f,handler:function(){this.createItem("Folder")},scope:this},"-",{text:IRm$.r1("D_CUSTOMMETRIC"),hidden:!1!==ig$.features.ig_n_cm,handler:function(){this.createItem("CustomMetric")},scope:this},{text:IRm$.r1("D_MEASURE"),hidden:!1!==ig$.features.ig_n_ms,handler:function(){this.createItem("Measure")},scope:this},{text:IRm$.r1("D_FORMULA"),hidden:!1!==ig$.features.ig_n_fm,handler:function(){this.createItem("FormulaMeasure")},scope:this},"-",{text:IRm$.r1("D_DATEMETRIC"),hidden:!1!==ig$.features.ig_n_dm,handler:function(){this.createItem("DateMetric")},scope:this},{text:IRm$.r1("D_CHARTMEASURE"),hidden:!1!==ig$.features.ig_n_cms,handler:function(){this.createItem("ChartMeasure")},scope:this},{text:IRm$.r1("D_HIERARCHY"),hidden:!1!==ig$.features.ig_n_hm,handler:function(){this.createItem("Hierarchy")},scope:this},{text:IRm$.r1("D_UDG"),hidden:!1!==ig$.features.ig_n_udg,handler:function(){this.createItem("UDG")},scope:this}]}}]}]}]}]}],tbar:[{iconCls:"icon-toolbar-save",name:"t_save",tooltip:IRm$.r1("L_SAVE"),handler:function(){this.tbarHndlr("cmd_save")},scope:this},"-",{xtype:"button",text:IRm$.r1("L_IMP_TB"),handler:function(){this.tbarHndlr("import_object")},scope:this},{text:IRm$.r1("L_C_INLINEV"),name:"b_m2",handler:function(){this.tbarHndlr("cmd_inlineview")},scope:this},{text:IRm$.r1("L_DATASET"),hidden:ig$.$l_>5||ig$.features&&ig$.features.ig_n_dataset,handler:function(){this.tbarHndlr("cmd_dataset")},scope:this},"-",{iconCls:"icon-toolbar-hl",tooltip:IRm$.r1("L_TB_HL"),hidden:ig$.$l_>5,handler:function(){this.tbarHndlr("cmd_hl_option")},scope:this},{iconCls:"icon-toolbar-filter",tooltip:"Security Filter",hidden:ig$.$l_>5,handler:function(){this.tbarHndlr("cmd_sec_filter")},scope:this},"-",{xtype:"button",text:IRm$.r1("L_BUILD_MODEL"),hidden:ig$.$l_>5,handler:function(){this.tbarHndlr("cmd_build_model")},scope:this},"-",{xtype:"button",iconCls:"icon-toolbar-addsheet",tooltip:IRm$.r1("B_ADD_BOBJ"),text:IRm$.r1("L_DT_MASHING"),hidden:ig$.$l_>5,handler:function(){this.tbarHndlr("cmd_add_bobj")},scope:this},"->",{text:IRm$.r1("L_EXTRACT_META"),hidden:!0,name:"btn_extr",handler:function(){this.tbarHndlr("cmd_extract_dbmeta")},scope:this},{iconCls:"icon-report",text:IRm$.r1("M_REPORT"),handler:function(){this.tbarHndlr("cmd_report")},scope:this},{text:IRm$.r1("L_EXPORT_META"),hidden:ig$.$l_>5,handler:function(){this.tbarHndlr("cmd_export_meta")},scope:this},"-",{xtype:"button",hidden:ig$.$l_>5,text:IRm$.r1("L_SEL_DB"),handler:function(){this.sel_db()},scope:this}],bbar:[{xtype:"toolbar",items:[{xtype:"button",text:"",name:"tbdsname",tooltipType:"title",tooltip:"Data Connections"}]}]}],listeners:{afterrender:function(e){e._init.call(e)}}}),IG$.tableManager.superclass.initComponent.call(this)}}),IG$.dlg_compare_field=$s.extend($s.window,{width:500,height:520,layout:"fit",padding:5,refreshFields:function(){var e=this,t=e._s1,n=new IG$._rpc$,a={uid:t.get("uid"),option:"compare_fields"},i={schema:e.schema,table:e.table};n.init(e,{ack:"tablecontent",payload:a,mbody:i},e,(function(e){var t,n,a,i,d;for(n=e&&e.columns||[],t=0;t<n.length;t++)if((a=n[t]).changedprop&&(a.status=a.changedprop.status,!a.status)){for(i in d=[],a.changedprop)"status"!=i&&d.push(i);d.length&&(a.status="CHANGED",a.propdesc=d.join(","))}this.down("[name=dgrid]").store.loadData(n)}),!1),n.send()},_confirm:function(){var e,t,n,a=this,i=a.down("[name=dgrid]"),d=(i.store,i.selModel.selected),o=[];for(n=0;n<d.length;n++)"CHANGED"!=(e=d.items[n]).data.status&&"NEW"!=e.data.status&&"REMOVED"!=e.data.status||("REMOVED"==e.data.status&&(t=1),o.push(e.data));0!=o.length?t?IG$.confirmMessages(ig$.appname,IRm$.r1("M_CONFIRM_DELETE"),(function(e){"yes"==e&&(a.callback&&a.callback.execute(o),a.close())})):(a.callback&&a.callback.execute(o),a.close()):IG$.alertmsg(ig$.appname,"No item selected",null,null,0,"warning")},initComponent:function(){$s.apply(this,{title:IRm$.r1("L_COL_SYNC"),items:[{xtype:"panel",padding:10,layout:{type:"vbox",align:"stretch"},items:[{xtype:"gridpanel",name:"dgrid",flex:1,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:[]},tbar:[{xtype:"button",text:IRm$.r1("L_UNDO"),handler:function(){var e=this.down("[name=dgrid]").getSelectionModel().selected;for(i,rec,i=0;i<e.length;i++)rec=e.items[i],rec.get("status")&&rec.set("status","IGNORE")},scope:this},"->",{xtype:"button",name:"alias_desc",text:IRm$.r1("L_ALIAS_TO_DESC"),handler:function(){var e,t,n,a,i=this.down("[name=dgrid]").getSelectionModel().selected;for(e=0;e<i.length;e++)(n=(t=i.items[e]).get("column_comments"))&&((a=t.data.changedprop)||(t.data.changedprop=a={}),a.name=null,a.description=n,t.set("description",n),t.set("status","CHANGED"))},scope:this},{xtype:"button",text:IRm$.r1("L_ALIAS_TO_NAME"),name:"alias_name",handler:function(){var e,t,n,a,i=this.down("[name=dgrid]").getSelectionModel().selected;for(e=0;e<i.length;e++)(n=(t=i.items[e]).get("column_comments"))&&((a=t.data.changedprop)||(t.data.changedprop=a={}),a.name=n,a.description=null,t.set("name",n),t.set("status","CHANGED"))},scope:this}],columns:[{text:IRm$.r1("B_NAME"),flex:1,dataIndex:"name",tdCls:"igc-td-link"},{text:IRm$.r1("B_STATUS"),width:100,dataIndex:"status"},{text:IRm$.r1("B_DESC"),flex:1,dataIndex:"propdesc"},{text:IRm$.r1("L_ALIAS"),flex:1,dataIndex:"column_comments"}]}]}],buttons:["->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){e.refreshFields()}}}),IG$.dlg_compare_field.superclass.initComponent.call(this)}}),IG$.dlg_schemaname=$s.extend($s.window,{width:300,autoHeight:!0,layout:"fit",padding:5,_confirm:function(){var e=this,t={pvalue:e.down("[name=toldvalue]").getValue(),nvalue:e.down("[name=tnewvalue]").getValue()};e.callback&&e.callback.execute(t),e.close()},initComponent:function(){$s.apply(this,{title:IRm$.r1("L_CHANGE_SCH_NAME"),items:[{xtype:"panel",padding:10,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("L_SCH_NAME_CHANGE"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"toldvalue",fieldLabel:IRm$.r1("L_OLD_NAME")},{xtype:"textfield",name:"tnewvalue",fieldLabel:IRm$.r1("L_NEW_NAME")}]}]}],buttons:["->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}]}),IG$.dlg_schemaname.superclass.initComponent.call(this)}});
IG$.dlg_select_ds||(IG$.dlg_select_ds=$s.extend($s.window,{width:500,height:520,layout:"fit",padding:5,_init:function(){var e,t=new IG$._rpc$,i=this.datasource;i&&this.down("[name=opt_dbtype]").setValue("db"),t.init(this,{ack:"userdb",payload:{address:"/Connections",option:"list"},mbody:{}},this,(function(t){var l,s=t.children,n=this.down("[name=dsource]"),d=[];if(s&&s.length)for(l=0;l<s.length;l++)(1==this.sel_mode||s[l].attributes&&"T"==s[l].attributes.attrb1)&&(i&&i.uid==s[l].uid&&(e=s[l]),d.push(s[l]));if(n.store.loadData(d),e){var o=n.store._pull[e.id];o&&n.getSelectionModel().select(o,!0)}}),!1),t.send()},_confirm:function(e){var t=this,i=t.down("[name=dsource]"),l=t.down("[name=opt_dbtype]").getValue().cb_dbtype,s=e?null:i.getSelectionModel().selected;"db"==l||1==t.sel_mode?e?(t.callback&&t.callback.execute(e),t.close()):s&&s.length?(t.callback&&t.callback.execute(s.items[0]),t.close()):IG$.ShowError(IRm$.r1("E_SEL_DC"),t):(t.callback&&t.callback.execute(),t.close())},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_SEL_DB"),items:[{xtype:"panel",padding:10,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("L_STORAGE_OPTIONS"),hidden:1==this.sel_mode,layout:{type:"vbox",align:"stretch"},items:[{xtype:"radiogroup",name:"opt_dbtype",fieldLabel:IRm$.r1("L_DATA_STORAGE"),padding:"0 5",plain:!0,items:[{boxLabel:IRm$.r1("L_USE_TEMP"),name:"cb_dbtype",inputValue:"h2",checked:!0},{boxLabel:IRm$.r1("L_USE_STG"),name:"cb_dbtype",inputValue:"db"}],listeners:{change:function(e,t,i){this.down("[name=mview]").setDisabled(!t||!t.cb_dbtype||"db"!=t.cb_dbtype)},scope:this}}]},{xtype:"fieldset",name:"mview",title:IRm$.r1("L_STAGING_DB"),flex:1,layout:{type:"vbox",align:"stretch"},paddingY:10,disabled:1!=this.sel_mode,items:[{xtype:"gridpanel",name:"dsource",flex:1,selType:"checkboxmodel",selModel:{mode:"SINGLE",checkSelector:".x-grid-cell"},store:{fields:[]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",tdCls:"igc-td-link"},{text:IRm$.r1("B_DESC"),dataIndex:"description"}],listeners:{cellclick:function(e,t,i,l,s,n){var d=this.down("[name=opt_dbtype]").getValue();1!=this.sel_mode&&1==i&&(d&&"db"==d.cb_dbtype?this._confirm(l):IG$.ShowError(IRm$.r1("E_CHECK_DTYPE"),this))},scope:this}}]}]}],buttons:["->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){e._init()}}}),IG$.dlg_select_ds.superclass.initComponent.call(this)}}));
IG$.relationMgr=$s.extend($s.window,{modal:!0,closable:!1,resizable:!0,layout:"fit",width:600,autoHeight:!0,layout:{type:"fit"},bodyPadding:0,loadRelation:function(e,t,n){var i=new IG$._rpc$,l=!0;"report"==(t?t.toLowerCase():"")&&(l=!1),i.init(this,{ack:"helpcontent",payload:{uid:e},mbody:{option:"relations",isdown:l?"T":"F",detail:"info"}},this,(function(t){var i,l,a=this.down("[name="+(n||"grd_rel")+"]"),o=t&&t.children?t.children:[],s=this.down("[name=txtrel]"),d=[];for(e||s.setValue("Relations : "+t.name+"("+t.nodepath+")"),i=0;i<o.length;i++)(l=o[i]).iconcls=IG$.get_metatype_icon(l.type.toLowerCase(),l),d.push(l);a.store.loadData(d)}),!1),i.send()},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_Resources"),items:[{xtype:"panel",bodyPadding:10,minHeight:500,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",name:"txtrel",value:"Relations"},{xtype:"gridpanel",name:"grd_rel",flex:1,store:{xtype:"store",fields:["name","nodepath","uid","type","iconcls"]},columns:[{xtype:"templatecolumn",text:IRm$.r1("B_NAME"),menuDisabled:!0,flex:1,minWidth:160,tdCls:"ig-navi-namecol",renderer:function(e,t,n){return["<div class='ig-navi-itemicon "+(n.get("iconcls")||"")+"'></div>","<span title='"+n.get("name")+"("+n.get("type")+")'>"+n.get("name")+"</span>"].join("")}},{text:IRm$.r1("B_PATH"),flex:1,minWidth:200,dataIndex:"nodepath"}],listeners:{cellclick:function(e,t,n,i,l,a){var o=this.down("[name=png_rel_sub]"),s=i.get("uid");0==n&&(o.show(),this.loadRelation(s,i.get("type"),"grd_rel_sub"))},scope:this}},{xtype:"panel",name:"png_rel_sub",flex:1,hidden:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:"Sub relations"},{xtype:"gridpanel",flex:1,name:"grd_rel_sub",store:{xtype:"store",fields:["name","nodepath","uid","type","iconcls"]},columns:[{xtype:"templatecolumn",text:IRm$.r1("B_NAME"),menuDisabled:!0,flex:1,minWidth:160,tdCls:"ig-navi-namecol",renderer:function(e,t,n){return["<div class='ig-navi-itemicon "+(n.get("iconcls")||"")+"'></div>","<span title='"+n.get("name")+"("+n.get("type")+")'>"+n.get("name")+"</span>"].join("")}},{text:IRm$.r1("B_PATH"),flex:1,minWidth:200,dataIndex:"nodepath"}]}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this.close()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]}),IG$.relationMgr.superclass.initComponent.call(this)},listeners:{afterrender:function(e){e.loadRelation(this.uid,this.type)}}});
IG$.measureEditor=$s.extend($s.window,{modal:!1,isWindow:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:500,height:530,reportoption:null,callback:null,init_f:function(){var e=this,t=e.dmode,a=new IG$._rpc$;e.down("[name=expressiontype]").setValue("([field])"),t?(e.dmode_cnt.meta_type="measure",e.rs_procLoadContent({content:e.dmode_cnt})):e.uid?(a.init(e,{ack:"content",payload:{uid:e.uid},mbody:{option:"diagnostics"}},e,e.rs_procLoadContent,null),a.send()):e.parentuid&&(a.init(e,{ack:"helpcontent",payload:{uid:e.uid},mbody:{option:"cube_style_info"}},e,(function(t){e.rs_procLoadContent({writable:!0,content:{writable:!0,cubeinfo:t,meta_type:"measure"}})}),null),a.send())},expressionChange:function(e,t,a){t&&this.down("[name=expression]").setValue(t)},rs_procLoadContent:function(e){e&&(this.clItem=e.content);var t,a,n,i,l,s=this,o=s.clItem,d=[],r=s.down("[name=optstyle]");if(o.rel_items=o.rel_items||[],s.down("[name=b_confirm]").setVisible(o.writable||s.dmode),s.down("[name=itemname]").setValue(o.name),s.down("[name=description]").setValue(o.description),a=o.nodepath?o.nodepath.split("/"):null)for(t=0;t<o.rel_items.length;t++)if(n=(n=o.rel_items[t].nodepath)?n.split("/"):null){for(i=n.length-1;i>=0;i--)n[i]==a[i]&&n.splice(i,1);o.rel_items[t].cpath=n.join("/")}d.push({disp:"--- select ---",name:""}),o.cubeinfo||(l=o.cubeinfo={app_style:{default_styles:[],custom_styles:[]}}),l=o.cubeinfo,delete o.cubeinfo,s.styles=d,$.each([{arr:l.app_style.default_styles,n:"appbase"},{arr:l.app_style.custom_styles,n:"appcustom"},{arr:l.cube_style?l.cube_style.custom_styles:null,n:"cubecustom"}],(function(e,t){var a,n,i=t.arr;if(i)for(a=0;a<i.length;a++)n=i[a],d.push({disp:n.name,name:n.name,type:t.n})})),r.store.loadData(d),r.setValue(o.stylename||""),s.down("[name=optdisplay]").setValue(o.optdisplay),s.datagrid.store.loadData(o.rel_items),s.down("[name=expression]").setValue(o.expression),ig$.$l_<5&&s.down("[name=mfilter]").setValue(o.measure_filter);var m=s.down("[name=expressiontype]");s.clItem.expressiontype="COUNT"==o.expressiontype?"COUNT_DISTINCT":o.expressiontype,m.setValue(o.expressiontype),m.on("change",s.expressionChange,s),s.dmode||s.getParentCube()},getParentCube:function(){var e=this;IG$.getParentCube.call(e,e.uid,e.parentuid,new IG$.callBackObj(e,(function(t){e.rs_getParentcube(t)})))},rs_getParentcube:function(e){var t=e&&e.length?e[0]:null;t&&(this.cubeuid=t.uid,this.cubepath=t.nodepath)},_confirm:function(){var e,t,a,n,i,l=this,s=l.down("[name=datagrid]"),o=l.clItem;if(IG$.checkFields(l,["itemname"])){for(o.name=l.down("[name=itemname]").getValue(),o.description=l.down("[name=description]").getValue(),e=l.down("[name=expression]").getValue(),o.expression=e,e=(n=l.down("[name=expressiontype]")).getValue(),i=0;i<n.store.data.items.length;i++)if(n.store.data.items[i].data.value==e){o.expressiontype=n.store.data.items[i].data.name;break}for(ig$.$l_<5&&(o.measure_filter=l.down("[name=mfilter]").getValue()),o.rel_items=[],i=0;i<s.store.data.items.length;i++)t={uid:(a=s.store.data.items[i].data).uid,name:a.name,nodepath:a.nodepath,memo:a.memo,type:a.type},o.rel_items.push(t);if(o.stylename=l.down("[name=optstyle]").getValue(),o.optdisplay=l.down("[name=optdisplay]").getValue(),l.dmode)l.callback&&l.callback.execute(o),l.close();else{var d=new IG$._rpc$;d.init(l,{ack:"writecontent",payload:{uid:l.uid,pid:l.parentuid,name:o.name,description:o.description,type:l.itemtype,nodepath:l.parentnodepath?l.parentnodepath+"/"+o.name:null},mbody:o,meta_type:"measure"},l,l.rs_saveContent,null,null),d.send()}}},rs_saveContent:function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success"),this.callback&&this.callback.execute(this.clItem),this.close()},editorItemName:function(e){var t=this.down("[name=expression]");IG$._inpEdt$(t,e)},selectItem:function(e){var t=new IG$.metaSelectDlg({instance:this.instance,visibleItems:"userdb;dataset;table;inlineview;folder;metric;custommetric;measure",multiselect:!0,tree_options:{cubebrowse:!0,rootuid:this.cubeuid}});t.callback=new IG$.callBackObj(this,this.cubeSelectedHandler,e),IG$.checkLogin(this,t)},cubeSelectedHandler:function(e,t){var a=this;if("grid"==t){var n=a.down("[name=datagrid]"),i=[];i=e.length?e:[e],$.each(i,(function(e,t){var i,l=!1;for(i=0;i<n.store.data.items.length;i++)if(n.store.data.items[i].get("uid")==t.uid){l=!0;break}0==l&&(a.cubepath?t.cpath=t.nodepath.replace(a.cubepath,""):t.cpath=t.nodepath,n.store.add(t))}))}},initComponent:function(){var e=this;e.title=IRm$.r1("T_MEASURE"),$s.apply(this,{defaults:{bodyStyle:"padding:0px"},items:[{xtype:"panel",layout:"fit",border:0,autoScroll:!0,defaults:{bodyPadding:5},items:[{xtype:"form",border:0,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME")},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC"),height:50}]},{xtype:"fieldset",title:IRm$.r1("L_SYNTAX"),flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{name:"expressiontype",fieldLabel:IRm$.r1("L_TYPE"),xtype:"combobox",labelAlign:"left",labelWidth:100,valueField:"value",displayField:"label",value:"",editable:!1,store:{xtype:"store",fields:["value","label","name"],data:[{label:"Custom",name:"CUSTOM",value:"([field])"},{label:"Distinct count",name:"COUNT_DISTINCT",value:"COUNT(DISTINCT [field])"},{label:"All count",name:"COUNT_ALL",value:"COUNT([field])"},{label:"Sum",name:"SUM",value:"SUM([field])"},{label:"Average",name:"AVERAGE",value:"AVG([field])"},{label:"Max",name:"MAX",value:"MAX([field])"},{label:"Min",name:"MIN",value:"MIN([field])"}]}}]},{name:"expression",xtype:"textarea",fieldLabel:IRm$.r1("L_SYNTAX"),labelWidth:100},ig$.$l_<5?{name:"mfilter",xtype:"textarea",fieldLabel:IRm$.r1("L_M_FILTER"),labelWidth:100}:{xtype:"container",height:10},{xtype:"gridpanel",name:"datagrid",store:{xtype:"store",fields:["name","type","delete","uid","nodepath","memo","cpath"]},stateful:!0,height:100,viewConfig:{plugins:[{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_",enableDrop:!0,enableDrag:!1}],listeners:{beforedrop:function(e,t,a,n,i,l){var s,o=!1,d=t.records&&t.records.length>0?t.records[0]:null;if(this==t.view?t.copy=!1:t.copy=!0,index=a?this.panel.store.indexOf(a):0,d&&"Metric"==d.data.type){for(s=0;s<this.store.data.items.length;s++)if(this.store.data.items[s].data.uid==d.data.uid){o=!0;break}0==o&&this.store.add(d.data)}return!1},drop:function(e,t,a,n,i){a&&a.get("name");return!1}}},columns:[{text:IRm$.r1("B_NAME"),flex:1,sortable:!1,dataIndex:"name",required:!0},{text:IRm$.r1("B_TYPE"),flex:1,sortable:!1,dataIndex:"type"},{text:IRm$.r1("B_PATH"),flex:1,sortable:!1,dataIndex:"cpath"},{xtype:"actioncolumn",width:30,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,a){e.store.getAt(t);e.store.removeAt(t)}}]}],listeners:{itemdblclick:function(e,t,a,n,i,l){this.editorItemName(t.data.name)},scope:this}},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",flex:1,value:IRm$.r1("L_ME_DISP1")},{xtype:"button",text:IRm$.r1("B_ADD"),handler:function(){this.selectItem("grid")},scope:this}]}]},{xtype:"fieldset",title:IRm$.r1("L_STYLE_OPTION"),layout:"anchor",padding:"3 5",hidden:ig$.$l_>5,items:[{xtype:"combobox",name:"optstyle",fieldLabel:IRm$.r1("L_BASE_STYLE"),queryMode:"local",displayField:"disp",valueField:"name",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","type","disp"]}},{xtype:"textfield",name:"optdisplay",fieldLabel:IRm$.r1("L_DISP_TITLE")}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),name:"b_confirm",handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.datagrid=this.down("[name=datagrid]"),this.init_f()}}}),IG$.measureEditor.superclass.initComponent.apply(this,arguments)}});
IG$.HierarchyEditor=$s.extend($s.window,{modal:!1,isWindow:!0,region:"center",layout:{type:"fit",align:"stretch"},closable:!1,resizable:!1,width:500,height:580,reportoption:null,callback:null,init_f:function(){var e=this,t=e.dmode,i=new IG$._rpc$;e.down("[name=disptype]").setValue("single"),t?e.rs_procLoadContent():e.uid?(i.init(e,{ack:"content",payload:{uid:e.uid},mbody:{option:"diagnostics"}},e,e.rs_procLoadContent,null),i.send()):e.parentuid&&e.rs_procLoadContent({content:{}})},rs_procLoadContent:function(e){var t,i,n,a,o=this;if(e&&(citem=o.clItem=e.content),i=citem.nodepath?citem.nodepath.split("/"):null,citem.rel_items=citem.rel_items||[],o.down("[name=itemname]").setValue(citem.name),o.down("[name=description]").setValue(citem.description),i)for(t=0;t<citem.rel_items.length;t++)if(n=(n=citem.rel_items[t].nodepath)?n.split("/"):null){for(a=n.length-1;a>=0;a--)n[a]==i[a]&&n.splice(a,1);citem.rel_items[t].cpath=n.join("/")}o.datagrid.store.loadData(citem.rel_items),o.down("[name=disptype]").setValue(citem.display_type||"single"),o.dmode||o.getParentCube()},getParentCube:function(){var e=this;IG$.getParentCube.call(e,e.uid,e.parentuid,new IG$.callBackObj(e,(function(t){e.rs_getParentcube(t)})))},rs_getParentcube:function(e){var t=e&&e.length?e[0]:null;t&&(this.cubeuid=t.uid,this.cubepath=t.nodepath)},_confirm:function(){var e,t,i,n,a=this,o=a.clItem,l=a.down("[name=datagrid]");if(i=a.down("[name=disptype]"),o.display_type=i.getValue(),IG$.checkFields(a,["itemname"])){for(o.meta_type="hierarchy_dimension",o.name=a.down("[name=itemname]").getValue(),o.description=a.down("[name=description]").getValue(),o.rel_items=[],n=0;n<l.store.data.items.length;n++)e={uid:(t=l.store.data.items[n].data).uid,name:t.name,nodepath:t.nodepath,memo:t.memo,type:t.type},o.rel_items.push(e);if(a.dmode)a.callback&&a.callback.execute({citem:o}),a.close(),s;else{var r=new IG$._rpc$;r.init(a,{ack:"writecontent",payload:{uid:a.uid,pid:a.parentuid,name:o.name,description:o.description,type:a.itemtype,nodepath:a.parentnodepath?a.parentnodepath+"/"+o.name:null},mbody:o,meta_type:"hierarchy_dimension"},a,a.rs_saveContent,null,null),r.send()}}},rs_saveContent:function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success"),this.callback&&this.callback.execute(this.clItem),this.close()},selectItem:function(e){var t=new IG$.metaSelectDlg({instance:this.instance,visibleItems:"folder;metric;table;custommetric;dataset;measure",multiselect:1,tree_options:{cubebrowse:!0,rootuid:this.cubeuid},callback:new IG$.callBackObj(this,this.cubeSelectedHandler,e)});IG$.checkLogin(this,t)},cubeSelectedHandler:function(e,t){var i=this;"grid"==t&&$.each(e,(function(e,t){var n,a=i.down("[name=datagrid]"),o=!1;for(n=0;n<a.store.data.items.length;n++)if(a.store.data.items[n].get("uid")==t.uid){o=!0;break}0==o&&(i.cubepath?t.cpath=t.nodepath.replace(i.cubepath,""):t.cpath=t.nodepath,a.store.add(t))}))},moveGridSelection:function(e,t){var i=e.getSelectionModel().getSelection(),n=i&&i.length?i[0]:null;if(n){var a=e.getStore().indexOf(n);if(t<0){if(--a<0)return}else if(++a>=e.getStore().getCount())return;e.getStore().remove(n),n=e.getStore().insert(a,n),e.getSelectionModel().select(n,!0)}},initComponent:function(){var e=this;e.title=IRm$.r1("T_HIERARCHY"),$s.apply(this,{defaults:{bodyStyle:"padding:0px"},items:[{xtype:"panel",layout:"fit",border:0,defaults:{bodyPadding:5},items:[{xtype:"form",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME")},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC"),height:50}]},{xtype:"fieldset",title:IRm$.r1("L_METRIC_ITEMS"),flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:"hbox",items:[{name:"disptype",fieldLabel:IRm$.r1("L_TYPE"),xtype:"combobox",labelAlign:"left",labelWidth:100,valueField:"value",displayField:"name",editable:!1,store:{xtype:"store",fields:["value","name"],data:[{name:"Compact Layout",value:"single"},{name:"Outline Layout",value:"multi"}]}}]}]},{xtype:"gridpanel",name:"datagrid",store:{xtype:"store",fields:["name","type","delete","uid","nodepath","memo","cpath"]},stateful:!0,flex:1,tbar:[{xtype:"toolbar",items:[{xtype:"button",text:IRm$.r1("B_UP"),handler:function(){var e=this.down("[name=datagrid]");this.moveGridSelection(e,-1)},scope:this},{xtype:"button",text:IRm$.r1("B_DOWN"),handler:function(){var e=this.down("[name=datagrid]");this.moveGridSelection(e,1)},scope:this}]}],viewConfig:{plugins:[{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_",enableDrop:!0,enableDrag:!1}],listeners:{beforedrop:function(e,t,i,n,a,o){var l,r=!1,d=t.records&&t.records.length>0?t.records[0]:null;if(this==t.view?t.copy=!1:t.copy=!0,i?this.panel.store.indexOf(i):0,d&&"Metric"==d.data.type){for(l=0;l<this.store.data.items.length;l++)if(this.store.data.items[l].data.uid==d.data.uid){r=!0;break}0==r&&this.store.add(d.data)}return!1},drop:function(e,t,i,n,a){i&&i.get("name");return!1}}},columns:[{text:IRm$.r1("B_NAME"),flex:1,sortable:!1,dataIndex:"name"},{text:IRm$.r1("B_DESC"),flex:1,sortable:!1,dataIndex:"type"},{text:IRm$.r1("B_PATH"),flex:1,sortable:!1,dataIndex:"cpath"},{xtype:"actioncolumn",width:30,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,i){e.store.getAt(t);e.store.removeAt(t)}}]}],listeners:{itemdblclick:function(e,t,i,n,a,o){this.editorItemName(t.data.name)},scope:this}},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",flex:1,value:IRm$.r1("L_ME_DISP1")},{xtype:"button",text:IRm$.r1("B_ADD"),handler:function(){this.selectItem("grid")},scope:this}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.datagrid=this.down("[name=datagrid]"),this.init_f()}}}),IG$.HierarchyEditor.superclass.initComponent.apply(this,arguments)}});
IG$.formulaEditor=$s.extend($s.window,{modal:!1,region:"center",isWindow:!0,layout:{type:"fit",align:"stretch"},closable:!0,resizable:!1,width:500,height:550,_confirm:function(){var e,t,a,i,n=this,o=n.clItem,s=this.down("[name=datagrid]");if(IG$.checkFields(n,["itemname"])){for(o.meta_type="formula_measure",o.name=n.down("[name=itemname]").getValue(),o.description=n.down("[name=description]").getValue(),e=n.down("[name=expression]").getValue(),o.expression=e,o.rel_items=[],i=0;i<s.store.data.items.length;i++)t={uid:(a=s.store.data.items[i].data).uid,name:a.name,nodepath:a.nodepath,memo:a.memo,type:a.type},o.rel_items.push(t);if(o.stylename=n.down("[name=optstyle]").getValue(),n.dmode)n.callback&&n.callback.execute(o),n.close();else{var r=new IG$._rpc$;r.init(n,{ack:"writecontent",payload:{uid:n.uid,pid:n.parentuid,name:o.name,description:o.description,type:n.itemtype,nodepath:n.parentnodepath?n.parentnodepath+"/"+o.name:null},mbody:o,meta_type:"formula_measure"},n,n.r_confirm,null),r.send()}}},r_confirm:function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success"),this.callback&&this.callback.execute(this.clItem),this.close()},selectItem:function(e){var t=new IG$.metaSelectDlg({instance:me.instance,multiselect:1,visibleItems:"folder;metric;dataset;table;inlineview;measuregroupdimension;measure;formulameasure",tree_options:{cubebrowse:!0,rootuid:this.cubeuid}});t.callback=new IG$.callBackObj(this,this.cubeSelectedHandler,e),IG$.checkLogin(this,t)},cubeSelectedHandler:function(e,t){if("measure"==t){var a=this.down("[name=datagrid]");$.each(e,(function(e,t){var i,n=!1;for(i=0;i<a.store.data.items.length;i++)if(a.store.data.items[i].get("uid")==t.uid){n=!0;break}0==n&&a.store.add(t)}))}},editorItemName:function(e){var t=this.down("[name=expression]");IG$._inpEdt$(t,e)},init_f:function(){var e=this,t=new IG$._rpc$;e.uid?(t.init(e,{ack:"content",payload:{uid:e.uid},mbody:{option:"diagnostics"}},e,e.rs_procLoadContent,null),t.send()):e.parentuid&&(t.init(e,{ack:"helpcontent",payload:{uid:e.parentuid},mbody:{option:"cube_style_info"}},e,(function(t){e.rs_procLoadContent({content:{cubeinfo:t}})}),null),t.send())},rs_procLoadContent:function(e){var t,a=this,i=a.down("[name=datagrid]"),n=a.down("[name=optstyle]"),o=[];t=a.clItem=e.content,a.down("[name=itemname]").setValue(t.name),a.down("[name=description]").setValue(t.description),t.rel_items=t.rel_items||[],i.store.loadData(t.rel_items),a.down("[name=expression]").setValue(t.expression),o.push({disp:"--- select ---",name:""}),cubeinfo=t.cubeinfo,delete t.cubeinfo,$.each([{arr:cubeinfo.app_style.default_styles,n:"appbase"},{arr:cubeinfo.app_style.custom_styles,n:"appcustom"},{arr:cubeinfo.cube_style?cubeinfo.cube_style.custom_styles:null,n:"cubecustom"}],(function(e,t){var a,i,n=t.arr;if(n)for(a=0;a<n.length;a++)i=n[a],o.push({disp:i.name,name:i.name,type:t.n})})),n.store.loadData(o),n.setValue(t.stylename||""),a.getParentCube()},getParentCube:function(){var e=this;IG$.getParentCube.call(e,e.uid,e.parentuid,new IG$.callBackObj(e,(function(t){e.rs_getParentcube(t)})))},rs_getParentcube:function(e){var t=e&&e.length?e[0]:null;t&&(this.cubeuid=t.uid)},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_FORMULA_MEASURE"),buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],items:[{xtype:"container",padding:5,bodyPadding:"5 5",autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME"),required:!0},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC")}]},{xtype:"fieldset",title:IRm$.r1("L_SYNTAX_FORMULA"),defaultType:"textfield",layout:{type:"vbox",align:"stretch"},defaults:{labelWidth:130},items:[{name:"expression",xtype:"textarea"}]},{xtype:"displayfield",value:IRm$.r1("L_FM_DISP1")},{xtype:"gridpanel",name:"datagrid",store:{fields:["name","type","delete","uid","nodepath","memo"]},stateful:!0,height:160,viewConfig:{stripeRows:!0,plugins:{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_"},listeners:{beforedrop:function(e,t,a,i,n){var o,s=!1,r=t.records&&t.records.length>0?t.records[0]:null;if(this==t.view?t.copy=!1:t.copy=!0,a?this.panel.store.indexOf(a):0,r&&("Measure"==r.data.type||"Metric"==r.data.type||"MeasureGroup"==r.data.type||"TabDimension"==r.data.type)){for(o=0;o<this.store.data.items.length;o++)if(this.store.data.items[o].data.uid==r.data.uid){s=!0;break}0==s&&this.store.add(r.data)}return!1},drop:function(e,t,a,i){a&&a.get("name");return!1}}},columns:[{text:IRm$.r1("B_NAME"),flex:1,sortable:!1,dataIndex:"name"},{text:IRm$.r1("B_TYPE"),flex:1,sortable:!1,dataIndex:"type"},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,a){var i=e.store;i.getAt(t);i.remove(i.data.items[t])}}]}],listeners:{itemdblclick:function(e,t,a,i,n,o){var s=t.data.name||"";s&&this.editorItemName(s)},scope:this}},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",flex:1,value:IRm$.r1("L_FM_DISP2")},{xtype:"button",text:IRm$.r1("B_ADD"),handler:function(){this.selectItem("measure")},scope:this}]},{xtype:"fieldset",title:IRm$.r1("L_STYLE_OPTION"),layout:"anchor",padding:"3 5",items:[{xtype:"combobox",name:"optstyle",fieldLabel:IRm$.r1("L_BASE_STYLE"),queryMode:"local",displayField:"disp",valueField:"name",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","type","disp"]}}]}]}],listeners:{afterrender:function(){this.init_f()}}}),IG$.formulaEditor.superclass.initComponent.apply(this,arguments)}});
IG$.codeMappingPanel=$s.extend($s.panel,{region:"center",layout:"anchor",defaults:{anchor:"100%"},callback:null,pitem:null,_confirm:function(e){var t,l,a,o=this,d=o._sel_table,i=o.down("[name=cbfield]"),n=o.down("[name=cbcodefield]"),r=o.down("[name=cbsortfield]"),s=o.down("[name=viewmode]"),c=o.down("[name=rftb1]"),u=o.down("[name=rftxt1]"),m=o.down("[name=rftb2]"),f=o.down("[name=rftxt2]"),b=o.down("[name=rftb3]"),p=o.down("[name=rftxt3]"),h=o.down("[name=rftc1]"),y=o.down("[name=rftc2]"),x=o.down("[name=rftc3]"),L=i.getValue(),_=n.getValue(),w=r.getValue();tname=d?d.name:null,c=c.getValue(),m=m.getValue(),b=b.getValue(),t=c&&u.getValue()?c+"|"+u.getValue()+"|"+h.getValue():null,l=m&&f.getValue()?m+"|"+f.getValue()+"|"+y.getValue():null,a=b&&p.getValue()?b+"|"+p.getValue()+"|"+x.getValue():null,o.rec.set("edited",!0),o.rec.set("codetable",d?d.name:null),o.rec.set("codetableuid",d?d.uid:null),o.rec.set("codefield",_),o.rec.set("valuefield",L),o.rec.set("sortfield",w),o.rec.set("codefilter1",t),o.rec.set("codefilter2",l),o.rec.set("codefilter3",a),o.rec.set("viewmode",s.getValue()),o.pitem&&(o.pitem.edited=!0,$.each(["codetable","codetableuid","codefield","valuefield","sortfield","codefilter1","codefilter2","codefilter3","codemapping","viewmode"],(function(e,t){o.pitem[t]=o.rec.get(t)})))},loadContent:function(){var e=this,t=e.datasource,l=new IG$._rpc$;t&&e.rec&&e.rec.codetableuid&&(l.init(e,{ack:"helpcontent",payload:{uid:e.rec.codetableuid},mbody:{option:"translate"}},e,(function(e){e&&e.length&&(this._sel_table=e[0],this.down("[name=cbtable]").setValue(this._sel_table.name),this.loadField())})),l.send())},loadField:function(){var e=new IG$._rpc$,t=this._sel_table;t&&(e.init(this,{ack:"content",payload:{uid:t.uid},mbody:{option:"folder"}},this,this.rs_loadField,null),e.send())},rs_loadField:function(e){var t,l,a,o,d,i,n,r,s,c,u,m,f,b,p=this,h=p.down("[name=cbfield]"),y=p.down("[name=cbcodefield]"),x=p.down("[name=cbsortfield]"),L=p.down("[name=viewmode]"),_=p.rec.get("codefield"),w=p.rec.get("valuefield"),I=p.rec.get("sortfield"),g=p.rec.get("viewmode"),v=[];if(a=e?e.children:null)for(t=0;t<a.length;t++)(o=a[t]).uid=o.uid||t,o.uid==_&&(d=o.uid),o.uid==w&&(i=o.uid),o.uid==I&&(n=o.uid),v.push(o);for(h.store.loadData(v,!1),y.store.loadData(v,!1),y.setValue(d),h.setValue(i),x.store.loadData(v,!1),x.setValue(n),L.setValue(g||""),p.down("[name=rftb1]").store.loadData(v,!1),p.down("[name=rftb2]").store.loadData(v,!1),p.down("[name=rftb3]").store.loadData(v,!1),t=1;t<4;t++)if((r=p.rec.get("codefilter"+t))&&(s=p.down("[name=rftb"+t+"]"),c=p.down("[name=rftxt"+t+"]"),m=p.down("[name=rftc"+t+"]"),r.indexOf("|")>-1))for(p.down("[name=rfilter"+t+"]").expand(),u=r.substring(0,r.indexOf("|")),b="1",(f=r.substring(r.indexOf("|")+1)).indexOf("|")>-1&&(b=f.substring(f.indexOf("|")+1),f=f.substring(0,f.indexOf("|"))),c.setValue(f),m.setValue(b),l=0;l<v.length;l++)if(v[l].nodepath==u){s.setValue(v[l].uid);break}},initComponent:function(){var e=[];$.each(IG$.filteropcodes,(function(t,l){e.push({value:l.name,name:l.locale})})),$s.apply(this,{items:[{xtype:"fieldset",checkboxToggle:"cmap"!=this.d_m,title:IRm$.r1("L_LOOKUP"),collapsed:!1,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"fieldcontainer",fieldLabel:IRm$.r1("B_TABLE"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"cbtable",readOnly:!0,emptyText:IRm$.r1("M_SEL_ITEM"),flex:1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){if(this.datasource){var e=new IG$.metaSelectDlg({instance:this.instance,visibleItems:"folder;table;inlineview;dataset;bo",targetobj:"inlineview;table;",tree_options:{cubebrowse:!0,rootuid:this.datasource},callback:new IG$.callBackObj(this,(function(e){var t=e.type.toLowerCase();1==/(inlineview|table)/.test(t)&&(this.down("[name=cbtable]").setValue(e.name),this._sel_table=e,this.loadField())}))});IG$.checkLogin(this,e)}},scope:this}]},{xtype:"combobox",name:"cbcodefield",queryMode:"local",fieldLabel:IRm$.r1("L_CODE_FIELD"),displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"cbfield",queryMode:"local",fieldLabel:IRm$.r1("L_VALUE_FIELD"),displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"cbsortfield",queryMode:"local",fieldLabel:IRm$.r1("L_SORT_FIELD"),displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}}]},{xtype:"fieldset",title:IRm$.r1("L_ADV_OPTION"),collapsed:!1,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"combobox",fieldLabel:IRm$.r1("L_DATA_VIEW"),name:"viewmode",queryMode:"local",editable:!1,valueField:"value",displayField:"name",store:{xtype:"store",fields:["name","value"],data:[{name:"Matching Values",value:""},{name:"Show All Codes",value:"code"},{name:"Show All Values",value:"value"}]}}]},{xtype:"fieldset",name:"rfilter1",checkboxToggle:!0,title:IRm$.r1("L_RANGE_FILTER1"),collapsed:!0,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"combobox",name:"rftb1",fieldLabel:IRm$.r1("L_FILTER_FIELD"),queryMode:"local",displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"rftc1",fieldLabel:IRm$.r1("B_OP"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{fields:["name","value"],data:e}},{xtype:"textfield",name:"rftxt1",fieldLabel:IRm$.r1("L_FILTER_VALUE")}],listeners:{collapse:function(e,t){this.down("[name=rftb1]").setValue(""),this.down("[name=rftxt1]").setValue("")}}},{xtype:"fieldset",name:"rfilter2",checkboxToggle:!0,title:IRm$.r1("L_RANGE_FILTER2"),collapsed:!0,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"combobox",name:"rftb2",fieldLabel:IRm$.r1("L_FILTER_FIELD"),queryMode:"local",displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"rftc2",fieldLabel:IRm$.r1("B_OP"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{fields:["name","value"],data:e}},{xtype:"textfield",name:"rftxt2",fieldLabel:IRm$.r1("L_FILTER_VALUE")}],listeners:{collapse:function(e,t){this.down("[name=rftb2]").setValue(""),this.down("[name=rftxt2]").setValue("")}}},{xtype:"fieldset",name:"rfilter3",checkboxToggle:!0,title:IRm$.r1("L_RANGE_FILTER3"),collapsed:!0,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"combobox",name:"rftb3",fieldLabel:IRm$.r1("L_FILTER_FIELD"),queryMode:"local",displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"rftc3",fieldLabel:IRm$.r1("B_OP"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{fields:["name","value"],data:e}},{xtype:"textfield",name:"rftxt3",fieldLabel:IRm$.r1("L_FILTER_VALUE")}],listeners:{collapse:function(e,t){this.down("[name=rftb3]").setValue(""),this.down("[name=rftxt3]").setValue("")}}}]}),IG$.codeMappingPanel.superclass.initComponent.apply(this,arguments)}});
IG$.metricEditor=$s.extend($s.window,{modal:!0,layout:{type:"vbox",align:"stretch"},closable:!1,resizable:!0,width:480,height:520,callback:null,_confirm:function(){var e=this,t=e.item;if(t){var a,n=e.down("[name=cb_sortdir]").getGroupValue(),i=(e.down("[name=cb_sorttype]"),e.down("[name=cb_sorttype]").getGroupValue()),o=e.down("[name=optstyle]"),l=e.down("[name=optremoveblank]"),m=e.down("[name=isdatetype]"),s=e.down("[name=dateformat]"),d=e.down("[name=usegeocode]"),r=e.down("[name=datatype]"),p=e.down("[name=db_datatype]"),u=e.down("[name=fname]"),c=(IG$.majorDateformat,t.content),_=t.metric?t.metric.fields:null;if(!IG$.checkFields(e,["itemname"]))return;c.name=e.down("[name=itemname]").getValue(),c.description=e.down("[name=description]").getValue(),t.name=c.name,t.description=c.description,c.sortorder=""==n?null:n,c.sorttype=""==i?null:i,c.removeblank=l.getValue(),c.stylename=o.getValue(),c.isdatetype=1==m.getValue(),c.dateformat=s.getValue(),c.fieldname=u.getValue(),c.datatype=r.getValue(),c.db_datatype=p.getValue(),c.attributes&&(c.attributes.attrb4=c.db_datatype),c.enable_geocode=1==d.getValue(),c.mask={type:e.down("[name=masktype]").getValue(),pattern:e.down("[name=mpattern]").getValue(),pattern_replace:e.down("[name=mpattern_rep]").getValue(),aes_pp:e.down("[name=aes_passph]").getValue()},_&&_.length&&u.getValue()&&(_[0].name=u.getValue(),a=(a=_[0].nodepath).substring(0,a.lastIndexOf("/"))+"/"+_[0].name,_[0].nodepath=a),c.dateitems="CUSTOM",c.datecustom=e.down("[name=t_dateformat]").getValue()}if("sql_report"==e.rpt_meta_type)e.callback&&e.callback.execute(e.item),e.close();else if(t.writable){var h=new IG$._rpc$,y=t.content;h.init(this,{ack:"writecontent",payload:{uid:this.uid,name:y.name,description:y.description},mbody:y,meta_type:"dimension"},this,this.rs_saveCnt,null),h.send()}else e.close()},rs_saveCnt:function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success"),this.callback&&this.callback.execute(this.item),this.close()},init_f:function(){var e=this;e.formulas=[],e.dmode_cnt?(e.dmode_cnt.cubeinfo={app_style:{default_styles:[],custom_styles:[]}},e.rs_loadItemContent({name:e.dmode_cnt.name,description:e.dmode_cnt.description,uid:e.dmode_cnt.uid,content:e.dmode_cnt,writable:!0})):e.uid&&e.loadItemContent()},applyItemInfo:function(){var e,t,a=this,n=a.item,i=n.content,o=i.sortorder||"",l=a.down("[name=optsortdir]"),m=i.sorttype||"",s=a.down("[name=optsorttype]"),d=a.down("[name=optstyle]"),r=a.down("[name=optremoveblank]"),p=a.down("[name=optsortitemname]"),u=a.down("[name=optdispitemname]"),c=a.down("[name=optcommentitemname]"),_=a.down("[name=isdatetype]"),h=a.down("[name=datatype]"),y=a.down("[name=db_datatype]"),f=a.down("[name=dateformat]"),b=a.down("[name=usegeocode]"),x=a.down("[name=cmap_disp]"),I=a.down("[name=fname]"),R=a.down("[name=masktype]"),g=(IG$.majorDateformat,[]),E=[],L=i.mask||{};for(a.down("[name=b_confirm]").setVisible(n.writable),a.down("[name=itemname]").setValue(i.name),a.down("[name=description]").setValue(i.description),l.setValue({cb_sortdir:[o]}),s.setValue({cb_sorttype:[m]}),r.setValue(i.removeblank||!1),_.setValue(i.isdatetype||!1),f.setValue(i.dateformat||""),b.setValue(i.enable_geocode),x.setValue(i.cmap_disp||""),h.setValue(i.datatype),y.setValue(i.db_datatype),a.down("[name=tname]").setValue(i.tablename),I.setValue(i.fieldname),R.setValue(L.type),a.down("[name=geolat]").setValue(i.geolat?i.geolat.name:null),a.down("[name=geolng]").setValue(i.geolng?i.geolng.name:null),i.opt_sort_item&&p.setValue(i.opt_sort_item.name),i.opt_disp_item&&u.setValue(i.opt_disp_item.name),i.opt_comment_item&&c.setValue(i.opt_comment_item.name),a.down("[name=mpattern]").setValue(L.pattern),a.down("[name=mpattern_rep]").setValue(L.pattern_replace),a.down("[name=aes_passph]").setValue(L.aes_pp),g.push({disp:"--- select ---",name:"",type:""}),a.styles=E,t=i.cubeinfo,delete i.cubeinfo,$.each([{arr:t.app_style.default_styles,n:"appbase"},{arr:t.app_style.custom_styles,n:"appcustom"},{arr:t.cube_style?t.cube_style.custom_styles:null,n:"cubecustom"}],(function(e,t){var a,n,i=t.arr;if(i)for(a=0;a<i.length;a++)n=i[a],E.push({name:n.name,type:t.n})})),e=0;e<E.length;e++)g.push({disp:E[e].name,name:E[e].name,type:E[e].type});d.store.loadData(g),d.setValue(i.stylename||""),a.down("[name=t_dateformat]").setValue(i.datecustom||"")},loadItemContent:function(){var e;(e=new IG$._rpc$).init(this,{ack:"content",payload:{uid:this.uid},mbody:{option:"diagnostics"}},this,this.rs_loadItemContent,!1),e.send()},rs_loadItemContent:function(e){this.item=e,this.applyItemInfo(),"sql_report"!=this.rpt_meta_type&&this.getMeasures()},getMeasures:function(){var e,t=this.down("[name=grd_measures]");(e=new IG$._rpc$).init(this,{ack:"content",payload:{uid:this.uid},mbody:{option:"folder"}},this,(function(e){t.store.loadData(e.children)}),!1),e.send()},changeDateFormat:function(){this.down("[name=dateformat]").setValue("")},cubeSelectedHandler:function(e){var t=this,a=new IG$.metaSelectDlg({instance:t.instance,folderItems:"codemap"==e?"folder;codemap":"folder;dataset;table;metric;inlineview;measure",visibleItems:"codemap"==e?"folder;codemap":"folder;dataset;table;metric;inlineview;measure",tree_options:{cubebrowse:!0,rootuid:"codemap"==e?"/SYS_Lookup":t.item.content.cubeuid||t.cubeuid},callback:new IG$.callBackObj(t,t.rs_cubeSelectedHandler,e)});IG$.checkLogin(t,a)},rs_cubeSelectedHandler:function(e,t){var a=this,n=a.item.content;"codemap"==t?(n.cmap_uid=e.uid,n.cmap_disp=e.name,a.down("[name=cmap_disp]").setValue(e.name)):"optsortitemname"==t?(n.opt_sort_item={uid:e.uid,name:e.name},a.down("[name=optsortitemname]").setValue(e.name)):"optdispitemname"==t?(n.opt_disp_item={uid:e.uid,name:e.name},a.down("[name=optdispitemname]").setValue(e.name)):"optcommentitemname"==t?(n.opt_comment_item={uid:e.uid,name:e.name},a.down("[name=optcommentitemname]").setValue(e.name)):"geolat"==t?(n.geolat={uid:e.uid,name:e.name},a.down("[name=geolat]").setValue(e.name)):"geolng"==t&&(n.geolng={uid:e.uid,name:e.name},a.down("[name=geolng]").setValue(e.name))},edit_customfield:function(e){var t=this.instance.mainPanel,a=e.get("type").toLowerCase();t&&e.get("writable")&&t.navigateApp.call(t,e.get("uid"),a,e.get("name"),e.get("nodepath"),!0,e.get("writable"),{callback:new IG$.callBackObj(this,(function(t){t&&e.set("name",t.name)}))})},initComponent:function(){var e,t=this,a=[],n=t.styles,i=[{text:IRm$.r1("B_EMAIL"),handler:function(){var e=this.down("[name=mpattern]"),t=this.down("[name=mpattern_rep]");e.setValue("(^[^@]{3}|(?!^)\\G)[^@]"),t.setValue("$1*")},scope:this}],o=ig$.patterns;if(o&&$.each(o,(function(e,t){pitems.push({text:t.name,handler:function(){var e=this.down("[name=mpattern]"),a=this.down("[name=mpattern_rep]");e.setValue(t.value),t.replace&&a.setValue(t.replace)},scope:this})})),t.title=IRm$.r1("T_METRIC_SETTING"),a.push({name:"-Item Default-",value:""}),n&&n.length>0)for(e=0;e<n.length;e++)a.push({name:n[e].name,value:n[e].name});$s.apply(t,{padding:0,border:0,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:5,items:[{xtype:"tabpanel",items:[{xtype:"panel",layout:"anchor",autoScroll:!0,bodyPadding:"5 5",title:IRm$.r1("B_GENERAL"),defaults:{anchor:"100%"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME")},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC")},{xtype:"fieldset",title:IRm$.r1("L_SORT_SEL"),layout:"anchor",padding:"0 5",defaults:{anchor:"100%"},items:[{xtype:"radiogroup",name:"optsortdir",fieldLabel:IRm$.r1("L_SORT_ORD"),padding:"0 5",plain:!0,items:[{boxLabel:IRm$.r1("B_DEFAULT"),name:"cb_sortdir",inputValue:"",checked:!0},{boxLabel:IRm$.r1("B_ASC"),name:"cb_sortdir",inputValue:"asc"},{boxLabel:IRm$.r1("B_DSC"),name:"cb_sortdir",inputValue:"desc"}]},{xtype:"radiogroup",name:"optsorttype",fieldLabel:IRm$.r1("L_SORT_TP"),padding:"0 5",plain:!0,items:[{boxLabel:IRm$.r1("B_DEFAULT"),name:"cb_sorttype",inputValue:"",checked:!0},{boxLabel:IRm$.r1("B_STRING"),name:"cb_sorttype",inputValue:"VARCHAR"},{boxLabel:IRm$.r1("B_NUMERIC"),name:"cb_sorttype",inputValue:"NUMBER"}]},{xtype:"fieldcontainer",name:"optdispitem",fieldLabel:IRm$.r1("L_F_DISP"),hidden:"sql_report"==t.rpt_meta_type||ig$.$l_>5,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"optdispitemname",emptyText:IRm$.r1("M_SEL_ITEM"),flex:1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.cubeSelectedHandler("optdispitemname")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){this.item.content.opt_disp_item=null,this.down("[name=optdispitemname]").setValue("")},scope:this}]},{xtype:"fieldcontainer",name:"optsortitem",hidden:"sql_report"==t.rpt_meta_type||ig$.$l_>5,fieldLabel:IRm$.r1("L_F_SORT"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"optsortitemname",emptyText:IRm$.r1("M_SEL_ITEM"),flex:1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.cubeSelectedHandler("optsortitemname")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){this.item.content.opt_sort_item=null,this.down("[name=optsortitemname]").setValue("")},scope:this}]},{xtype:"fieldcontainer",name:"optcommentitem",fieldLabel:IRm$.r1("L_F_COMMENT"),hidden:"sql_report"==t.rpt_meta_type||ig$.$l_>5,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"optcommentitemname",emptyText:IRm$.r1("M_SEL_ITEM"),flex:1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.cubeSelectedHandler("optcommentitemname")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){this.item.content.opt_comment_item=null,this.down("[name=optcommentitemname]").setValue("")},scope:this}]}]},{xtype:"fieldset",title:IRm$.r1("L_STYLE_OPTION"),layout:"anchor",padding:"3 5",hidden:ig$.$l_>5,items:[{xtype:"combobox",name:"optstyle",fieldLabel:IRm$.r1("L_BASE_STYLE"),queryMode:"local",displayField:"disp",valueField:"name",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","type","disp"]}}]},{xtype:"fieldset",title:IRm$.r1("L_OTHER_OPTION"),layout:"anchor",padding:"3 5",hidden:ig$.$l_>5,defaults:{anchor:"100%"},items:[{xtype:"checkbox",name:"optremoveblank",boxLabel:IRm$.r1("L_REM_BLK")},{xtype:"checkbox",name:"isdatetype",boxLabel:IRm$.r1("L_DATE_TYPE"),listeners:{change:function(e,t,a,n){var i=e.getValue(),o=this.down("[name=t_format]"),l=this.down("[name=d_format]");this.down("[name=customdatetypecontainer]");o.setVisible(i),l.setVisible(i)},scope:this}},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATE_FORMAT_SRC"),name:"d_format",labelWidth:130,hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"dateformat",flex:1},{xtype:"button",text:IRm$.r1("B_EXAMPLE"),menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){t.down("[name=dateformat]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){t.down("[name=dateformat]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){t.down("[name=dateformat]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){t.down("[name=dateformat]").setValue(this.value)}}]}}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATE_FORMAT_TGT"),name:"t_format",labelWidth:130,hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"t_dateformat",flex:1},{xtype:"button",text:IRm$.r1("B_EXAMPLE"),menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){t.down("[name=t_dateformat]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){t.down("[name=t_dateformat]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){t.down("[name=t_dateformat]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){t.down("[name=t_dateformat]").setValue(this.value)}}]}}]}]},{xtype:"fieldset",title:IRm$.r1("L_CODE_FIELD"),layout:"anchor",hidden:ig$.$l_>5,defaults:{anchor:"100%"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:IRm$.r1("L_CODE_FIELD"),items:[{xtype:"textfield",name:"cmap_disp",emptyText:IRm$.r1("M_SEL_ITEM"),readOnly:!0,flex:1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.cubeSelectedHandler("codemap")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){var e=this.item.content;this.down("[name=cmap_disp]").setValue(null),e.cmap_disp=null,e.cmap_uid=null},scope:this}]}]}]},{xtype:"panel",title:IRm$.r1("B_ADVANCED"),layout:"anchor",bodyPadding:"5 5",autoScroll:!0,defaults:{anchor:"100%"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("L_TABLE_NAME"),name:"tname",readOnly:!0},{xtype:"textfield",fieldLabel:IRm$.r1("L_FIELD_NAME"),name:"fname"},{xtype:"textfield",fieldLabel:IRm$.r1("B_DATATYPE"),name:"datatype"},{xtype:"combobox",name:"db_datatype",fieldLabel:" ",queryMode:"local",displayField:"name",valueField:"value",store:{data:[{name:"",value:""},{name:"BIT",value:"-7"},{name:"TINYINT",value:"-6"},{name:"SMALLINT",value:"5"},{name:"INTEGER",value:"4"},{name:"BIGINT",value:"-5"},{name:"FLOAT",value:"6"},{name:"REAL",value:"7"},{name:"DOUBLE",value:"8"},{name:"NUMERIC",value:"2"},{name:"DECIMAL",value:"3"},{name:"CHAR",value:"1"},{name:"VARCHAR",value:"12"},{name:"LONGVARCHAR",value:"-1"},{name:"DATE",value:"91"},{name:"TIME",value:"92"},{name:"TIMESTAMP",value:"93"},{name:"BINARY",value:"-2"},{name:"VARBINARY",value:"-3"},{name:"LONGVARBINARY",value:"-4"},{name:"NULL",value:"0"},{name:"OTHER",value:"1111"},{name:"JAVA_OBJECT",value:"2000"},{name:"DISTINCT",value:"2001"},{name:"STRUCT",value:"2002"},{name:"ARRAY",value:"2003"},{name:"BLOB",value:"2004"},{name:"CLOB",value:"2005"},{name:"REF",value:"2006"},{name:"DATALINK",value:"70"},{name:"BOOLEAN",value:"16"},{name:"ROWID",value:"-8"},{name:"NCHAR",value:"-15"},{name:"NVARCHAR",value:"-9"},{name:"LONGVARCHAR",value:"-16"},{name:"NCLOB",value:"2011"},{name:"SQLXML",value:"2009"},{name:"REF_CURSOR",value:"2012"},{name:"TIME_WITH_TIMEZONE",value:"2013"},{name:"TIMESTAMP_WITH_TIMEZONE",value:"2014"}]}},{xtype:"fieldset",title:IRm$.r1("L_MASK_TEXT"),layout:"anchor",hidden:ig$.$l_>5,items:[{xtype:"combobox",name:"masktype",fieldLabel:IRm$.r1("L_MASK_TYPE"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:"No Mask",value:""},{name:"RegExp Pattern",value:"pattern"},{name:"Base64 Encoding",value:"base64"},{name:"SHA-1",value:"sha1"},{name:"AES",value:"aes"}]},listeners:{change:function(e){var t=e.getValue(),a=this.down("[name=pb1]"),n=this.down("[name=mpattern_rep]"),i=this.down("[name=aes_passph]");a["pattern"==t?"show":"hide"](),n["pattern"==t?"show":"hide"](),i["aes"==t?"show":"hide"]()},scope:this}},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_MASK_PATTERN"),hidden:!0,name:"pb1",layout:"hbox",items:[{xtype:"textfield",name:"mpattern"},{xtype:"button",text:IRm$.r1("B_EXAMPLE"),menu:{xtype:"menu",items:i}}]},{xtype:"textfield",name:"mpattern_rep",hidden:!0,fieldLabel:IRm$.r1("L_REPLACE_WITH")},{xtype:"textfield",name:"aes_passph",hidden:!0,fieldLabel:IRm$.r1("L_AES_PASS_PHRASE")}]},{xtype:"fieldset",title:IRm$.r1("L_MEASURES"),hidden:"sql_report"==t.rpt_meta_type,layout:"anchor",hidden:ig$.$l_>5,items:[{xtype:"gridpanel",height:160,name:"grd_measures",tbar:[{text:IRm$.r1("B_REFRESH"),handler:function(){this.getMeasures()},scope:this},"->",{text:IRm$.r1("L_ADD_FORMULA"),handler:function(){var e=this,t=new IG$.multiMeasure({instance:e.instance,uid:e.uid,mitem:e.item,vmode:2,callback:new IG$.callBackObj(e,e.getMeasures)});IG$.checkLogin(e,t)},scope:this}],store:{fields:["name"]},columns:[{text:IRm$.r1("B_NAME"),width:220,dataIndex:"name"},{text:IRm$.r1("B_FORMULA"),flex:1},{xtype:"actioncolumn",width:80,items:[{iconCls:"icon-grid-config",handler:function(e,t,a,n){this.edit_customfield(n)},scope:this},{iconCls:"icon-grid-delete",handler:function(e,t,a,n){if(n.get("uid")){var i=this;IG$.confirmMessages(ig$.appname,IRm$.r1("M_CONFIRM_DELETE"),(function(t){if("yes"==t){var a=new IG$._rpc$;a.init(i,{ack:"deletecontent",payload:{uid:n.get("uid")},mbody:{}},i,(function(t){e.store.remove(n)})),a.send()}}),i,i)}},scope:this}]}]}]},{xtype:"fieldset",title:IRm$.r1("L_GEOCODE"),hidden:"sql_report"==t.rpt_meta_type,layout:"anchor",hidden:ig$.$l_>5,items:[{xtype:"checkbox",fieldLabel:IRm$.r1("L_USE_GEOCODE"),name:"usegeocode",boxLabel:IRm$.r1("B_ENABLED")},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("B_LAT"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,emptyText:IRm$.r1("M_SEL_ITEM"),name:"geolat"},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.cubeSelectedHandler("geolat")},scope:this}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("B_LNG"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,emptyText:IRm$.r1("M_SEL_ITEM"),name:"geolng"},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.cubeSelectedHandler("geolng")},scope:this}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"fieldcontainer",flex:1},{xtype:"button",text:IRm$.r1("L_GEOMAPPING"),handler:function(){var e=new IG$.geoMapping({instance:me.instance,uid:this.uid});IG$.checkLogin(this,e)},scope:this}]}]}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),name:"b_confirm",handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){this.init_f()}}}),IG$.metricEditor.superclass.initComponent.apply(this,arguments)}});
IG$.geoMapping=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:500,autoHeight:!0,callback:null,_confirm:function(){this.callback&&this.callback.execute([]),this.close()},in$t:function(){var e=this.down("[name=georeqtype]");ig$.geo_encoding&&ig$.geo_encoding.length>0&&e.store.loadData(ig$.geo_encoding),this.getValueList()},getValueList:function(){if(this.uid){var e,t=new IG$._rpc$;e={uid:this.uid,option:"valuelist"},t.init(this,{ack:"olapservice",payload:e,mbody:{}},this,this.rs_getValueList,null),t.send()}},rs_getValueList:function(e){var t=this.uid,o=new IG$._ICd(e,t),i=this.down("[name=grd_data]");this.pool=o.pool,i.store.loadData(o.data)},geoEncode:function(){var e=this.down("[name=georeqtype]").getValue();if(e){var t,o,i,a,n=new IG$._rpc$,l=this.down("[name=grd_data]");for(o={uid:this.uid,action:"geoencode",georeqtype:e},t={items:[]},i=0;i<l.store.data.items.length;i++)(a=l.store.data.items[i]).get("lat")&&a.get("lng")||t.items.push({code:a.get("code")});n.init(this,{ack:"geoservice",payload:o,mbody:t},this,this.rs_geoEncode,null),n.send()}},rs_geoEncode:function(e){var t,o,i,a,n,l,s=this.down("[name=georeqtype]").getValue(),d=IG$.XGetNode(e,"/smsg/results"),r=d?IG$.XGetChildNodes(d):null,c=this.down("[name=grd_data]"),g={};if(r){if(n=IG$.geocoder&&IG$.geocoder[s]?IG$.geocoder[s]:null)for(t=0;t<r.length;t++)o=IG$._I19(r[t],"code"),o=IG$.XGetTextVal(o),a=IG$._I19(r[t],"result"),a=IG$.XGetTextVal(a),a=Base64.decode(a),(l=n.getGeoCode(a)).lat&&l.lng&&(g[o]=l);for(t=0;t<c.store.data.items.length;t++)(l=g[(i=c.store.data.items[t]).get("code")])&&(i.set("lat",l.lat),i.set("lng",l.lng))}},updateGeoData:function(){var e=this.down("[name=geosql]").getValue();if(this.uid&&e&&this.pool){var t,o,i,a="",n=new IG$._rpc$,l=this.down("[name=grd_data]");for(t={uid:this.uid,action:"geoupdate",pool:this.pool},a={sql:e,items:[]},o=0;o<l.store.data.items.length;o++)(i=l.store.data.items[o]).get("lat")&&i.get("lng")&&a.items.push({lat:i.get("lat"),lng:i.get("lng"),code:i.get("code")});n.init(this,{ack:"geoservice",payload:t,mbody:a},this,this.rs_geoEncode,null),n.send()}},rs_updateGeoData:function(e){},initComponent:function(){$s.apply(this,{defaults:{bodyStyle:"padding:10px"},title:IRm$.r1("L_GEOMAPPING"),items:[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"displayfield",value:"Address to geo axis values"},{xtype:"gridpanel",name:"grd_data",height:250,store:{xtype:"store",fields:["code","lat","lng"]},plugins:[{ptype:"cellediting",clicksToEdit:!1}],columns:[{xtype:"gridcolumn",text:IRm$.r1("L_GEO_ADDRESS"),dataIndex:"code",flex:1},{xtype:"gridcolumn",text:IRm$.r1("B_LAT"),dataIndex:"lat",editor:{allowBlank:!1}},{xtype:"gridcolumn",text:IRm$.r1("B_LNG"),dataIndex:"lng",editor:{allowBlank:!1}}]},{xtype:"fieldset",title:"Get GeoEncode",layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"combobox",fieldLabel:IRm$.r1("L_GEO_REQ_TYPE"),flex:1,name:"georeqtype",queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"]}},{xtype:"button",text:IRm$.r1("L_UPD_GEOCODE"),handler:function(){this.geoEncode()},scope:this}]},{xtype:"textarea",name:"geosql",fieldLabel:IRm$.r1("L_APPLY_DB")},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"fieldcontainer",flex:1},{xtype:"button",text:IRm$.r1("L_RUN_SQL"),handler:function(){this.updateGeoData()},scope:this}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.in$t()}}}),IG$.geoMapping.superclass.initComponent.apply(this,arguments)}});
IG$.cubeStyle=$s.extend($s.window,{modal:!0,layout:"border",closable:!1,resizable:!0,width:720,height:500,reportoption:null,callback:null,globalstyle:null,globalstylemap:null,styleinfo:null,loadGlobalStyle:function(){var e=new IG$._rpc$;e.init(this,{ack:"appoption",payload:{address:"ReportStyle"},mbody:{}},this,this.rs_loadGlobalStyle,null),e.send()},rs_loadGlobalStyle:function(e){var t,l,a,n,o,s=e.themes[0],i=[{name:"Select Item",value:""}],m=(ig$.theme_id,["default_styles","custom_styles"]);if(this.globalstyle=[],this.globalstylemap={},s){for(n=0;n<m.length;n++)if(t=s[a=m[n]])for(o=0;o<t.length;o++)l=t[o],this.globalstyle.push(l),i.push({name:l.name,value:l.name}),this.globalstylemap[l.name]=l;for(a in this.globalstylemap)(l=this.globalstylemap[a]).basestylename&&this.globalstylemap[l.basestylename]&&this.globalstylemap[l.basestylename]}this.down("[name=base_style]").store.loadData(i),this.loadLocalStyle()},loadLocalStyle:function(){var e,t,l,a,n=this,o=n.down("[name=stylelist]"),s=[];if(n.down("[name=c_cset]").setValue(n.c_cset||""),n.styleinfo){for(a={name:"LocalStyle",leaf:!1,children:[]},s.push(a),e=0;e<n.styleinfo.length;e++)l={name:(t=n.styleinfo[e]).name,leaf:!0,custom:!1},t.basestylename&&n.globalstylemap[t.basestylename]&&n.globalstylemap[t.basestylename],a.children.push(l);o.store.setRootNode({expanded:!0,text:IRm$.r1("B_STYLE"),name:IRm$.r1("B_STYLE"),title:IRm$.r1("B_STYLE"),children:s})}},editStyleItem:function(e){var t,l=this,a=l.down("[name=form_header]"),n=l.down("[name=form_data]");for(l.commitStyleItem(),t=0;t<l.styleinfo.length;t++)if(l.styleinfo[t].name==e){l._edtItem=l.styleinfo[t],l._valForm=1,l.down("[name=sname]").setValue(l.styleinfo[t].name),l.down("[name=base_style]").setValue(l.styleinfo[t].basestylename||""),a.loadStyleData.call(a,l.styleinfo[t].header),n.loadStyleData.call(n,l.styleinfo[t].data),l._valForm=0;break}},commitStyleItem:function(){var e=this,t=e.down("[name=form_header]"),l=e.down("[name=form_data]"),a=e.down("[name=sname]").getValue();nvalue=e.down("[name=base_style]").getValue(),e._edtItem&&nvalue&&a&&(e._edtItem.basestylename=nvalue,e._edtItem.name=a,l.updateStyleData.call(l),t.updateStyleData.call(t))},_confirm:function(){var e,t,l=this;for(l.commitStyleItem(),e=0;e<l.styleinfo.length;e++)(t=l.styleinfo[e]).basestylename&&l.globalstylemap[t.basestylename]&&l.globalstylemap[t.basestylename];l.c_cset=l.down("[name=c_cset]").getValue(),l.callback&&l.callback.execute(l),l.close()},toolbarHandler:function(e){switch(e){case"cmd_add_custom":var t=new IG$.makeStyle({instance:this.instance,styleinfo:this.globalstyle,callback:new IG$.callBackObj(this,this.rs__appendCustomStyle)});IG$.checkLogin(this,t);break;case"cmd_delete":var l,a=this.down("[name=stylelist]").getSelectionModel().selected,n=a&&a.length>0?a.items[0]:null;if(n)for(l=0;l<this.styleinfo.length;l++)if(n.get("name")==this.styleinfo[l].name){this.styleinfo.splice(l,1),n.remove();break}}},rs__appendCustomStyle:function(e){var t=e[0],l=e[1];if(l&&t&&this.globalstylemap[l]){var a,n,o,s=this.down("[name=stylelist]"),i=s.store.getRootNode();o=i.childNodes[i.childNodes.length-1],n={name:t,leaf:!0,custom:!0},(a={}).name=t,a.nodename="ItemStyle",a.basestylename=l,a.header={},a.data={},this.styleinfo.push(a);var m=[s.store._record(n)];s.store._appendNode(m,o)}},initComponent:function(){var e,t=this,l=new IG$.styleEditor({instance:me.instance,title:IRm$.r1("L_STYLE_TITLE"),name:"form_header",htype:"hd"}),a=new IG$.styleEditor({instance:me.instance,title:IRm$.r1("L_STYLE_DATA"),name:"form_data",htype:"dt"}),n=[{name:IRm$.r1("B_DEFAULT"),value:""}],o=IG$.__chartoption.chartcolors;for(e in o)n.push({name:e,value:e});t.title=IRm$.r1("T_STYLE_WIZARD"),$s.apply(this,{defaults:{bodyStyle:"padding:3px"},items:[{xtype:"treepanel",title:IRm$.r1("B_STYLE"),name:"stylelist",preventHeader:!0,region:"west",width:160,split:!0,border:!1,rootVisible:!1,hideHeaders:!0,autoScroll:!0,store:{xtype:"treestore",fields:["name","text","type","pname","region","custom"],root:{expanded:!0,name:"Style",children:[]},folderSort:!1},useArrows:!0,dockedItems:[{xtype:"toolbar",dock:"top",plain:!0,items:[{iconCls:"icon-toolbar-add",tooltip:"Add Custom Style",text:IRm$.r1("L_ADD_NEW"),handler:function(){this.toolbarHandler("cmd_add_custom")},scope:this},{iconCls:"icon-grid-delete",tooltip:IRm$.r1("B_DELETE"),handler:function(){this.toolbarHandler("cmd_delete")},scope:this}]}],columns:[{xtype:"treecolumn",text:IRm$.r1("B_TEXT"),flex:2,sortable:!1,dataIndex:"name"},{xtype:"actioncolumn",width:26,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,l){e.store.getAt(t)},getClass:function(e,t,l,a,n,o){return 0==a||0==l.isLeaf()||l.data&&0==l.data.custom?"idv-hd-val":""}}]}],listeners:{afterrender:function(){},itemclick:function(e,l,a,n,o){var s=l.get("name");0==l.isRoot()&&s&&t.editStyleItem.call(t,s)}}},{xtype:"form",region:"center",layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"sname",fieldLabel:IRm$.r1("B_NAME")},{xtype:"combobox",fieldLabel:IRm$.r1("L_INHERIT"),name:"base_style",displayField:"name",valueField:"value",editable:!1,queryMode:"local",store:{fields:["name","value"]},listeners:{change:function(e,t,l){var a,n=this,o=n.down("[name=base_style]").getValue(),s=n.down("[name=form_header]"),i=n.down("[name=form_data]");n._valForm||o&&(a=n.globalstylemap[o])&&(s.loadStyleData.call(s,a.header),i.loadStyleData.call(i,a.data))},scope:this}},{xtype:"combobox",fieldLabel:IRm$.r1("L_CHART_STYLE"),name:"c_cset",displayField:"name",valueField:"value",editable:!1,queryMode:"local",store:{fields:["name","value"],data:n}},{xtype:"tabpanel",plain:!0,flex:1,items:[a,l]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){this.loadGlobalStyle()}}}),IG$.cubeStyle.superclass.initComponent.apply(this,arguments)}});
IG$.cube_object_select=$s.extend($s.window,{modal:!0,region:"center",layout:{type:"vbox",align:"stretch"},closable:!0,resizable:!0,width:770,height:500,_init:function(){var e=this;e.alias_map={},e._aliasLoaded=!1,e.curnode=null,e.cursop=null,e._getDB(e.targetdb||e.dbo.uid)},_getDB:function(e){var t=new IG$._rpc$,a={uid:e},n=this.dbo;t.init(this,{ack:"tablecontent",payload:a,mbody:{option:"standard"}},this,(function(e,t){var a,i,s=e,l=this.down("[name=fschema]"),o=[],r=n?n.username.toUpperCase():null,d="";if(s)for(a=0;a<e.schemas.length;a++)i=e.schemas[a],o.push(i),r&&i.name.toUpperCase()==r&&(d=i.name);l.store.loadData(o),l.setValue(d)}),!1),t.send()},_isValid:function(e){var t=this.down("[name=fschema]");return t.clearInvalid(),t.getValue()?1:(t.markInvalid("Select Item"),0)},_searchTb:function(){var e,t,a=this.down("[name=src_keyword]"),n=this.down("[name=fschema]"),i=n.getValue();if(this._isValid()){for(e=0;e<n.store.data.items.length;e++)if(n.store.data.items[e].get("name")==i){t=n.store.data.items[e];break}this._getTable(t,null,a.getValue())}},_getTable:function(e,t,a,n){var i,s=e.get("db_uid"),l=new IG$._rpc$,o={uid:s,option:t,schema:e.get("name"),search:a,product_code:e.get("product_code")};if(n)for(i in n)o[i]=n[i];l.init(this,{ack:"tablecontent",payload:o,mbody:o},this,this.rs__getTable,!1,[e,t]),l.send()},rs__getTable:function(e,t){var a,n,i=t[0],s=t[1],l=e.tables||(e.length?e[0].children:null),o=[],r=!!s,d=r?this.down("[name=grid_st]"):this.down("[name=grid_sc]");if(l&&l.length)for(a=0;a<l.length;a++)(n=r?l[a].content:l[a]).uid=n.uid||""+a,n.product_code=i.get("product_code"),n.allow_insert=n.allow_insert,n.allow_insert_desc=n.allow_insert?"Yes":"",o.push(n);else IG$.ShowError(IRm$.r1("M_NO_DATA"),this);d.store.loadData(o)},_regTables:function(e,t){var a,n,i=this.down("[name=grid_sc]"),s=this.down("[name=grid_st]"),l=(this.alias_map,{});if(0!=(n=e&&t?{length:1,items:[t]}:(e?s:i).getSelectionModel().selected).length||e){if(!e)for(a=0;a<s.store.data.items.length;a++)l[s.store.data.items[a].get("external_name")]=1;for(a=0;a<n.length;a++)e?s.store.remove(n.items[a]):l[n.items[a].get("external_name")]||s.store.add(n.items[a]);e||i.getSelectionModel().clear()}else IG$.alertmsg(ig$.appname,"Search and check table to register.",null,null,0,"error")},initComponent:function(){var e=this;e.title=IRm$.r1("L_IMPORT_TABLES"),$s.apply(this,{padding:10,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",queryMode:"local",fieldLabel:IRm$.r1("B_SCHEMA"),name:"fschema",displayField:"name",valueField:"name",emptyText:IRm$.r1("L_SELECT_ITEM"),typeAhead:!0,forceSelection:!1,autoSelect:!0,autoScroll:!0,store:{fields:["name","uid","db_uid","type"]}},{xtype:"panel",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",name:"grid_sc",title:IRm$.r1("L_AVAILABLE_ITEMS"),emptyText:IRm$.r1("M_S_S1"),selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},store:{fields:["name","type","nodepath","uid","schemaname","dispname","checked"]},tbar:[{xtype:"textfield",name:"src_keyword",fieldLabel:IRm$.r1("B_SEARCH"),labelWidth:60,width:160,emptyText:IRm$.r1("L_SEARCH_KWD"),enableKeyEvents:!0,listeners:{keyup:function(e,t,a){13==t.keyCode&&this._searchTb()},scope:this}},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this._searchTb()},scope:this},"->"],columns:[{text:IRm$.r1("B_TYPE"),width:60,sortable:!0,dataIndex:"object_type"},{text:IRm$.r1("B_NAME"),flex:1,sortable:!0,dataIndex:"name"},{text:IRm$.r1("B_OBJ_NAME"),flex:1,sortable:!0,dataIndex:"external_name"}],listeners:{itemdblclick:function(t,a,n,i,s){e._regTables()},scope:this}},{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:1},{xtype:"button",text:">",handler:function(){this._regTables()},scope:this},{xtype:"container",flex:1}]},{xtype:"gridpanel",title:IRm$.r1("L_SELECTED_ITEMS"),name:"grid_st",emptyText:IRm$.r1("M_S_S1"),tbar:[{xtype:"textfield",name:"tgt_keyword",fieldLabel:IRm$.r1("B_SEARCH"),labelWidth:60,width:160,enableKeyEvents:!0,listeners:{keyup:function(e,t,a){13==t.keyCode&&IG$._dofilter(this,"grid_st",["name"],this.down("[name=tgt_keyword]"))},scope:this}},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){IG$._dofilter(this,"grid_st",["name"],e.down("[name=tgt_keyword]"))},scope:this}],store:{fields:["name","type","nodepath","uid","schemaname","dispname","checked"]},columns:[{text:IRm$.r1("B_TYPE"),width:60,sortable:!0,dataIndex:"object_type"},{text:IRm$.r1("B_NAME"),flex:1,sortable:!0,dataIndex:"name"},{text:IRm$.r1("B_OBJ_NAME"),flex:1,sortable:!0,dataIndex:"external_name"},{xtype:"actioncolumn",width:30,items:[{iconCls:"icon-grid-delete",tooltip:IRm$.r1("L_REMOVE"),handler:function(e,t,a){var n=e.store.getAt(t);this._regTables(1,n)},scope:this}]}],listeners:{itemdblclick:function(t,a,n,i,s){e._regTables(1,a)},scope:this}}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){var e,t=this.down("[name=grid_st]"),a=[];for(e=0;e<t.store.data.items.length;e++)a.push(t.store.data.items[e].data);a.length?(this.callback&&this.callback.execute(a),this.close()):IG$.alertmsg(ig$.appname,"Search and check table to register.",null,null,0,"error")},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.cube_object_select.superclass.initComponent.apply(this,arguments)}});
IG$.securityFilter=$s.extend($s.window,{modal:!1,layout:"fit",closable:!1,resizable:!1,width:400,height:500,bodyPadding:10,_key:0,_addFilter:function(){var e,t=this;e=new IG$.mgrUserDuty({instance:t.instance,modal:!1,callback:new IG$.callBackObj(t,(function(e){var i,n,a,l=[],r="",s=this.down("[name=gridduty]");for(i=0;i<e.length;i++){var o={sid:e[i].get("sid"),name:e[i].get("name")};l.push(o)}if(l.length>0){for((n=new IG$.clFilterGroup(null)).auth=[],i=0;i<l.length;i++)n.auth.push({name:l[i].name,sid:l[i].sid}),r+=(i>0?",":"")+l[i].name;n.active=!0,n.index=t._key++,t.securityfilter.push(n),a=s.store.add({authname:r,active:n.active,index:n.index}),t.authSet(a,"edit")}}))}),IG$.checkLogin(t,e)},_confirm:function(){if(this.callback){var e,t=this.down("[name=gridduty]"),i={};for(e=0;e<t.store.data.items.length;e++)i[t.store.data.items[e].get("index")]=!0;for(e=panel.securityfilter.length-1;e>=0;e--)i[panel.securityfilter[e].index]||panel.securityfilter.splice(e,1);this.callback.execute()}this.close()},loadSecurityFilter:function(){var e,t,i,n,a=[],l=this.down("[name=gridduty]");if(this.securityfilter)for(e=0;e<this.securityfilter.length;e++){for((n=this.securityfilter[e]).auth=n.auth||[],n.index=this._key++,i="",t=0;t<n.auth.length;t++)i+=(t>0?",":"")+n.auth[t].name;a.push({authname:i,active:n.active,index:n.index})}l.store.loadData(a)},authSet:function(e,t){var i,n,a,l,r,s=this,o=s.down("[name=gridduty]"),c=e.get("index");for(a=0;a<this.securityfilter.length;a++)if(s.securityfilter[a].index==c){r=s.securityfilter[a],l=a;break}if("remove"==t)i=o.store.indexOf(e),s.securityfilter.splice(i,1),o.store.remove(e);else if("auth"==t)n=new IG$.mgrUserDuty({instance:s.instance,modal:!1,sel:r.auth,callback:new IG$.callBackObj(s,(function(t){var i,n=[],a="";this.down("[name=gridduty]");for(i=0;i<t.length;i++){var l={sid:t[i].get("sid"),name:t[i].get("name")};n.push(l)}if(n.length>0){for(r.auth=[],i=0;i<n.length;i++)r.auth.push({name:n[i].name,sid:n[i].sid}),a+=(i>0?",":"")+n[i].name;e.set("authname",a)}}))}),IG$.checkLogin(s,n);else{var d=new IG$.filterEditorWindow({instance:s.instance,sheetoption:{model:{filter:r,cube_object:{uid:s.uid}}},reportoption:{cubeuid:s.uid},callback:new IG$.callBackObj(s,(function(e){this.securityfilter[l]=e.model.filter}))});IG$.checkLogin(s,d)}},initComponent:function(){var e=this;e.title=IRm$.r1("L_SECURITY_FILTER_MGR");var t=[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},border:0,items:[{xtype:"displayfield",value:"Select user duty from list"},{xtype:"gridpanel",name:"gridduty",flex:1,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},multiSelect:!0,store:{fields:["authname","active","index"]},columns:[{header:"Auth Name",dataIndex:"authname",flex:1,sortable:!1,hideable:!1},{xtype:"actioncolumn",width:70,items:[{iconCls:"icon-grid-add",tooltip:"Edit",handler:function(t,i,n){var a=t.store.getAt(i);e.authSet.call(e,a,"edit")}},{iconCls:"icon-grid-config",tooltip:"Edit",handler:function(t,i,n){var a=t.store.getAt(i);e.authSet.call(e,a,"auth")}},{iconCls:"icon-grid-delete",tooltip:"Remove Filtering",handler:function(t,i,n){var a=t.store.getAt(i);e.authSet.call(e,a,"remove")}}]}]}]}],i=[{text:IRm$.r1("L_ADD_FILTER"),handler:function(){this._addFilter()},scope:this},"->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}];$s.apply(this,{items:t,buttons:i}),IG$.securityFilter.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(e){this.loadSecurityFilter()}}});
IG$.m$CubeModel=function(e){var o,t,i,r,n,l,b=this;if(b._mc=e=e||{},$s.defaults(e,{pool:[]}),b.zoom=1,b.groupview=!1,b.tables=[],b.relations=[],b.highlight=[],b.fixKeyMode=!1,n=e.tables)for(t=0;t<n.length;t++){if((l=new IG$.m$TblObj(n[t])).fields=[],r=l.columns)for(i=0;i<r.length;i++)r[i].seq=l.seq;b.tables.push(l)}if(n=e.joins)for(t=0;t<n.length;t++)(o=n[t]).source.seq=o.source.seq||0,o.target.seq=o.target.seq||0,b.relations.push(o);if(n=e.securityfilter,b.securityfilter=[],n)for(t=0;t<n.length;t++)o=n[t],b.securityfilter.push(o);b.highlight=e.highlight},IG$.m$TblObj=function(e){this._mc=e,this.ranged=!1},IG$.m$TblObj.prototype={stageX:function(){var e=this,o=0,t=e.bbox;return e.box&&(e.bbox={left:e.box.pobj.scrollPanel.offset().left,top:e.box.pobj.scrollPanel.offset().top},t=e.bbox,o=$(e.box.innerGrid.body.dom).offset().left-t.left),o},stageY:function(e){var o,t,i,r=this,n=0,l=r.bbox;if(r.box&&(r.bbox={left:r.box.pobj.scrollPanel.offset().left,top:r.box.pobj.scrollPanel.offset().top},l=r.bbox,o=$(r.box.innerGrid.body.dom),i=(t=r.box.innerGrid.down("[name=skey]"))&&t.body?$(t.body.dom):null,n=o.offset().top-l.top+(i&&i.height()||0),null!=e)){var b,s=r.box.innerGrid;n+=(b=s.getHeight.call(s,e)).d,r.ranged=b.ranged}return n},bodyWidth:function(){var e=0;return this.box&&(e=this.box.innerGrid.getWidth()),e},bodyHeight:function(){var e=0;return this.box&&((e=this.box.innerGrid.getHeight()).ranged||(e=e.d)),e}},IG$.m$CubeModel.prototype={getXML:function(){return this._mc}};
IG$.cubeModelViewer=function(e,t){var i=this;i.sobj=t,i.instance=t.instance,i.viewer=e,i.dialog=[],i.links=[],i.zoomRatio=1,i.lineMode="2"},IG$.cubeModelViewer.prototype={init:function(){var e=this;e._mouseActionPoint=null,e.container=$("<div class='igc-cubemodelviewer'></div>").css({position:"absolute",top:0,bottom:0,left:0,right:0,overflow:"auto"}).appendTo(e.viewer),e.paint=$("<div></div>"),e.paint.appendTo(e.container),e.scrollPanel=$("<div></div>").css({position:"absolute",top:0,bottom:0,width:IG$.j$ext._w(e.container),height:IG$.j$ext._h(e.container),backgroundColor:"none"}).appendTo(e.container),e.appendScrollBar(),e.container.droppable({drop:function(e,t){}}),e.allowDrop(e.scrollPanel[0]),e.container.bind("resize",(function(t){e.validateSize.call(e)}))},zoom:function(e){var t=this.zoomRatio+e;t>.3&&t<5&&(this.zoomRatio=t,$(this.scrollPanel).css({transform:"scale("+t+","+t+")","transform-origin":"0px 0px"}))},allowDrop:function(e){var t=this;this.dropZone=$s.create($s.dropzone,e,{ddGroup:"CubeModelDDGroup",nodeouttimer:-1,getTargetFromEvent:function(i){var o=i.browserEvent.pageX||i.browserEvent.clientX,a=i.browserEvent.pageY||i.browserEvent.clientY,l=t.getRendererByPoint(o,a);return null==l&&(l=e),l},notifyOut:function(e,i,o){var a=this;a.lastOverNode&&(a.onNodeOut(a.lastOverNode,e,i,o),a.lastOverNode=null),t.isDragging=!1,t.hideDropFeedback&&(t.hideDropFeedback.call(t,i),1==a.accept&&1==a.pivotmove&&t.sheetobj&&(a.nodeouttimer>-1&&clearTimeout(a.nodeouttimer),a.nodeouttimer=setTimeout((function(){t.hideDropFeedback.call(t,i)}),100)))},onNodeEnter:function(e,i,o,a){t.isDragging=!0;var l,n=!1;a.records&&a.records.length>0?"Table"!=(l=a.records[0].get("type"))&&"InlineView"!=l&&"CubeModel"!=l||(n=!0):a.cellData&&(l=a.cellData,n=!0),this.accept=n},onNodeOut:function(e,t,i,o){},onNodeOver:function(e,t,i,o){var a;return a=window.Ext?1==this.accept?Ext.dd.DropZone.prototype.dropAllowed:Ext.dd.DropZone.prototype.dropNotAllowed:this.accept,1==this.accept&&(o.records&&o.records.length>0?o.records[0].data:o.cellData),a},onNodeDrop:function(e,i,o,a){return 1==this.accept&&(a.records&&a.records.length>0?(dt=a.records[0].data,t.sobj.onDropRecord.call(t.sobj,o,dt)):dt=a.cellData),this.accept=!1,!0}})},focusTable:function(e){var t,i,o,a=this,l=a.container,n=e.box.innerGrid,s=a.viewer;n&&(i=l.offset(),n.$ex?(a._psel&&a._psel.box&&$(a._psel.box.innerGrid.$ex.$view).removeClass("igc-f-table"),t=(o=$(n.$ex.$view)).offset(),o.addClass("igc-f-table"),l.animate({scrollTop:Math.max(t.top-i.top+l.scrollTop()-(s.height()-o.height())/2,0),scrollLeft:Math.max(t.left-i.left+l.scrollLeft()-(s.width()-o.width())/2,0)},200)):n.el&&n.el.dom&&(a._psel&&a._psel.box&&$(a._psel.box.innerGrid.el.dom).removeClass("igc-f-table"),t=(o=$(n.el.dom)).offset(),o.addClass("igc-f-table"),l.animate({scrollTop:Math.max(t.top-i.top+l.scrollTop()-(s.height()-o.height())/2,0),scrollLeft:Math.max(t.left-i.left+l.scrollLeft()-(s.width()-o.width())/2,0)},200)),a._psel=e)},getRendererByPoint:function(){return null},appendScrollBar:function(){var e=this;e.scrollbar=$("<div></div>").css({position:"absolute",top:0,bottom:0,width:IG$.j$ext._w(e.container),height:IG$.j$ext._h(e.container),backgroundColor:"none"}).appendTo(e.scrollPanel),e.rcanvas=Raphael(e.scrollbar[0],0,0,"100%","100%"),e._ca=[]},scrollHandler:function(e,t){var i=this;switch(e){case"down":i._mouseActionPoint={x:t.pageX,y:t.pageY};break;case"up":i._mouseActionPoint=null;break;case"move":var o=IG$.j$ext._w(container),a=IG$.j$ext._w(scrollPanel),l=IG$.j$ext._h(container),n=IG$.j$ext._h(scrollPanel);if(null!=i._mouseActionPoint&&(o<a||h_container<h_scrollPanel)){var s,r=i.paint,d=i.scrollPanel,c=i.scrollbar,h=i.container.offset(),f=d.offset(),p=t.pageX-i._mouseActionPoint.x,b=t.pageY-i._mouseActionPoint.y;if(s={top:f.top+b,left:f.left+p},i._mouseActionPoint={x:t.pageX,y:t.pageY},s.top<l-n||s.left<o-a||s.top-h.top>0||s.left-h.left>0)return;c.offset(s),d.offset(s),r.offset(s)}}},clearAll:function(){var e=this;e.dialog=[],e.links=[],e.rcanvas.clear(),$.each(e._ca,(function(e,t){t.remove()})),e._ca=[],e.scrollPanel.empty(),e.appendScrollBar()},validateTimer:-1,validateSize:function(){var e=this;e.validateTimer&&clearTimeout(e.validateTimer),e.validateTimer=setTimeout((function(){e.validateSizeProc.call(e)}),100)},validateSizeProc:function(){this.container.offset();var e,t=IG$.j$ext._w(this.container),i=IG$.j$ext._h(this.container);for(e=0;e<this.dialog.length;e++)t=Math.max(t,this.dialog[e].table.stageX()+this.dialog[e].table.bodyWidth()+100),i=Math.max(i,this.dialog[e].table.stageY()+this.dialog[e].table.bodyHeight()+100);IG$.j$ext._w(this.scrollPanel,t),IG$.j$ext._h(this.scrollPanel,i),IG$.j$ext._w(this.scrollbar,t),IG$.j$ext._h(this.scrollbar,i),IG$.j$ext._w(this.paint,t),IG$.j$ext._h(this.paint,i),this.rcanvas.setViewBox(0,0,t,i,!0),this.rcanvas.setSize(t,i),this.validateLinks()},validateLinks:function(){var e,t=this;for(t.rcanvas.clear(),$.each(t._ca,(function(e,t){t.remove()})),t._ca=[],e=0;e<t.links.length;e++)t.links[e].refresh.call(t.links[e],e,1==t.sobj.cubemodel.groupview)},addBox:function(e,t,i,o,a,l){var n=new IG$.tableBox(this,e,t,i,o,a);return n.main=l,n.collapsePanel.call(n),n.innerGrid.fixKeyMode.call(n.innerGrid,a._mcfixKeyMode),this.dialog.push(n),n},addLink:function(e,t,i,o){var a,l,n,s=this;for(s.relations=o,a=0;a<s.links.length;a++)if((n=s.links[a])&&(n.fromobj._mc.uid==e._mc.uid&&n.toobj._mc.uid==t._mc.uid&&n.fromobj._mc.seq==e._mc.seq&&n.toobj._mc.seq==t._mc.seq||n.fromobj._mc.uid==t._mc.uid&&n.toobj._mc.uid==e._mc.uid&&n.fromobj._mc.seq==t._mc.seq&&n.toobj._mc.seq==e._mc.seq)){l=n;break}return l?l.links.push(i):(l=new IG$.LinkField(s,e,t,i,o),s.links.push(l)),l},removeTbl:function(e){var t,i,o,a=this.sobj,l=a.cubemodel,n=this.dialog,s=this.links;for(t=0;t<l.tables.length;t++)if(e.table==l.tables[t]){l.tables.splice(t,1);break}for(t=0;t<n.length;t++)if(n[t]==e){n.splice(t,1);break}for(t=s.length-1;t>=0;t--)if(s[t].fromobj==e.table||s[t].toobj==e.table){for(o=s[t],i=l.relations.length-1;i>=0;i--)l.relations[i].bl==o&&l.relations.splice(i,1);s.splice(t,1)}a.updateUsedTable.call(a),a.validateTables.call(a),a.validateJoins.call(a)}},IG$.tableBox=function(e,t,i,o,a,l){var n=this,s=this,r=e,d=l._mc.name;s.instance=e.instance,s.pobj=e,s.table=l,l._mc.theight=l._mc.theight||a,l._mc.seq&&l._mc.seq>0&&(d+="("+l._mc.seq+")"),s.innerGrid=new $s.panel({instance:s.instance,renderTo:this.pobj.scrollPanel[0],table:l,autoScroll:!1,stateful:!1,draggable:!0,plain:!1,minimizable:!1,alwaysFramed:!0,closable:!0,cpa:r,title:d,x:t,border:1,y:i,width:o,height:(l._mc.theight||100)<100?100:l._mc.theight,viewmode:"physical",fixKeyVal:!1,fixKeyMode:function(e){this.fixKeyVal=e,this.g_key.setVisible(e),this.loadData()},layout:{type:"vbox",align:"stretch"},_loadModel:function(){var e=this,t=e.table._mc,i=new IG$._rpc$;t.uid&&"cubemodel"==t.type.toLowerCase()&&(i.init(e,{ack:"content",payload:{uid:t.uid,type:t.type},mbody:{}},e,(function(t){var i,o,a=t.content.tables,l=e.down("[name=stables]"),n=[];for(i=0;i<a.length;i++)o={uid:a[i].uid,type:a[i].type,name:a[i].name,nodepath:a[i].nodepath},n.push(o);l.store.loadData(n)})),i.send())},_loadField:function(e){var t=this,i=new IG$._rpc$,o=t.table._mc,a=t.table._tables;if(t.table._sel_table=e,a[e]){var n=t.cpa.sobj;n.validateTables(),n.validateJoins()}else i.init(t,{ack:"tablecontent",payload:{uid:e,option:"StoredContent"},mbody:{option:"folder",readcontent:"T"}},t,(function(t){var i,n,s,r=t.length?t[0]:null,d=(r&&r.content,[]),c=this.cpa.sobj;if(a[e]={columns:[]},r&&r.children)for(i=r.children,s=0;s<i.length;s++)(n=i[s].content).model=o.uid,n.tablename=r.name||n.tablename,n.alias=n.alias||n.name,n.iskey=n.iskey,n.leaf=!0,n.dispname=n.name,n.allowDrag=!0,n.seq=l._mc.seq,n.tableuid=r.uid,d.push(n);a[e].columns=d,c.validateTables(),c.validateJoins()}),null),i.send()},loadData:function(){var e,t,i=this,o=[],a=[],l=i.table,n=i.table._mc,s=n.columns;if("cubemodel"==n.type.toLowerCase()){if(!l._sel_table||!l._tables[l._sel_table])return void i._loadModel();s=l._tables[l._sel_table].columns}if(s)for(e=0;e<s.length;e++)t=s[e],!i.fixKeyVal||1!=t.iskey&&1!=t.hasjoin?o.push(t):a.push(t);i.g_key.store.loadData(a),i.g_fields.store.loadData(o)},getHeight:function(e){var t,i,o,a,l,n={d:0,ranged:!1},s=!1,r=!1;if(this.fixKeyVal){for(l=(o=this.g_key).getHeight(),t=0;t<o.store.data.items.length;t++)if(o.store.data.items[t].get("name")==e){i=o.getView().getNode(t);break}i&&(r=!0,(a=$(i).offset().top-$(o.el.dom).offset().top+$(i).height()/2)>-1&&a<l?s=!0:(a=a<0?0:a,a=Math.min(a,l)))}if(0==r){if(l=(o=this.g_fields).getHeight(),e){for(t=0;t<o.store.data.items.length;t++)if(o.store.data.items[t].get("name")==e){i=o.getView().getNode(t);break}}else a=l;i&&((a=$(i).offset().top-$(o.el.dom).offset().top+$(i).height()/2)>-1&&a<l?s=!0:(a=a<0?0:a,a=Math.min(a,l)))}return a&&(n.d=a),n.ranged=s,n},adjHeight:function(){var e,t,i=this,o=i.getHeight();i.fixKeyVal&&(0==(e=i.g_key.store.data.items.length)?i.g_key.setVisible(!1):(i.g_key.setVisible(!0),t=Math.min(22*e+2,.4*o),i.g_key.setHeight(t)),i.cpa.validateLinks.call(i.cpa))},searchField:function(){var e=this;e.__s&&clearTimeout(e.__s),e.__s=setTimeout((function(){e.searchFlt.call(e)}),40)},searchFlt:function(){var e=this.down("[name=g_fields]").store,t=this.down("[name=skey]").getValue();t?(t=t.toLowerCase(),e.clearFilter(!0),e.filterBy((function(e){var i=e.get("name").toLowerCase(),o=e.get("alias")||"";return o=o.toLowerCase(),i.indexOf(t)>-1||o.indexOf(t)>-1}))):e.clearFilter(!1)},items:[{xtype:"container",hidden:"CubeModel"!=s.table._mc.type,layout:{type:"hbox",align:"stretch"},items:[{xtype:"combobox",name:"stables",flex:1,displayField:"name",valueField:"uid",store:{},listeners:{change:function(e){e.getValue()&&(s.innerGrid.table._tables=s.innerGrid.table._tables||{},s.innerGrid._loadField(e.getValue()))},scope:this}},{xtype:"button",iconCls:"icon-refresh",tooltip:IRm$.r1("B_REFRESH"),handler:{},scope:this}]},{xtype:"textfield",name:"skey",emptyText:IRm$.r1("L_SEARCH_ITEM"),enableKeyEvents:!0,listeners:{keyup:function(e,t,i){e.ownerCt.searchField.call(e.ownerCt)}}},{xtype:"gridpanel",name:"g_key",border:0,scroll:"vertical",autoScroll:!0,enableDragDrop:!0,enableDD:!0,useArrows:!0,header:!1,hideHeaders:!0,hidden:!0,cpa:r,ddGroup:"CubeModelFieldDDGroup",viewConfig:{emptyText:IRm$.r1("L_P_RELOAD"),plugins:{ptype:"gridviewdragdrop",ddGroup:"CubeModelFieldDDGroup"},listeners:{beforedrop:function(e,t,i,o){var a=t.records[0],l=i;return a&&l&&r.sobj.onDropField.call(r.sobj,a,l),!1},drop:function(e,t,i,o){i&&i.get("name")}}},store:{fields:["name","nodepath","datasize","datatype","tablename","type","selected","seq","alias","tableuid"]},afterScroll:function(){this.cpa.validateLinks.call(this.cpa)},columns:[{xtype:"checkcolumn",dataIndex:"selected",enableColumnHide:!1,checkedAll:!1,width:30,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"},listeners:{checkchange:function(e,t,i,o){var a,l=n.innerGrid.g_fields.store.data.items[t].get("nodepath"),s=n.table;for(a=0;a<s.fields.length;a++)if(s.fields[a].nodepath==l){s.fields[a].selected=i;break}},headerclick:function(e,t,i,o,a){var l,s=e.ownerCt,r=n.table;if("checkcolumn"==t.xtype){for(t.checkedAll=!t.checkedAll,l=0;l<s.store.data.items.length;l++)s.store.data.items[l].set("selected",t.checkedAll);for(l=0;l<r.fields.length;l++)r.fields[l].selected=t.checkedAll}}}},{header:IRm$.r1("B_NAME"),dataIndex:"name",sortable:!0,hideable:!1,flex:1},{header:IRm$.r1("B_ALIAS"),dataIndex:"alias",sortable:!0,hideable:!1,hidden:!0,flex:1}],listeners:{afterrender:function(e){this.getView().on("bodyscroll",this.afterScroll,this)},scrollershow:function(e,t,i){}}},{xtype:"gridpanel",name:"g_fields",border:0,scroll:"vertical",autoScroll:!0,enableDragDrop:!0,enableDD:!0,useArrows:!0,header:!1,hideHeaders:!0,flex:1,cpa:r,ddGroup:"CubeModelFieldDDGroup",viewConfig:{emptyText:IRm$.r1("L_P_RELOAD"),plugins:{ptype:"gridviewdragdrop",ddGroup:"CubeModelFieldDDGroup"},listeners:{beforedrop:function(e,t,i,o){var a=t.records[0],l=i;return a&&l&&r.sobj.onDropField.call(r.sobj,a,l),!1},drop:function(e,t,i,o){i&&i.get("name")}}},store:{fields:["name","nodepath","datasize","datatype","tablename","type","selected","seq","alias","tableuid"]},afterScroll:function(){this.cpa.validateLinks.call(this.cpa)},columns:[{xtype:"checkcolumn",dataIndex:"selected",enableColumnHide:!1,checkedAll:!1,width:30,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"},listeners:{checkchange:function(e,t,i,o){var a,l=n.innerGrid.g_fields.store.data.items[t].get("nodepath"),s=n.table;for(a=0;a<s.fields.length;a++)if(s.fields[a].nodepath==l){s.fields[a].selected=i;break}},headerclick:function(e,t,i,o,a){var l,s=e.ownerCt,r=n.table;if("checkcolumn"==t.xtype){for(t.checkedAll=!t.checkedAll,l=0;l<s.store.data.items.length;l++)s.store.data.items[l].set("selected",t.checkedAll);for(l=0;l<r.fields.length;l++)r.fields[l].selected=t.checkedAll}}}},{header:IRm$.r1("B_NAME"),dataIndex:"name",sortable:!0,hideable:!1,flex:1},{header:IRm$.r1("B_ALIAS"),dataIndex:"alias",sortable:!0,hideable:!1,hidden:!0,flex:1}],listeners:{afterrender:function(e){this.getView().on("bodyscroll",this.afterScroll,this)},scrollershow:function(e,t,i){}}}],bbar:[{xtype:"button",iconCls:"icon-tb-alias",tooltip:"Alias",handler:function(){var e=this.innerGrid,t=this.innerGrid.g_key,i=this.innerGrid.g_fields.columns,o=t.columns;switch("physical"==e.viewmode?e.viewmode="logical":"logical"==e.viewmode?e.viewmode="both":e.viewmode="physical",e.viewmode){case"physical":i[1].show(),i[2].hide(),o[1].show(),o[2].hide();break;case"logical":i[1].hide(),i[2].show(),o[1].hide(),o[2].show();break;default:i[1].show(),i[2].show(),o[1].show(),o[2].show()}},scope:n},{xtype:"button",iconCls:"icon-tb-refresh",tooltip:IRm$.r1("B_REFRESH"),handler:function(){var e=this;e.innerGrid.g_fields;if("cubemodel"==e.table._mc.type.toLowerCase()){var t=e.innerGrid.down("[name=stables]");t.getValue()&&(e.table._tables=e.table._tables||{},e.innerGrid._loadField(t.getValue()))}else e.main.loadTableContent.call(e.main,e.table)},scope:n},{xtype:"button",iconCls:"icon-tb-preview",tooltip:"Preview",handler:function(){this.main.previewSQL.call(this.main,this.table)},scope:n},{xtype:"displayfield",value:"",name:"m_disp"}],listeners:{afterrender:function(e){var t=this;t.fixKeyVal=t.cpa.sobj.fixKeyMode,t.g_key=t.down("[name=g_key]"),t.g_fields=t.down("[name=g_fields]"),t.m_disp=t.down("[name=m_disp]"),t.loadData()},scrollershow:function(e,t,i){},resize:function(t,i,o,a,l,n){e.validateSize.call(e)},startmove:function(t){t.$ex&&(t.$ex.config.zoomRatio=e.zoomRatio)},move:function(t,i,o,a){(i<0||o<0)&&this.setPosition(i<0?0:i,o<0?0:o),e.validateSize.call(e)},close:function(e,t){r.removeTbl.call(r,n)}}})},IG$.tableBox.prototype={fixKeyMode:function(e){this.table.fixKeyMode!=e&&(this.table.fixKeyMode=e,this.innerGrid.fixKeyMode.call(this.innerGrid,e))},collapsePanel:function(e){var t,i=this.pobj;this.table._mc.width;t=((t=this.table._mc.theight)||100)<100?100:t,this.innerGrid.setVisible(!0),i.validateSize.call(i),i.validateLinks.call(i)}},IG$.LinkField=function(e,t,i,o,a){var l=this;l.pobj=e,l.fromobj=t,l.toobj=i,l.links=[o],l.relations=a,l._fromDir="",l._toDir="",l.lineMode=e.lineMode},IG$.LinkField.prototype={validateDirection:function(e){var t=$(this.fromobj.box.innerGrid.body.dom),i=t.offset(),o=$(this.toobj.box.innerGrid.body.dom),a=o.offset(),l=IG$.j$ext._w(t)*e,n=IG$.j$ext._w(o)*e;i.left+l<a.left?(this._fromDir="right",this._toDir="left"):a.left+n<i.left?(this._fromDir="left",this._toDir="right"):(i.left,a.left,this._fromDir="right",this._toDir="right")},showLinkEditor:function(e,t){var i=this.pobj.instance,o=new IG$.linkEditor({instance:i,pobj:this.pobj,link:e,links:t,relations:this.relations,callback:new IG$.callBackObj(this,this.rs_showLinkEditor)});IG$.showDlg(this,o)},rs_showLinkEditor:function(e){var t,i=e[0];switch(e[1]){case"remove":this.pobj.sobj.updateJoinFields.call(this.pobj.sobj),this.pobj.sobj.validateLinks.call(this.pobj.sobj),this.pobj.validateLinks.call(this.pobj);break;case"confirm":for(t=0;t<this.links.length;t++)this.links[t]!=i[0]&&(this.links[t].join=i[0].join);this.pobj.validateLinks.call(this.pobj)}},refresh:function(e,t){var i,o,a,l,n,s,r,d=this,c=1,h=d.fromobj,f=d.toobj,p=d.links,b=d.pobj.rcanvas,m={stroke:"#8d8d8d","stroke-width":1,fill:"none",opacity:1},u={stroke:"#8d8d8d",fill:"#8d8d8d",opacity:1},g=d.pobj.zoomRatio,_=1/g;d.links&&d.links.length>1&&1==t&&(c=1.5*d.links.length),d.validateDirection(g),r=1==t&&p.length>0?[p[0]]:p,$.each(r,(function(e,r){if(r){var g=d._fromDir,v=d._toDir;r.p1dist=void 0===r.p1dist?null:r.p1dist,r.source.tablename==f._mc.name&&r.target.tablename==h._mc.name&&r.source.seq==f._mc.seq&&r.target.seq==h._mc.seq?(h=d.toobj,f=d.fromobj,g!=v&&(g="right"==g?"left":"right",v="right"==v?"left":"right")):(h=d.fromobj,f=d.toobj),s=1==p.length||0==t?p[e].source.name:null,i={x:h.stageX()*_,y:h.stageY(s)*_},s=1==p.length||0==t?p[e].target.name:null,l={x:f.stageX()*_,y:f.stageY(s)*_},1==h.ranged&&1==f.ranged?(!0,m.stroke="#000000",m["stroke-width"]=c,u.stroke="#000000",u.fill="#000000"):c>1?(!1,m.stroke="#000000",m["stroke-width"]=c,u.stroke="#000000",u.fill="#000000"):!1,"right"==g?(i.x+=h.bodyWidth(),o={x:i.x+10,y:i.y}):"left"==g&&(o={x:i.x-10,y:i.y}),"right"==v?(l.x+=f.bodyWidth(),a={x:l.x+10,y:l.y}):"left"==v&&(a={x:l.x-10,y:l.y}),n=(n=IG$.lineInterpolate(o,a,3)).length>0?n[1]:null,p&&p.length>0&&"RIGHT OUTER"==p[0].join?"right"==v?b.path("M"+l.x+" "+(l.y+10)+"L"+(l.x+10)+" "+l.y+"L"+l.x+" "+(l.y-10)).attr(m):b.path("M"+l.x+" "+(l.y+10)+"L"+(l.x-10)+" "+l.y+"L"+l.x+" "+(l.y-10)).attr(m):p&&p.length>0&&"LEFT OUTER"==p[0].join&&("right"==g?b.path("M"+i.x+" "+(i.y+10)+"L"+(i.x+10)+" "+i.y+"L"+i.x+" "+(i.y-10)).attr(m):b.path("M"+i.x+" "+(i.y+10)+"L"+(i.x-10)+" "+i.y+"L"+i.x+" "+(i.y-10)).attr(m)),b.path("M"+i.x+" "+i.y+"L"+o.x+" "+o.y+"L"+a.x+" "+a.y+"L"+l.x+" "+l.y).attr(m);var x,y=1==p.length||1==t?p:[p[e]],w=$("<div class='igc-cm-join'><span></span></div>").appendTo(d.pobj.scrollbar),k="",j=$("span",w);if(1==t)for(e=0;e<p.length;e++)e>0&&(k+="\n"),k+=p[e].source.name,p[e].source.name!=p[e].target.name&&(k+=" - "+p[e].target.name);else k=r.source.name+" - "+r.target.name;j.html(k),w.attr("title",k),x=Math.min(j.width()/2||30,20),w.css({left:n.x-x,top:n.y}),w.bind("click",(function(e){e.preventDefault(),e.stopPropagation(),d.showLinkEditor.call(d,y,p)})),d.pobj._ca.push(w)}}))}};
IG$.linkFieldEditor=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:420,_init:function(){var e=this,t=e._target;t&&(e.down("[name=t_disp]").setValue(t.name),e.down("[name=t_value]").setValue(e.joinobj[e.fieldname]))},_confirm:function(){var e=this;e._target&&(e.joinobj[e.fieldname]=e.down("[name=t_value]").getValue()),e.callback&&e.callback.execute(),e.close()},initComponent:function(){var e=this;e.title=IRm$.r1("L_JOIN_REL_CUSTOM_FIELD"),$s.apply(this,{padding:10,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},padding:10,items:[{xtype:"displayfield",name:"t_disp"},{xtype:"textarea",name:"t_value",height:120},{xtype:"displayfield",value:"Field in formula, Use {FIELD}. Ex: SUBSTR({FIELD}, 1, 6)"}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.linkFieldEditor.superclass.initComponent.apply(this,arguments)}}),IG$.linkEditor=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:420,autoHeight:!0,callback:null,_curLink:null,_init:function(){if(this._curLink=null,this.link&&this.link.length>0){var e,t,i=this.down("[name=selR]"),n=this.down("[name=btn_upd]"),l=[];if(this.link.length>1){for(i.setVisible(!0),n.setVisible(!0),e=0;e<this.link.length;e++)t=this.link[e],l.push({name:t.source.tablename+"."+t.source.name+" - "+t.target.tablename+"."+t.target.name,__i:e});i.store.loadData(l),i.setValue(0)}this.setFieldValue(this.link[0])}},setFieldValue:function(e){var t=this,i=t.down("[name=sfield]"),n=t.down("[name=tfield]"),l=t.down("[name=oprel]");e&&(t._curLink=e,i.setValue(t.getDispName(e.source)),n.setValue(t.getDispName(e.target)),l.setValue(e.join))},getDispName:function(e){return e.formula?e.formula.replace("{FIELD}",e.name):e.tablename+"."+e.name},removeLink:function(){var e,t,i,n=this,l=0,a=n.down("[name=selR]"),o=n.link,s=n.relations,r=n._curLink,c=n.pobj.links;if(o.length>1){for(e=0;e<s.length;e++)if(s[e]==r){s.splice(e,1);break}for(e=0;e<o.length;e++)if(o[e]==r){o.splice(e,1),l=1;break}for(e=0;e<c.length;e++){for(i=0,t=0;t<c[e].links.length;t++)if(c[e].links[t]==r){c[e].links.splice(t,1),i=1;break}if(i){0==c[e].length&&c.splice(e,1);break}}if(l){var d=a.getValue();for(e=0;e<a.store.data.items.length;e++)if(a.store.data.items[e].get("__i")==d){a.store.removeAt(e);break}1==a.store.data.items.length&&a.hide(),a.store.data.items.length>0&&a.setValue(a.store.data.items[0].get("__i"))}for(e=0;e<a.store.data.items.length;e++)a.store.data.items[e].set("__i",e);n.callback&&n.callback.execute([o,"remove"])}else{for(e=0;e<s.length;e++)if(s[e]==r){s.splice(e,1);break}for(e=0;e<c.length;e++){for(l=0,t=0;t<c[e].links.length;t++)if(c[e].links[t]==r){c[e].links.splice(t,1),l=1;break}if(l){0==c[e].length&&c.splice(e,1);break}}n.callback&&n.callback.execute([o,"remove"]),n.close()}},confirmChanges:function(){var e=this.down("[name=oprel]"),t=this._curLink;t&&(t.join=e.getValue(),t.operator="=")},_confirm:function(){var e=this;e.confirmChanges(),e.callback&&e.callback.execute([e.link,"confirm"]),e.close()},editField:function(e){var t,i=this,n=i._curLink,l=i.down("[name="+(e?"s":"t")+"field]"),a=e?n.source:n.target,o=(e?"source":"target")+"_field_formula";a&&(t=new IG$.linkFieldEditor({instance:i.instance,joinobj:n,_target:a,fieldname:o,callback:new IG$.callBackObj(i,(function(){l.setValue(this.getDispName(a))}))}),IG$.checkLogin(i,t))},initComponent:function(){$s.apply(this,{padding:10,title:IRm$.r1("L_JOIN_REL_EDITOR"),items:[{xtype:"form",layout:{type:"vbox",align:"stretch"},padding:10,items:[{xtype:"combobox",fieldLabel:IRm$.r1("B_RELATION"),name:"selR",hidden:!0,queryMode:"local",autoSelect:!0,autoScroll:!0,editable:!1,labelField:"name",displayField:"name",valueField:"__i",store:{fields:["name","__i"]},listeners:{change:function(e,t,i,n){var l=e.getValue();this.setFieldValue(this.link[l])},scope:this}},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},name:"sfield_cnt",items:[{xtype:"textfield",name:"sfield",emptyText:IRm$.r1("M_SEL_ITEM"),fieldLabel:IRm$.r1("L_SOURCE_FIELD"),readOnly:!0,flex:1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.editField(!0)},scope:this}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},name:"tfield_cnt",items:[{xtype:"textfield",name:"tfield",emptyText:IRm$.r1("M_SEL_ITEM"),fieldLabel:IRm$.r1("L_TARGET_FIELD"),readOnly:!0,flex:1},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this.editField(!1)},scope:this}]},{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},defaults:{labelWidth:150},title:IRm$.r1("L_OPTIONS"),items:[{xtype:"combobox",name:"oprel",fieldLabel:IRm$.r1("L_SRC_TO_TGT_IS"),queryMode:"local",autoSelect:!0,editable:!1,valueField:"op",displayField:"name",labelField:"name",$w:390,store:{fields:["name","op","desc"],data:[{name:"Inner equal",op:"INNER JOIN",desc:"Show only match values"},{name:"Left outer",op:"LEFT OUTER",desc:"Show all source values even not match"},{name:"Right outer",op:"RIGHT OUTER",desc:"Show all target values even not match"},{name:"Auto natural",op:"NATURAL",desc:"Automatic join with column foreign key"},{name:"Full outer",op:"FULL OUTER",desc:"Show all source and target values"}]},listeners:{change:function(e){var t,i,n,l=e.getValue(),a=this.down("[name=op_desc]");for(i=0;i<e.store.data.items.length;i++)if((n=e.store.data.items[i]).get("op")==l){t=n;break}t&&a.setValue("* "+t.get("desc"))},scope:this}},{xtype:"displayfield",name:"op_desc"}]},{xtype:"container",layout:{type:"hbox",align:"right"},items:[{xtype:"button",name:"btn_upd",text:IRm$.r1("L_CONFIRM_CURRENT"),hidden:!0,handler:function(){this.confirmChanges()},scope:this},{xtype:"button",text:IRm$.r1("L_REMOVE_RELATION"),handler:function(){this.removeLink()},scope:this}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.linkEditor.superclass.initComponent.apply(this,arguments)}});
IG$.CubeModel=$s.extend(IG$.v$pnl,{collapseFirst:!1,bodyBorder:!1,layout:"fit",defaults:{collapsible:!1,split:!1,animFloat:!1,autoHide:!1,useSplitTips:!0},initialized:!1,closable:!0,overflowX:"hidden",overflowY:"hidden",iconCls:"icon-cubemodel",_init:function(){var e=this,t=e.down("[name=mcontainer]");e.m=new IG$.cubeModelViewer($(t.body.dom),e),e.m.init(),e.uid?(e.load_content(),e.down("[name=t_save]").setVisible(e.writable),e.writable&&IG$.checkLock(e,(function(t){"unlock"!=t&&(e.writable=!1,e.down("[name=t_save]").hide())}))):e._c$?e.rs_load_content(e._c$):(e.cubemodel=new IG$.m$CubeModel(null),e.loadPool())},load_content:function(){var e=new IG$._rpc$;e.init(this,{ack:"content",payload:{address:this.uid},mbody:{option:"diagnostics"}},this,this.rs_load_content,null),e.send()},rs_load_content:function(e){var t,i,n=this;n.cubemodel=new IG$.m$CubeModel(e.content),!(i=n.cubemodel._mc).datasource&&n.obj_uid?i.datasource={uid:n.obj_uid}:n.obj_uid&&(i.datasource.uid=n.obj_uid),n.obj_uid=i.datasource.uid,n.cubemodel.datasource={uid:i.datasource.uid||n.obj_uid},t={type:"ROOT",name:"DataSource",uid:n.obj_uid,leaf:!1,children:[{type:"load",name:"Loading..."}]},(t=n.down("[name=mtree]").setRootNode(t)).expand(),n.loadPool()},loadPool:function(){this.validateTables(),this.validateJoins()},updatePoolInfo:function(e,t){var i,n,a,o,l;for(i=0;i<e.length;i++)if((l=e[i]).dispname=l.name,l.dispname.length>17&&"_"==l.dispname.charAt(17)&&(l.dispname=l.dispname.substring(18)),l.children)for(o=l.children,n=0;n<o.length;n++)a=o[n],t.push({value:a.uid,name:l.dispname+"-"+a.name});else t.push({value:"",name:l.dispname+"-ERROR(No Schema)"})},updateUsedTable:function(){var e,t=this.down("[name=grid_st]").store,i=this.cubemodel,n={};if(t.data.items.length){for(e=0;e<i.tables.length;e++)n[i.tables[e]._mc.uid]=1;for(e=0;e<t.data.items.length;e++)t.data.items[e].set("used",n[t.data.items[e].get("uid")]?"*":"")}},loadTableContent:function(e,t,i){var n=new IG$._rpc$,a=e._mc;n.init(this,{ack:"tablecontent",payload:{uid:a.uid,nodepath:a.nodepath,name:a.name,option:"StoredContent"},mbody:{option:"folder",readcontent:"T"}},this,(function(n){var a,o,l,s=n.length?n[0]:null,r=(s&&s.content,[]);if(s&&s.children)for(a=s.children,l=0;l<a.length;l++)(o=a[l].content).tablename=e._mc.name||o.tablename,o.alias=o.alias||o.name,o.iskey=o.iskey,o.leaf=!0,o.dispname=o.name,o.allowDrag=!0,o.seq=e._mc.seq,o.tableuid=e._mc.uid,r.push(o);e._mc.columns=r,(!t||t&&i)&&(this.validateTables(),this.validateJoins())}),null),n.send()},previewSQL:function(e){var t=new IG$.dlgLoadPreview({instance:this.instance,table:e});IG$.checkLogin(this,t)},updateJoinFields:function(){var e,t,i,n,a,o,l,s,d=this.cubemodel;for(e=0;e<d.tables.length;e++){for(n=(i=d.tables[e])._mc,tname=n.name+"_"+n.seq,n.columns=n.columns||[],t=0;t<n.columns.length;t++)n.columns[t].hasjoin=!1;for(a=0;a<d.relations.length;a++)if(r=d.relations[a],o=r.source.tablename+"_"+r.source.seq,l=r.target.tablename+"_"+r.target.seq,s=o==tname?r.source.name:l==tname?r.target.name:null)for(t=0;t<n.columns.length;t++)if(n.columns[t].name==s){n.columns[t].hasjoin=!0;break}i.box&&i.fixKeyMode&&i.box.innerGrid.loadData.call(i.box.innerGrid)}},validateTables:function(e){var t,i,n,a,o,l=this,s=l.cubemodel,r=l.m;l.tablemap=l.tablemap||{},l.updateJoinFields(),$.each(s.tables,(function(d,c){var u,m=c._mc;i=m.x,n=m.y,a=m.width,o=m.height,m.theight||m.height,u=m.uid+"_"+m.seq,c.box?c.box.innerGrid.loadData.call(c.box.innerGrid):(t=r.addBox.call(r,i,n,a,o,c,l),c.box=t,e&&l.loadTableContent.call(l,c,e,d==s.tables.length-1)),l.tablemap[u]=c})),r.validateSize.call(r)},validateJoins:function(){var e,t,i,n,a=this,o=a.cubemodel,l=a.m;for(e=o.relations.length-1;e>=0;e--)t=o.relations[e],i=a.tablemap[(t.source.model||t.source.tableuid)+"_"+t.source.seq],n=a.tablemap[(t.target.model||t.target.tableuid)+"_"+t.target.seq],i&&n?t.bl||(t.bl=l.addLink.call(l,i,n,t,o.relations)):o.relations.splice(e,1);a.updateJoinFields(),a.validateLinks(),l.validateLinks.call(l)},validateLinks:function(){var e,t,i,n,a=this.down("[name=mRel]"),o=[],l=this.m.relations||[];for(e=0;e<l.length;e++)i=(t=l[e]).source,n=t.target,i&&n&&o.push({s0:i.tablename,t0:n.tablename,s1:i.seq,t1:n.seq,s2:i.name,t2:n.name,r0:t.join,sdesc:i.tablename+"."+i.name,tdesc:n.tablename+"."+n.name,l:t});a.store.loadData(o)},onDropRecord:function(e,t){var i,n,a,o=this,l=t,s=o.cubemodel,r=o.m.viewer.offset();for(a=(i=new IG$.m$TblObj(null))._mc={},IG$.CopyObject(l,i._mc,"nodepath;name;type;uid;memo;schemaname;alias"),a.x=e.getX()-r.left,a.y=e.getY()-r.top,a.width=180,a.height=200,a.seq=0,i.fields=[],n=0;n<s.tables.length;n++)s.tables[n]._mc.uid==a.uid&&(a.seq=Math.max(a.seq,s.tables[n]._mc.seq+1));s.tables.push(i),o.updateUsedTable(),o.loadTableContent(i)},updateModel:function(){var e,t,i,n,a,o,l,s,r,d,c=this.m,u=c.scrollPanel.offset(),m=this.cubemodel,h=m._mc,b={},p=1/c.zoomRatio;for(h.tables=[],h.joins=[],h.securityfilter=[],e=0;e<m.relations.length;e++)r={join:(d=m.relations[e]).join,operator:d.operator,source:d.source,target:d.target,source_field_formula:d.source_field_formula,target_field_formula:d.target_field_formula},b[d.source.uid]=1,b[d.target.uid]=1,h.joins.push(r);for(e=0;e<m.tables.length;e++){if(s=(i=m.tables[e])._mc,(l=IG$.copyObject(s)).columns=[],n=i.box.innerGrid,a=(o=$(n.$ex.$view)).offset(),l.x=(a.left-u.left)*p,l.y=(a.top-u.top)*p,l.width=o.width(),l.height=o.height(),l.theight=l.height,s.columns)for(t=s.columns.length-1;t>=0;t--)(s.columns[t].iskey||b[s.columns[t].uid])&&l.columns.push(s.columns[t]);h.tables.push(l)}if(m.securityfilter)for(e=0;e<m.securityfilter.length;e++)h.securityfilter.push(m.securityfilter[e])},saveContent:function(e){var t=this;t.updateModel(),t.fireEvent("_model_updated");var i,n=t.cubemodel,a=n.getXML.call(n),o=new IG$._rpc$;i=e?{pid:n.item.pid,address:n.item.address,name:n.item.name,type:"CubeModel"}:{uid:t.uid},o.init(t,{ack:"writecontent",payload:i,mbody:a,meta_type:"cubemodel"},t,(function(e){this.uid=e.uid,this.setTitle(e.name),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}),null),o.send()},onDropField:function(e,t){var i,n,a=this,o=a.cubemodel,l=a.m,s={join:"inner",operator:"="};s.source=e.data,s.target=t.data,o.relations.push(s),a.updateJoinFields(),i=a.tablemap[(s.source.model||s.source.tableuid)+"_"+s.source.seq],n=a.tablemap[(s.target.model||s.target.tableuid)+"_"+s.target.seq],i&&n&&(s.bl=l.addLink.call(l,i,n,s,o.relations),a.validateLinks(),l.validateLinks.call(l))},toolbarHandler:function(e){var t,i=this,n=i.m;switch(e){case"cmd_save":i.uid?i.saveContent():i.saveAsContent(!1);break;case"cmd_saveas":i.saveAsContent(!1);break;case"cmd_simple_view":i.cubemodel.groupview=!i.cubemodel.groupview,n.validateLinks.call(n);break;case"cmd_fix_key":var a=i.cubemodel;for(a.fixKeyMode=!a.fixKeyMode,t=0;t<a.tables.length;t++)a.tables[t].box.fixKeyMode.call(a.tables[t].box,a.fixKeyMode);break;case"cmd_autojoin":i.auto_join();break;case"cmd_load_fields":i.load_fields();break;case"cmd_beutify":i.beutify_diagram();break;case"cmd_table_order":var o=new IG$.dlgTableOrder({instance:i.instance,cubemodel:i.cubemodel});IG$.showDlg(i,o);break;case"cmd_refresh_table":i.down("[name=grid_st]").store.loadData([]),i._s1&&i.loadDatabaseTable(i._s1,"StoredContent",null,{readcontent:"T"})}},load_fields:function(){var e=this,t=e.cubemodel;t.tables.length&&$.each(t.tables,(function(t,i){e.loadTableContent(i)}))},auto_join:function(){var e,t,i,n,a,o,l=this,s=l.cubemodel,r={},d=[];if(s.tables.length>1){for(e=0;e<s.relations.length;e++)r[(a=(n=s.relations[e]).source.tableuid+"_"+n.source.fieldname)+":"+(o=n.target.tableuid+"_"+n.target.fieldname)]=1,r[o+":"+a]=1;for(e=0;e<s.tables.length;e++)for((i=s.tables[e])._cnames={},t=0;t<i._mc.columns.length;t++)i._cnames[i._mc.columns[t].fieldname]=i._mc.columns[t];for(e=0;e<s.tables.length;e++)i=s.tables[e],l.get_auto_join(s.tables,r,d,i);if(d.length>0){var c=new IG$.JoinRec({instance:l.instance,joins:d,callback:new IG$.callBackObj(l,(function(e){var t,i,n,a,o=this.m;for(i=0;i<e.length;i++)t=e[i],s.relations.push(t),n=this.tablemap[(t.source.model||t.source.tableuid)+"_"+t.source.seq],a=this.tablemap[(t.target.model||t.target.tableuid)+"_"+t.target.seq],n&&a&&(t.bl=o.addLink.call(o,n,a,t,s.relations));this.validateLinks(),o.validateLinks.call(o)}))});IG$.showDlg(l,c)}else IG$.alertmsg(ig$.appname,"No join suggestions on this model",null,null,0,"success")}},get_auto_join:function(e,t,i,n){var a,o,l,s,r,d,c,u,m,h,b,p,f=n._mc;for(r=f.uid+"_",a=0;a<e.length;a++)if(p=e[a]._mc,f.uid!=p.uid&&(!f.external_name||f.external_name&&f.external_name!=p.external_name)){for(d=p.uid+"_",u=[],m=[],h=p.columns.length,b=!1,o=0;o<h;o++)c=p.columns[o].fieldname,n._cnames[c]&&(l=r+c,s=d+c,c.indexOf("id")>-1&&(b=!0),t[l+":"+s]||(u.push({join:"inner",operator:"=",source:n._cnames[c],target:p.columns[o]}),t[l+":"+s]=1,t[s+":"+l]=1),m.push(c));if((m.length>5&&h>5||m.length==h)&&b)for(o=u.length-1;o>=0;o--)u[o].source.fieldname.indexOf("id")<0&&u.splice(o,1);for(o=0;o<u.length;o++)i.push(u[o])}},beutify_diagram:function(){var e,t,i,n,a,o=this,l=o.cubemodel,s=[],r=[],d={},c={},u=[];if(l.tables.length>1&&l.relations.length>1){for(e=0;e<l.relations.length;e++)c[(n=l.relations[e]).source.tableuid]=c[n.source.tableuid]||[],c[n.source.tableuid].push(n),c[n.target.tableuid]=c[n.target.tableuid]||[],c[n.target.tableuid].push(n);for(e=0;e<l.tables.length;e++)(a=l.tables[e]).parent=null,a.childnodes=[],a.jointable=[],d[a._mc.uid]=a,u.push(a);for(;u.length>0;)if(c[(a=u[0])._mc.uid])for(t={fact_table:null,tables:[]},i=c[a._mc.uid],e=0;e<i.length;e++)t.tables.push(a),s.push(t),u.splice(0,1),o.gather_join_tables(u,c,d,i[e],t,a);else r.push(a),u.splice(0,1);if(s.length>0)for(e=0;e<s.length;e++)o.update_table_hierarchy(d,s[e]);var m,h=10,b=10,p=0;for(e=0;e<r.length;e++)h+=(m=o.update_position(h,b,10,r[e])).x,p=Math.max(p,m.y);for(b+=p+10,h=10,e=0;e<s.length;e++)b=(m=o.update_position(h,b,10,s[e].fact_table)).y}},update_table_hierarchy:function(e,t){var i={};t.tables.sort((function(e,t){var i=e.jointable.length;return t.jointable.length-i})),t.fact_table=t.tables[0],i[t.fact_table._mc.uid]=1,this.update_linklist(e,t.fact_table,i)},update_linklist:function(e,t,i){var n,a;for(n=0;n<t.jointable.length;n++)i[(a=t.jointable[n])._mc.uid]||(i[a._mc.uid]=1,t.childnodes.push(a),t.jointable[n].parent=t,this.update_linklist(e,a,i))},update_position:function(e,t,i,n){var a,o=e,l=t,s=0;if(n.box.innerGrid.setPosition(e,t),l+=n._mc.height,n.childnodes&&n.childnodes.length){for(l+=i,a=0;a<n.childnodes.length;a++)this.update_position(o,l,i,n.childnodes[a]),o+=n._mc.width+i,s=Math.max(s,n._mc.height);l+=s}return{x:o,y:l}},gather_join_tables:function(e,t,i,n,a,o){var l,s,r,d,c;for(r=n.source.tableuid==o._mc.uid?n.target:n.source,l=0;l<e.length;l++)if(e[l]._mc.uid==r.tableuid){if(c=e[l],a.tables.push(c),e.splice(l,1),o.jointable.push(c),c.jointable.push(o),d=t[c._mc.uid])for(s=0;s<d.length;s++)this.gather_join_tables(e,t,i,d[s],a,c);break}},loadDatabaseTable:function(e,t,i,n){var a,o=e.get("nodepath"),l=new IG$._rpc$,s={address:o,option:t,search:i,uid:e.get("uid")};if(n)for(a in n)s[a]=n[a];(s.uid||s.address)&&(s.subfolder="T",l.init(this,{ack:"content",payload:s,mbody:s},this,this.rs_loadDatabaseTable,!1,[e,t]),l.send())},rs_loadDatabaseTable:function(e,t){t[0];var i,n,a,o=t[1],l=e.children||[],s=[],r=!!o,d=this.down("[name=grid_st]"),c=this.cubemodel,u={};if(l){for(c.tables=c.tables||[],i=0;i<c.tables.length;i++)u[c.tables[i]._mc.uid]=1;for(i=0;i<l.length;i++)a=(n=r?l[i].content:l[i]).type.toLowerCase(),n.uid=n.uid||""+i,n.uid!=this.uid&&(u[n.uid]&&(n.used="*"),"cubemodel"!=a&&(n.physical_name=n.attributes.attrb3),n.iconcls=IG$.get_metatype_icon(a),s.push(n))}d.store.loadData(s)},saveAsContent:function(e){var t=this,i=new IG$.metaSelectDlg({instance:t.instance,mode:"newitem",tree_options:{rootuid:t.obj_uid},callback:new IG$.callBackObj(t,t.saveNewContent,e)});IG$.checkLogin(t,i)},saveNewContent:function(e,t){this.cubemodel.item={name:e.name,address:e.nodepath+"/"+e.name,pid:e.uid},this.saveContent(!0)},_r_join:function(e){var t,i,n=this.cubemodel,a=this.m,o=n.relations;for(t=0;t<o.length;t++)if(o[t]==e){o.splice(t,1);break}for(t=0;t<a.links.length;t++){for(i=!1,j=0;j<a.links[t].links.length;j++)if(a.links[t].links[j]==e){a.links[t].links.splice(j,1),i=!0;break}if(1==i){0==a.links[t].length&&a.links.splice(t,1);break}}this.updateJoinFields(),this.validateLinks(),a.validateLinks.call(a)},searchRelationship:function(){var e=this.down("[name=txt_rel]").getValue(),t=this.down("[name=mRel]").store;t.clearFilter(),e&&(e=e.toLowerCase(),t.filterBy((function(t){var i,n=[t.get("s0"),t.get("s2"),t.get("t0"),t.get("t2")],a=!1;for(i=0;i<n.length;i++)if(n[i]&&n[i].toLowerCase().indexOf(e)>-1){a=!0;break}return a})))},rs_custom_click_func:function(e,t,i){this._s1=e,this.toolbarHandler("cmd_refresh_table")},initComponent:function(){var e=this;$s.apply(this,{items:[{xtype:"panel",layout:"border",split:!0,items:[{xtype:"panel",region:"west",width:250,hideHeaders:!0,title:IRm$.r1("L_TABLE_LIST"),layout:{type:"vbox",align:"stretch"},items:[new IG$.n$navTreeCom({instance:e.instance,name:"mtree",rootuid:this.obj_uid,visibleItems:"folder;dataset;",flex:1,showCustomMenu:function(e){var t=this.customMenu,i=e.get("type").toLowerCase(),n=e.get("name"),a=e.get("nodepath"),o=e.get("uid"),l=(e.get("type"),1==e.get("writable")||1==e.get("manage")),s=1==e.get("manage"),r=!1;return t.removeAll(),(l||s)&&(r=!0,"folder"==i&&t.add({text:IRm$.r1("B_FOLDER"),hidden:!1!==ig$.features.ig_n_f_f,handler:function(){this._createMetaObject.call(this,"Folder",o,a,e)},scope:this}),t.add({text:IRm$.r1("L_RENAME_ITEM",IG$._gitemname(n)),hidden:!1!==ig$.features.ig_n_ren,handler:function(){this._renameMetaObject.call(this,n,o,a,record)},scope:this}),t.add({text:IRm$.r1("L_DELETE_ITEM",IG$._gitemname(n)),hidden:!1!==ig$.features.ig_n_del,handler:function(){this.deleteMetaObject.call(this,o,record)},scope:this})),r},custom_expand_func:new IG$.callBackObj(e,(function(e){this.rs_custom_click_func(e,1,0)})),custom_click_func:new IG$.callBackObj(e,(function(e,t){this.rs_custom_click_func(e,0,1)}))}),{xtype:"gridpanel",name:"grid_st",flex:2,title:IRm$.r1("L_REGISTERED_TABLE"),emptyText:IRm$.r1("M_S_S2"),plain:!0,store:{showcheckselect:!0,fields:["name","type","uid","nodepath","dispname","checked","allow_insert","allow_insert_desc","iconcls","physical_name"]},enableDragDrop:!0,enableDD:!0,columns:[{text:"",width:20,dataIndex:"used"},{xtype:"templatecolumn",text:IRm$.r1("B_NAME"),flex:2,sortable:!1,dataIndex:"name",tdCls:"igc-td-link",tpl:"<div class='ig-navi-itemicon-p'><div class='ig-navi-itemicon {iconcls}'></div></div><span class='ig-navi-text' title='{name} ({type})'>{name} </span>",editor:{allowBlank:!1}}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{iconCls:"icon-refresh",tooltip:IRm$.r1("B_REFRESH"),handler:function(){this.toolbarHandler("cmd_refresh_table")},scope:this},{xtype:"textfield",flex:1,name:"_filter",emptyText:IRm$.r1("L_SEARCH_KWD"),enableKeyEvents:!0,listeners:{keyup:function(e,t,i){13==t.keyCode&&IG$._dofilter(this,"grid_st",["name","alias"])},scope:this}},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){IG$._dofilter(this,"grid_st",["name","alias"])},scope:this}]}],listeners:{cellclick:function(e,t,i,n,a,o){var l,s,r=e.store.getAt(a),d=this.cubemodel;if("*"==r.get("used")){for(l=0;l<d.tables.length;l++)if(d.tables[l]._mc.uid==r.get("uid")){s=d.tables[l];break}s&&this.m.focusTable(s)}},scope:this}}]},{type:"panel",html:"",split:!0,overflowX:"hidden",overflowY:"hidden",name:"mcontainer",region:"center"},{xtype:"panel",split:!0,title:IRm$.r1("L_RELATIONS"),region:"east",name:"p_joins",hidden:!0,tools:[{type:"collapse"}],width:320,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("B_SEARCH"),name:"txt_rel",labelWidth:40,labelAlign:"right",flex:1,emptyText:IRm$.r1("L_SEARCH_KWD"),enableKeyEvents:!0,listeners:{keyup:function(t,i,n){13==i.keyCode&&e.searchRelationship()},scope:this}},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){e.searchRelationship()}}]},{xtype:"gridpanel",name:"mRel",flex:1,store:{fields:["s0","s1","s2","t0","t1","t2","r0","sdesc","tdesc","l"]},columns:[{text:IRm$.r1("L_I_FROM"),flex:1,dataIndex:"sdesc"},{text:IRm$.r1("L_I_TO"),flex:1,dataIndex:"tdesc"},{xtype:"actioncolumn",width:45,items:[{iconCls:"icon-grid-config",tooltip:"Config item",handler:function(e,t,i){var n,a=e.store.getAt(t).get("l");a&&a.bl&&(n=a.bl).showLinkEditor.call(n,[n.links[0]],n.links)}},{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(t,i,n){var a=t.store.getAt(i);e._r_join(a.get("l"))}}]}]}]}]}],tbar:[{iconCls:"icon-toolbar-save",name:"t_save",text:IRm$.r1("B_SAVE"),tooltip:IRm$.r1("L_SAVE_REPORT"),handler:function(){this.toolbarHandler("cmd_save")},scope:this},"-",{iconCls:"icon-toolbar-simple-view",tooltip:IRm$.r1("L_SIMPLE_REL_VIEW"),handler:function(){this.toolbarHandler("cmd_simple_view")},scope:this},{iconCls:"icon-toolbar-table-order",tooltip:IRm$.r1("L_TABLE_ORDER"),handler:function(){this.toolbarHandler("cmd_table_order")},scope:this},"-",{iconCls:"icon-toolbar-fixkey",text:IRm$.r1("L_FIX_KEY"),tooltip:IRm$.r1("L_FIX_KEY"),handler:function(){this.toolbarHandler("cmd_fix_key")},scope:this},{iconCls:"icon-toolbar-autojoin",text:IRm$.r1("L_AUTO_JOIN"),tooltip:"Auto Join",handler:function(){this.toolbarHandler("cmd_autojoin")},scope:this},{iconCls:"icon-toolbar-tablesort",text:IRm$.r1("L_JOIN_BEUTIFY"),tooltip:"sort",handler:function(){this.toolbarHandler("cmd_beutify")},scope:this},{iconCls:"icon-refresh",tooltip:IRm$.r1("B_REFRESH"),handler:function(){this.toolbarHandler("cmd_load_fields")},scope:this},"-",{iconCls:"icon-toolbar-export",tooltip:"Print",handler:function(){this.toolbarHandler("cmd_print")},scope:this},"-",{tooltip:"Zoom In",iconCls:"icon-toolbar-zoomin",handler:function(){this.m.zoom(.1)},scope:this},{tooltip:"Zoom Out",iconCls:"icon-toolbar-zoomout",handler:function(){this.m.zoom(-.1)},scope:this},"->",{iconCls:"icon-joins",tooltip:"Joins",handler:function(){var e=this.down("[name=p_joins]");e.isVisible()?e.hide():e.show()},scope:this}],listeners:{afterrender:function(e){this._init()},resize:function(e){this.m.validateSize()},beforeclose:function(e,t){var i=this;if(i.writable&&i.uid){var n=new IG$._rpc$;n.init(i,{ack:"helpcontent",payload:{uid:i.uid},mbody:{option:"lock",detail:"close"}},i,(function(e){}),!1),n.send()}return!0}}}),IG$.CubeModel.superclass.initComponent.call(this)}}),IG$.dlgTableOrder=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!0,resizable:!0,width:500,height:610,callback:null,_init:function(){var e,t,i,n=this.cubemodel,a=[],o=this.down("[name=grd_tables]");for(n.tables=n.tables||[],e=n.tables,t=0;t<e.length;t++)(i={uid:e[t]._mc.uid,name:e[t]._mc.name,seq:e[t]._mc.seq}).disp=i.seq?i.name+"("+i.seq+")":i.name,a.push(i);o.store.loadData(a)},confirmChanges:function(){var e,t,i,n=this.cubemodel.tables,a={},o=this.down("[name=grd_tables]");for(e=0;e<o.store.data.items.length;e++)a[(t=o.store.data.items[e]).get("uid")+"_"+t.get("seq")]=e;for(e=0;e<n.length;e++)i=n[e]._mc.uid+"_"+n[e]._mc.seq,n[e].sortindex=a[i];n.sort((function(e,t){return e.sortindex-t.sortindex})),this.close()},changeOrder:function(e){var t,i,n=this.down("[name=grd_tables]"),a=n.getSelectionModel(),o=a.selected;o&&1==o.length&&(i=o.items[0],t=n.store.indexOf(i),-1==e?t>0&&(n.store.remove(i),i=n.store.insert(t-1,i),a.select(i,!0)):t+1<n.store.data.items.length&&(n.store.remove(i),i=n.store.insert(t+1,i),a.select(i,!0)))},initComponent:function(){var e=this;e.title=IRm$.r1("L_TBL_ORD"),$s.apply(this,{defaults:{padding:10},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",flex:1,name:"grd_tables",store:{xtype:"store",fields:["name","uid","seq","disp"]},columns:[{xtype:"gridcolumn",flex:1,text:IRm$.r1("B_NAME"),dataIndex:"name"}]},{xtype:"container",padding:"0 0 0 5",layout:{type:"vbox",pack:"center",align:"stretch"},items:[{xtype:"container",flex:1},{xtype:"button",iconCls:"ig-btn-up",handler:function(){this.changeOrder(-1)},scope:this},{xtype:"container",height:10},{xtype:"button",iconCls:"ig-btn-down",handler:function(){this.changeOrder(1)},scope:this},{xtype:"container",flex:1}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this.confirmChanges()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]}),IG$.dlgTableOrder.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(e){e._init.call(e)}}}),IG$.dlgLoadPreview=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!0,resizable:!0,width:950,autoHeight:!0,callback:null,_init:function(){var e=this;e.table?e.load_content():e.dataset&&e.rs_load_content(e.dataset)},load_content:function(e){var t=this,i=new IG$._rpc$,n=t.table._mc;i.init(t,{ack:"tablecontent",payload:{uid:n.uid,type:n.type,passwd:e,option:"preview"},mbody:{option:"preview"}},t,t.rs_load_content,t.err_load_content),i.send()},rs_load_content:function(e){var t,i,n,a,o,l,s,r=e.headers,d=e.inline_data,c=[],u=[],m=[],h=this.down("[name=dataview]"),b=this.table?this.table._mc:null,p={};if(r&&d){if(b&&b.columns)for(t=0;t<b.columns.length;t++)p[b.columns[t].name]=b.columns[t].alias;for(e.delimiter,t=0;t<r.length;t++)p[a=r[t].name]&&p[a]!=a&&(a=p[a]+" - "+a),o="col_"+t,u.push({xtype:"gridcolumn",width:150,text:a,dataIndex:o}),m.push({name:o,mapping:o});for(u.length,t=0;t<d.length;t++){for(n={},s=d[t],i=0;i<s.length;i++)n[o="col_"+i]=s[i];c.push(n)}}l={store:"array",fields:m,data:c},h.reconfigure(l,u)},initComponent:function(){var e=this;e.title=IRm$.r1("L_PRV_DATA"),$s.apply(this,{defaults:{padding:10},layout:"fit",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:"Table data preview"},{xtype:"gridpanel",name:"dataview",height:400,columns:[]}]}],buttons:[{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.dlgLoadPreview.superclass.initComponent.apply(this,arguments)}}),IG$.JoinRec=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!0,resizable:!0,width:600,autoHeight:!0,padding:5,_init:function(){var e,t,i,n,a,o=this.down("[name=gmain]"),l=this.joins,s=[];for(e=0;e<l.length;e++)n=(i=l[e]).source,a=i.target,t={stableuid:n.tableuid,stable:n.tablename,sfield:n.fieldname,ttableuid:a.tableuid,ttable:a.tablename,tfield:a.fieldname,join:i.join},s.push(t);o.store.loadData(s)},_confirm:function(){var e,t,i,n=this,a=n.down("[name=gmain]"),o=n.joins,l=[],s={};for(t=0;t<a.store.data.items.length;t++)s[(e=a.store.data.items[t]).get("stableuid")+"_"+e.get("sfield")+":"+e.get("ttableuid")+"_"+e.get("tfield")]=1;for(t=0;t<o.length;t++)s[(i=o[t]).source.tableuid+"_"+i.source.fieldname+":"+i.target.tableuid+"_"+i.target.fieldname]&&l.push(i);n.callback&&n.callback.execute(l),n.close()},initComponent:function(){$s.apply(this,{title:IRm$.r1("L_JOIN_RECOMMENDATIONS"),items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},minHeight:400,padding:10,items:[{xtype:"gridpanel",name:"gmain",flex:1,columns:[{text:IRm$.r1("L_SRC_TBL"),dataIndex:"stable"},{text:IRm$.r1("L_SRC_FIELD"),dataIndex:"sfield"},{text:IRm$.r1("L_TGT_TABLE"),dataIndex:"ttable"},{text:IRm$.r1("L_TGT_FIELD"),dataIndex:"tfield"},{text:IRm$.r1("B_OP"),dataIndex:"join"},{xtype:"actioncolumn",width:45,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,i){e.store.getAt(t);e.store.removeAt(t)}}]}],store:{fields:["stable","sfield","ttable","tfield","join","stableuid","ttableuid"]}}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.JoinRec.superclass.initComponent.apply(this,arguments)}});
IG$.mgrUserDuty=$s.extend($s.window,{modal:!0,layout:"fit",closable:!1,resizable:!1,width:500,autoHeight:!0,bodyPadding:10,bodyStyle:{background:"#ffffff"},_confirm:function(){if(this.callback){var e,t=this.down("[name=gridduty_sel]"),s=[];for(e=0;e<t.store.data.length;e++)s.push(t.store.data.items[e]);this.callback.execute(s)}this.close()},loadDutyList:function(){var e=new IG$._rpc$;e.init(this,{ack:"usercontent",payload:{address:"/Auth"},mbody:{option:"select"}},this,this.rs_loadDutyList,!1),e.send()},rs_loadDutyList:function(e){var t,s,i=[],o=[],d=this.down("[name=gridduty]"),l=this.down("[name=gridduty_sel]"),a={};if(this.sel)for(t=0;t<this.sel.length;t++)a[this.sel[t].sid]=this.sel[t];if(e)for(t=0;t<e.length;t++)a[(s=e[t]).sid]?o.push(s):i.push(s);d.store.loadData(i),l.store.loadData(o)},moveDuty:function(e){var t,s=this.down("[name=gridduty"+(0==e?"_sel":"")+"]"),i=this.down("[name=gridduty"+(1==e?"_sel":"")+"]"),o=s.getSelectionModel().getSelection();if(o.length>0)for(t=0;t<o.length;t++)s.store.remove(o[t]),i.store.add(o[t])},initComponent:function(){this.title=IRm$.r1("L_MGR_UD");var e=[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},border:0,bodyPadding:5,items:[{xtype:"displayfield",value:IRm$.r1("L_UD_DESC")},{xtype:"panel",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",name:"gridduty",border:1,flex:1,height:300,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},multiSelect:!0,store:{fields:["name","dutytype","sid","status","type"]},columns:[{header:IRm$.r1("B_NAME"),dataIndex:"name",flex:1,sortable:!0,hideable:!1},{header:IRm$.r1("B_TYPE"),dataIndex:"type",flex:1,sortable:!0,hideable:!1}]},{xtype:"container",bodyPadding:"0 4 0 4",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:1},{xtype:"button",text:">>",handler:function(){this.moveDuty(!0)},scope:this},{xtype:"button",text:"<<",handler:function(){this.moveDuty(!1)},scope:this},{xtype:"container",flex:1}]},{xtype:"gridpanel",name:"gridduty_sel",flex:1,border:1,height:300,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},multiSelect:!0,store:{fields:["name","dutytype","sid","status","type"]},columns:[{header:IRm$.r1("B_NAME"),dataIndex:"name",flex:1,sortable:!0,hideable:!1},{header:IRm$.r1("B_TYPE"),dataIndex:"type",flex:1,sortable:!0,hideable:!1}]}]}]}],t=[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}];$s.apply(this,{items:e,buttons:t}),IG$.mgrUserDuty.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(e){this.loadDutyList()}}});
IG$.codemapping=$s.extend($s.window,{modal:!0,layout:"fit",closable:!1,resizable:!1,width:540,height:480,_confirm:function(){var e,t,a,i=this,n=i.down("[name=grd_data]"),o=i.down("[name=i_cset_g]"),l=i.down("[name=displabel_c]"),d=i.down("[name=p_1a]"),s=i.down("[name=p_1]"),c=i.pitem;if(IG$.checkFields(i,["p_1"])&&c){if(s.clearInvalid(),c.name=s.getValue(),c.description=i.down("[name=p_2]").getValue(),c.dtype=i.down("[name=p_3]").getValue(),c.sql_data=i.down("[name=p_4]").getValue(),c.static_data=[],c.datasource=i.down("[name=cbdatasource]").getValue(),!c.name)return void s.markInvalid();for(c.i_cdata=[],"static"==c.dtype?c.i_cset=i.down("[name=i_cset_s]").getValue():c.i_cset=i.down("[name=i_cset]").checkboxCmp.getValue(),e=0;e<n.store.data.items.length;e++)(t=n.store.data.items[e]).get("code")&&(c.static_data.push({code:t.get("code"),value:t.get("value")}),"static"==c.dtype&&t.get("color")&&c.i_cdata.push({code:t.get("code"),color:t.get("color")}));if("static"!=c.dtype)for(e=0;e<o.store.data.items.length;e++)(t=o.store.data.items[e]).get("color")&&c.i_cdata.push({code:t.get("code"),color:t.get("color")});d._confirm.call(d),"static"!=c.dtype&&"sql"!=c.dtype||(c.displabel=l.getValue()),(a=new IG$._rpc$).init(i,{ack:"writecontent",payload:{uid:i.pitem.uid,name:i.pitem.name,description:i.pitem.description},mbody:i.pitem,meta_type:"code_mapping"},i,(function(e){this.callback&&this.callback.execute(this.item),this.close()}),null),a.send()}},_init:function(){this._getDsource()},_getDsource:function(){var e=this.instance,t=new IG$._rpc$;t.init(this,{ack:"tablecontent",payload:{address:"/"},mbody:{option:"standard"}},this,(function(t){var a,i,n,o=[],l=(e.dlgLogin.jS2,this.down("[name=cbdatasource]"));if(t&&t.length){for(n=t,o.push({dispname:"-- Select Pool --",uid:""}),i=0;i<n.length;i++)(a=n[i]).dispname=a.name,o.push(a);l.store.loadData(o),l.setValue("")}this._getMeta()}),!1),t.send()},_getMeta:function(){var e=new IG$._rpc$;e.init(this,{ack:"content",payload:{uid:this.uid,revision:this.revision},mbody:{option:"diagnostics"}},this,(function(e){var t=this;t.pitem=e.content,t.pitem.get=function(e){return t.pitem[e]},t.pitem.set=function(e,a){t.pitem[e]=a},t._applyMeta()}),!1),e.send()},_applyMeta:function(){var e,t,a=this,i=a.pitem,n=a.down("[name=p_1a]");if(i){if(e=[{c:"p_1",v:i.name},{c:"p_2",v:i.description},{c:"p_3",v:i.dtype||(ig$.$l_>5?"static":"")},{c:"p_4",v:i.sql_data},{c:"cbdatasource",v:i.datasource},{c:"i_cset_s",v:i.i_cset}],a.down("[name=p_1a]").rec=i,"sqljoin"==i.dtype&&(n.datasource=i.datasource,n.loadContent.call(n)),a._applyVal(e),i.i_cset&&i.i_cdata){var o,l={};for(t=0;t<i.i_cdata.length;t++)l[(o=i.i_cdata[t]).code]=o.color;for(t=0;t<i.static_data.length;t++)(o=i.static_data[t]).color=l[o.code]}a.down("[name=grd_data]").store.loadData(i.static_data),a.down("[name=i_cset_g]").store.loadData(i.i_cdata),a.down("[name=displabel_c]").setValue(i.displabel||""),i.i_cset&&a.down("[name=i_cset]").expand()}},_applyVal:function(e){var t;for(t=0;t<e.length;t++)this.down("[name="+e[t].c+"]").setValue(e[t].v||"")},_moveGrdSel:function(e,t){var a=e.getSelectionModel().getSelection(),i=a&&a.length?a[0]:null;if(i){var n=e.getStore().indexOf(i);if(t<0){if(--n<0)return}else if(++n>=e.getStore().getCount())return;e.getStore().remove(i),i=e.getStore().insert(n,i),e.getSelectionModel().select(i,!0)}},initComponent:function(){var e=this,t=[{name:IRm$.r1("B_SELECT"),value:""},{name:"Static Values",value:"static"},{name:"SQL Query",value:"sql"}];ig$.$l_=ig$.$l_||0,ig$.$l_<5&&t.push({name:"SQL Join",value:"sqljoin"}),e.title=IRm$.r1("T_CODE_MAPPING"),$s.apply(e,{bodyStyle:"padding:5px; background: #ffffff",items:[{xtype:"panel",padding:"5 5",border:0,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("B_NAME"),name:"p_1"},{xtype:"textarea",fieldLabel:IRm$.r1("B_DESC"),name:"p_2",height:60},{xtype:"combobox",fieldLabel:IRm$.r1("L_MAPPING_TYPE"),hidden:ig$.$l_>5,name:"p_3",store:{xtype:"store",fields:["name","value"],data:t},queryMode:"local",valueField:"value",displayField:"name",editable:!1,listeners:{change:function(e,t,a){if(t){var i=this;i.down("[name=cbdatasource]").setVisible("static"!=t),i.down("[name=lt_0]").setVisible("static"==t),i.down("[name=lt_1]").setVisible("sql"==t),i.down("[name=lt_2]").setVisible("sqljoin"==t),i.down("[name=i_cset]").setVisible("static"!=t),ig$.$l_<5&&i.down("[name=displabel_c]").setVisible("sqljoin"!=t)}},scope:this}},{xtype:"fieldset",title:IRm$.r1("L_STATIC_DATA_VALUES"),name:"lt_0",flex:1,hidden:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"checkbox",name:"i_cset_s",fieldLabel:IRm$.r1("L_USE_COLORSET"),boxLabel:IRm$.r1("B_ENABLE"),hidden:ig$.$l_>5,listeners:{change:function(e){var t=e.getValue();this.down("[name=grd_data]").columns[2].setVisible(t)},scope:this}},{xtype:"gridpanel",name:"grd_data",tbar:[{xtype:"toolbar",hidden:!!this.mdlgmode,items:[{text:IRm$.r1("L_ADD_ROW"),xtype:"button",handler:function(){this.down("[name=grd_data]").store.add({})},scope:this},{text:IRm$.r1("L_DELETE_CHECKED"),xtype:"button",handler:function(){var e,t=this.down("[name=grd_data]"),a=t.getSelectionModel().selected;for(e=a.length-1;e>=0;e--)t.store.remove(a.items[e])},scope:this},"-",{xtype:"button",text:IRm$.r1("B_UP"),handler:function(){var e=this.down("[name=grd_data]");this._moveGrdSel(e,-1)},scope:this},{xtype:"button",text:IRm$.r1("B_DOWN"),handler:function(){var e=this.down("[name=grd_data]");this._moveGrdSel(e,1)},scope:this}]}],flex:1,store:{xtype:"store",fields:["code","value","color"]},selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{text:IRm$.r1("B_CODE"),dataIndex:"code",flex:1,editor:{xtype:"textfield",allowBlack:!0}},{text:IRm$.r1("B_TEXT"),dataIndex:"value",flex:1,editor:{xtype:"textfield",allowBlack:!1}},{text:IRm$.r1("B_COLOR"),dataIndex:"color",width:160,hidden:!0,renderer:function(e,t,a){return"<div class='igc-colorset-icon' style='background-color:"+e+";'></div><span>"+e+"</span>"},editor:{type:"color"}}]}]},{xtype:"combobox",name:"cbdatasource",queryMode:"local",fieldLabel:IRm$.r1("L_DATASOURCE"),displayField:"dispname",valueField:"uid",editable:!1,autoSelect:!1,store:{xtype:"store",fields:["name","dispname","uid","isuserdb","savepwd"]},listeners:{select:function(e){var t=e.getValue(),a=this.down("[name=p_1a]");"sqljoin"==this.down("[name=p_3]").getValue()&&(a.datasource=t,a.loadContent.call(a))},scope:this}},{xtype:"fieldset",title:IRm$.r1("L_SQL_DATA_VALUES"),name:"lt_1",minHeight:230,flex:1,hidden:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textarea",name:"p_4",flex:1},{xtype:"displayfield",autowidth:!1,value:"CODE, VALUE, SORT and additional fields in SELECT"}]},{xtype:"container",title:IRm$.r1("L_SQL_TABLE_JOIN"),name:"lt_2",flex:1,hidden:!0,minHeight:600,layout:"anchor",items:[new IG$.codeMappingPanel({name:"p_1a",border:0,anchor:"100%",d_m:"cmap"})]},{xtype:"combobox",fieldLabel:IRm$.r1("L_LABEL_VALUE"),name:"displabel_c",queryMode:"local",hidden:!0,editable:!0,valueField:"value",displayField:"name",store:{xtype:"store",fields:["name","value"],data:[{name:"Mapped values",value:""},{name:"{CODE} {VALUE}",value:"{CODE} {VALUE}"},{name:"{CODE} {SORT} {VALUE}",value:"{CODE} {SORT} {VALUE}"}]}},{xtype:"fieldset",title:ig$.$l_<5?IRm$.r1("L_COLORSET"):null,name:"i_cset",checkboxToggle:ig$.$l_<5,collapsed:!0,height:200,layout:"fit",items:[{xtype:"gridpanel",name:"i_cset_g",selType:"checkboxmodel",tbar:[{xtype:"toolbar",items:[{text:IRm$.r1("L_ADD_ROW"),xtype:"button",handler:function(){this.down("[name=i_cset_g]").store.add({})},scope:this},{text:IRm$.r1("L_DELETE_CHECKED"),xtype:"button",handler:function(){var e,t=this.down("[name=i_cset_g]"),a=t.getSelectionModel().selected;for(e=a.length-1;e>=0;e--)t.store.remove(a.items[e])},scope:this},"-",{xtype:"button",text:IRm$.r1("B_UP"),handler:function(){var e=this.down("[name=i_cset_g]");this._moveGrdSel(e,-1)},scope:this},{xtype:"button",text:IRm$.r1("B_DOWN"),handler:function(){var e=this.down("[name=i_cset_g]");this._moveGrdSel(e,1)},scope:this}]}],selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},store:{xtype:"store",fields:["code","color"]},columns:[{text:IRm$.r1("B_VALUE"),dataIndex:"code",flex:1,editor:{xtype:"textfield",allowBlack:!1}},{text:IRm$.r1("B_COLOR"),dataIndex:"color",flex:1,renderer:function(e,t,a){return"<div class='igc-colorset-icon' style='background-color:"+e+";'></div><span>"+e+"</span>"},editor:{type:"color"}}]}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){this._init()}}}),IG$.codemapping.superclass.initComponent.apply(this,arguments)}});
IG$.multiMeasure=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",padding:5,closable:!1,resizable:!1,width:550,height:560,callback:null,_fdata:[{name:"Distinct Count",value:"COUNT DISTINCT",metric:1},{name:"Count",value:"COUNT",metric:1},{name:"Sum",value:"SUM",metric:1},{name:"Average",value:"AVG",metric:1},{name:"Max",value:"MAX",metric:1},{name:"Min",value:"MIN",metric:1},{name:"Template",value:"TMPL",metric:0}],_confirm:function(){var e=this;if(e.callback){var t,a,n,l=[],i=this.down("[name=measureview]"),o=this.down("[name=clocation]");for(t=0;t<i.store.data.items.length;t++)(a=i.store.data.items[t]).data.selected&&(n={nodepath:a.get("nodepath"),formula:a.get("formula"),type:a.get("type"),name:a.get("name"),uid:a.get("uid"),datatype:a.get("datatype"),measurename:a.get("measurename"),ctype:a.get("ctype"),clocation:a.get("clocation")},l.push(n));if(0==l.length)return void IG$.alertmsg(ig$.appname,IRm$.r1("B_SELECT_TARGET"),null,null,0,"");e.rs_reg_measures({items:l,clocation:o.getValue(),dialog:e,vmode:e.vmode,tmpl:e.tmpl})}e.close()},rs_reg_measures:function(e){var t,a,n,l,i,o,s,r,m,d,u,c=this,p=[],f={items:[]},h=(e.vmode,e.items),_=e.clocation,g=(e.dialog,c.nodepath),y=e.tmpl,x=f.items;for(c.mfolder=_,t=0;t<h.length;t++)if(l=h[t],s=e.vmode?l.clocation+"/":"{parent}"==_.substring(0,"{parent}".length)?l.nodepath.substring(0,l.nodepath.lastIndexOf("/"))+_.substring("{parent}".length)+"/":g+"/"+(_?_+"/":""),l.cloc=s,(d=l.measurename).indexOf("/")>-1&&(d=(d=d.split("/")).join("&#x2044;")),i={name:d,uid:s+d,type:l.ctype||"Measure",createstructure:"T"},c.mitem&&(i.pid=c.mitem.uid),p.push(i),u=c.mitem?c.mitem:l,"DateMetric"==l.ctype)o={cubeuid:c.uid,dateformat:"DATE",fieldid:l.uid,fieldname:d,dbtype:"auto",issql:!0,meta_type:"custom_dimension"},x.push(o);else{switch(l.formula){case"COUNT DISTINCT":case"COUNT_DISTINCT":n="COUNT(DISTINCT ["+l.name+"])";break;case"TMPL":break;default:n=l.formula+"(["+l.name+"])"}if("TMPL"==l.formula&&y){for(m=(n=y.expression).indexOf("[field]");m>-1;)m=(n=n.substring(0,m)+"["+l.name+"]"+n.substring(m+"[field]".length)).indexOf("[field]");for(o={meta_type:"measure",name:l.measurename,expression_type:y.expressiontype,calcmode:y.calcmode,expression:n,rel_items:[u]},a=0;a<y.fields.length;a++)y.fields[a].type=y.fields[a].type||y.fields[a].itemtype,o.items.push(y.fields[a]);x.push(o)}else o={meta_type:"measure",name:l.measurename,expression_type:l.formula,expression:n,rel_items:[u]},x.push(o)}(r=new IG$._rpc$).init(c,{ack:"batchcontent",payload:p,mbody:f},c,(function(e){c.callback.execute()}),null),r.send()},_getfmtvalue:function(e,t,a,n){if(n||(e?/(\[field\]|\[formula\])/.test(e):0)){var l=function(e,t,a){if(a&&a.length){var n=t.indexOf(e);n>-1&&(t=t.substring(0,n)+a+t.substring(n+e.length))}return t};this._fmt_formu||(this._fmt_formu={COUNT:"Count",COUNT_DISTINCT:"Unique count","COUNT DISTINCT":"Unique count",SUM:"Total",MIN:"Min.",MAX:"Max.",AVG:"Avg."}),t=l("[field]",e,t),t=this._fmt_formu[a.toUpperCase()]?l("[formula]",t,this._fmt_formu[a.toUpperCase()]):l("[formula]",t,a)}return t},apply_template:function(){var e,t,a,n=this.down("[name=measureview]"),l=this.down("[name=t_format]").getValue(),i=n.getSelectionModel().selected,o=l?/(\[field\]|\[formula\])/.test(l):0;if(0==i.length&&(i=n.store.data),o)for(e=0;e<i.length;e++)a=(t=i.items[e]).get("name"),a=this._getfmtvalue(l,a,t.get("formula"),o),t.set("measurename",a)},initComponent:function(){this.title=IRm$.r1("T_M_MEASURE"),$s.apply(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:5,items:[{xtype:"fieldset",title:IRm$.r1("L_MULTIMEASURE"),layout:{type:"vbox",align:"stretch"},flex:1,padding:5,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("B_PATH"),hidden:1==this.vmode||2==this.vmode,name:"clocation"},{xtype:"fieldcontainer",layout:"hbox",fieldLabel:IRm$.r1("L_MEASURE_NAME"),items:[{xtype:"textfield",name:"t_format",value:"[formula] [field]"},{xtype:"button",text:IRm$.r1("B_APPLY"),handler:function(){this.down("[name=t_format]").getValue()&&(ig$.measure_naming=this.down("[name=t_format]").getValue()),this.apply_template()},scope:this},{xtype:"container",flex:1}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},hidden:1==this.vmode||2==this.vmode,items:[{xtype:"displayfield",value:"Location ex: {parent}/measures"},{xtype:"container",flex:1}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"displayfield",value:"Name template ex: [formula] [field]"},{xtype:"container",flex:1}]}]},{xtype:"gridpanel",name:"measureview",collapsible:!1,stateful:!0,columnLines:!0,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell"},store:{fields:["name","uid","nodepath","type","datatype","measurename","formula","ctype","clocation"]},flex:1,initialized:!1,layout:"fit",plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{text:IRm$.r1("L_MEASURE_NAME"),dataIndex:"measurename",flex:1,editor:{allowBlank:!1}},{text:IRm$.r1("L_FACT_NAME"),dataIndex:"name",flex:1,editor:{allowBlank:!1}},{width:120,text:IRm$.r1("B_TYPE"),dataIndex:"formula",editor:{xtype:"combobox",queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,triggerAction:"all",selectOnTab:!0,store:{xtype:"store",fields:["name","value"],data:this._fdata},lazyRender:!0,listClass:"x-combo-list-small"}}],viewConfig:{stripeRows:!0},fbar:[{xtype:"toolbar",items:[{xtype:"button",text:IRm$.r1("L_REMOVE_SELECTED"),handler:function(){var e,t=this.down("[name=measureview]"),a=t.store,n=t.getSelectionModel().selected;for(e=n.length-1;e>=0;e--)a.remove(n.items[e])},scope:this},"->",{xtype:"button",text:IRm$.r1("B_TEMPLATE"),handler:function(){var e,t=this,a=new IG$.measureEditor({instance:t.instance,dmode:1,cubeuid:t.pcube.uid,clItem:t.tmpl||{},callback:new IG$.callBackObj(t,(function(e){t.tmpl=e?e.citem:null;var a,n=t.down("[name=measureview]").getSelectionModel().selected;for(a=0;a<n.length;a++)n.items[a].set("formula","TMPL")}))}),n=t.pcube,l=n?n.customstyle:null;if(a.clItem.cubeinfo.styles=[],l)for(e=0;e<l.length;e++)a.clItem.cubeinfo.styles.push(l[e]);a.clItem.expressiontype=a.clItem.expressiontype||"SUM([field])",a.clItem.expression=a.clItem.expression||"SUM([field])",IG$.showDlg(t,a)},scope:this}]}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){var e,t,a,n,l,i,o=this,s=o.down("[name=measureview]"),r=o.down("[name=clocation]"),m=o.mitem;if(n=ig$.measure_naming||"[formula] [field]",o.down("[name=t_format]").setValue(n),2==o.vmode){for(nformat=n?/(\[field\]|\[formula\])/.test(n):0,e=[],t=0;t<o._fdata.length;t++)(a=o._fdata[t]).metric>0&&(l=a.name,i=l=o._getfmtvalue(n,l,a.value,nformat),e.push({measurename:i,formula_desc:a.name,name:m.name,formula:a.value}));s.store.loadData(e)}else r.setValue(null==o.mfolder?"{parent}/measures":o.mfolder),o.metaitems&&(s.store.loadData(o.metaitems),o.apply_template())}}}),IG$.multiMeasure.superclass.initComponent.apply(this,arguments)}}),IG$.multiRename=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",padding:5,closable:!1,resizable:!1,width:560,height:500,callback:null,_confirm:function(){var e,t,a,n=[],l=this.down("[name=measureview]");for(e=0;e<l.store.data.items.length;e++)(t=l.store.data.items[e]).get("cname")&&(a={nodepath:t.get("nodepath"),type:t.get("type"),name:t.get("cname"),uid:t.get("uid")},n.push(a));0!=n.length?this.rs_rename_tool({items:n,dialog:this}):IG$.alertmsg(ig$.appname,IRm$.r1("B_SELECT_TARGET"),null,null,0,"")},rs_rename_tool:function(e){var t,a,n,l,i=this,o=[],s=(e.vmode,e.items);e.dialog;for(t=0;t<s.length;t++)n={name:(a=s[t]).name,uid:a.uid,type:a.type,option:"rename"},o.push(n);(l=new IG$._rpc$).init(i,{ack:"batchcontent",payload:o,mbody:{items:[],option:"rename"}},i,(function(e){i.callback&&i.callback.execute(),i.close()}),null),l.send()},apply_template:function(){var e=this,t=e.down("[name=orig_filename]"),a=e.down("[name=photo]"),n=e.down("[name=mform]");if(e.__cprog)IG$.alertmsg(ig$.appname,"Still progressing. Please wait!",null,null,0,"warning");else if(a.getRawValue()){n.getForm();document.charset="UTF-8";var l=a.getRawValue();l.indexOf("\\")>-1&&(l=l.substring(l.lastIndexOf("\\")+1)),t.setValue(l),e.__cprog=1,n.submit({url:ig$.servlet,waitMsg:"Uploading your data file",success:function(n,l){var i=n.errorReader.jsonData,o=i&&i.result?i.result.uid:null;t.setValue(""),a.clearValue(),e.processUploadedFile(o),e.__cprog=0}})}else e.__cprog=0,e.apply_template_final()},processUploadedFile:function(e){var t=new IG$._rpc$;t.init(this,{ack:"uploadcontent",payload:{fileuid:e},mbody:{option:"read_txt"}},this,(function(e){var t,a,n,l,i,o,s=e.content;if(t=this.__dict=this.__dict||{},s&&s.length)for(a=s.split("\n"),l=0;l<a.length;l++)(n=a[l]).length&&n.indexOf(",")>0&&(i=n.substring(0,n.indexOf(",")),o=n.substring(n.indexOf(",")+1),i&&i.length&&o&&o.length&&(t[i]=o));this.apply_template_final(!0)})),t.send()},apply_template_final:function(){var e,t,a,n,l,i=this.down("[name=measureview]"),o=this.down("[name=renamemask]").getValue(),s=this.down("[name=remove_underline]").getValue(),r=i.getSelectionModel().selected,m="a,an,the,at,by,for,in,of,on,to,from,up,and,as,but,or,nor,yet,so,vs".split(","),d={},u={id:1};for(l=this.__dict||{},0==r.length&&(r=i.store.data),e=0;e<m.length;e++)d[m[e]]=1;var c=function(e,t){var a,n,i,o,r,m,c="",p=t.length;for(l[t]&&(p=(t=l[t]).length),a=0;a<p;a++){switch(i=a>0?t.charAt(a-1):null,n=t.charAt(a),s&&"_"==n&&(n=" "),e){case"lowercase":n=n.toLowerCase();break;case"uppercase":n=n.toUpperCase();break;case"first_letter_uppercase":n=0==a?n.toUpperCase():n.toLowerCase();break;case"first_of_each_word_uppercase":n=0==a||" "==i||"_"==i?n.toUpperCase():n.toLowerCase();break;case"first_of_each_word_uppercase_english":if(0==a)n=n.toUpperCase();else if(" "==i||"_"==i){for(r="",o=a;o<p&&(" "!=(m=t.charAt(o))&&"_"!=m);o++)r+=m;d[r.toLowerCase()]?n=n.toLowerCase():u[r.toLowerCase()]?(n=r,a+=r.length):n=n.toUpperCase()}else n=n.toLowerCase()}c+=n}return c};for(e=0;e<r.length;e++)a=(t=r.items[e]).get("name"),n=c(o,t.get("physical_name")||a),t.set("cname",n)},initComponent:function(){this.title=IRm$.r1("T_M_MEASURE"),$s.apply(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:5,items:[{xtype:"fieldset",title:IRm$.r1("L_MULTI_RENAME"),layout:{type:"vbox",align:"stretch"},flex:1,padding:5,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",name:"mform",layout:"anchor",items:[{xtype:"hiddenfield",name:"_mts_",value:IG$._g$a},{xtype:"textfield",name:"orig_filename",hidden:!0,fieldLabel:IRm$.r1("L_ORIG_NAME")},{xtype:"fileuploadfield",name:"photo",fieldLabel:IRm$.r1("L_DATA"),msgTarget:"side",allowBlank:!1,anchor:"100%",buttonText:IRm$.r1("L_SELECT_FILE"),buttonConfig:{margin:"0 2 0"}}]},{xtype:"checkbox",name:"remove_underline",fieldLabel:IRm$.r1("L_REMOVE_UNDERLINE"),boxLabel:IRm$.r1("B_ENABLED")},{xtype:"fieldcontainer",layout:"hbox",fieldLabel:IRm$.r1("L_RENAME_MASK"),items:[{xtype:"combobox",name:"renamemask",valueField:"value",displayField:"name",queryMode:"local",editable:!1,store:{fields:["name","value"],data:[{name:"Unchanged",value:""},{name:"All lowercase",value:"lowercase"},{name:"All UPPERCASE",value:"uppercase"},{name:"First letter uppercase",value:"first_letter_uppercase"},{name:"First of each word uppercase",value:"first_of_each_word_uppercase"},{name:"First of each word uppercase (English in title)",value:"first_of_each_word_uppercase_english"}]}},{xtype:"button",text:IRm$.r1("B_APPLY"),handler:function(){this.apply_template()},scope:this}]}]}]},{xtype:"gridpanel",name:"measureview",collapsible:!1,stateful:!0,columnLines:!0,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell"},store:{fields:[]},flex:1,initialized:!1,layout:"fit",plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{text:IRm$.r1("L_PHYSICAL_NAME"),dataIndex:"physical_name",flex:1},{text:IRm$.r1("B_NAME"),dataIndex:"name",flex:1},{text:IRm$.r1("L_NEW_NAME"),dataIndex:"cname",flex:1,editor:{allowBlank:!1}}],viewConfig:{stripeRows:!0},tbar:[{xtype:"toolbar",items:[{xtype:"button",text:IRm$.r1("L_REMOVE_SELECTED"),handler:function(){var e,t=this.down("[name=measureview]"),a=t.store,n=t.getSelectionModel().selected;for(e=n.length-1;e>=0;e--)a.remove(n.items[e])},scope:this}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){var e=this.down("[name=measureview]"),t=this.down("[name=mform]");e.store.loadData(this.metaitems),t.getForm().errorReader=new IG$.m2ER}}}),IG$.multiRename.superclass.initComponent.apply(this,arguments)}});
IG$.d$QryTool=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:700,autoHeight:!0,autoScroll:!0,updateChanges:function(){var t,e,o,a=this,i=a.down("[name=ctrlpool]"),l=a.down("[name=columngrid]");for(a.sheetoption.sqloption.dbpool=i.getValue(),i=a.down("[name=sqlquery]"),a.sheetoption.sqloption.sql=i.getValue(),a.sheetoption.sqloption.sqlquery=a.sheetoption.sqloption.sql,a.sheetoption.sqloption.columns=[],t=0;t<l.store.data.items.length;t++)(o=(e=l.store.data.items[t]).data).dataoption={},o.dataoption.data=e.get("dataoption_data"),o.dataoption.datadelimiter=e.get("dataoption_datadelimiter"),o.dataoption.coldelimiter=e.get("dataoption_coldelimiter"),o.dataoption.valuetype=e.get("dataoption_valuetype"),a.sheetoption.sqloption.columns.push(o)},confirmDialig:function(){this.updateChanges(),this.callback&&this.callback.execute(),this.close()},loadPool:function(){var t=this,e=new IG$._rpc$;t.sheetoption.sqloption||(t.sheetoption.sqloption={}),t.down("[name=sqlquery]").setValue(t.sheetoption.sqloption.sql||t.sheetoption.sqloption.sqlquery||""),e.init(t,{ack:"tablecontent",payload:{address:""},mbody:{}},t,t.rs_loadPool,null),e.send()},rs_loadPool:function(t){var e,o,a=IG$.XGetNode(t,"/smsg/item"),i=IG$.XGetChildNodes(a),l=this.down("[name=ctrlpool]"),n=this.down("[name=ctrlquerytype]"),s=[];for(e=0;e<i.length;e++)(o=IG$.XGetAttrProp(i[e])).select=this.sheetoption.sqloption.dbpool==o.name,"MECBASE"!=o.name&&s.push(o);l.store.loadData(s),l.setValue(this.sheetoption.sqloption.dbpool),n.setValue("stmt")},getMetaInfo:function(){var t,e=this,o=new IG$._rpc$;e.down("[name=promptgrid]");e.updateChanges(),t={dbpool:e.down("[name=ctrlpool]").getValue(),method:e.down("[name=ctrlquerytype]").getValue(),sql:e.down("[name=sqlquery]").getValue()},o.init(e,{ack:"olapservice",payload:{uid:e.uid,option:"sqlcubedata"},mbody:t},e,e.rs_getMetaInfo,null),o.send()},rs_getMetaInfo:function(t){var e,o,a,i,l,n,s=IG$.XGetNode(t,"/smsg/columns"),d=s?IG$.XGetChildNodes(s):null,p=IG$.XGetNode(t,"/smsg/result"),r=[],m=[],u=[],c=[],h=this.down("[name=columngrid]");if(d){for(e=0;e<d.length;e++)o=IG$.XGetAttrProp(d[e]),r.push(o),u.push("c"+e),m.push({xtype:"gridcolumn",flex:1,text:o.fieldname,minWidth:120,dataIndex:"c"+e});if(p)for(l=IG$.XGetAttr(p,"delimiter"),i=(i=IG$.XGetTextVal(p)).split(l),a={},e=0;e<i.length&&(n=e%r.length,!(e>0&&0==n&&(c.push(a),a={},c.length>100)));e++)a["c"+n]=i[e]}var y=Ext.create("Ext.data.ArrayStore",{fields:u});h.reconfigure(y,m),h.store.loadData(c)},toolbarHandler:function(t){switch(t){case"cmd_getmeta":this.getMetaInfo()}},initComponent:function(){var t=this,e=$(document);t.maxHeight=e.height()-20,t.title=IRm$.r1("I_SQLCUBE"),t.title=IRm$.r1("I_QRY_TOOL");var o={xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:5,tbar:[{xtype:"combobox",name:"ctrlpool",queryMode:"local",displayField:"disp",valueField:"name",fieldLabel:IRm$.r1("L_DATASOURCE"),editable:!1,autoSelect:!0,store:{fields:["name","disp"]}},{xtype:"combobox",name:"ctrlquerytype",queryMode:"local",displayField:"disp",valueField:"name",fieldLabel:IRm$.r1("L_QUERY_TYPE"),editable:!1,autoSelect:!0,store:{fields:["name","disp"],data:[{disp:"Statement",name:"stmt",selected:1},{disp:"PreparedStatement",name:"pstmt"}]}}],items:[{xtype:"textarea",name:"sqlquery",fieldLabel:IRm$.r1("L_SQL_QUERY"),height:160},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:IRm$.r1("L_RUN_REPORT"),width:120,handler:function(){this.toolbarHandler("cmd_getmeta")},scope:this},{xtype:"fieldcontainer",width:10},{xtype:"displayfield",value:" Click button to get result",flex:1}]},{xtype:"grid",title:IRm$.r1("L_DATA_RESULTS"),name:"columngrid",height:250,stateful:!0,columnLines:!0,store:{xtype:"store",fields:["name","fieldname","type","datatype","tablename","dataoption_data","dataoption_valuetype","dataoption_datadelimiter","dataoption_coldelimiter","uid","mapto"]},initialized:!1,layout:"fit",columns:[]}]};Ext.apply(this,{defaults:{bodyStyle:"padding:0px"},autoScroll:!0,items:[o],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this.confirmDialig()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(t){this.loadPool()}}}),IG$.d$QryTool.superclass.initComponent.apply(this,arguments)}});
IG$.sqlcube_wizard=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!1,resizable:!0,width:650,height:500,autoScroll:!1,bodyPadding:0,_confirm:function(){var e=this;e.getAllValues(e.sheetoption)||(e.callback&&e.callback.execute(e),e.close())},init:function(){new IG$._rpc$;this.setAllValues(this.sheetoption)},validateQuery:function(){var e,t=this,i=new IG$._rpc$;e={dbpool:t.sheetoption.dbpool},t.getAllValues(e)||(i.init(t,{ack:"olapservice",payload:{uid:t.sheetoption.uid,option:"sqlcubemeta"},mbody:e,meta_type:"inlineview"},t,(function(e){e&&1==e.length&&IG$.alertmsg(ig$.appname,IRm$.r1("M_VALIDATED")+"("+(e[0].columns?e[0].columns.length:"0")+" columns)",null,null,0,"success")}),null),i.send())},initComponent:function(){var e=this;e.title=IRm$.r1("I_SQLCUBE"),$s.apply(this,{items:[{xtype:"panel",name:"mainpanel",layout:{type:"vbox",align:"stretch"},flex:1,autoScroll:!1,items:[{xtype:"panel",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("L_VIEW_NAME"),name:"name",required:!0},{xtype:"textarea",name:"sql",fieldLabel:IRm$.r1("L_SQL_QUERY"),flex:1,required:!0}]}]}],buttons:[{text:IRm$.r1("B_VALIDATE"),handler:function(){this.validateQuery()},scope:this},"->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.init()}}}),IG$.sqlcube_wizard.superclass.initComponent.apply(this,arguments)}});
IG$.multimetric=$s.extend(IG$.v$pnl,{layout:"fit",uid:null,parentnodepath:null,itemtype:null,parentuid:null,callback:null,objinfo:null,seq:0,bodyPadding:10,initComponent:function(){var e=this;$s.apply(this,{items:[{xtype:"gridpanel",name:"elemtree",store:{xtype:"store",fields:["name","ukey"]},selModel:Ext.create(Ext.selection.CheckboxModel,{checkSelector:".x-grid-cell"}),tbar:[{iconCls:"icon-toolbar-save",tooltip:"Save Content",handler:function(){this.storeContent.call(this,null)},scope:this},"-",{iconCls:"icon-toolbar-add",tooltip:"Add Node",hidden:!0,handler:function(){this.appendSelection.call(this)},scope:this},{iconCls:"icon-toolbar-remove",tooltip:"Delete Node",hidden:!0,handler:function(){this.removeSelection.call(this)},scope:this}],plugins:[{ptype:"cellediting",clicksToEdit:!1}],columns:[{xtype:"gridcolumn",text:IRm$.r1("B_NAME"),dataIndex:"name",flex:1,editor:{allowBlank:!1}},{xtype:"gridcolumn",text:IRm$.r1("L_UNIQUE_VALUE"),dataIndex:"ukey",width:80,editor:{allowBlank:!1}},{xtype:"actioncolumn",hidden:!0,width:80,items:[{iconCls:"icon-grid-config",tooltip:IRm$.r1("B_CONFIG_ITEM"),handler:function(t,i,n,o,l,s){e.updateValues(i,s,"edit")},scope:e},{iconCls:"icon-grid-delete",tooltip:IRm$.r1("B_DELETE_ITEM"),handler:function(t,i,n,o,l,s){e.updateValues(i,s,"delete")},scope:e}]}],listeners:{checkchange:function(e,t){e.set("chekced",t)}}}],storeContent:function(e){var t,i="<item uid='"+this.uid+"'>",n=this.down("[name=elemtree]").store.getRootNode();t=this.getElementContent(n,null),i+="<objinfo"+IG$.XUpdateInfo(this.objinfo,"cubeuid","s")+"/>",i+="<Elements lseq='"+this.seq+"'><![CDATA["+t+"]]></Elements>",i+="</item>";var o=new IG$._rpc$;o.init(this,{ack:"writecontent",payload:{uid:this.uid},mbody:i},this,this.rs_storeContent,null,e),o.send()},rs_storeContent:function(e,t){this.buildCube(t)},buildCube:function(e){var t=new IG$._rpc$;t.init(this,{ack:17,payload:{uid:this.uid,cubeuid:this.objinfo.cubeuid,action:"UpdateMetric"},mbody:{}},this,this.rs_buildCube,null,e),t.send()},rs_buildCube:function(e,t){t?t.close():IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},getElementContent:function(e,t){var i,n,o="";for(i=0;i<e.childNodes.length;i++)o+=(n=e.childNodes[i]).get("seq")+","+(t?t.get("seq"):"")+","+n.get("name")+"|",n.childNodes&&n.childNodes.length>0&&(o+=this.getElementContent(n,n));return o},refreshContent:function(){var e=new IG$._rpc$;e.init(this,{ack:"content",payload:{uid:this.uid},mbody:{option:"diagnostics"}},this,this.rs_refreshContent,null),e.send()},rs_refreshContent:function(e){IG$.XGetNode(e,"/smsg/item");var t=IG$.XGetNode(e,"/smsg/item/objinfo");t&&(this.objinfo=IG$.XGetAttrProp(t)),this.objinfo&&this.objinfo.sequence&&this.updateTreeNode([])},appendElementTree:function(e,t){for(var i=0;i<e.length;i++){var n=IG$.XGetAttr(e[i],"id"),o=IG$.XGetAttr(e[i],"text"),l=this.mtree.appendNodeElement.call(this.mtree,t,n,o),s=IG$.XGetChildNodes(e[i]);s&&s.length>0&&this.appendElementTree(s,l)}},updateValues:function(e,t,i){this.down("[name=elemtree]").store;"delete"==i&&!0!==t.get("root")&&t.remove()},updateTreeNode:function(e){var t=this,i=(this.clItem,this.objinfo);t.setLoading(!0);var n=new IG$._rpc$;n.init(t,{ack:17,payload:{uid:t.uid,sequence:i.sequence,action:"55"},mbody:{option:"standard"}},t,t.rs_updateTreeNode,null),n.send()},rs_updateTreeNode:function(e){var t,i,n=IG$.XGetNode(e,"/smsg/item"),o=n?IG$.XGetChildNodes(n):null,l=[],s=this.down("[name=elemtree]");for(this.setLoading(!1),i=0;i<o.length;i++)(t=IG$.XGetAttrProp(o[i])).name=IG$.XGetTextVal(o[i]),l.push(t);s.store.loadData(l)},rebuildTree:function(e){var t,n=[],o={};for(i=0;i<e.length;i++)o[e[i].seq]=e[i],null!=e[i].pnode&&o[e[i].pnode]?((t=o[e[i].pnode]).leaf=!1,delete t.checked,e[i].leaf=!0,e[i].checked=!1,t.children=t.children||[],t.children.push(e[i])):(e[i].leaf=!0,e[i].checked=!1,n.push(e[i]));return n},appendSelection:function(){var e,t,i,n,o,l,s,d=this.down("[name=elemtree]"),r=(d.store,d.getSelectionModel()),a=0;for(e=(i=r.selected.items.length>0?r.selected.items[0]:d.getRootNode()).get("valuedesc"),t=i.get("values"),i.set("valuedesc",""),i.set("values",""),i.set("leaf",!1),l="new item ",o=0;o<i.childNodes.length;o++)(s=i.childNodes[o].get("name")).substring(0,l.length)==l&&(s=s.substring(l.length),s=Number(s),0==isNaN(s)&&(a=Math.max(a,Number(s)+1)));a=Math.max(a,this.seq+1),this.seq=a,n={seq:a,name:l+=a,values:t||"",valuedesc:e||"",leaf:!0,checked:!1},i.appendChild(n),i.expand()},removeSelection:function(){var e=this.down("[name=elemtree]").store.getRootNode();this.removeSelectedRow(e)},removeSelectedRow:function(e){var t,i;for(t=e.childNodes.length-1;t>=0;t--)1==(i=e.childNodes[t]).get("checked")?e.removeChild(i):i.childNodes&&i.childNodes.length>0&&this.removeSelectedRow(i)},listeners:{afterrender:function(e){this.refreshContent()}}}),IG$.multimetric.superclass.initComponent.apply(this)}}),IG$.multiMeasureEditor=$s.extend($s.window,{modal:!0,layout:"fit",closable:!1,resizable:!1,width:500,height:400,initComponent:function(){var e=this;e.title=IRm$.r1("L_MC_ELEM_EDT"),e.edt=new IG$.multimetric({uid:e.uid}),$s.apply(this,{defaults:{bodyStyle:"padding:0px"},layout:"fit",items:[this.edt],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){var e=this.edt;e.storeContent.call(e,this)},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]}),IG$.multiMeasureEditor.superclass.initComponent.apply(this,arguments)}});
function CMolapMeasure(e){this.measuretype="COUNT",this.uid=null,this.name=null,this.nodepath=null,this.baseItem=null,this.parseMeasure=function(e){var t=IG$.XGetNode(e,"/smsg/item");if(this.name=IG$.XGetAttr(t,"name"),this.nodepath=IG$.XGetAttr(t,"nodepath"),this.uid=IG$.XGetAttr(t,"uid"),this.isDisinct=!0,(t=IG$.XGetNode(e,"/smsg/item/objinfo"))&&(this.measuretype=IG$.XGetAttr(t,"measuretype")),(t=IG$.XGetNode(e,"/smsg/item/BaseItem"))&&(this.baseItem={},this.baseItem.name=IG$.XGetAttr(t,"name"),this.baseItem.uid=IG$.XGetAttr(t,"uid"),this.baseItem.nodepath=IG$.XGetAttr(t,"nodepath"),this.baseItem.itemtype=IG$.XGetAttr(t,"type")),(t=IG$.XGetNode(e,"/smsg/item/Options"))&&1==t.hasChildNodes()){var s=IG$.XGetChildNodes(t);for(i=0;i<s.length;i++){var a=s[i],n=IG$.XGetTextVal(s[i]);switch(IG$.XGetAttr(a,"name")){case"isDistinct":this.isDisinct="F"!=n}}}},this.getMeasureXML=function(){var e=this,t={uid:e.uid,name:e.name,nodepath:e.nodepath,measuretype:e.measuretype},i=e.baseItem;switch(e.measuretype){case"COUNT":t.rel_items=[],t.rel_items.push({uid:i.uid,nodepath:i.nodepath,name:i.name,type:i.itemtype}),t.options=[],t.options.push({name:"isDisinct",value:e.isDisinct?"T":"F"})}return t},e&&this.parseMeasure(e)}IG$.multimeasure=function(e){$s.apply(this,e),IG$.multimeasure.superclass.constructor.call(this,{autoScroll:!0,collapseFirst:!1,closable:!0,items:[{html:"<div class='elementeditor'></div>"}]})},IG$.multimeasure=$s.extend(IG$.v$pnl,{modal:!0,region:"center",layout:"vbox",layoutConfig:{align:"stretch"},closable:!0,resizable:!1,width:400,height:500,uid:null,cubeuid:null,parentnodepath:null,itemtype:null,parentuid:null,measureObj:null,selectCombo:null,defaults:{autoHeight:!0,bodyStyle:"padding:10px"},pivotSelectionChangedHandler:function(e){this.measureObj.measuretype=e,this.resetMeasureUI()},metricSelectedHandler:function(e){this.measureObj.baseItem=e,this.baseItemField1.setValue(this.measureObj.baseItem.nodepath)},initComponent:function(){var e=this;e.title=IRm$.r1("L_MULTI_MEASURE"),this.baseItemField1=new Ext.form.TextField({name:"fmetric",allowBlank:!1}),this.stabcontainer=new Ext.Container({flex:3,layout:"card",items:[{layout:"fit",layoutConfig:{align:"stretch"},items:[{xtype:"fieldcontainer",fieldLabel:IRm$.r1("B_METRIC"),items:[this.baseItemField1,{xtype:"button",text:"..",handler:function(){var t=new IG$.metaSelectDlg({instance:me.instance,tree_options:{cubebrowse:!0,rootuid:e.cubeuid}});t.callback=new IG$.callBackObj(e,e.metricSelectedHandler),IG$.checkLogin(this,t)},scope:this}]}],hidden:!1},{html:"Sum of measure type",hidden:!0},{html:"Max of measure type",hidden:!0},{html:"Date of measure type",hidden:!0}]}),$s.apply(this,{items:[{flex:1,height:40,items:[{html:'<div class="pivotSelect">Measure type:</div>',border:!1,listeners:{afterlayout:function(e){e.addPivotSelectHandler.call(e)}},selectBoxAdded:!1,addPivotSelectHandler:function(){if(0==this.selectBoxAdded){var t=$(".pivotSelect",e.body.dom),i=$('<select name="pivotSelect"><option value="COUNT">Count Metric</option><option value="SUM">Sum data</option><option value="MAX">Max data</option><option value="DATE">Date Measure</option></select>');i.change((function(){e.pivotSelectionChangedHandler.call(e,this.value)})),i.appendTo(t),this.selectBoxAdded=!0,e.selectCombo=i}}}]},this.stabcontainer],tbar:[{iconCls:"icon-expand-all",tooltip:"Save Content",handler:function(){this.storeContent.call(this)},scope:this}],storeContent:function(){var e=this.measureObj.getMeasureXML(),t=new IG$._rpc$;t.init(this,{ack:"writecontent",payload:{uid:this.uid},mbody:e},this,this.rs_storeContent,null),t.send()},rs_storeContent:function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},refreshContent:function(){var e=new IG$._rpc$;e.init(this,{ack:"content",payload:{uid:this.uid},mbody:{}},this,this.rs_refreshContent,null),e.send()},rs_refreshContent:function(t){e.measureObj=new CMolapMeasure(t),e.resetMeasureUI.call(e)},resetMeasureUI:function(){this.selectCombo[0].value=this.measureObj.measuretype;var e=0;switch(this.measureObj.measuretype){case"COUNT":e=0,this.measureObj.baseItem&&this.baseItemField1.setValue(this.measureObj.baseItem.nodepath);break;case"SUM":e=1;break;case"MAX":e=2;break;case"DATE":e=3}var t=this.stabcontainer;for(i=0;i<t.items.items.length;i++)t.items.items[i].setVisible(i==e)}}),IG$.multimeasure.superclass.initComponent.apply(this,arguments)}});
IG$._udgeditor=$s.extend($s.window,{modal:!1,isWindow:!0,region:"center",layout:{type:"fit",align:"stretch"},closable:!1,resizable:!1,width:500,height:460,callback:null,_init:function(){var e=this,t=new IG$._rpc$;e.uid?(t.init(e,{ack:"content",payload:{uid:this.uid},mbody:{option:"diagnostics"}},e,e.rs_loadCnt,null),t.send()):e.parentuid&&(e.clItem={},e.rs_loadCnt())},rs_loadCnt:function(e){var t,l=this;e&&(l.clItem=e.content),(t=l.clItem).rel_items=t.rel_items||[],t.groupdata=t.groupdata||[],l.down("[name=itemname]").setValue(t.name||""),l.down("[name=description]").setValue(t.description||"");var n=l.down("[name=targetitem]"),i=(l.down("[name=udgtree]"),l.down("[name=usesum]")),a=l.down("[name=expandall]"),s=l.down("[name=othervalues]");n.setValue(t.rel_items.length?t.rel_items[0].name:""),i.setValue(t.usesum),a.setValue(t.expandall),s.setValue(t.othervalues),l._updateTreeNode(t.groupdata),l._getBO()},_getBO:function(){var e=this;IG$.getParentCube.call(e,e.uid,e.parentuid,new IG$.callBackObj(e,(function(t){e.rs_getBO(t)})))},rs_getBO:function(e){var t=e&&e.length?e[0]:null;t&&(this.cubeuid=t.uid)},_confirm:function(){var e=this,t=e.clItem,l=e.down("[name=udgtree]"),n=e.down("[name=usesum]"),i=e.down("[name=expandall]"),a=l.store.getRootNode();IG$.checkFields(e,["itemname"])&&(t.meta_type="udg_dimension",t.name=e.down("[name=itemname]").getValue(),t.description=e.down("[name=description]").getValue(),t.groupdata=[],t.usesum=n.getValue(),t.expandall=i.getValue(),t.othervalues=e.down("[name=othervalues]").getValue(),e._updateStoreTree(a,t.groupdata),e._save(e.uid,t))},_save:function(e,t){var l=this,n=new IG$._rpc$;n.init(l,{ack:"writecontent",payload:{uid:l.uid,pid:l.parentuid,name:t.name,description:t.description,type:l.itemtype,nodepath:l.parentnodepath?l.parentnodepath+"/"+t.name:null},mbody:t,meta_type:"udg_dimension"},l,(function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success"),l.callback&&l.callback.execute(l.clItem),l.close()}),null),n.send()},_appendSel:function(){var e,t,l,n,i,a,s,o=this.down("[name=udgtree]"),d=(o.store,o.getSelectionModel()),r=0;for(e=(l=d.selected.items.length>0?d.selected.items[0]:o.getRootNode()).get("valuedesc"),t=l.get("values"),l.set("valuedesc",""),l.set("values",null),l.set("leaf",!1),a="new item ",i=0;i<l.childNodes.length;i++)(s=l.childNodes[i].get("name")).substring(0,a.length)==a&&(s=s.substring(a.length),s=Number(s),0==isNaN(s)&&(r=Math.max(r,Number(s)+1)));n={name:a+=r,values:t||null,valuedesc:e||"",leaf:!0,checked:!1},l.appendChild(n),l.expand()},_removeSel:function(){var e=this.down("[name=udgtree]").store.getRootNode();this._removeSelRow(e)},_updateTreeNode:function(e){this.clItem;var t=this.down("[name=udgtree]"),l={name:"User defined group",expanded:!0,leaf:!1,children:[]};this._buildNode(l.children,e||[]),t.store.setRootNode(l),t.store.getRootNode().expand()},_buildNode:function(e,t){var l,n,i,a,s;for(l=0;l<t.length;l++){if(a={ftype:(i=t[l]).ftype,udgtype:i.udgtype,name:i.name,values:i.values},s="",(!i.children||i.children&&0==i.children.length)&&i.values&&i.values.length)for(n=0;n<i.values.length;n++)"formula"==i.values[n].udgtype?s=i.values[n].code:s+=(s?",":"")+(i.values[n].value||i.values[n].code||"");a.valuedesc=s,i.children&&i.children.length&&(a.children=[],this._buildNode(a.children,i.children)),e.push(a)}},_updateStoreTree:function(e,t){var l,n,i;for(l=0;l<e.childNodes.length;l++)i={name:(n=e.childNodes[l]).get("name"),ftype:n.childNodes&&n.childNodes.length?"group":"condition",operator:"IN",valuetype:n.get("valuetype"),values:n.get("values")},t.push(i),n.childNodes&&n.childNodes.length>0&&(i.children=[],this._updateStoreTree(n,i.children))},_removeSelRow:function(e){var t,l,n,i,a;for(t=e.childNodes.length-1;t>=0;t--)1==(l=e.childNodes[t]).get("checked")?e.removeChild(l):l.childNodes&&l.childNodes.length>0&&this._removeSelRow(l);if(0==e.isRoot()&&0==e.hasChildNodes()){for(n=e.parentNode,i=e.get("name"),a=0,t=0;t<n.childNodes.length;t++)if(n.childNodes[t]==e){a=t;break}n.insertChild(a,{name:i,values:null,valuedesc:"",leaf:!0,checked:!1}),n.removeChild(e,!1,!1,!1)}},_selItem:function(e){var t=new IG$.metaSelectDlg({instance:this.instance,multiselect:"customfield"==e?1:0,visibleItems:"codemap"==e?"folder;codemap":"userdb;dataset;table;inlineview;metric;custommetric",tree_options:{cubebrowse:!0,rootuid:this.cubeuid},callback:new IG$.callBackObj(this,(function(t){this.clItem.rel_items=[t],this.down("[name="+e+"]").setValue(t.name)}),e)});IG$.checkLogin(this,t)},_updateValues:function(e,t){var l=this;l.down("[name=udgtree]").store;if(l.clItem&&l.clItem.rel_items.length){if(0==t.isRoot()){var n=l.clItem.rel_items[0];new IG$.udgValSel({field:n,rec:t,callback:new IG$.callBackObj(l,l.rs_editFilter,[t])}).show()}}else IG$.ShowError(IRm$.r1("E_SEL_TGT"),l)},_loadExternal:function(){this.clItem&&this.clItem.fields||IG$.ShowError(IRm$.r1("E_SEL_TGT"),this)},rs_editFilter:function(e,t){var l,n,i=t[0],a="",s=e.selection,o=e.selmode,d=e.syntax,r=[];if(2==o)i.set("udgtype","formula"),r.push({code:d}),a=d;else for(i.set("udgtype","normal"),n=0;n<s.length;n++)l=s[n].code||s[n].text,r.push({code:s[n].code,value:s[n].text}),a+=0==n?l:","+l;i.set("values",r),i.set("valuedesc",a)},initComponent:function(){this.title=IRm$.r1("T_UDG"),$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},autoScroll:!0,padding:10,items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME")},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC"),height:50}]},{xtype:"fieldset",title:IRm$.r1("L_TARGET_OPTIONS"),items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"targetitem",emptyText:IRm$.r1("M_SEL_ITEM"),fieldLabel:IRm$.r1("L_TARGET_ITEM")},{xtype:"button",iconCls:"icon-toolbar-search",tooltip:IRm$.r1("B_SEARCH"),handler:function(){this._selItem("targetitem")},scope:this}]},{xtype:"button",text:IRm$.r1("L_IMP_FROM_EXCEL"),hidden:!0,handler:function(){this._loadExternal()},scope:this},{xtype:"checkbox",fieldLabel:IRm$.r1("L_USE_SUM_ON_FOLDER"),name:"usesum",boxLabel:IRm$.r1("B_ENABLE")},{xtype:"checkbox",fieldLabel:IRm$.r1("L_EXPAND_ALL"),name:"expandall",boxLabel:IRm$.r1("B_ENABLE")},{xtype:"textfield",fieldLabel:IRm$.r1("L_OTHER_VALUES"),name:"othervalues"}]},{xtype:"treepanel",name:"udgtree",store:{xtype:"treestore",fields:["gname","values","valuedesc","ctype","syntax"],folderSort:!1},hideHeaders:!0,rootVisible:!0,useArrows:!0,multiSelect:!0,singleExpand:!1,height:400,selModel:"SINGLE",tbar:[{xtype:"button",text:IRm$.r1("B_ADD"),handler:function(){this._appendSel.call(this)},scope:this},{xtype:"button",text:IRm$.r1("B_REMOVE"),handler:function(){this._removeSel.call(this)},scope:this}],plugins:[{ptype:"cellediting",clicksToEdit:!1}],columns:[{xtype:"treecolumn",text:IRm$.r1("L_GROUP_NAME"),dataIndex:"name",flex:1,editor:{allowBlank:!1}},{text:IRm$.r1("L_VALUES"),flex:1,dataIndex:"valuedesc"},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-config",tooltip:IRm$.r1("B_CONFIG_ITEM"),handler:function(e,t,l,n,i,a){this._updateValues(t,a)},scope:this}]}],listeners:{checkchange:function(e,t){e.set("chekced",t)},celldblclick:function(e,t,l,n,i,a,s,o){if(0==n.isRoot()&&1==n.hasChildNodes()){var d=new IG$.udgGroupName({instance:this.instance,gname:n.get("name"),callback:new IG$.callBackObj(this,(function(e){n.set("name",e)}))});return IG$.showDlg(this,d),!1}},scope:this}}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){var t=this;setTimeout((function(){t._init.call(t)}),100)}}}),IG$._udgeditor.superclass.initComponent.apply(this,arguments)}}),IG$.udgGroupName=$s.extend($s.window,{isWindow:!0,region:"center",layout:{type:"fit",align:"stretch"},closable:!1,resizable:!1,width:230,autoHeight:!0,modal:!0,callback:null,_confirm:function(){var e=this.down("[name=gname]").getValue();e&&(this.callback&&this.callback.execute(e),this.close())},initComponent:function(){this.title=IRm$.r1("T_UDG"),$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("L_GROUP_NAME"),allowBlank:!1,name:"gname"},{xtype:"displayfield",value:"Set group name for this subject"}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.down("[name=gname]").setValue(this.gname||"")},scope:this}}),IG$.udgGroupName.superclass.initComponent.apply(this,arguments)}}),IG$.udgValSel=$s.extend($s.window,{modal:!0,region:"center",layout:"card",closable:!1,resizable:!1,width:500,height:400,field:null,callback:null,selmode:0,_confirm:function(){var e,t=this,l=[];if(0==t.selmode){if((n=this.down("[name=_2]").store.data.items)&&n.length>0)for(e=0;e<n.length;e++)l.push(n[e].data)}else if(1==t.selmode){var n,i=t.down("[name=txtselvalues]").getValue();if(i)for(n=i.split(";"),e=0;e<n.length;e++)n[e]&&l.push({code:n[e],text:n[e]})}else t.selmode;this.callback&&this.callback.execute({selmode:t.selmode,syntax:t.down("[name=_s1]").getValue(),selection:l}),t.close()},_init:function(){var e=this.rec,t=0,l=this.down("[name=_s1]");e&&"formula"==e.get("udgtype")&&(t=2,l.setValue(e.get("syntax"))),this._viewmode(t)},_viewmode:function(e){var t=this.down("[name=_mpanel]").getLayout();this.selmode=e,t.setActiveItem(this.selmode)},initComponent:function(){var e=new IG$.d$ValSel({sheetoption:this.sheetoption,prompt:this.prompt,field:this.field});this.title=IRm$.r1("T_VALUE_SELECT"),$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"panel",layout:"card",name:"_mpanel",tbar:[{text:IRm$.r1("B_COMBO_VAL"),handler:function(){this._viewmode(0)},scope:this},{text:IRm$.r1("B_CUST_VAL"),handler:function(){this._viewmode(1)},scope:this},{text:IRm$.r1("B_FORMULA"),handler:function(){this._viewmode(2)},scope:this}],items:[e,{xtype:"form",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:IRm$.r1("L_CVAL_DESC")},{xtype:"textarea",fieldLabel:IRm$.r1("B_VALUES"),name:"txtselvalues",flex:1}]},{xtype:"panel",layout:{type:"vbox",align:"stretch"},items:[{xtype:"textarea",flex:1,name:"_s1"}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}]}),IG$.udgValSel.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(e){e._init.call(e)}}});