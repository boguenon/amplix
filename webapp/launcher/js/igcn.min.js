IG$.$expr=$s.extend($s.window,{modal:!0,layout:"fit",closable:!1,resizable:!1,width:500,autoHeight:!0,init_view:function(){var e,t;for(e=0;e<10;e++)(t=this.down("[name=op"+(e+1)+"]"))&&t.addEventListener("click",function(){})},commit_f:function(){var e=this;e.validate_expression()&&(e.callback&&e.callback.execute(),e.close())},validate_expression:function(){return 0},initComponent:function(){$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},items:[{xtype:"tabpanel",flex:1,items:[{xtype:"treepanel",title:"Fields",store:{fields:["name","value"]}},{xtype:"treepanel",title:"Functions",store:{fields:["name","value"]}}]},{xtype:"textarea",name:"expression",flex:1,tbar:[{text:"+",name:"op1"},{text:"-",name:"op2"},{text:"*",name:"op3"},{text:"/",name:"op4"},{text:"%",name:"op5"},{text:"()",name:"op6"},{text:"//(comment)",name:"op7"},{xtype:"combobox",width:50,store:{fields:["name","value"]}}]}]}],buttons:[{text:"Validate",handler:function(){this.validate_expression()},scope:this},{text:IRm$.r1("B_CONFIRM"),handler:function(){this.commit_f()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.init_view()},scope:this}}),IG$.$expr.superclass.initComponent.call(this)}});
IG$.datemetric=$s.extend($s.window,{modal:!1,isWindow:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:580,autoHeight:!0,callback:null,init_f:function(){var e,t=this,a=t.down("[name=datediv]");for(t.setTitle(IRm$.r1("T_DM")+(t.name?" ("+t.name+")":"")),IG$.datemetric._datetypes||(IG$.datemetric._datetypes=[{label:IRm$.r1("B_YEAR"),name:"YYYY"},{label:IRm$.r1("B_QUARTER"),name:"QUARTER"},{label:IRm$.r1("B_MONTH"),name:"MM"},{label:IRm$.r1("B_DAY"),name:"DD"},{label:IRm$.r1("B_WEEKMONTH"),name:"WM"},{label:IRm$.r1("B_WEEK"),name:"WEEK"},{label:IRm$.r1("B_AMPM"),name:"AMPM"},{label:IRm$.r1("B_HOUR"),name:"HH"},{label:IRm$.r1("B_MINUTE"),name:"MI"}]),t.datetypes=[],e=0;e<IG$.datemetric._datetypes.length;e++)t.datetypes.push({name:IG$.datemetric._datetypes[e].name,label:IG$.datemetric._datetypes[e].label});a.store.loadData(t.datetypes),t.uid?t.procLoadContent():t.rs_procLoadContent({content:{meta_type:"date_dimension"}})},procLoadContent:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"content",payload:{uid:this.uid},mbody:{option:"diagnostics"}},e,e.rs_procLoadContent,null),t.send()},rs_procLoadContent:function(e){var t,a,n=this;n.down("[name=itemname]").setValue(e.name),n.down("[name=description]").setValue(e.description),a=(t=n.mobj=e.content).rel_items,n.down("[name=rg_dateformatting]").setValue({dateformatting:t.issql?"sqlfunc":"formatting"}),n.down("[name=dateformat]").setValue(t.dateformat||""),n.down("[name=fieldname]").setValue(a&&a.length?a[0].name:""),t.cubeuid?n.uid&&n.loadSubCnt():n.getCubeInfo()},getCubeInfo:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"helpcontent",payload:{uid:e.uid||e.parentuid,parenttype:"Bobject",read:"F"},mbody:{option:"parentcontent"}},e,e.rs_getCubeInfo,null),t.send()},rs_getCubeInfo:function(e){var t=this,a=e&&e.length?e[0]:null;t.mobj.cubeuid=a.uid,t.uid&&t.loadSubCnt()},loadSubCnt:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"content",payload:{uid:this.uid},mbody:{subfolder:"T",itemtype:"CustomMetric",readcontent:"T"}},e,e.rs_loadSubCnt,null),t.send()},rs_loadSubCnt:function(e){var t,a,n,i,o=this,d=e.children||[],s=(o.mobj,o.down("[name=datediv]")),l=s.getSelectionModel(),m={};for(l.clear(),t=0;t<d.length;t++)d[t],(a=d[t].content)&&"CUSTOM"==(m[a.datedivision]=a).datedivision&&o.down("[name=customdatetype]").setValue(a.customdatetype);for(o.custominfo=m,t=0;t<s.store.data.items.length;t++)(i=m[(n=s.store.data.items[t]).get("name")])&&(l.select(n,!0),n.set("itemname",i.name),n.set("syntax",i.expression))},layoutFormItems:function(){var e,t,a=this,n="sqlfunc"==a.down("[name=dateformatting]").getGroupValue(),i=a.down("[name=ex_format1]"),o=a.down("[name=ex_format2]");for(e=0;e<i.menu.items.length;e++)(t=i.menu.items.items[e]).setVisible(!t.issql||1==t.issql&&1==n);for(e=0;e<o.menu.items.length;e++)(t=o.menu.items.items[e]).setVisible(!t.issql||1==t.issql&&1==n)},closedlg:function(){this.close(),this.callback&&this.callback.execute()},_confirm:function(){var e=this,t=e.down("[name=fieldname]");if(t.clearInvalid(),e.mobj)if(t.getValue()){if(IG$.checkFields(e,["itemname"])){e.mobj.name=e.down("[name=itemname]").getValue(),e.mobj.description=e.down("[name=description]").getValue();var a=e.down("[name=dateformat]"),n=e.down("[name=dateformatting]"),i=(a=e.down("[name=dateformat]"),"sqlfunc"==n.getGroupValue()),o=e.mobj;if(o.issql=i,o.dateformat=a.getValue(),o.database_type="auto",a.clearInvalid(),i||o.dateformat){var d=new IG$._rpc$;e.setLoading(!0),d.init(e,{ack:"writecontent",payload:{uid:e.uid,pid:e.parentuid,name:o.name,description:o.description,type:e.itemtype||o.type,nodepath:e.parentnodepath?e.parentnodepath+"/"+o.name:null},mbody:o,meta_type:"date_dimension"},e,e.rs_writeCnt),d.send()}else a.markInvalid(IRm$.r1("B_REQ"))}}else t.markInvalid(IRm$.r1("B_REQ"))},rs_writeCnt:function(e){var t,a,n,i,o=this,d=IG$.majorDateformat,s=(o.down("[name=dateformat]"),o.down("[name=datediv]")),l={},m=[],r=[],u=0,c=o.mobj,p=o.custominfo,f="sqlfunc"==o.down("[name=dateformatting]").getGroupValue();for(o.uid||(o.uid=e.uid),p=o.custominfo=o.custominfo||{},n=0;n<d.length;n++)d[n].rname=d[n].rname||d[n].name,d[n].dname=IRm$.r1("B_"+d[n].rname);for(n=0;n<s.store.data.items.length;n++)l[s.store.data.items[n].get("name")]=s.store.data.items[n];for(n=0;n<d.length;n++)t=d[n].name,a=d[n].dname||t,cdatetype="",l[t]&&l[t].get("checked")?(i=p[t],a=l[t].get("itemname")||i&&i.name||a,"CUSTOM"==t&&(cdatetype=o.down("[name=customdatetype]").getValue()),m.push({uid:i&&i.uid?i.uid:c.nodepath+"/"+a,pid:o.uid,name:a,type:"CustomMetric",meta_type:"custom_dimension"}),i={uid:i&&i.uid?i.uid:c.nodepath+"/"+a,pid:o.uid,name:a,type:"CustomMetric",meta_type:"custom_dimension",rel_items:[]},r.push(i),c.rel_items&&c.rel_items.length?i.rel_items.push({uid:c.rel_items[0].uid,name:c.rel_items[0].name,nodepath:c.rel_items[0].nodepath||"",type:"Metric"}):i.rel_items.push({uid:c.uid,name:c.name,nodepath:c.nodepath,type:c.type}),$s.defaults(i,{datedivision:t.toUpperCase(),dateformat:c.dateformat,predefinetype:1==f?"DATE":"",custom_type:1==f?"CUSTOM_FIELD":"PREDEFINED_FIELD",customdatetype:cdatetype,meta_type:"custom_dimension"}),l[t].set("itemname",i.name),f&&(i.expression=l[t].get("syntax")||o.getCustExpr(t),l[t].set("syntax",i.expression)),u++):p[t]&&(i=p[t],m.push({uid:i.uid,name:i.name,nodepath:i.nodepath,option:"delete"}),r.push({}),u++);if(0<u){var y=new IG$._rpc$;y.init(o,{ack:"batchcontent",payload:m,mbody:{items:r}},o,o.rs_updateDateCnt),y.send()}else o.setLoading(!1),o.close()},rs_updateDateCnt:function(e){this.setLoading(!1),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success"),this.close()},getCustExpr:function(e){var t="",a=e.toLowerCase(),n=IG$.sqlDateFormat,i=this.down("[name=dateformat]").getValue(),o="";return n&&n[a]&&(t=n[a],o="["+this.mobj.rel_items[0].name+"]","EPOCH"==i&&(o="FROM_UNIXTIME("+o+")"),t=t.replace(/_date_/g,o)),t},selectField:function(){var e=this.mobj,t=new IG$.metaSelectDlg({visibleItems:"folder;metric;table;custommetric;measuregroupdimension",tree_options:{cubebrowse:!0,rootuid:e.cubeuid},callback:new IG$.callBackObj(this,this.cubeSelectedHandler)});IG$.checkLogin(this,t)},cubeSelectedHandler:function(e){this.mobj.rel_items=[{uid:e.uid,name:e.name}],this.down("[name=fieldname]").setValue(e.name)},initComponent:function(){var e=this;e.title=IRm$.r1("T_DM"),$s.apply(this,{items:[{xtype:"panel",bodyStyle:"padding:10px",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME"),required:!0},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC")}]},{xtype:"fieldset",title:"Date Type",layout:{type:"vbox",align:"stretch"},items:[{xtype:"radiogroup",name:"rg_dateformatting",fieldLabel:"",vertical:!0,items:[{boxLabel:"Date Formatting",name:"dateformatting",inputValue:"formatting"},{boxLabel:"SQL Functions",name:"dateformatting",inputValue:"sqlfunc"}],listeners:{change:function(){this.layoutFormItems()},scope:this}}]},{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},title:"Input Format",items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:"Date Metric",items:[{xtype:"textfield",name:"fieldname",flex:1,readOnly:!0},{xtype:"button",name:"btn_search",text:"..",handler:function(){this.selectField()},scope:this}]},{xtype:"fieldcontainer",fieldLabel:"Date format",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"dateformat",flex:1},{xtype:"button",text:"Example",name:"ex_format1",menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"DATE",value:"DATE",issql:!0,hidden:!0,handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"DATETIME",value:"DATETIME",issql:!0,hidden:!0,handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"TIMESTAMP",value:"TIMESTAMP",issql:!0,hidden:!0,handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"EPOCH time value",value:"EPOCH",issql:!0,hidden:!0,handler:function(){e.down("[name=dateformat]").setValue(this.value)}}]}}]},{xtype:"container",fieldLabel:IRm$.r1("L_GROUP_LEVEL"),name:"datedivision",layout:{type:"vbox",align:"stretch"},defaults:{border:0},border:0,items:[{xtype:"gridpanel",name:"datediv",store:{fields:["name","label"]},selType:"checkboxmodel",selModel:{mode:"MULTI"},plugins:[{ptype:"cellediting",clicksToEdit:!1}],height:230,columns:[{text:"Name",dataIndex:"label",tdCls:"igc-td-link",flex:1},{text:"Item Name",dataIndex:"itemname",editor:{allowBlank:!1},flex:1},{text:"Syntax",dataIndex:"syntax",editor:{allowBlank:!1},flex:1}],listeners:{cellclick:function(e,t,a,n,t,i,o){if(1==a){var d,s=this.custominfo;if(s&&s[n.get("name")]&&(d=s[n.get("name")]).uid){var l=IG$.mainPanel,m=d.type.toLowerCase();l&&d.writable&&l.navigateApp.call(l,d.uid,m,d.name,d.nodepath,!0,d.writable)}}},scope:this}}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("B_CUSTOM"),name:"customdatetypecontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"customdatetype"},{xtype:"button",text:"Example",name:"ex_format2",menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){e.down("[name=customdatetype]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){e.down("[name=customdatetype]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){e.down("[name=customdatetype]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){e.down("[name=customdatetype]").setValue(this.value)}}]}}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.init_f()},scope:this}}),IG$.datemetric.superclass.initComponent.apply(this,arguments)}});
IG$.customMetricInner=$s.extend($s.formpanel,{bodyBorder:!1,layout:"fit",loadedItem:{},changeDateFormat:function(){var e=this.down("[name=optdateformat]"),t=this.down("[name=dateformat]"),a=e.getValue();t.setValue(a)},init_f:function(){var o=this,e=o.dmode,t=new IG$._rpc$,a=o.down("[name=optdateformat]"),n=o.down("[name=custom_type]");a.on("change",function(e,t,a,n){o.changeDateFormat.call(o)}),n.setValue("CUSTOM_FIELD"),n.on("change",function(e,t,a){var n,l=o.down("[name=custom_type]").getValue(),i=1;if(l){switch(l){case"CUSTOM_FIELD":i=1;break;case"GROUP_FIELD":i=2;break;case"PREDEFINED_FIELD":i=3,o.updateDateFormat();break;case"GEO_FIELD":i=4;break;case"RANGE_FIELD":i=5;break;case"LINK_FIELD":i=6}for(n=1;n<7;n++)o.down("[name=pconfig"+n+"]")[n==i?"show":"hide"]()}}),e?(o.dmode_cnt.meta_type="custom_dimension",o.rs_procLoadContent({content:o.dmode_cnt})):o.uid?(t.init(o,{ack:"content",payload:{uid:o.uid},mbody:{option:"diagnostics"}},o,o.rs_procLoadContent,null),t.send()):o.parentuid&&(t.init(o,{ack:"helpcontent",payload:{uid:o.parentuid},mbody:{option:"cube_style_info"}},o,function(e){o.rs_procLoadContent({content:{cubeinfo:e,meta_type:"custom_dimension"}})},null),t.send())},rs_procLoadContent:function(e){var t=this,i=[],a=e.content,n=a.cubeinfo,l=t.down("[name=optstyle]");n=n||(a.cubeinfo={app_style:{default_styles:[],custom_styles:[]}}),t.clItem=a,t.down("[name=itemname]").setValue(a.name),t.down("[name=description]").setValue(a.description),t.down("[name=optremoveblank]").setValue(a.removeblank),t.down("[name=isdatetype]").setValue(a.isdatetype),t.down("[name=dateformat]").setValue(a.dateformat),t.down("[name=t_dateformat]").setValue(a.datecustom),a.rel_items=a.rel_items||[],a.grouping=a.grouping||{},a.link_option=a.link_option||{},$s.defaults(a.grouping,{groupmin:0,groupmax:0,stepinterval:10,groupminlabel:"Under %MIN",groupmaxlabel:"Over %MAX",grouplabel:"%MIN - %MAX",groupformat:"#,###"}),$s.defaults(a.link_option,{l_tp:"DRILL",l_nm:null,l_elnk:null,l_elnk_tgt:null,l_rpt_name:null,l_rpt_uid:null,l_rpt_tmpl:null}),i.push({disp:"--- select ---",name:"",type:""}),t.styles=i,n=a.cubeinfo,delete a.cubeinfo,$.each([{arr:n.app_style.default_styles,n:"appbase"},{arr:n.app_style.custom_styles,n:"appcustom"},{arr:n.cube_style?n.cube_style.custom_styles:null,n:"cubecustom"}],function(e,t){var a,n,l=t.arr;if(l)for(a=0;a<l.length;a++)n=l[a],i.push({disp:n.name,name:n.name,type:t.n})}),l.store.loadData(i),l.setValue(a.itemstyle||""),t.getParentCube(),a.link_option.l_rpt_uid&&t.loadTemplate(a.link_option.l_rpt_uid)},loadTemplate:function(e){var t=this,o=t.clItem,a=new IG$._rpc$;a.init(t,{ack:"content",payload:{uid:e},mbody:{option:"diagnostics"}},t,function(e){var t,a,n=e.exportOption.otmpl,l=this.down("[name=l_rpt_tmpl]"),i=[{disp:"Select Item",seq:""}];if(n)for(t=0;t<n.length;t++)(a=n[t]).disp=a.name+(a.description?"-"+a.description+" ":" ")+(a.export_type?"("+a.export_type+")":""),a.seq=""+t,i.push(a);l.store.loadData(i),l.setValue(o&&o.link_option&&o.link_option.l_rpt_tmpl||"")},null),a.send()},updateDateFormat:function(){var e=this,t=e.clItem?e.clItem.fields:null,a=e.down("[name=custom_type]").getValue(),n=new IG$._rpc$;t&&0<t.length&&a&&"PREDEFINED_FIELD"==a&&(e.loadedItem&&e.loadedItem[t[0].uid]?e.applyDateFormat(e.loadedItem[t[0].uid]):(n.init(e,{ack:"content",payload:{uid:t[0].uid,type:t[0].type,nodepath:t[0].nodepath},mbody:{}},e,e.rs_updateDateFormat,null),n.send()))},rs_updateDateFormat:function(e){var t,a,n=IG$.XGetNode(e,"/smsg/item"),l=IG$.XGetNode(e,"/smsg/item/objinfo");l&&(a=IG$.XGetAttr(n,"uid"),t=IG$.XGetAttr(l,"dateformat"),this.loadedItem[a]={uid:a,dateformat:t},this.applyDateFormat(this.loadedItem[a]))},applyDateFormat:function(e){var t=this.down("[name=dateformat]"),a=t.getValue();""==e.dateformat||""!=a&&a==e.dateformat||t.setValue(e.dateformat)},getParentCube:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"helpcontent",payload:{uid:e.uid||e.parentuid,parenttype:"Bobject",read:"F"},mbody:{option:"parentcontent"}},e,e.rs_getParentcube,null),t.send()},rs_getParentcube:function(e){var t,a=this,n=e&&e.length?e[0]:null,l=a.clItem;n&&(a.cubeuid=n.uid),l.custom_type&&a.down("[name=custom_type]").setValue(l.custom_type),IG$.setFieldValue(a,"expression","s",l.expression||""),IG$.setFieldValue(a,"datagrid","dg",l.rel_items),IG$.setFieldValue(a,"groupfielditem","s",0<l.rel_items.length?l.rel_items[0].name:""),IG$.setFieldValue(a,"predefinefield","s",0<l.rel_items.length?l.rel_items[0].name:""),IG$.setFieldValue(a,"rangefield","s",0<l.rel_items.length?l.rel_items[0].name:"");var i,o=a.down("[name=dateformat]"),d=a.down("[name=optdateformat]"),r=a.down("[name=datedivision]"),m=a.down("[name=customdatetype]"),s=a.down("[name=othergroupvalue]"),u=a.down("[name=groupdatagrid]"),p=[];if(l.groupfilter&&l.groupfilter.children){for(t=0;t<l.groupfilter.children.length;t++)i=l.groupfilter.children[t],p.push({name:i.name,values:i.values,operator:i.operator});u.store.loadData(p)}d.setValue(l.dateformat||""),o.setValue(l.dateformat||""),r.setValue({datediv:l.datedivision}),m.setValue(l.customdatetype||""),s.setValue(l.othergroupvalue),a.down("[name=geolat]").setValue(l.geolat?l.geolat.name:""),a.down("[name=geolng]").setValue(l.geolng?l.geolng.name:""),a.down("[name=cmap_disp]").setValue(l.cmap_disp||""),a.f_="groupmin;groupmax;stepinterval;groupminlabel;groupmaxlabel;grouplabel;groupformat".split(";"),$.each(a.f_,function(e,t){a.down("[name="+t+"]").setValue(l.grouping[t])}),l.link_option&&$.each(["l_tp","l_nm","l_rpt_tmpl","l_elnk","l_elnk_tgt","l_rpt_name","l_rpt_uid"],function(e,t){a.down("[name="+t+"]").setValue(l.link_option[t])})},_confirm:function(){var e,t,a,n,l,i=this,o=i.clItem,d=i.down("[name=groupdatagrid]"),r=i.down("[name=datagrid]"),m=d.store;if(IG$.checkFields(i,["itemname"])){for(o.name=i.down("[name=itemname]").getValue(),o.description=i.down("[name=description]").getValue(),o.expression=i.down("[name=expression]").getValue(),o.custom_type=i.down("[name=custom_type]").getValue(),o.dateformat=i.down("[name=dateformat]").getValue(),o.datedivision=i.down("[name=datedivision]").getValue().datediv,o.othergroupvalue=i.down("[name=othergroupvalue]").getValue(),o.customdatetype=i.down("[name=customdatetype]").getValue(),o.itemstyle=i.down("[name=optstyle]").getValue(),o.removeblank=i.down("[name=optremoveblank]").getValue(),o.isdatetype=i.down("[name=isdatetype]").getValue(),o.dateformat=i.down("[name=dateformat]").getValue(),o.datecustom=i.down("[name=t_dateformat]").getValue(),o.groupfilter={ftype:"group",children:[]},e=0;e<m.data.items.length;e++)(a={ftype:"condition",name:(t=m.data.items[e]).get("name"),values:[]}).operator=t.get("operator"),a.values=t.data.values,o.groupfilter.children.push(a);if("CUSTOM_FIELD"==o.custom_type)for(o.rel_items=[],e=0;e<r.store.data.items.length;e++)l={uid:(n=r.store.data.items[e].data).uid,name:n.name,nodepath:n.nodepath,memo:n.memo,type:n.type},o.rel_items.push(l);$.each(i.f_,function(e,t){var a=i.down("[name="+t+"]");o.grouping[t]=a.getValue()}),i.clItem.link_option=i.clItem.link_option||{},$.each(["l_tp","l_nm","l_rpt_tmpl","l_elnk","l_elnk_tgt","l_rpt_name","l_rpt_uid"],function(e,t){var a=i.down("[name="+t+"]");o.link_option[t]=a.getValue()}),i.dmode||i.saveContent(i.uid,o)}},saveContent:function(e,t){var a=this,n=new IG$._rpc$;n.init(a,{ack:"writecontent",payload:{uid:a.uid,pid:a.parentuid,name:t.name,description:t.description,type:a.itemtype,nodepath:a.parentnodepath?a.parentnodepath+"/"+t.name:null},mbody:t,meta_type:"custom_dimension"},a,a.rs_saveContent,null),n.send()},rs_saveContent:function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success"),this.wd.closedlg.call(this.wd)},selectItem:function(e){var t=new IG$.metaSelectDlg({multiselect:"customfield"==e?1:0,visibleItems:"codemap"==e?"folder;codemap":"userdb;table;metric;custommetric",tree_options:{cubebrowse:!0,rootuid:"codemap"==e?"/SYS_Lookup":this.cubeuid},callback:new IG$.callBackObj(this,this.cubeSelectedHandler,e)});IG$.checkLogin(this,t)},selectReport:function(t){var e=new IG$.metaSelectDlg({multiselect:0,visibleItems:"folder;report",tree_options:{rootuid:null},callback:new IG$.callBackObj(this,function(e){"l_rpt"==t&&(this.down("[name=l_rpt_uid]").setValue(e.uid),this.down("[name=l_rpt_name]").setValue(e.name),this.loadTemplate(e.uid))})});IG$.checkLogin(this,e)},cubeSelectedHandler:function(e,t){var a=this,n="customfield"==t?null:e,l=a.clItem;if("geolat"==t||"geolng"==t)"geolat"==t?(l.geolat={uid:n.uid,name:n.name},a.down("[name=geolat]").setValue(n.name)):"geolng"==t&&(l.geolng={uid:n.uid,name:n.name},a.down("[name=geolng]").setValue(n.name));else if("customfield"==t){var i=a.down("[name=datagrid]");$.each(e,function(e,t){var a,n=!1;for(a=0;a<i.store.data.items.length;a++)if(i.store.data.items[a].get("uid")==t.uid){n=!0;break}0==n&&i.store.add(t)})}else"codemap"==t?(l.cmap_uid=n.uid,l.cmap_disp=n.name,a.down("[name=cmap_disp]").setValue(n.name)):(l.rel_items=[n],IG$.setFieldValue(a,t,"s",n.name),a.updateDateFormat())},addBlankCondition:function(){this.down("[name=groupdatagrid]").store.add({})},editFilter:function(e,t){var a=this.clItem;if(0<a.rel_items.length){var n=a.rel_items[0];new IG$.valueSelectWindow({field:n,callback:new IG$.callBackObj(this,this.rs_editFilter,[e,t])}).show()}},rs_editFilter:function(e,t){var a,n=t[0],l=t[1],i="";for(n.values=e,a=0;a<e.length;a++)i+=0==a?e[a].text||e[a].code:", "+(e[a].text||e[a].code);l.set("value",i)},editorItemName:function(e){var t,a,n=this.down("[name=expression]"),l=n.inputEl.dom,i=n.getRawValue(),o=-1,d=-1;if(e="["+e+"]",0<i.length){var r=-1,m=-1;if(0==(t=$(l).getSelection()).length){for(a=t.start;0<=a;a--){if("["==i.charAt(a)){r=a;break}if("]"==i.charAt(a)||")"==i.charAt(a)||"("==i.charAt(a))break}if(-1<r)for(a=t.end;a<i.length;a++){if("]"==i.charAt(a)){m=a+1;break}if("["==i.charAt(a)||")"==i.charAt(a)||"("==i.charAt(a))break}}else-1<t.start-1&&t.end<i.length&&"["==i.charAt(t.start-1)&&"]"==i.charAt(t.end)&&(t.start-=1,t.end+=1);-1!=r&&-1!=m||(r=t.start,m=t.end),i=i.substring(0,r)+e+i.substring(m,i.length),d=(o=r)+e.length}else o=0,d=(i=e).length;n.setValue(i),-1<o&&o<d&&n.selectText(o,d)},initComponent:function(){var e=this;this.items=[{xtype:"panel",layout:"fit",padding:"5 5",items:[{xtype:"tabpanel",autoScroll:!0,items:[{xtype:"form",layout:{type:"vbox",align:"stretch"},title:IRm$.r1("B_GENERAL"),autoScroll:!0,bodyStyle:"padding: 5px",items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME"),required:!0},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC")},{name:"custom_type",xtype:"combobox",fieldLabel:"Metric Type",queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:IRm$.r1("L_CUSTOM_FIELD"),value:"CUSTOM_FIELD"},{name:IRm$.r1("L_GROUP_FIELD"),value:"GROUP_FIELD"},{name:IRm$.r1("L_PREDEFINED_FIELD"),value:"PREDEFINED_FIELD"},{name:IRm$.r1("L_GEO_FIELD"),value:"GEO_FIELD"},{name:IRm$.r1("L_RANGE_FIELD"),value:"RANGE_FIELD"},{name:IRm$.r1("L_LINK_FIELD"),value:"LINK_FIELD"}]}},{xtype:"fieldset",border:!1,title:IRm$.r1("L_CUSTOM_FIELD"),name:"pconfig1",layout:{type:"vbox",align:"stretch"},fieldDefaults:{labelWidth:60},items:[{name:"expression",labelWidth:60,fieldLabel:IRm$.r1("L_SYNTAX"),xtype:"textarea"},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"displayfield",anchor:"100%",autowidth:!1,value:IRm$.r1("L_CM_DISP_1")},{xtype:"container",flex:1}]},{xtype:"gridpanel",flex:1,store:{fields:[{name:"name"},{name:"type"},{name:"delete"},{name:"nodepath"},{name:"uid"},{name:"memo"}]},name:"datagrid",height:120,columns:[{text:IRm$.r1("B_NAME"),flex:1,sortable:!1,dataIndex:"name"},{text:IRm$.r1("B_TYPE"),flex:1,sortable:!1,dataIndex:"type"},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,a){var n=e.store;n.getAt(t);n.removeAt(t)}}]}],viewConfig:{stripeRows:!0,plugins:{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_"},listeners:{beforedrop:function(e,t,a,n,l){var i,o=this,d=!1,r=t.records&&0<t.records.length?t.records[0]:null,m=r?r.get("type"):null;if(o==t.view?t.copy=!1:t.copy=!0,a?o.panel.store.indexOf(a):0,"Metric"==m){for(i=0;i<o.store.data.items.length;i++)if(o.store.data.items[i].get("uid")==r.data.uid){d=!0;break}0==d&&o.store.add(r.data)}return!1},drop:function(e,t,a,n){a&&a.get("name");return!1}}},listeners:{itemdblclick:function(e,t,a,n,l,i){this.editorItemName(t.data.name)},scope:this}},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"displayfield",autowidth:!1,flex:1,value:IRm$.r1("L_CD_DISP_2")},{xtype:"container",flex:1},{xtype:"button",text:"Add",handler:function(){this.selectItem("customfield")},scope:this}]}]},{xtype:"fieldset",border:!1,title:IRm$.r1("L_GROUP_FIELD"),name:"pconfig2",hidden:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:IRm$.r1("L_BASE_METRIC"),items:[{xtype:"textfield",hideLabel:!0,flex:1,name:"groupfielditem",allowBlack:!1},{xtype:"button",text:"..",handler:function(){this.selectItem("groupfielditem")},scope:this}]},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"grid",flex:1,store:{fields:["name","operator","opname","value","values","delete"]},name:"groupdatagrid",stateful:!0,plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{text:IRm$.r1("B_NAME"),flex:1,sortable:!1,dataIndex:"name",editor:{clickToEdit:!1,allowBlank:!1}},{text:IRm$.r1("L_CONDITION"),flex:1,sortable:!1,dataIndex:"operator",editor:{xtype:"combobox",queryMode:"local",displayField:"name",labelField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:"Like",value:"like"},{name:"=",value:"eq"},{name:">",value:"gt"},{name:"<",value:"lt"},{name:">=",value:"gte"},{name:"<=",value:"lte"},{name:"In",value:"in"},{name:"Except",value:"except"}]}}},{text:IRm$.r1("B_VALUE"),flex:1,sortable:!1,dataIndex:"value",editor:{clickToEdit:!1,isvalue:!0}},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-delete",tooltip:IRm$.r1("L_REMOVE"),handler:function(e,t,a){var n=e.store;n.getAt(t);n.removeAt(t)},scope:this},{iconCls:"icon-grid-config",tooltip:IRm$.r1("L_EDIT"),handler:function(e,t,a){var n=e.store.getAt(t);this.editFilter(n.data,n)},scope:this}]}],viewConfig:{stripeRows:!0},listeners:{itemdblclick:function(e,t,a,n,l){var i=t.data,o=t.get("operator");!i||"in"!=o&&"except"!=o||this.editFilter(i,t)},edit:function(e,t){e.grid;var a,n,l,i=t.record;if("value"==e.column)for(i.data.values=[],l=t.value.split(","),a=0;a<l.length;a++)(n=IG$.trim12(l[a]))&&i.data.values.push({code:n,text:n})},scope:this}},{xtype:"fieldcontainer",layout:{type:"vbox",pack:"center"},items:[{xtype:"button",iconCls:"icon-toolbar-add",tooltip:IRm$.r1("L_ADD_CONDITION"),handler:function(){this.addBlankCondition()},scope:this},{xtype:"button",iconCls:"icon-toolbar-moveup",tooltip:"Move Up",handler:function(){var e,t,a=this.down("[name=groupdatagrid]"),n=a.getSelectionModel().getSelection();n&&1==n.length&&(e=n[0],0<(t=a.store.indexOf(e))&&(a.store.remove(e),e=a.store.insert(t-1,e)))},scope:this},{xtype:"button",iconCls:"icon-toolbar-movedown",tooltip:"Move Down",handler:function(){var e,t,a=this.down("[name=groupdatagrid]"),n=a.getSelectionModel().getSelection();n&&1==n.length&&(e=n[0],(t=a.store.indexOf(e))+1<a.store.data.items.length&&(a.store.remove(e),e=a.store.insert(t+1,e)))},scope:this}]}]},{xtype:"textfield",name:"othergroupvalue",fieldLabel:IRm$.r1("L_OTHER_VALUE")}]},{xtype:"fieldset",border:!1,title:IRm$.r1("L_PREDEFINED_FIELD"),name:"pconfig3",hidden:!0,defaultType:"textfield",layout:{type:"vbox",align:"stretch"},defaults:{anchor:"100%"},items:[{xtype:"fieldcontainer",layout:{type:"hbox"},fieldLabel:IRm$.r1("L_BASE_METRIC"),items:[{xtype:"textfield",hideLabel:!0,name:"predefinefield",allowBlack:!1},{xtype:"button",text:"..",handler:function(){this.selectItem("predefinefield")},scope:this}]},{xtype:"fieldcontainer",layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",name:"optdateformat",fieldLabel:"Date format example",queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:"Select",value:""},{name:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss"},{name:"2001-07-04 12:08:56",value:"yyyy-MM-dd HH:mm:ss"},{name:"2001-07-04 AM 12:08",value:"yyyy-MM-dd a HH:mm"},{name:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy"},{name:"20010704120856",value:"yyyyMMddHHmmss"}]}},{name:"dateformat",fieldLabel:IRm$.r1("L_DATE_FORMAT"),xtype:"textfield",value:""},{fieldLabel:IRm$.r1("L_GROUP_LEVEL"),name:"datedivision",xtype:"radiogroup",columns:3,$h:120,plain:!0,items:[{boxLabel:IRm$.r1("B_YEAR"),name:"datediv",inputValue:"YYYY",checked:!0},{boxLabel:IRm$.r1("B_QUARTER"),name:"datediv",inputValue:"QUARTER"},{boxLabel:IRm$.r1("B_MONTH"),name:"datediv",inputValue:"MM"},{boxLabel:IRm$.r1("B_DAY"),name:"datediv",inputValue:"DD"},{boxLabel:IRm$.r1("B_WEEKMONTH"),name:"datediv",inputValue:"WM"},{boxLabel:IRm$.r1("B_WEEK"),name:"datediv",inputValue:"WEEK"},{boxLabel:IRm$.r1("B_AMPM"),name:"datediv",inputValue:"AMPM"},{boxLabel:IRm$.r1("B_HOUR"),name:"datediv",inputValue:"HH"},{boxLabel:IRm$.r1("B_MINUTE"),name:"datediv",inputValue:"MI"},{boxLabel:IRm$.r1("B_CUSTOM"),name:"datediv",inputValue:"CUSTOM"}],listeners:{change:function(e,t,a,n){var l=e.getValue().datediv;this.down("[name=customdatetype]").setVisible("CUSTOM"==l)},scope:this}},{fieldLabel:IRm$.r1("B_CUSTOM"),name:"customdatetype",xtype:"textfield",hidden:!0}]}]},{xtype:"fieldset",name:"pconfig4",hidden:!0,border:!1,title:IRm$.r1("L_GEO_FIELD"),defaultType:"textfield",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_LATITUDE"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,name:"geolat"},{xtype:"button",text:"..",handler:function(){this.selectItem("geolat")},scope:this}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_LONGITUDE"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,name:"geolng"},{xtype:"button",text:"..",handler:function(){this.selectItem("geolng")},scope:this}]}]},{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},name:"pconfig5",hidden:!0,title:IRm$.r1("L_RANGE_FIELD"),items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:IRm$.r1("L_BASE_METRIC"),items:[{xtype:"textfield",hideLabel:!0,name:"rangefield",allowBlack:!1},{xtype:"button",text:"..",handler:function(){this.selectItem("rangefield")},scope:this}]},{name:"groupmin",fieldLabel:"Start minimum",xtype:"numberfield",value:-1,minValue:-1,maxValue:1e8,allowDecimals:!0,decimalPrecision:2,step:1},{name:"groupmax",fieldLabel:"End Maximum",xtype:"numberfield",value:-1,minValue:-1,maxValue:1e8,allowDecimals:!0,decimalPrecision:2,step:1},{name:"stepinterval",fieldLabel:"Step Interval",xtype:"numberfield",value:-1,minValue:-1,maxValue:10,allowDecimals:!0,decimalPrecision:2,step:1},{name:"groupminlabel",fieldLabel:"Under minimum",xtype:"textfield"},{name:"groupmaxlabel",fieldLabel:"Over maximum",xtype:"textfield"},{name:"grouplabel",fieldLabel:"Label text",xtype:"textfield"},{xtype:"displayfield",value:"Use keyword %MIN %MAX for range labeling"},{xtype:"textfield",name:"groupformat",fieldLabel:"Numeric Format"}]},{xtype:"fieldset",title:"Link Option",name:"pconfig6",hidden:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",name:"l_tp",fieldLabel:IRm$.r1("L_LNK_TP"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:IRm$.r1("L_LNK_DRILL"),value:"DRILL"},{name:IRm$.r1("L_LNK_DOC"),value:"DOC"},{name:IRm$.r1("L_LNK_EXT"),value:"EXTERNAL"}]},listeners:{change:function(e){var t=this,a=(t.down("[name=l_nm]"),t.down("[name=l_tr]")),n=t.down("[name=l_elnk]"),l=t.down("[name=l_elnk_tgt]"),i=t.down("[name=l_rpt_tmpl]"),o=e.getValue(),d="EXTERNAL"==o;a.setVisible(!d),i.setVisible("DOC"==o),n.setVisible(d),l.setVisible(d)},scope:this}},{xtype:"textfield",name:"l_nm",fieldLabel:"Display Name"},{xtype:"fieldcontainer",fieldLabel:"Target Report",name:"l_tr",hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",hidden:!0,name:"l_rpt_uid"},{xtype:"textfield",name:"l_rpt_name",flex:1},{xtype:"button",name:"..",handler:function(){this.selectReport("l_rpt")},scope:this}]},{xtype:"combobox",name:"l_rpt_tmpl",fieldLabel:IRm$.r1("L_LNK_TMPL"),queryMode:"local",displayField:"disp",valueField:"seq",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["disp","seq"]}},{xtype:"textfield",name:"l_elnk_tgt",fieldLabel:IRm$.r1("L_LNK_TGT"),hidden:!0},{xtype:"textarea",fieldLabel:IRm$.r1("L_LNK_URL"),anchor:"100%",hidden:!0,name:"l_elnk"}]}]},{xtype:"panel",title:"Advanced Options",autoScroll:!0,padding:5,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("L_SORT_SEL"),layout:{type:"vbox",align:"stretch"},padding:5,items:[{xtype:"radiogroup",name:"optsortdir",fieldLabel:IRm$.r1("L_SORT_ORD"),padding:"0 5",plain:!0,items:[{boxLabel:IRm$.r1("B_DEFAULT"),name:"cb_sortdir",inputValue:"",checked:!0},{boxLabel:IRm$.r1("B_ASC"),name:"cb_sortdir",inputValue:"asc"},{boxLabel:IRm$.r1("B_DSC"),name:"cb_sortdir",inputValue:"desc"}]},{xtype:"radiogroup",name:"optsorttype",fieldLabel:IRm$.r1("L_SORT_TP"),padding:"0 5",plain:!0,items:[{boxLabel:IRm$.r1("B_DEFAULT"),name:"cb_sorttype",inputValue:"",checked:!0},{boxLabel:IRm$.r1("B_STRING"),name:"cb_sorttype",inputValue:"VARCHAR"},{boxLabel:IRm$.r1("B_NUMERIC"),name:"cb_sorttype",inputValue:"NUMBER"}]}]},{xtype:"fieldset",title:IRm$.r1("L_OTHER_OPTION"),layout:"anchor",padding:"3 5",defaults:{anchor:"100%"},items:[{xtype:"checkbox",name:"optremoveblank",boxLabel:IRm$.r1("L_REM_BLK")},{xtype:"checkbox",name:"isdatetype",boxLabel:IRm$.r1("L_DATE_TYPE"),listeners:{change:function(e,t,a,n){var l=e.getValue(),i=this.down("[name=t_format]"),o=this.down("[name=d_format]");this.down("[name=customdatetypecontainer]");i.setVisible(l),o.setVisible(l)},scope:this}},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATE_FORMAT_SRC"),name:"d_format",labelWidth:130,hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"dateformat",flex:1},{xtype:"button",text:"Example",menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){e.down("[name=dateformat]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){e.down("[name=dateformat]").setValue(this.value)}}]}}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATE_FORMAT_TGT"),name:"t_format",labelWidth:130,hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"t_dateformat",flex:1},{xtype:"button",text:"Example",menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){e.down("[name=t_dateformat]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){e.down("[name=t_dateformat]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){e.down("[name=t_dateformat]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){e.down("[name=t_dateformat]").setValue(this.value)}}]}}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:IRm$.r1("L_CODE_FIELD"),items:[{xtype:"textfield",name:"cmap_disp",readOnly:!0,flex:1},{xtype:"button",text:"..",handler:function(){this.selectItem("codemap")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){this.down("[name=cmap_disp]").setValue(""),this.clItem.objectinfo.cmap_disp="",this.clItem.objectinfo.cmap_uid=""},scope:this}]}]},{xtype:"fieldset",title:IRm$.r1("L_STYLE_OPTION"),layout:{type:"vbox",align:"stretch"},padding:"3 5",items:[{xtype:"combobox",name:"optstyle",fieldLabel:IRm$.r1("L_BASE_STYLE"),queryMode:"local",displayField:"disp",valueField:"name",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["disp","name","type"]}}]},{xtype:"fieldset",title:"Measures",hidden:this.dmode,layout:{type:"vbox",align:"stretch"},items:[{xtype:"gridpanel",height:160,name:"grd_measures",tbar:[{text:"Refresh",handler:function(){this.getMeasures()},scope:this},"->",{text:"Add Formula",handler:function(){var e=this,t=new IG$.multiMeasure({uid:e.uid,mitem:e.item,vmode:2,callback:new IG$.callBackObj(e,e.reg_measures)});IG$.checkLogin(e,t)},scope:this},{text:"Custom Formula",handler:function(){},scope:this}],store:{fields:["name"]},columns:[{text:"Name",width:220,dataIndex:"name"},{text:"Formula",flex:1},{xtype:"actioncolumn",width:80,items:[{iconCls:"icon-grid-config",handler:function(e,t,a,n){this.edit_customfield(n)},scope:this},{iconCls:"icon-grid-delete",handler:function(e,t,a,n){e.store.remove(n)},scope:this}]}]}]}]}]}]}],IG$.customMetricInner.superclass.initComponent.apply(this)},listeners:{afterrender:function(e){var t=this;setTimeout(function(){t.init_f.call(t)},100)}}}),IG$.custommetric=$s.extend($s.window,{modal:!1,isWindow:!0,region:"center",layout:{type:"fit",align:"stretch"},closable:!1,resizable:!1,width:500,height:480,callback:null,closedlg:function(){this.close()},_confirm:function(){var e=this;e.mainpanel._confirm.call(e.mainpanel),e.callback&&e.callback.execute(e.mainpanel.clItem),e.close()},initComponent:function(){var e=this;e.mainpanel=new IG$.customMetricInner({uid:e.uid,writable:e.writable,parentuid:e.parentuid,parentnodepath:e.parentnodepath,itemtype:e.itemtype,wd:e,dmode:e.dmode,dmode_cnt:e.dmode_cnt}),e.title=IRm$.r1("T_CUSTOM_METRIC"),$s.apply(e,{defaults:{bodyStyle:"padding:10px"},items:[e.mainpanel],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}]}),IG$.custommetric.superclass.initComponent.apply(this,arguments)}});
IG$.p$DbMeta=$s.extend($s.window,{modal:!0,closable:!1,resizable:!0,width:820,height:520,iconCls:"icon-doc-table",layout:"fit",bodyPadding:5,_init:function(){this._loadDbMeta("F")},_loadDbMeta:function(e){var t=this,a=new IG$._rpc$;a.init(t,{ack:"userdb",payload:{uid:t.uid,option:"extract_dbmeta",refresh:e||"T"},mbody:{}},t,function(e){this.down("[name=tbsrc]").store.loadData(e)},!1),a.send()},initComponent:function(){$s.apply(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},border:0,padding:5,items:[{xtype:"panel",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",title:"Source tables",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1},{xtype:"button",text:".."}]},{xtype:"grid",name:"tbsrc",flex:1,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},columns:[{text:"Name",dataIndex:"name",flex:1}],store:{fields:[]},listeners:{cellclick:function(e,t,a,n,i,l,o,s){var d=this.down("[name=tbfield]"),c=this.down("[name=ttbname]");d.store.loadData(n.get("fields")),c.setValue(n.get("name").toLowerCase())},scope:this}}]},{xtype:"container",width:5},{xtype:"panel",title:"Field Mapping",flex:2,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"Target tablename",name:"ttbname"},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,fieldLabel:"Search"},{xtype:"button",text:".."}]},{xtype:"grid",flex:1,name:"tbfield",plugins:[{ptype:"cellediting",clicksToEdit:!1}],columns:[{text:"Name",dataIndex:"name",flex:1},{text:"DB name",dataIndex:"physical_name",flex:1},{text:"DataType",dataIndex:"fieldtype"},{text:"Length",dataIndex:"length"}],store:{fields:[]}}]}]}]}],buttons:[{iconCls:"icon-toolbar-schedule",text:IRm$.r1("B_SCHEDULE"),handler:function(){var e,t,a,n=this,i=[],l=n.down("[name=tbsrc]").getSelectionModel().selected,o={};for(e={ack:"userdb",payload:{uid:n.uid,target_folder:n.target_folder.get("uid"),option:"sync_dbmeta"},mbody:{tables:[]},jobkey:"0",meta_type:"metatables"},o.name="",t=0;t<l.length;t++)a=l.items[t].data,e.mbody.tables.push(a),t<3?o.name+=(0<t?",":"")+a.name:3==t&&(o.name+=" and ("+l.length+")");i.push(e),IG$.showScheduler(n,n.uid,n.itemtype,i,o)},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()},scope:this}}),IG$.p$DbMeta.superclass.initComponent.call(this)}});
IG$.tableManager=$s.extend(IG$.v$pnl,{iconCls:"icon-bobject",closable:!0,layout:"fit",bodyPadding:5,_init:function(){var e,t=this;t.uid?t.getLCnt():(e={},t._ds&&t._ds.uid&&(e.datasource={uid:t._ds.uid,name:t._ds.name}),t.refLCnt(e))},getLCnt:function(){var t=this,e=new IG$._rpc$;e.init(t,{ack:"content",payload:{uid:t.uid},mbody:{option:"content"}},t,function(e){e.content||(e.content={name:e.name,uid:e.uid,nodepath:e.nodepath,type:e.type,meta_type:"business_object"}),t.refLCnt(e.content)},!1),e.send()},refLCnt:function(e){var t=this;t._mc=e,t._mc.highlight=t._mc.highlight||[],t._mc.datasource?t.getCnt():t.sel_db(),t._mc.uid&&t.refRoot()},refRoot:function(){var e,t=this._mc,n=this.down("[name=cube_tree]");e={type:"ROOT",name:t.name,uid:t.uid,nodepath:t.nodepath,leaf:!1,children:[{type:"load",name:"Loading..."}]},n.setRootNode(e),setTimeout(function(){n.getRootNode().expand()},10)},getCnt:function(){var t=this,e=new IG$._rpc$;e.init(t,{ack:"content",payload:{uid:t._mc.datasource.uid},mbody:{}},t,function(e){t.refCnt(e.content)},!1),e.send()},refCnt:function(e){var t=this,n=t._mc.datasource;t.dbo=e,n.uid=e.uid,n.nodepath=e.nodepath,n.name=e.name,t.down("[name=tbdsname]").setText(e.name+" ("+t.dbo.dbtype+")"),"sforce"==t.dbo.dbtype?(t.down("[name=btn_extr]").show(),t.targetdb=t.dbo.options.sf_targetdb):"essbase"==t.dbo.dbtype?(t.down("[name=btn_extr]").show(),t.targetdb=t.dbo.options.essbase_targetdb):"sapbw"==t.dbo.dbtype&&(t.down("[name=btn_extr]").show(),t.targetdb=t.dbo.options.sapbw_targetdb)},custom_click_func:function(e,t){var n=this,a=!1,i=e.get("type");return i=i?i.toLowerCase():null,n._s1=null,"folder"!=i&&"dataset"!=i&&"bobject"!=i&&"datemetric"!=i||((n._s1=e).get("open")||e.expand(),n.load_fields(e)),"table"==i||"inlineview"==i?((n._s1=e).get("open")||e.expand(),n.load_fields(e),a=!0):"folder"==i&&1==e.get("subitem")?(n.load_fields(e),a=!0):"cubemodel"==i&&(a=n._load_cubemodel(e)),a},custom_expand_func:function(e){var t=this,n=!1,a=e.get("type");return e.isRoot()?t._s1||(t._s1=e):"Folder"==a||"DataSet"==a?t._s1||(t._s1=e):"Table"!=a&&"InlineView"!=a||(0<e.childNodes.length&&"load"==e.childNodes[0].get("type")&&(e.removeAll(),t._s1&&t._s1.get("uid")==e.get("uid")&&t.load_fields(e)),n=!0),n},_load_dataset:function(e){var t=IG$.mainPanel;return t&&e&&t.navigateApp.call(t,e.get("uid"),"dataset",e.get("name"),e.get("nodepath"),!1,e.get("writable"),{}),!0},_load_cubemodel:function(e){var t=IG$.mainPanel,n={};return t&&(n={obj_uid:this.uid,cubemodel:e?null:new IG$.m$CubeModel(null)},e?t.navigateApp.call(t,e.get("uid"),"cubemodel",e.get("name"),e.get("nodepath"),!1,e.get("writable"),n):t.navigateApp.call(t,null,"cubemodel","new model",null,!1,!0,n)),!0},load_fields_grid:function(m,e,u){var p=this,t=(m.type.toLowerCase(),new IG$._rpc$);t.init(p,{ack:"content",payload:{uid:m.uid,nodepath:m.nodepath,name:m.name,type:m.type},mbody:{option:"folder"}},p,function(e){var t,n,a,i=[],o=[],d=[],l=p.down("[name=file_field]"),s=p.down("[name=seq_field]"),c=p.down("[name=allow_insert]"),r=p.down("[name=grdfields]");for(a=e.children||[],t=0;t<a.length;t++)(n=a[t]).iconcls=IG$.get_metatype_icon(n.type.toLowerCase(),n),"Folder"==n.type?(n.children=[{type:"load",name:"Loading..."}],n.subitem=!0,i.push(n)):(n.dispname=n.name,n.physical_name=n.attributes.attrb3,"Dimension"!=n.type&&"Metric"!=n.type||(n.datatype=IG$.get_datatype(n.attributes.attrb4)),n.iconcls=IG$.get_metatype_icon(n.type?n.type.toLowerCase():"metric",n),o.push({name:n.name,value:n.physical_name}),d.push(n));IG$.sortMeta(d),IG$.sortMeta(i),i.length&&0==u.childNodes.length&&u.appendChild(i),r.store.loadData(d),c.setValue("Table"==m.type&&m.allow_insert),c.setDisabled("Table"!=m.type),l.store.loadData(o),l.setValue(m.file_field),s.store.loadData(o),s.setValue(m.seq_field)},!1),t.send()},load_fields:function(n,a){var i=this,e=i.down("[name=cube_tree]"),t=new IG$._rpc$,o=n.get("type").toLowerCase(),d=i.down("[name=tb_info]");e.__loaded&&e.setLoading(!0),i.down("[name=t_btn]").setVisible("folder"==o||"table"==o||"inlineview"==o),i.down("[name=t_btn2]").setVisible("table"==o||"inlineview"==o),i.down("[name=t_btn3]").setVisible("folder"==o||"bobject"==o),i.down("[name=t_btn_pv]").setVisible("table"==o||"inlineview"==o),i.down("[name=b_opt_4]").setVisible("dataset"==o),"folder"==o||"bobject"==o?(d.hide(),i.down("[name=b_opt_1]").hide(),i.down("[name=b_opt_1a]").hide(),i.down("[name=b_opt_2]").hide(),i.down("[name=b_opt_3]").hide(),i.load_fields_grid(n.data,a,n)):"dataset"==o?(i.down("[name=b_opt_4]").setText(IRm$.r1("L_EDIT_ITEM",n.get("locale_name")||n.get("name"))),i.down("[name=b_opt_4]").setDisabled(!n.get("writable")),i.down("[name=b_opt_1]").hide(),i.down("[name=b_opt_1a]").hide(),i.down("[name=b_opt_2]").hide(),i.down("[name=b_opt_3]").hide(),i.load_fields_grid(n.data,a,n)):(d.show(),i.down("[name=b_opt_1]").show(),i.down("[name=b_opt_1a]").show(),i.down("[name=b_opt_2]").show(),i.down("[name=b_opt_3]").show(),t.init(e,{ack:"content",payload:{uid:n.get("uid")},mbody:{option:"diagnostics"}},e,function(e){var t=e&&e.content?e.content:"Folder"==e.type?e:null;(i._s1c=t)&&("Folder"==t.type||(i.down("[name=external_name]").setValue(t.external_name||t.name),i.down("[name=schema_name]").setValue(t.attributes?t.attributes.attrb2:"")),i.down("[name=edit_sql]").setVisible("InlineView"==t.type),i.load_fields_grid(t,a,n))}),t.send())},edit_dimension:function(e){var t=IG$.mainPanel,n=e.get("type").toLowerCase();"link"==n&&(n=e.get("rawtype").toLowerCase()),t&&"folder"!=n&&"table"!=n&&"inlineview"!=n&&t.navigateApp.call(t,e.get("uid"),n,e.get("name"),e.get("nodepath"),!0,1==e.get("writable"),{cubeuid:this.uid,obj_uid:this.uid})},createItem:function(e,t){var n=this,a=(n.down("[name=mtree]"),n._s1);t&&!a&&(a=n.down("[name=cube_tree]").getRootNode()),a&&IG$._createMetaObject.call(n,e,a.get("uid"),a.get("nodepath"),a,new IG$.callBackObj(n,function(e,t){n._s1&&n.load_fields(n._s1)}))},tbarHndlr:function(e,t){var n,i=this,a=IG$.mainPanel,o=i._s1?i._s1.get("type").toLowerCase():null;switch(e){case"cmd_save":i.saveCnt();break;case"cmd_extract_dbmeta":i.extrDbMeta();break;case"import_object":if(!i.checkTargetFolder())return;d=new IG$.cube_object_select({uid:i.uid,dbo:i.dbo,targetdb:i.targetdb||i.dbo.uid,callback:new IG$.callBackObj(i,function(e){i.registerSelectedTable(e)})}),IG$.checkLogin(i,d);break;case"cmd_inlineview":if(!t&&!i.checkTargetFolder())return;n=t&&"InlineView"==t.type?t:{dbpool:i.dbo.uid},d=new IG$.sqlcube_wizard({wmode:"inlineview",sheetoption:n,columns:[],callback:new IG$.callBackObj(i,i.rsInlineView)}),IG$.checkLogin(this,d);break;case"cmd_report":a&&a.navigateApp.call(a,null,"report","New Report",null,!0,!0,{cubeuid:i.uid});break;case"cmd_export_meta":IG$.confirmMessages(IRm$.r1("T_EXP_MC"),IRm$.r1("T_EXP_MC_Q"),function(e){var t=new IG$._rpc$,n=i.dbo,a=[];n&&"yes"==e&&(a.push({uid:n.uid,nodepath:n.nodepath,name:n.name,type:n.type}),t.init(i,{ack:"content",payload:a,mbody:{output:"file"}},i,function(e){var t,n;jnode&&(t=jnode.luid,n=jnode.filename,t&&n&&$.download(ig$.servlet,[{name:"ack",value:"download"},{name:"payload",value:t},{name:"mbody",value:n},{name:"_mts_",value:IG$._g$a||""}],"POST"))},null),t.send())},i,i);break;case"cmd_build_model":i.build_model();break;case"cmd_regmeasures":i.reg_measures();break;case"cmd_rel_field":if(o&&("table"==o||"inlineview"==o)){var d=new IG$.relationMgr({uid:i._s1.get("uid")});IG$.checkLogin(i,d)}break;case"cmd_preview":if(o&&("table"==o||"inlineview"==o)){d=new IG$.dlgLoadPreview({table:{_mc:i._s1.data}});IG$.checkLogin(i,d)}break;case"cmd_reglinks":i.reg_links();break;case"cmd_change_schema":i.batchUpdateSchema();break;case"cmd_save_field":i.saveFields();break;case"cmd_refresh_field":d=new IG$.dlg_compare_field({_s1:i._s1,schema:i.down("[name=schema_name]").getValue()||"none",table:i.down("[name=external_name]").getValue()||"none",callback:new IG$.callBackObj(i,function(t){var n,e,a,i=this,o=i.down("[name=grdfields]").store,d={},l={},s=[];if(t&&t.length){for(n=0;n<t.length;n++)"CHANGED"==t[n].status?d[t[n].uid]=t[n]:"REMOVED"==t[n].status&&(l[t[n].uid]=t[n]);for(n=o.data.items.length-1;0<=n;n--)(a=d[(e=o.data.items[n]).get("uid")])?e.set("changedprop",a.changedprop):l[e.get("uid")]&&s.push({uid:e.get("uid"),option:"delete"});if(s.length){var c=new IG$._rpc$;c.init(i,{ack:"batchcontent",payload:s,mbody:{}},i,function(e){for(n=0;n<t.length;n++)"NEW"==t[n].status&&(t[n].physical_name=t[n].fieldname,o.add(t[n]));i.saveFields()}),c.send()}else{for(n=0;n<t.length;n++)"NEW"==t[n].status&&(t[n].physical_name=t[n].fieldname,o.add(t[n]));i.saveFields()}}})});IG$.checkLogin(i,d);break;case"cmd_delete_field":i.deleteFields();break;case"cmd_hl_option":i.showHighlightOptions();break;case"cmd_sec_filter":i.showSecurityFilter()}},showSecurityFilter:function(){var e,t,o=this,n=o._mc;n.securityfilter=n.securityfilter||[],t=(e=n.securityfilter)&&0<e.length?new IG$.securityFilter({modal:!1,uid:o.uid,securityfilter:e}):new IG$.mgrUserDuty({modal:!1,callback:new IG$.callBackObj(o,function(e){var t,n,a=[];for(t=0;t<e.length;t++){var i={sid:e[t].get("sid"),name:e[t].get("name")};a.push(i)}if(0<a.length){for((n=new IG$.clFilterGroup(null)).auth=[],t=0;t<a.length;t++)n.auth.push({name:a[t].name,sid:a[t].sid});n.active=!0,o.showSecurityFilterEditor(n,!0)}})}),IG$.checkLogin(o,t)},showSecurityFilterEditor:function(e,n){var a=this,t=new IG$.filterEditorWindow({modal:!1,sheetoption:{datasource:{uid:a.uid},model:{filter:e}},reportoption:{cubeuid:a.uid},callback:new IG$.callBackObj(a,function(e){if(1==n){var t=e.model.filter;t&&a._mc.securityfilter.push(t)}})});IG$.checkLogin(a,t)},batchUpdateSchema:function(){var n=this;IG$.confirmMessages(ig$.appname,"Batch update schema for all tables in the folder. Would you continue?",function(e){if("yes"==e){var t=new IG$.dlg_schemaname({callback:new IG$.callBackObj(n,function(e){var t,n,a=new IG$._rpc$,i=this.down("[name=grdfields]").store,o=[];for(t=0;t<i.data.items.length;t++)"Table"==(n=i.data.items[t]).get("type")&&n.get("attributes").attrb2==e.pvalue&&o.push({uid:n.get("uid")});0!=o.length?(a.init(this,{ack:"tablecontent",payload:{option:"rename_schema",pvalue:e.pvalue,nvalue:e.nvalue},mbody:{children:o},meta_type:"metrics"},this,function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}),a.send()):IG$.alertmsg(ig$.appname,"No schema named with "+e.pvalue,null,null,0,"error")})});IG$.checkLogin(n,t)}})},showHighlightOptions:function(){var e=new IG$.$d_hlconfig({_piobj:this,callback:new IG$.callBackObj(this,function(e){})});IG$.checkLogin(this,e)},saveCnt:function(){var e=new IG$._rpc$;e.init(this,{ack:"writecontent",payload:{uid:this._mc.uid},mbody:this._mc,meta_type:"business_object"},this,function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}),e.send()},sel_db:function(){var t,n=this;t=new IG$.dlg_select_ds({sel_mode:1,callback:new IG$.callBackObj(n,function(e){var t=0;(!n._mc.datasource||n._mc.datasource&&n._mc.datasource.uid!=e.data.uid)&&(t=1),n._mc.datasource={uid:e.data.uid,name:e.data.name},t&&n.saveCnt(),n.getCnt()})}),n._mc.datasource&&n._mc.datasource.uid?IG$.confirmMessages(ig$.appname,n._mc.name+" already have datasource defined. Select another data source can cause report not running. Would you continue?",function(e){"yes"==e&&IG$.checkLogin(n,t)}):IG$.checkLogin(n,t)},saveFields:function(){var e,t,n,a,i,o=this,d=(o._s1,o._s1c),l=o.down("[name=grdfields]"),s=new IG$._rpc$;for(d.schemaname=o.down("[name=schema_name]").getValue(),d.external_name=o.down("[name=external_name]").getValue(),d.attributes.attrb2=d.schemaname,d.attributes.attrb3=d.external_name,d.columns=[],i=0;i<l.store.data.items.length;i++)a=(t=(e=l.store.data.items[i]).data).changedprop,(n=e.data.dimension?t.dimension:{uid:t.uid,name:t.name,meta_type:"dimension"}).fieldname=t.physical_name,n.tablename=d.external_name,n.changedprop=a,n.attributes={attrb1:d.external_name,attrb2:d.uid,attrb3:t.physical_name,attrb4:t.db_datatype},d.columns.push(n);s.init(o,{ack:"tablecontent",payload:{uid:d.uid,option:"updatetable"},mbody:d,meta_type:"table"},o,function(e){o._refresh_grid()},!1),s.send()},rsInlineView:function(e){var t=this,n=e.sheetoption,a=t._s1,i=new IG$._rpc$,o=n.uid;n.uid||(n.type="InlineView",n.pid=a.get("uid"),n.nodepath=a.get("nodepath")+"/"+n.name,o=n.nodepath),i.init(t,{ack:"writecontent",payload:{uid:o,type:"InlineView",name:n.name},mbody:n,meta_type:"inlineview"},t,function(e){n.uid?(t.refreshAll(),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")):(n.uid=e.uid,t._updIV(e))}),i.send()},_updIV:function(e){var t=this,n=new IG$._rpc$,a={uid:e.uid,option:"updateview"};n.init(t,{ack:"tablecontent",payload:a,mbody:{option:"updateview"}},t,function(e){t.refreshAll(),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},!1),n.send()},_refresh_grid:function(){var e=this._s1;"DataSet"==e.get("type")?this._load_dataset(e):this.load_fields(e)},deleteFields:function(){var a,i=this,o=i.down("[name=grdfields]").getSelectionModel().selected;o&&o.length&&IG$.confirmMessages(ig$.appname,"Confirm to delete content?",function(e){if("yes"==e){var t=[],n=new IG$._rpc$;for(a=0;a<o.length;a++)t.push({uid:o.items[a].get("uid"),option:"delete"});n.init(i,{ack:"batchcontent",payload:t,mbody:{}},i,function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_DELETED"),null,i,0,"success"),i._refresh_grid()}),n.send()}})},checkTargetFolder:function(){var e=this._s1;if(!e||"Folder"==e.get("type")||"Bobject"==e.get("type"))return e||(this._s1=e=this.down("[name=cube_tree]").getRootNode()),e;IG$.alertmsg(ig$.appname,IRm$.r1("B_SELECT_FOLDER"),null,null,0,"")},extrDbMeta:function(){var e,t;(t=this.checkTargetFolder())&&(e=new IG$.p$DbMeta({uid:this.uid,target_folder:t,callback:new IG$.callBackObj(this,function(){})}),IG$.checkLogin(this,e))},reg_links:function(){var e,t,n,c=this,r=[],a=c.down("[name=grdfields]").store.data.items;for(e=0;e<a.length;e++)1==(t=a[e]).get("selected")&&t.get("uid")&&(n={},IG$.CopyObject(t.data,n,"uid;name;type;memo;nodepath","s"),r.push(n));if(r.length){var i=new IG$.metaSelectDlg({mode:"select",targetobj:"folder",tree_options:{rootuid:c.uid},callback:new IG$.callBackObj(c,function(e){var t,n,a,i,o,d,l=[],s={items:[]};if(e){for(n=0;n<r.length;n++)-1<(d=(o=r[n]).name).indexOf("/")&&(d=(d=d.split("/")).join("&#x2044;")),a={rawuid:o.uid,rawtype:o.type,name:d,type:"Link",pid:e.uid,address:e.nodepath+"/"+d},i={meta_type:"link",rawuid:o.uid,rawtype:o.type,name:d},l.push(a),s.items.push(i);c.setLoading(!0),(t=new IG$._rpc$).init(c,{ack:"batchcontent",payload:l,mbody:s},c,function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},null),t.send()}})});IG$.checkLogin(c,i)}},reg_measures:function(){var e,t,n,a=this,i=[],o=a.down("[name=grdfields]").store.data.items;for(e=0;e<o.length;e++)1==(t=o[e]).get("selected")&&t.get("uid")&&(n={},IG$.CopyObject(t.data,n,"uid;name;type;memo;nodepath","s"),n.formula=IG$.isNumericType(t.get("datatype"))?"SUM":"COUNT",n.formula_desc="SUM"==n.formula?"Total":"Count",i.push(n));if(0<i.length){var d=new IG$.multiMeasure({metaitems:i,mfolder:a.mfolder,pcube:a,nodepath:a._mc.nodepath,callback:new IG$.callBackObj(a,a.rs_reg_measures)});IG$.checkLogin(a,d)}},rs_saveRegMeasures:function(e,t){t[0];var n,a,i,o,d,l,s,c=t[1],r=[];for(this.setLoading(!1),o=0;o<c.length;o++)"DateMetric"==(d=c[o]).ctype&&tnodes[o]&&(d.cuid=IG$.XGetAttr(tnodes[o],"uid"),r.push(d));if(r.length){for(l=[],s=[],o=0;o<r.length;o++)$.each([{name:"YYYY",rname:"YEAR"},{name:"QUARTER"},{name:"MM"},{name:"DD",rname:"DAY"},{name:"WM",rname:"WEEKMONTH"},{name:"WEEK"}],function(e,t){a=IRm$.r1("B_"+t.rname),i=t.name,l.push({uid:c[o].cloc+"/"+r[o].measurename+"/"+a,pid:r[o].cuid,name:a,type:"CustomMetric"}),s.push({meta_type:"custom_dimension",uid:c[o].cloc+"/"+r[o].measurename+"/"+a,pid:r[o].cuid,name:a,type:"CustomMetric",rel_items:[{uid:r[o].uid,name:r[o].uid,nodepath:"",type:"Metric"}],datedivision:i,dateformat:"DATE",predefinetype:"DATE",custom_type:"CUSTOM_FIELD",customdatetype:"",expression:"$DATE_YYYY(["+r[o].name+"])$"})});(n=new IG$._rpc$).init(this,{ack:"batchcontent",payload:l,mbody:s},this,function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}),n.send()}else IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},build_model:function(){var e,t,n,a,i=this,o=i.down("[name=grdfields]").getSelectionModel().selected,d={tables:[]};for(n=0;n<o.length;n++)"table"!=(a=(t=o.items[n]).get("type").toLowerCase())&&"inlineview"!=a||d.tables.push({name:t.get("name"),uid:t.get("uid")});d.pool=[{uid:i.uid}],(e=new IG$._rpc$).init(i,{ack:"cubecontent",payload:{option:"build_model"},mbody:d,meta_type:"tables"},i,function(e){var t=IG$.mainPanel;t&&t.navigateApp.call(t,null,"cubemodel".toLowerCase(),"new model",null,!1,!0,{obj_uid:i.uid,_c$:e})},!1),e.send()},registerSelectedTable:function(e){var t,n=this,a={option:"register"},i={tables:[]},o=new IG$._rpc$,d=n._s1;if(0!=e.length){for(t=0;t<e.length;t++)s=e[t],i.tables.push({dbpool:n.targetdb||n.dbo.uid,pid:d.get("uid"),name:s.name,schemaname:s.schemaname,product_code:s.product_code,external_name:s.external_name||s.name,object_type:s.object_type}),s.product_code&&(a.product_code=s.product_code);n.setLoading(!0),o.init(n,{ack:"tablecontent",payload:a,mbody:i,meta_type:"tables"},n,function(e){n.refreshAll(),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},!1),o.send()}},refreshAll:function(){this.down("[name=cube_tree]").refreshTree()},initComponent:function(){var e=this;$s.apply(e,{items:[{xtype:"panel",flex:1,border:1,layout:"border",split:!0,items:[new IG$.naviTree({showtoolbar:!1,cubebrowse:!0,ddGroup:"_I$RD_G_",name:"cube_tree",rootuid:e.uid,region:"west",width:300,border:0,split:!0,title:"Folder and Tables",visibleItems:"folder;table;inlineview;cubemodel;dataset;datemetric;",enabledrag:!0,_search:!0,custom_click_func:new IG$.callBackObj(e,e.custom_click_func),custom_expand_func:new IG$.callBackObj(e,e.custom_expand_func),isdatasource:!0,listeners:{toolbar:function(e,t,n){this._s1=t,this.tbarHndlr(e)},scope:this}}),{xtype:"panel",region:"center",flex:1,border:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",layout:"anchor",name:"tb_info",hidden:!0,border:0,items:[{xtype:"container",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"Table Name",name:"schema_name",width:220},{xtype:"textfield",name:"external_name"},{xtype:"button",text:"Edit SQL",name:"edit_sql",hidden:!0,handler:function(){this._s1c||IG$.alertmsg(ig$.appname,IRm$.r1("B_SELECT_TARGET"),null,null,0,""),this.tbarHndlr("cmd_inlineview",this._s1c)},scope:this},{xtype:"container",flex:1}]},{xtype:"checkbox",fieldLabel:"Allow Insert",name:"allow_insert",border:0,labelAlign:"right",boxLabel:IRm$.r1("B_ENABLE"),disabled:!0,listeners:{change:function(e){this.down("[name=t2]").setVisible(e.getValue())},scope:this}},{xtype:"panel",border:0,name:"t2",hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"combobox",name:"file_field",labelAlign:"right",fieldLabel:"File Field",valueField:"value",displayField:"name",queryMode:"local",editable:!1,store:{fields:["name","value"]}},{xtype:"combobox",name:"seq_field",labelAlign:"right",fieldLabel:"Unique Field",valueField:"value",displayField:"name",queryMode:"local",editable:!1,store:{fields:["name","value"]}},{xtype:"container",flex:1}]}]},{xtype:"gridpanel",title:"Fields",name:"grdfields",flex:1,border:0,store:{fields:["name","datatype","datasize","decimaldigits","tablename","type","iskey","iconcls","physical_name"]},selType:"checkboxmodel",selModel:{mode:"MULTI"},viewConfig:{plugins:[{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_",enableDrop:!1,enableDrag:!0}],listeners:{}},plugins:[{ptype:"cellediting",clicksToEdit:!1}],defaults:{sortable:!1,hideable:!1},columns:[{header:"",dataIndex:"iconcls",menuDisabled:!0,width:30,renderer:function(e){return"<div class='igc_g_icon "+e+"'></div>"}},{header:IRm$.r1("B_NAME"),dataIndex:"name",flex:1},{header:IRm$.r1("B_PHY_NAME"),dataIndex:"physical_name",flex:1},{header:IRm$.r1("B_DATATYPE"),dataIndex:"datatype",width:80},{xtype:"actioncolumn",width:30,items:[{iconCls:"icon-grid-delete",tooltip:IRm$.r1("L_REMOVE"),handler:function(e,t,n){var a=e.store,i=a.getAt(t);IG$.deleteMetaObject(i.get("uid"),i,IG$.callBackObj(this,function(){a.removeAt(t)}))},scope:this}]}],listeners:{beforeedit:function(e,t,n){var a=1==this.__dbtype,i=!0;return 0!=t.colIdx||a||(i=!1),i},cellclick:function(e,t,n,a,i,o,d,l){"Field"!=a.get("type")&&2==n&&this.edit_dimension(a)},scope:this},dockedItems:[{xtype:"toolbar",dock:"top",items:[{iconCls:"icon-toolbar-save",tooltip:"Save field",name:"b_opt_1",hidden:!0,handler:function(){this.tbarHndlr("cmd_save_field")},scope:this},{iconCls:"icon-refresh",tooltip:"Refresh",hidden:!0,name:"b_opt_1a",handler:function(){this.tbarHndlr("cmd_refresh_field")},scope:this},{iconCls:"icon-toolbar-remove",tooltip:"Delete",handler:function(){this.tbarHndlr("cmd_delete_field")},scope:this},{xtype:"textfield",flex:1,name:"_filter",enableKeyEvents:!0,listeners:{keyup:function(e,t,n){13==t.keyCode&&IG$._dofilter(this,"grdfields",["name","physical_name"])},scope:this}},{xtype:"button",text:"..",handler:function(){IG$._dofilter(this,"grdfields",["name","physical_name"])},scope:this},"-",{xtype:"button",name:"t_btn_pv",iconCls:"icon-tb-preview",text:"Data",tooltip:"Preview",hidden:!0,handler:function(){this.tbarHndlr("cmd_preview")},scope:this},{xtype:"button",name:"t_btn2",hidden:!0,text:IRm$.r1("L_OPTIONS"),menu:{xtype:"menu",items:[{text:"Relations",handler:function(){this.tbarHndlr("cmd_rel_field")},scope:this},{iconCls:"icon-measure",text:IRm$.r1("L_REG_MEASURES"),name:"b_opt_2",handler:function(){this.tbarHndlr("cmd_regmeasures")},scope:this},"-",{iconCls:"icon-link",text:IRm$.r1("L_REG_LINK"),name:"b_opt_3",handler:function(){this.tbarHndlr("cmd_reglinks")},scope:this}]}},{xtype:"button",name:"t_btn3",hidden:!0,text:IRm$.r1("L_OPTIONS"),menu:{xtype:"menu",items:[{text:"Batch update schema",handler:function(){this.tbarHndlr("cmd_change_schema")},scope:this}]}},"->",{text:IRm$.r1("L_EDIT_ITEM"),name:"b_opt_4",hidden:!0,handler:function(){this._s1&&"DataSet"==this._s1.get("type")&&this._load_dataset(this._s1)},scope:this},{xtype:"button",name:"t_btn",text:IRm$.r1("L_CREATE_ITEM"),hidden:!0,menu:{xtype:"menu",items:[{text:IRm$.r1("D_FOLDER"),hidden:ig$.features.ig_n_f_f,handler:function(){this.createItem("Folder")},scope:this},"-",{text:IRm$.r1("D_CUSTOMMETRIC"),hidden:ig$.features.ig_n_cm,handler:function(){this.createItem("CustomMetric")},scope:this},{text:IRm$.r1("D_MEASURE"),hidden:ig$.features.ig_n_ms,handler:function(){this.createItem("Measure")},scope:this},{text:IRm$.r1("D_FORMULA"),hidden:ig$.features.ig_n_fm,handler:function(){this.createItem("FormulaMeasure")},scope:this},"-",{text:IRm$.r1("D_DATEMETRIC"),hidden:ig$.features.ig_n_dm,handler:function(){this.createItem("DateMetric")},scope:this},{text:IRm$.r1("D_CHARTMEASURE"),hidden:ig$.features.ig_n_cms,handler:function(){this.createItem("ChartMeasure")},scope:this},{text:IRm$.r1("D_HIERARCHY"),hidden:ig$.features.ig_n_hm,handler:function(){this.createItem("Hierarchy")},scope:this}]}}]}]}]}],tbar:[{iconCls:"icon-toolbar-save",name:"t_save",tooltip:IRm$.r1("L_SAVE"),handler:function(){this.tbarHndlr("cmd_save")},scope:this},"-",{xtype:"button",text:IRm$.r1("L_IMP_TB"),handler:function(){this.tbarHndlr("import_object")},scope:this},{text:IRm$.r1("L_C_INLINEV"),name:"b_m2",handler:function(){this.tbarHndlr("cmd_inlineview")},scope:this},"-",{iconCls:"icon-toolbar-hl",tooltip:IRm$.r1("L_TB_HL"),handler:function(){this.tbarHndlr("cmd_hl_option")},scope:this},{iconCls:"icon-toolbar-filter",tooltip:"Security Filter",handler:function(){this.tbarHndlr("cmd_sec_filter")},scope:this},"-",{xtype:"button",text:IRm$.r1("L_BUILD_MODEL"),handler:function(){this.tbarHndlr("cmd_build_model")},scope:this},"->",{text:"Extract Meta",hidden:!0,name:"btn_extr",handler:function(){this.tbarHndlr("cmd_extract_dbmeta")},scope:this},{iconCls:"icon-report",text:IRm$.r1("M_REPORT"),handler:function(){this.tbarHndlr("cmd_report")},scope:this},{text:IRm$.r1("L_EXPORT_META"),handler:function(){this.tbarHndlr("cmd_export_meta")},scope:this},"-",{xtype:"button",text:IRm$.r1("L_SEL_DB"),handler:function(){this.sel_db()},scope:this}],bbar:[{xtype:"toolbar",items:[{xtype:"button",text:"",name:"tbdsname",tooltipType:"title",tooltip:"Data Connections"}]}]}],listeners:{afterrender:function(e){e._init.call(e)}}}),IG$.tableManager.superclass.initComponent.call(this)}}),IG$.dlg_compare_field=$s.extend($s.window,{width:500,height:520,layout:"fit",padding:5,refreshFields:function(){var e=this,t=e._s1,n=new IG$._rpc$,a={uid:t.get("uid"),option:"compare_fields"},i={schema:e.schema,table:e.table};n.init(e,{ack:"tablecontent",payload:a,mbody:i},e,function(e){var t,n,a,i,o;for(n=e&&e.columns||[],t=0;t<n.length;t++)if((a=n[t]).changedprop&&(a.status=a.changedprop.status,!a.status)){for(i in o=[],a.changedprop)"status"!=i&&o.push(i);o.length&&(a.status="CHANGED",a.propdesc=o.join(","))}this.down("[name=dgrid]").store.loadData(n)},!1),n.send()},_confirm:function(){var e,t,n,a=this,i=a.down("[name=dgrid]"),o=(i.store,i.selModel.selected),d=[];for(n=0;n<o.length;n++)"CHANGED"!=(e=o.items[n]).data.status&&"NEW"!=e.data.status&&"REMOVED"!=e.data.status||("REMOVED"==e.data.status&&(t=1),d.push(e.data));0!=d.length?t?IG$.confirmMessages(ig$.appname,"Confirm to delete content?",function(e){"yes"==e&&(a.callback&&a.callback.execute(d),a.close())}):(a.callback&&a.callback.execute(d),a.close()):IG$.alertmsg(ig$.appname,"No item selected",null,null,0,"warning")},initComponent:function(){$s.apply(this,{title:"Column synchronization",items:[{xtype:"panel",padding:10,layout:{type:"vbox",align:"stretch"},items:[{xtype:"gridpanel",name:"dgrid",flex:1,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:[]},tbar:[{xtype:"button",text:"Undo changes",handler:function(){var e=this.down("[name=dgrid]").getSelectionModel().selected;for(i,rec,i=0;i<e.length;i++)rec=e.items[i],rec.get("status")&&rec.set("status","IGNORE")},scope:this}],columns:[{text:IRm$.r1("B_NAME"),flex:1,dataIndex:"name",tdCls:"igc-td-link"},{text:IRm$.r1("B_STATUS"),width:100,dataIndex:"status"},{text:IRm$.r1("B_DESC"),flex:1,dataIndex:"propdesc"}]}]}],buttons:["->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){e.refreshFields()}}}),IG$.dlg_compare_field.superclass.initComponent.call(this)}}),IG$.dlg_schemaname=$s.extend($s.window,{width:300,autoHeight:!0,layout:"fit",padding:5,_confirm:function(){var e=this,t={pvalue:e.down("[name=toldvalue]").getValue(),nvalue:e.down("[name=tnewvalue]").getValue()};e.callback&&e.callback.execute(t),e.close()},initComponent:function(){$s.apply(this,{title:"Change schemaname",items:[{xtype:"panel",padding:10,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:"Schema name change",layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"toldvalue",fieldLabel:"Old name"},{xtype:"textfield",name:"tnewvalue",fieldLabel:"New name"}]}]}],buttons:["->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}]}),IG$.dlg_schemaname.superclass.initComponent.call(this)}});
IG$.dlg_select_ds||(IG$.dlg_select_ds=$s.extend($s.window,{width:500,height:520,layout:"fit",padding:5,_init:function(){var t=new IG$._rpc$;t.init(this,{ack:"userdb",payload:{address:"/Connections",option:"list"},mbody:{}},this,function(t){var e,n=t.children,i=this.down("[name=dsource]"),s=[];if(n&&n.length)for(e=0;e<n.length;e++)(1==this.sel_mode||n[e].attributes&&"T"==n[e].attributes.attrb1)&&s.push(n[e]);i.store.loadData(s)},!1),t.send()},_confirm:function(t){var e=this,n=e.down("[name=dsource]"),i=t?null:n.getSelectionModel().selected;t?(e.callback&&e.callback.execute(t),e.close()):i&&i.length?(e.callback&&e.callback.execute(i.items[0]),e.close()):IG$.ShowError("Select datasource to continue!",e)},initComponent:function(){$s.apply(this,{title:"Select DataSource",items:[{xtype:"panel",padding:10,layout:{type:"vbox",align:"stretch"},items:[{xtype:"gridpanel",name:"dsource",flex:1,selType:"checkboxmodel",selModel:{mode:"SINGLE"},store:{fields:[]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",tdCls:"igc-td-link"},{text:IRm$.r1("B_DESC"),dataIndex:"description"}],listeners:{cellclick:function(t,e,n,i,e,s,l){1==n&&this._confirm(i)},scope:this}}]}],buttons:["->",{xtype:"button",text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{xtype:"button",text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(t){t._init()}}}),IG$.dlg_select_ds.superclass.initComponent.call(this)}}));
IG$.relationMgr=$s.extend($s.window,{modal:!0,closable:!1,resizable:!0,layout:"fit",width:600,autoHeight:!0,layout:{type:"fit"},bodyPadding:0,loadRelation:function(s,d){var e=this,t=new IG$._rpc$;t.init(e,{ack:"helpcontent",payload:{uid:s||e.uid},mbody:{option:"relations",isdown:e.isdown?"T":"F",detail:"info"}},e,function(e){var t,n,i=this.down("[name="+(d||"grd_rel")+"]"),l=e&&e.children?e.children:[],a=this.down("[name=txtrel]"),o=[];for(s||a.setValue("Relations : "+e.name+"("+e.nodepath+")"),t=0;t<l.length;t++)(n=l[t]).iconcls=IG$.get_metatype_icon(n.type.toLowerCase(),n),o.push(n);i.store.loadData(o)},!1),t.send()},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_Resources"),items:[{xtype:"panel",bodyPadding:10,minHeight:500,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",name:"txtrel",value:"Relations"},{xtype:"gridpanel",name:"grd_rel",flex:1,store:{xtype:"store",fields:["name","nodepath","uid","type","iconcls"]},columns:[{xtype:"templatecolumn",text:IRm$.r1("B_NAME"),menuDisabled:!0,flex:1,minWidth:160,tdCls:"ig-navi-namecol",tpl:"<div class='ig-navi-itemicon {iconcls}'></div><span title='{name} ({type})'>{name}</span>"},{text:"Location",flex:1,minWidth:200,dataIndex:"nodepath"}],listeners:{cellclick:function(e,t,n,i,l,a,o,s){var d=this.down("[name=png_rel_sub]"),p=i.get("uid");0==n&&(d.show(),this.loadRelation(p,"grd_rel_sub"))},scope:this}},{xtype:"panel",name:"png_rel_sub",flex:1,hidden:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:"Sub relations"},{xtype:"gridpanel",flex:1,name:"grd_rel_sub",store:{xtype:"store",fields:["name","nodepath","uid","type","iconcls"]},columns:[{xtype:"templatecolumn",text:IRm$.r1("B_NAME"),menuDisabled:!0,flex:1,minWidth:160,tdCls:"ig-navi-namecol",tpl:"<div class='ig-navi-itemicon {iconcls}'></div><span title='{name} ({type})'>{name}</span>"},{text:"Location",flex:1,minWidth:200,dataIndex:"nodepath"}]}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this.close()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]}),IG$.relationMgr.superclass.initComponent.call(this)},listeners:{afterrender:function(e){e.loadRelation()}}});
IG$.measureEditor=$s.extend($s.window,{modal:!1,isWindow:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:500,height:530,reportoption:null,callback:null,init_f:function(){var t=this,e=t.dmode,a=new IG$._rpc$;t.down("[name=expressiontype]").setValue("([field])"),e?(t.dmode_cnt.meta_type="measure",t.rs_procLoadContent({content:t.dmode_cnt})):t.uid?(a.init(t,{ack:"content",payload:{uid:t.uid},mbody:{option:"diagnostics"}},t,t.rs_procLoadContent,null),a.send()):t.parentuid&&(a.init(t,{ack:"helpcontent",payload:{uid:t.uid},mbody:{option:"cube_style_info"}},t,function(e){t.rs_procLoadContent({content:{cubeinfo:e,meta_type:"measure"}})},null),a.send())},expressionChange:function(e,t,a){t&&this.down("[name=expression]").setValue(t)},rs_procLoadContent:function(e){e&&(this.clItem=e.content);var t,a,n,i,l,o=this,s=o.clItem,r=[],d=o.down("[name=optstyle]");if(s.rel_items=s.rel_items||[],o.down("[name=itemname]").setValue(s.name),o.down("[name=description]").setValue(s.description),a=s.nodepath?s.nodepath.split("/"):null)for(t=0;t<s.rel_items.length;t++)if(n=(n=s.rel_items[t].nodepath)?n.split("/"):null){for(i=n.length-1;0<=i;i--)n[i]==a[i]&&n.splice(i,1);s.rel_items[t].cpath=n.join("/")}r.push({disp:"--- select ---",name:""}),s.cubeinfo||(l=s.cubeinfo={app_style:{default_styles:[],custom_styles:[]}}),l=s.cubeinfo,delete s.cubeinfo,o.styles=r,$.each([{arr:l.app_style.default_styles,n:"appbase"},{arr:l.app_style.custom_styles,n:"appcustom"},{arr:l.cube_style?l.cube_style.custom_styles:null,n:"cubecustom"}],function(e,t){var a,n,i=t.arr;if(i)for(a=0;a<i.length;a++)n=i[a],r.push({disp:n.name,name:n.name,type:t.n})}),d.store.loadData(r),d.setValue(s.itemstyle||""),o.datagrid.store.loadData(s.rel_items),o.down("[name=expression]").setValue(s.expression),o.down("[name=mfilter]").setValue(s.measure_filter);var c=o.down("[name=expressiontype]");o.clItem.expressiontype="COUNT"==s.expressiontype?"COUNT_DISTINCT":s.expressiontype,c.setValue(s.expressiontype),c.on("change",o.expressionChange,o),o.down("[name=calcmode]").setValue(s.calcmode),IG$.r___.registerTooltip(o.down("[name=calcmode]"),"calcmode"),o.dmode||o.getParentCube()},getParentCube:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"helpcontent",payload:{uid:e.uid||e.parentuid,parenttype:"Bobject",read:"F"},mbody:{option:"parentcontent"}},e,e.rs_getParentcube,null),t.send()},rs_getParentcube:function(e){var t=e&&e.length?e[0]:null;t&&(this.cubeuid=t.uid,this.cubepath=t.nodepath)},_confirm:function(){var e,t,a,n,i,l=this,o=l.down("[name=datagrid]"),s=l.clItem;if(IG$.checkFields(l,["itemname"])){for(s.name=l.down("[name=itemname]").getValue(),s.description=l.down("[name=description]").getValue(),e=l.down("[name=expression]").getValue(),s.expression=e,e=(n=l.down("[name=expressiontype]")).getValue(),i=0;i<n.store.data.items.length;i++)if(n.store.data.items[i].data.value==e){s.expressiontype=n.store.data.items[i].data.name;break}for(s.measure_filter=l.down("[name=mfilter]").getValue(),s.rel_items=[],i=0;i<o.store.data.items.length;i++)t={uid:(a=o.store.data.items[i].data).uid,name:a.name,nodepath:a.nodepath,memo:a.memo,type:a.type},s.rel_items.push(t);if(s.calcmode=l.down("[name=calcmode]").getValue(),s.itemstyle=l.down("[name=optstyle]").getValue(),l.dmode)l.closedlg({meta:meta,citem:s});else{var r=new IG$._rpc$;r.init(l,{ack:"writecontent",payload:{uid:l.uid,pid:l.parentuid,name:s.name,description:s.description,type:l.itemtype,nodepath:l.parentnodepath?l.parentnodepath+"/"+s.name:null},mbody:s,meta_type:"measure"},l,l.rs_saveContent,null,null),r.send()}}},rs_saveContent:function(e){this.closedlg()},closedlg:function(e){var t=this;t.callback&&t.callback.execute(e),t.close()},editorItemName:function(e){var t,a,n=this.down("[name=expression]"),i=n.inputEl.dom,l=n.getRawValue(),o=-1,s=-1;if(e="["+e+"]",0<l.length){var r=-1,d=-1;if(0==(t=$(i).getSelection()).length){for(a=t.start;0<=a;a--){if("["==l.charAt(a)){r=a;break}if("]"==l.charAt(a)||")"==l.charAt(a)||"("==l.charAt(a))break}if(-1<r)for(a=t.end;a<l.length;a++){if("]"==l.charAt(a)){d=a+1;break}if("["==l.charAt(a)||")"==l.charAt(a)||"("==l.charAt(a))break}}else-1<t.start-1&&t.end<l.length&&"["==l.charAt(t.start-1)&&"]"==l.charAt(t.end)&&(t.start-=1,t.end+=1);-1!=r&&-1!=d||(r=t.start,d=t.end),l=l.substring(0,r)+e+l.substring(d,l.length),s=(o=r)+e.length}else o=0,s=(l=e).length;n.setValue(l),-1<o&&o<s&&n.selectText(o,s)},selectItem:function(e){var t=new IG$.metaSelectDlg({visibleItems:"userdb;table;inlineview;folder;metric;custommetric;measure",multiselect:!0,tree_options:{cubebrowse:!0,rootuid:this.cubeuid}});t.callback=new IG$.callBackObj(this,this.cubeSelectedHandler,e),IG$.checkLogin(this,t)},cubeSelectedHandler:function(e,t){var i=this;if("grid"==t){var l=i.down("[name=datagrid]"),a=[];a=e.length?e:[e],$.each(a,function(e,t){var a,n=!1;for(a=0;a<l.store.data.items.length;a++)if(l.store.data.items[a].get("uid")==t.uid){n=!0;break}0==n&&(i.cubepath?t.cpath=t.nodepath.replace(i.cubepath,""):t.cpath=t.nodepath,l.store.add(t))})}},initComponent:function(){this.title=IRm$.r1("T_MEASURE"),$s.apply(this,{defaults:{bodyStyle:"padding:0px"},items:[{xtype:"panel",layout:"fit",border:0,autoScroll:!0,defaults:{bodyPadding:5},items:[{xtype:"form",border:0,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME")},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC"),height:50}]},{xtype:"fieldset",title:IRm$.r1("L_SYNTAX"),flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{name:"expressiontype",fieldLabel:IRm$.r1("L_TYPE"),xtype:"combobox",labelAlign:"left",labelWidth:100,valueField:"value",displayField:"label",value:"",editable:!1,store:{xtype:"store",fields:["value","label","name"],data:[{label:"Custom",name:"CUSTOM",value:"([field])"},{label:"Distinct count",name:"COUNT_DISTINCT",value:"COUNT(DISTINCT [field])"},{label:"All count",name:"COUNT_ALL",value:"COUNT([field])"},{label:"Sum",name:"SUM",value:"SUM([field])"},{label:"Average",name:"AVERAGE",value:"AVG([field])"},{label:"Max",name:"MAX",value:"MAX([field])"},{label:"Min",name:"MIN",value:"MIN([field])"}]}},{name:"calcmode",boxLabel:"Calculate In Result",xtype:"checkbox",padding:"0 5 0"}]},{name:"expression",xtype:"textarea",fieldLabel:IRm$.r1("L_SYNTAX"),labelWidth:100},{name:"mfilter",xtype:"textarea",fieldLabel:IRm$.r1("L_M_FILTER"),labelWidth:100},{xtype:"gridpanel",name:"datagrid",store:{xtype:"store",fields:["name","type","delete","uid","nodepath","memo","cpath"]},stateful:!0,height:100,viewConfig:{plugins:[{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_",enableDrop:!0,enableDrag:!1}],listeners:{beforedrop:function(e,t,a,n,i,l){var o,s=!1,r=t.records&&0<t.records.length?t.records[0]:null;if(this==t.view?t.copy=!1:t.copy=!0,a?this.panel.store.indexOf(a):0,r&&"Metric"==r.data.type){for(o=0;o<this.store.data.items.length;o++)if(this.store.data.items[o].data.uid==r.data.uid){s=!0;break}0==s&&this.store.add(r.data)}return!1},drop:function(e,t,a,n,i){a&&a.get("name");return!1}}},columns:[{text:"Name",flex:1,sortable:!1,dataIndex:"name",required:!0},{text:"Type",flex:1,sortable:!1,dataIndex:"type"},{text:"Path",flex:1,sortable:!1,dataIndex:"cpath"},{xtype:"actioncolumn",width:30,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,a){e.store.getAt(t);e.store.removeAt(t)}}]}],listeners:{itemdblclick:function(e,t,a,n,i,l){this.editorItemName(t.data.name)},scope:this}},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",flex:1,value:IRm$.r1("L_ME_DISP1")},{xtype:"button",text:"Add",handler:function(){this.selectItem("grid")},scope:this}]}]},{xtype:"fieldset",title:IRm$.r1("L_STYLE_OPTION"),layout:"anchor",padding:"3 5",items:[{xtype:"combobox",name:"optstyle",fieldLabel:IRm$.r1("L_BASE_STYLE"),queryMode:"local",displayField:"disp",valueField:"name",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","type","disp"]}}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.datagrid=this.down("[name=datagrid]"),this.init_f()}}}),IG$.measureEditor.superclass.initComponent.apply(this,arguments)}});
IG$.HierarchyEditor=$s.extend($s.window,{modal:!1,isWindow:!0,region:"center",layout:{type:"fit",align:"stretch"},closable:!1,resizable:!1,width:500,height:450,reportoption:null,callback:null,init_f:function(){var e=this,t=e.dmode,i=new IG$._rpc$;e.down("[name=disptype]").setValue("single"),t?e.rs_procLoadContent():e.uid?(i.init(e,{ack:"content",payload:{uid:e.uid},mbody:{option:"diagnostics"}},e,e.rs_procLoadContent,null),i.send()):e.parentuid&&e.rs_procLoadContent({content:{}})},rs_procLoadContent:function(e){var t,i,n,a,o=this;if(e&&(citem=o.clItem=e.content),i=citem.nodepath?citem.nodepath.split("/"):null,citem.rel_items=citem.rel_items||[],o.down("[name=itemname]").setValue(citem.name),o.down("[name=description]").setValue(citem.description),i)for(t=0;t<citem.rel_items.length;t++)if(n=(n=citem.rel_items[t].nodepath)?n.split("/"):null){for(a=n.length-1;0<=a;a--)n[a]==i[a]&&n.splice(a,1);citem.rel_items[t].cpath=n.join("/")}o.datagrid.store.loadData(citem.rel_items),o.down("[name=disptype]").setValue(citem.display_type||"single"),o.dmode||o.getParentCube()},getParentCube:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"helpcontent",payload:{uid:e.uid||e.parentuid,parenttype:"Bobject",read:"F"},mbody:{option:"parentcontent"}},e,e.rs_getParentcube,null),t.send()},rs_getParentcube:function(e){var t=e&&e.length?e[0]:null;t&&(this.cubeuid=t.uid,this.cubepath=t.nodepath)},_confirm:function(){var e,t,i,n,a=this,o=a.clItem,d=a.down("[name=datagrid]");if(i=a.down("[name=disptype]"),o.display_type=i.getValue(),IG$.checkFields(a,["itemname"])){for(o.meta_type="hierarchy_dimension",o.name=a.down("[name=itemname]").getValue(),o.description=a.down("[name=description]").getValue(),o.rel_items=[],n=0;n<d.store.data.items.length;n++)e={uid:(t=d.store.data.items[n].data).uid,name:t.name,nodepath:t.nodepath,memo:t.memo,type:t.type},o.rel_items.push(e);if(a.dmode)a.closedlg({citem:o});else{var l=new IG$._rpc$;l.init(a,{ack:"writecontent",payload:{uid:a.uid,pid:a.parentuid,name:o.name,description:o.description,type:a.itemtype,nodepath:a.parentnodepath?a.parentnodepath+"/"+o.name:null},mbody:o,meta_type:"hierarchy_dimension"},a,a.rs_saveContent,null,null),l.send()}}},rs_saveContent:function(e){this.closedlg()},closedlg:function(e){var t=this;t.callback&&t.callback.execute(e),t.close()},selectItem:function(e){var t=this,i=new IG$.metaSelectDlg({visibleItems:"folder;metric;table;custommetric;dataset;measure",multiselect:1,tree_options:{cubebrowse:!0,rootuid:t.cubeuid},callback:new IG$.callBackObj(t,t.cubeSelectedHandler,e)});IG$.checkLogin(this,i)},cubeSelectedHandler:function(e,t){var o=this;"grid"==t&&$.each(e,function(e,t){var i,n=o.down("[name=datagrid]"),a=!1;for(i=0;i<n.store.data.items.length;i++)if(n.store.data.items[i].get("uid")==t.uid){a=!0;break}0==a&&(o.cubepath?t.cpath=t.nodepath.replace(o.cubepath,""):t.cpath=t.nodepath,n.store.add(t))})},moveGridSelection:function(e,t){var i=e.getSelectionModel().getSelection(),n=i&&i.length?i[0]:null;if(n){var a=e.getStore().indexOf(n);if(t<0){if(--a<0)return}else if(++a>=e.getStore().getCount())return;e.getStore().remove(n),n=e.getStore().insert(a,n),e.getSelectionModel().select(n,!0)}},initComponent:function(){this.title=IRm$.r1("T_HIERARCHY"),$s.apply(this,{defaults:{bodyStyle:"padding:0px"},items:[{xtype:"panel",layout:"fit",border:0,defaults:{bodyPadding:5},items:[{xtype:"form",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME")},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC"),height:50}]},{xtype:"fieldset",title:IRm$.r1("L_METRIC_ITEMS"),flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:"hbox",items:[{name:"disptype",fieldLabel:IRm$.r1("L_TYPE"),xtype:"combobox",labelAlign:"left",labelWidth:100,valueField:"value",displayField:"name",editable:!1,store:{xtype:"store",fields:["value","name"],data:[{name:"Compact Layout",value:"single"},{name:"Outline Layout",value:"multi"}]}}]}]},{xtype:"gridpanel",name:"datagrid",store:{xtype:"store",fields:["name","type","delete","uid","nodepath","memo","cpath"]},stateful:!0,flex:1,tbar:[{xtype:"toolbar",items:[{xtype:"button",text:"Up",handler:function(){var e=this.down("[name=datagrid]");this.moveGridSelection(e,-1)},scope:this},{xtype:"button",text:"Down",handler:function(){var e=this.down("[name=datagrid]");this.moveGridSelection(e,1)},scope:this}]}],viewConfig:{plugins:[{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_",enableDrop:!0,enableDrag:!1}],listeners:{beforedrop:function(e,t,i,n,a,o){var d,l=!1,r=t.records&&0<t.records.length?t.records[0]:null;if(this==t.view?t.copy=!1:t.copy=!0,i?this.panel.store.indexOf(i):0,r&&"Metric"==r.data.type){for(d=0;d<this.store.data.items.length;d++)if(this.store.data.items[d].data.uid==r.data.uid){l=!0;break}0==l&&this.store.add(r.data)}return!1},drop:function(e,t,i,n,a){i&&i.get("name");return!1}}},columns:[{text:"Name",flex:1,sortable:!1,dataIndex:"name"},{text:"Type",flex:1,sortable:!1,dataIndex:"type"},{text:"Path",flex:1,sortable:!1,dataIndex:"cpath"},{xtype:"actioncolumn",width:30,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,i){e.store.getAt(t);e.store.removeAt(t)}}]}],listeners:{itemdblclick:function(e,t,i,n,a,o){this.editorItemName(t.data.name)},scope:this}},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",flex:1,value:IRm$.r1("L_ME_DISP1")},{xtype:"button",text:"Add",handler:function(){this.selectItem("grid")},scope:this}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.datagrid=this.down("[name=datagrid]"),this.init_f()}}}),IG$.HierarchyEditor.superclass.initComponent.apply(this,arguments)}});
IG$.formulaEditor=$s.extend($s.window,{modal:!1,region:"center",isWindow:!0,layout:{type:"fit",align:"stretch"},closable:!0,resizable:!1,width:500,height:550,_confirm:function(){var e,t,n,a,i=this,o=i.clItem,s=this.down("[name=datagrid]");if(IG$.checkFields(i,["itemname"])){for(o.meta_type="formula_measure",o.name=i.down("[name=itemname]").getValue(),o.description=i.down("[name=description]").getValue(),e=i.down("[name=expression]").getValue(),o.expression=e,o.rel_items=[],a=0;a<s.store.data.items.length;a++)t={uid:(n=s.store.data.items[a].data).uid,name:n.name,nodepath:n.nodepath,memo:n.memo,type:n.type},o.rel_items.push(t);if(o.itemstyle=i.down("[name=optstyle]").getValue(),i.dmode)i.callback&&i.callback.execute(o),i.close();else{var r=new IG$._rpc$;r.init(i,{ack:"writecontent",payload:{uid:i.uid,pid:i.parentuid,name:o.name,description:o.description,type:i.itemtype,nodepath:i.parentnodepath?i.parentnodepath+"/"+o.name:null},mbody:o,meta_type:"formula_measure"},i,i.r_confirm,null),r.send()}}},r_confirm:function(e){this.callback&&this.callback.execute(),this.close()},selectItem:function(e){var t=new IG$.metaSelectDlg({visibleItems:"folder;metric;table;inlineview;measuregroupdimension;measure;formulameasure",tree_options:{cubebrowse:!0,rootuid:this.cubeuid}});t.callback=new IG$.callBackObj(this,this.cubeSelectedHandler,e),IG$.checkLogin(this,t)},cubeSelectedHandler:function(e,t){if("measure"==t){var n,a=this.down("[name=datagrid]"),i=!1;for(n=0;n<a.store.data.items.length;n++)if(a.store.data.items[n].get("uid")==e.uid){i=!0;break}0==i&&a.store.add(e)}},editorItemName:function(e){var t,n=this.down("[name=expression]"),a=n.inputEl.dom,i=n.getRawValue(),o=-1,s=-1;if(e="["+e+"]",0<i.length){var r=-1,l=-1;$(a).focus(),0==(t=$(a).getSelection()).length?(r=i.length,l=i.length):-1<t.start-1&&t.end<i.length&&"["==i[t.start-1]&&"]"==i[t.end]&&(t.start-=1,t.end+=1),-1!=r&&-1!=l||(r=t.start,l=t.end),i=i.substring(0,r)+e+i.substring(l,i.length),s=(o=r)+e.length}else o=0,s=(i=e).length;n.setValue(i),-1<o&&o<s&&n.selectText(o,s)},init_f:function(){var t=this,e=new IG$._rpc$;t.uid?(e.init(t,{ack:"content",payload:{uid:t.uid},mbody:{option:"diagnostics"}},t,t.rs_procLoadContent,null),e.send()):t.parentuid&&(e.init(t,{ack:"helpcontent",payload:{uid:t.parentuid},mbody:{option:"cube_style_info"}},t,function(e){t.rs_procLoadContent({content:{cubeinfo:e}})},null),e.send())},rs_procLoadContent:function(e){var t,n=this,a=n.down("[name=datagrid]"),i=n.down("[name=optstyle]"),o=[];t=n.clItem=e.content,n.down("[name=itemname]").setValue(t.name),n.down("[name=description]").setValue(t.description),t.rel_items=t.rel_items||[],a.store.loadData(t.rel_items),n.down("[name=expression]").setValue(t.expression),o.push({disp:"--- select ---",name:""}),cubeinfo=t.cubeinfo,delete t.cubeinfo,$.each([{arr:cubeinfo.app_style.default_styles,n:"appbase"},{arr:cubeinfo.app_style.custom_styles,n:"appcustom"},{arr:cubeinfo.cube_style?cubeinfo.cube_style.custom_styles:null,n:"cubecustom"}],function(e,t){var n,a,i=t.arr;if(i)for(n=0;n<i.length;n++)a=i[n],o.push({disp:a.name,name:a.name,type:t.n})}),i.store.loadData(o),i.setValue(t.itemstyle||""),n.getParentCube()},getParentCube:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"helpcontent",payload:{uid:e.uid||e.parentuid,parenttype:"Bobject",read:"F"},mbody:{option:"parentcontent"}},e,e.rs_getParentcube,null),t.send()},rs_getParentcube:function(e){var t=e&&e.length?e[0]:null;t&&(this.cubeuid=t.uid)},initComponent:function(){$s.apply(this,{title:IRm$.r1("T_FORMULA_MEASURE"),buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],items:[{xtype:"container",padding:5,bodyPadding:"5 5",autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:IRm$.r1("B_GENERAL"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:IRm$.r1("B_NAME"),required:!0},{xtype:"textarea",name:"description",fieldLabel:IRm$.r1("B_DESC")}]},{xtype:"fieldset",title:IRm$.r1("L_SYNTAX_FORMULA"),defaultType:"textfield",layout:{type:"vbox",align:"stretch"},defaults:{labelWidth:130},items:[{name:"expression",xtype:"textarea"}]},{xtype:"displayfield",value:IRm$.r1("L_FM_DISP1")},{xtype:"gridpanel",name:"datagrid",store:{fields:["name","type","delete","uid","nodepath","memo"]},stateful:!0,height:160,viewConfig:{stripeRows:!0,plugins:{ptype:"gridviewdragdrop",ddGroup:"_I$RD_G_"},listeners:{beforedrop:function(e,t,n,a,i){var o,s=!1,r=t.records&&0<t.records.length?t.records[0]:null;if(this==t.view?t.copy=!1:t.copy=!0,n?this.panel.store.indexOf(n):0,r&&("Measure"==r.data.type||"Metric"==r.data.type||"MeasureGroup"==r.data.type||"TabDimension"==r.data.type)){for(o=0;o<this.store.data.items.length;o++)if(this.store.data.items[o].data.uid==r.data.uid){s=!0;break}0==s&&this.store.add(r.data)}return!1},drop:function(e,t,n,a){n&&n.get("name");return!1}}},columns:[{text:IRm$.r1("B_NAME"),flex:1,sortable:!1,dataIndex:"name"},{text:IRm$.r1("B_TYPE"),flex:1,sortable:!1,dataIndex:"type"},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,n){var a=e.store;a.getAt(t);a.remove(a.data.items[t])}}]}],listeners:{itemdblclick:function(e,t,n,a,i,o){var s=t.data.name||"";s&&this.editorItemName(s)},scope:this}},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",flex:1,value:IRm$.r1("L_FM_DISP2")},{xtype:"button",text:"Add",handler:function(){this.selectItem("measure")},scope:this}]},{xtype:"fieldset",title:IRm$.r1("L_STYLE_OPTION"),layout:"anchor",padding:"3 5",items:[{xtype:"combobox",name:"optstyle",fieldLabel:IRm$.r1("L_BASE_STYLE"),queryMode:"local",displayField:"disp",valueField:"name",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","type","disp"]}}]}]}],listeners:{afterrender:function(){this.init_f()}}}),IG$.formulaEditor.superclass.initComponent.apply(this,arguments)}});
IG$.codeMappingPanel=$s.extend($s.panel,{region:"center",layout:"anchor",defaults:{anchor:"100%"},callback:null,pitem:null,_confirm:function(e){var l,t,a,d=this,i=d._sel_table,o=d.down("[name=cbfield]"),n=d.down("[name=cbcodefield]"),r=d.down("[name=cbsortfield]"),s=d.down("[name=viewmode]"),c=d.down("[name=rftb1]"),u=d.down("[name=rftxt1]"),m=d.down("[name=rftb2]"),f=d.down("[name=rftxt2]"),b=d.down("[name=rftb3]"),p=d.down("[name=rftxt3]"),y=d.down("[name=rftc1]"),h=d.down("[name=rftc2]"),x=d.down("[name=rftc3]"),w=o.getValue(),g=n.getValue(),v=r.getValue();tname=i?i.name:null,c=c.getValue(),m=m.getValue(),b=b.getValue(),l=c&&u.getValue()?c+"|"+u.getValue()+"|"+y.getValue():null,t=m&&f.getValue()?m+"|"+f.getValue()+"|"+h.getValue():null,a=b&&p.getValue()?b+"|"+p.getValue()+"|"+x.getValue():null,d.rec.set("edited",!0),d.rec.set("codetable",i?i.name:null),d.rec.set("codetableuid",i?i.uid:null),d.rec.set("codefield",g),d.rec.set("valuefield",w),d.rec.set("sortfield",v),d.rec.set("codefilter1",l),d.rec.set("codefilter2",t),d.rec.set("codefilter3",a),d.rec.set("viewmode",s.getValue()),d.pitem&&(d.pitem.edited=!0,$.each(["codetable","codetableuid","codefield","valuefield","sortfield","codefilter1","codefilter2","codefilter3","codemapping","viewmode"],function(e,l){d.pitem[l]=d.rec.get(l)}))},loadContent:function(){var e=this,l=e.datasource,t=new IG$._rpc$;l&&e.rec&&e.rec.codetableuid&&(t.init(e,{ack:"helpcontent",payload:{uid:e.rec.codetableuid},mbody:{option:"translate"}},e,function(e){var l=this;e&&e.length&&(l._sel_table=e[0],l.down("[name=cbtable]").setValue(l._sel_table.name),l.loadField())}),t.send())},loadField:function(){var e=this,l=new IG$._rpc$,t=e._sel_table;t&&(l.init(e,{ack:"content",payload:{uid:t.uid},mbody:{option:"folder"}},e,e.rs_loadField,null),l.send())},rs_loadField:function(e){var l,t,a,d,i,o,n,r,s,c,u,m,f,b,p=this,y=p.down("[name=cbfield]"),h=p.down("[name=cbcodefield]"),x=p.down("[name=cbsortfield]"),w=p.down("[name=viewmode]"),g=p.rec.get("codefield"),v=p.rec.get("valuefield"),F=p.rec.get("sortfield"),V=p.rec.get("viewmode"),_=[];if(a=e?e.children:null)for(l=0;l<a.length;l++)(d=a[l]).uid=d.uid||l,d.uid==g&&(i=d.uid),d.uid==v&&(o=d.uid),d.uid==F&&(n=d.uid),_.push(d);for(y.store.loadData(_,!1),h.store.loadData(_,!1),h.setValue(i),y.setValue(o),x.store.loadData(_,!1),x.setValue(n),w.setValue(V||""),p.down("[name=rftb1]").store.loadData(_,!1),p.down("[name=rftb2]").store.loadData(_,!1),p.down("[name=rftb3]").store.loadData(_,!1),l=1;l<4;l++)if((r=p.rec.get("codefilter"+l))&&(s=p.down("[name=rftb"+l+"]"),c=p.down("[name=rftxt"+l+"]"),m=p.down("[name=rftc"+l+"]"),-1<r.indexOf("|")))for(p.down("[name=rfilter"+l+"]").expand(),u=r.substring(0,r.indexOf("|")),b="1",-1<(f=r.substring(r.indexOf("|")+1)).indexOf("|")&&(b=f.substring(f.indexOf("|")+1),f=f.substring(0,f.indexOf("|"))),c.setValue(f),m.setValue(b),t=0;t<_.length;t++)if(_[t].nodepath==u){s.setValue(_[t].uid);break}},initComponent:function(){var t=[];$.each(IG$.filteropcodes,function(e,l){t.push({value:l.name,name:l.locale})}),$s.apply(this,{items:[{xtype:"fieldset",checkboxToggle:"cmap"!=this.d_m,title:IRm$.r1("L_LOOKUP"),collapsed:!1,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"fieldcontainer",fieldLabel:"Table",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"cbtable",readOnly:!0,flex:1},{xtype:"button",text:"..",handler:function(){if(this.datasource){var e=new IG$.metaSelectDlg({visibleItems:"folder;table;inlineview;dataset",targetobj:"inlineview;table;",tree_options:{cubebrowse:!0,rootuid:this.datasource},callback:new IG$.callBackObj(this,function(e){var l=e.type.toLowerCase();1==/(inlineview|table)/.test(l)&&(this.down("[name=cbtable]").setValue(e.name),this._sel_table=e,this.loadField())})});IG$.checkLogin(this,e)}},scope:this}]},{xtype:"combobox",name:"cbcodefield",queryMode:"local",fieldLabel:"Code Field",displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"cbfield",queryMode:"local",fieldLabel:"Value Field",displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"cbsortfield",queryMode:"local",fieldLabel:"Sort Field",displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}}]},{xtype:"fieldset",title:IRm$.r1("L_ADV_OPTION"),collapsed:!1,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"combobox",fieldLabel:"Data View",name:"viewmode",queryMode:"local",editable:!1,valueField:"value",displayField:"name",store:{xtype:"store",fields:["name","value"],data:[{name:"Matching Values",value:""},{name:"Show All Codes",value:"code"},{name:"Show All Values",value:"value"}]}}]},{xtype:"fieldset",name:"rfilter1",checkboxToggle:!0,title:"Range Filter 1st",collapsed:!0,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"combobox",name:"rftb1",fieldLabel:"Filter Field",queryMode:"local",displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"rftc1",fieldLabel:IRm$.r1("B_OP"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{fields:["name","value"],data:t}},{xtype:"textfield",name:"rftxt1",fieldLabel:"Filter Value"}],listeners:{collapse:function(e,l){this.down("[name=rftb1]").setValue(""),this.down("[name=rftxt1]").setValue("")}}},{xtype:"fieldset",name:"rfilter2",checkboxToggle:!0,title:"Range Filter 2nd",collapsed:!0,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"combobox",name:"rftb2",fieldLabel:"Filter Field",queryMode:"local",displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"rftc2",fieldLabel:IRm$.r1("B_OP"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{fields:["name","value"],data:t}},{xtype:"textfield",name:"rftxt2",fieldLabel:"Filter Value"}],listeners:{collapse:function(e,l){this.down("[name=rftb2]").setValue(""),this.down("[name=rftxt2]").setValue("")}}},{xtype:"fieldset",name:"rfilter3",checkboxToggle:!0,title:"Range Filter 3rd",collapsed:!0,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"combobox",name:"rftb3",fieldLabel:"Filter Field",queryMode:"local",displayField:"name",valueField:"uid",editable:!1,autoSelect:!0,store:{fields:["name","memo","uid","type","nodepath"]}},{xtype:"combobox",name:"rftc3",fieldLabel:IRm$.r1("B_OP"),queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{fields:["name","value"],data:t}},{xtype:"textfield",name:"rftxt3",fieldLabel:"Filter Value"}],listeners:{collapse:function(e,l){this.down("[name=rftb3]").setValue(""),this.down("[name=rftxt3]").setValue("")}}}]}),IG$.codeMappingPanel.superclass.initComponent.apply(this,arguments)}});
IG$.metricEditor=$s.extend($s.window,{modal:!0,region:"center",layout:{type:"fit",align:"stretch"},closable:!1,resizable:!0,width:480,height:520,callback:null,_confirm:function(){var e=this,t=e.item;if(t){var a,n=e.down("[name=cb_sortdir]").getGroupValue(),o=(e.down("[name=cb_sorttype]"),e.down("[name=cb_sorttype]").getGroupValue()),i=e.down("[name=optstyle]"),l=e.down("[name=optremoveblank]"),m=e.down("[name=isdatetype]"),s=e.down("[name=dateformat]"),d=e.down("[name=usegeocode]"),p=e.down("[name=fname]"),r=(IG$.majorDateformat,t.content),u=t.metric?t.metric.fields:null;if(!IG$.checkFields(e,["itemname"]))return;r.name=e.down("[name=itemname]").getValue(),r.description=e.down("[name=description]").getValue(),r.sortorder=""==n?null:n,r.sorttype=""==o?null:o,r.removeblank=l.getValue(),r.itemstyle=i.getValue(),r.isdatetype=1==m.getValue(),r.dateformat=s.getValue(),r.fieldname=p.getValue(),r.enable_geocode=1==d.getValue(),r.mask={type:e.down("[name=masktype]").getValue(),pattern:e.down("[name=mpattern]").getValue(),pattern_replace:e.down("[name=mpattern_rep]").getValue(),aes_pp:e.down("[name=aes_passph]").getValue()},u&&u.length&&p.getValue()&&(u[0].name=p.getValue(),a=(a=u[0].nodepath).substring(0,a.lastIndexOf("/"))+"/"+u[0].name,u[0].nodepath=a),r.dateitems="CUSTOM",r.datecustom=e.down("[name=t_dateformat]").getValue()}if(e.callback)e.callback.execute(t),e.close();else{var c=this,h=new IG$._rpc$,y=t.content;h.init(c,{ack:"writecontent",payload:{uid:c.uid,name:y.name,description:y.description},mbody:y,meta_type:"dimension"},c,c.rs_saveCnt,null),h.send()}},rs_saveCnt:function(e){this.close()},init_f:function(){var e=this;e.formulas=[],e.uid&&e.loadItemContent()},applyItemInfo:function(){var e,t,a=this,n=a.item.content,o=n.sortorder||"",i=a.down("[name=optsortdir]"),l=n.sorttype||"",m=a.down("[name=optsorttype]"),s=a.down("[name=optstyle]"),d=a.down("[name=optremoveblank]"),p=a.down("[name=optsortitemname]"),r=a.down("[name=optdispitemname]"),u=a.down("[name=optcommentitemname]"),c=a.down("[name=isdatetype]"),h=a.down("[name=dateformat]"),y=a.down("[name=usegeocode]"),f=a.down("[name=cmap_disp]"),x=a.down("[name=fname]"),b=a.down("[name=masktype]"),_=(IG$.majorDateformat,[]),g=n.geocode,w=[],V=n.mask||{};for(a.down("[name=itemname]").setValue(n.name),a.down("[name=description]").setValue(n.description),i.setValue({cb_sortdir:[o]}),m.setValue({cb_sorttype:[l]}),d.setValue(n.removeblank||!1),c.setValue(n.isdatetype||!1),h.setValue(n.dateformat||""),y.setValue(n.geocode_enable),f.setValue(n.cmap_disp||""),a.down("[name=tname]").setValue(n.tablename),x.setValue(n.fieldname),b.setValue(V.type),a.down("[name=geolat]").setValue(g&&g.geolat?g.geolat.name:null),a.down("[name=geolng]").setValue(g&&g.geolnt?g.geolng.name:null),n.opt_sort_item&&p.setValue(n.opt_sort_item.name),n.opt_disp_item&&r.setValue(n.opt_disp_item.name),n.opt_comment_item&&u.setValue(n.opt_comment_item.name),a.down("[name=mpattern]").setValue(V.pattern),a.down("[name=mpattern_rep]").setValue(V.pattern_replace),a.down("[name=aes_passph]").setValue(V.aes_pp),_.push({disp:"--- select ---",name:"",type:""}),a.styles=w,t=n.cubeinfo,delete n.cubeinfo,$.each([{arr:t.app_style.default_styles,n:"appbase"},{arr:t.app_style.custom_styles,n:"appcustom"},{arr:t.cube_style?t.cube_style.custom_styles:null,n:"cubecustom"}],function(e,t){var a,n,o=t.arr;if(o)for(a=0;a<o.length;a++)n=o[a],w.push({name:n.name,type:t.n})}),e=0;e<w.length;e++)_.push({disp:w[e].name,name:w[e].name,type:w[e].type});s.store.loadData(_),s.setValue(n.itemstyle||""),a.down("[name=t_dateformat]").setValue(n.datecustom||"")},loadItemContent:function(){var e;(e=new IG$._rpc$).init(this,{ack:"content",payload:{uid:this.uid},mbody:{option:"diagnostics"}},this,this.rs_loadItemContent,!1),e.send()},rs_loadItemContent:function(e){this.item=e,this.applyItemInfo(),this.getMeasures()},getMeasures:function(){var e,t=this.down("[name=grd_measures]");(e=new IG$._rpc$).init(this,{ack:"content",payload:{uid:this.uid},mbody:{option:"folder"}},this,function(e){t.store.loadData(e.children)},!1),e.send()},changeDateFormat:function(){this.down("[name=dateformat]").setValue("")},cubeSelectedHandler:function(e){var t=this,a=new IG$.metaSelectDlg({visibleItems:"codemap"==e?"folder;codemap":"folder;table;metric;inlineview;measure",tree_options:{cubebrowse:!0,rootuid:"codemap"==e?"/SYS_Lookup":t.item.content.cubeuid||t.cubeuid},callback:new IG$.callBackObj(t,t.rs_cubeSelectedHandler,e)});IG$.checkLogin(t,a)},rs_cubeSelectedHandler:function(e,t){var a=this,n=a.item.content;"codemap"==t?(n.cmap_uid=e.uid,n.cmap_disp=e.name,a.down("[name=cmap_disp]").setValue(e.name)):"optsortitemname"==t?(n.opt_sort_item={uid:e.uid,name:e.name},a.down("[name=optsortitemname]").setValue(e.name)):"optdispitemname"==t?(n.opt_disp_item={uid:e.uid,name:e.name},a.down("[name=optdispitemname]").setValue(e.name)):"optcommentitemname"==t?(n.opt_comment_item={uid:e.uid,name:e.name},a.down("[name=optcommentitemname]").setValue(e.name)):"geolat"==t?(n.geolat={uid:e.uid,name:e.name},a.down("[name=geolat]").setValue(e.name)):"geolng"==t&&(n.geolng={uid:e.uid,name:e.name},a.down("[name=geolng]").setValue(e.name))},edit_customfield:function(e){var t=IG$.mainPanel,a=e.get("type").toLowerCase();t&&e.get("writable")&&t.navigateApp.call(t,e.get("uid"),a,e.get("name"),e.get("nodepath"),!0,e.get("writable"))},initComponent:function(){var e,t=this,a=[],n=t.styles,o=[{text:"Email",handler:function(){var e=this.down("[name=mpattern]"),t=this.down("[name=mpattern_rep]");e.setValue("(^[^@]{3}|(?!^)\\G)[^@]"),t.setValue("$1*")},scope:this}],i=ig$.patterns;if(i&&$.each(i,function(e,a){pitems.push({text:a.name,handler:function(){var e=this.down("[name=mpattern]"),t=this.down("[name=mpattern_rep]");e.setValue(a.value),a.replace&&t.setValue(a.replace)},scope:this})}),t.title=IRm$.r1("T_METRIC_SETTING"),a.push({name:"-Item Default-",value:""}),n&&0<n.length)for(e=0;e<n.length;e++)a.push({name:n[e].name,value:n[e].name});$s.apply(t,{padding:5,border:0,items:[{xtype:"panel",layout:"fit",padding:"5 5",items:[{xtype:"tabpanel",items:[{xtype:"panel",layout:"anchor",autoScroll:!0,bodyPadding:"5 5",title:"General Options",defaults:{anchor:"100%"},items:[{xtype:"textfield",name:"itemname",_fasl:1,fieldLabel:"Name"},{xtype:"textarea",name:"description",fieldLabel:"Description"},{xtype:"fieldset",title:IRm$.r1("L_SORT_SEL"),layout:"anchor",padding:"0 5",defaults:{anchor:"100%"},items:[{xtype:"radiogroup",name:"optsortdir",fieldLabel:IRm$.r1("L_SORT_ORD"),padding:"0 5",plain:!0,items:[{boxLabel:IRm$.r1("B_DEFAULT"),name:"cb_sortdir",inputValue:"",checked:!0},{boxLabel:IRm$.r1("B_ASC"),name:"cb_sortdir",inputValue:"asc"},{boxLabel:IRm$.r1("B_DSC"),name:"cb_sortdir",inputValue:"desc"}]},{xtype:"radiogroup",name:"optsorttype",fieldLabel:IRm$.r1("L_SORT_TP"),padding:"0 5",plain:!0,items:[{boxLabel:IRm$.r1("B_DEFAULT"),name:"cb_sorttype",inputValue:"",checked:!0},{boxLabel:IRm$.r1("B_STRING"),name:"cb_sorttype",inputValue:"VARCHAR"},{boxLabel:IRm$.r1("B_NUMERIC"),name:"cb_sorttype",inputValue:"NUMBER"}]},{xtype:"fieldcontainer",name:"optdispitem",fieldLabel:IRm$.r1("L_F_DISP"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"optdispitemname",flex:1},{xtype:"button",text:"..",handler:function(){this.cubeSelectedHandler("optdispitemname")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){this.optdispitemname=null,this.optdispitemuid=null,this.down("[name=optdispitemname]").setValue("")},scope:this}]},{xtype:"fieldcontainer",name:"optsortitem",fieldLabel:IRm$.r1("L_F_SORT"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"optsortitemname",flex:1},{xtype:"button",text:"..",handler:function(){this.cubeSelectedHandler("optsortitemname")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){this.optsortitemname=null,this.optsortitemuid=null,this.down("[name=optsortitemname]").setValue("")},scope:this}]},{xtype:"fieldcontainer",name:"optcommentitem",fieldLabel:IRm$.r1("L_F_COMMENT"),layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"optcommentitemname",flex:1},{xtype:"button",text:"..",handler:function(){this.cubeSelectedHandler("optcommentitemname")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){this.optdispitemname=null,this.optdispitemuid=null,this.down("[name=optcommentitemname]").setValue("")},scope:this}]}]},{xtype:"fieldset",title:IRm$.r1("L_STYLE_OPTION"),layout:"anchor",padding:"3 5",items:[{xtype:"combobox",name:"optstyle",fieldLabel:IRm$.r1("L_BASE_STYLE"),queryMode:"local",displayField:"disp",valueField:"name",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","type","disp"]}}]},{xtype:"fieldset",title:IRm$.r1("L_OTHER_OPTION"),layout:"anchor",padding:"3 5",defaults:{anchor:"100%"},items:[{xtype:"checkbox",name:"optremoveblank",boxLabel:IRm$.r1("L_REM_BLK")},{xtype:"checkbox",name:"isdatetype",boxLabel:IRm$.r1("L_DATE_TYPE"),listeners:{change:function(e,t,a,n){var o=e.getValue(),i=this.down("[name=t_format]"),l=this.down("[name=d_format]");this.down("[name=customdatetypecontainer]");i.setVisible(o),l.setVisible(o)},scope:this}},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATE_FORMAT_SRC"),name:"d_format",labelWidth:130,hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"dateformat",flex:1},{xtype:"button",text:"Example",menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){t.down("[name=dateformat]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){t.down("[name=dateformat]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){t.down("[name=dateformat]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){t.down("[name=dateformat]").setValue(this.value)}}]}}]},{xtype:"fieldcontainer",fieldLabel:IRm$.r1("L_DATE_FORMAT_TGT"),name:"t_format",labelWidth:130,hidden:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",name:"t_dateformat",flex:1},{xtype:"button",text:"Example",menu:{items:[{text:"2001.07.04 AM 12:08:56",value:"yyyy.MM.dd a HH:mm:ss",handler:function(){t.down("[name=t_dateformat]").setValue(this.value)}},{text:"2001-07-04 AM 12:08:56",value:"yyyy-MM-dd a HH:mm:ss",handler:function(){t.down("[name=t_dateformat]").setValue(this.value)}},{text:"Wed, Jul 4, '01",value:"EEE, MMM d, ''yy",handler:function(){t.down("[name=t_dateformat]").setValue(this.value)}},{text:"20010704120856",value:"yyyyMMddHHmmss",handler:function(){t.down("[name=t_dateformat]").setValue(this.value)}}]}}]}]},{xtype:"fieldset",title:IRm$.r1("L_CODE_FIELD"),layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:IRm$.r1("L_CODE_FIELD"),items:[{xtype:"textfield",name:"cmap_disp",readOnly:!0,flex:1},{xtype:"button",text:"..",handler:function(){this.cubeSelectedHandler("codemap")},scope:this},{xtype:"button",text:IRm$.r1("B_CLEAR"),handler:function(){var e=this.item.content;this.down("[name=cmap_disp]").setValue(null),e.cmap_disp=null,e.cmap_uid=null},scope:this}]}]}]},{xtype:"panel",title:"Advanced Options",layout:"anchor",bodyPadding:"5 5",autoScroll:!0,defaults:{anchor:"100%"},items:[{xtype:"textfield",fieldLabel:"Table name",name:"tname",readOnly:!0},{xtype:"textfield",fieldLabel:"Field name",name:"fname"},{xtype:"fieldset",title:"Mask Text",layout:"anchor",items:[{xtype:"combobox",name:"masktype",fieldLabel:"Mask type",queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"],data:[{name:"No Mask",value:""},{name:"RegExp Pattern",value:"pattern"},{name:"Base64 Encoding",value:"base64"},{name:"SHA-1",value:"sha1"},{name:"AES",value:"aes"}]},listeners:{change:function(e){var t=e.getValue(),a=this.down("[name=pb1]"),n=this.down("[name=mpattern_rep]"),o=this.down("[name=aes_passph]");a["pattern"==t?"show":"hide"](),n["pattern"==t?"show":"hide"](),o["aes"==t?"show":"hide"]()},scope:this}},{xtype:"fieldcontainer",fieldLabel:"Mask Pattern",hidden:!0,name:"pb1",layout:"hbox",items:[{xtype:"textfield",name:"mpattern"},{xtype:"button",text:"Example",menu:{xtype:"menu",items:o}}]},{xtype:"textfield",name:"mpattern_rep",hidden:!0,fieldLabel:"Replace With"},{xtype:"textfield",name:"aes_passph",hidden:!0,fieldLabel:"AES Pass Phrase (For decryption)"}]},{xtype:"fieldset",title:"Measures",layout:"anchor",items:[{xtype:"gridpanel",height:160,name:"grd_measures",tbar:[{text:"Refresh",handler:function(){this.getMeasures()},scope:this},"->",{text:"Add Formula",handler:function(){var e=this,t=new IG$.multiMeasure({uid:e.uid,mitem:e.item,vmode:2,callback:new IG$.callBackObj(e,e.getMeasures)});IG$.checkLogin(e,t)},scope:this},{text:"Custom Formula",handler:function(){},scope:this}],store:{fields:["name"]},columns:[{text:"Name",width:220,dataIndex:"name"},{text:"Formula",flex:1},{xtype:"actioncolumn",width:80,items:[{iconCls:"icon-grid-config",handler:function(e,t,a,n){this.edit_customfield(n)},scope:this},{iconCls:"icon-grid-delete",handler:function(a,e,t,n){if(n.get("uid")){var o=this;IG$.confirmMessages(ig$.appname,"Confirm to delete content?",function(e){if("yes"==e){var t=new IG$._rpc$;t.init(o,{ack:"deletecontent",payload:{uid:n.get("uid")},mbody:{}},o,function(e){a.store.remove(n)}),t.send()}},o,o)}},scope:this}]}]}]},{xtype:"fieldset",title:"Geo Code",layout:"anchor",items:[{xtype:"checkbox",fieldLabel:"Use geocode",name:"usegeocode",boxLabel:"Enable"},{xtype:"fieldcontainer",fieldLabel:"Latitude",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,name:"geolat"},{xtype:"button",text:"..",handler:function(){this.cubeSelectedHandler("geolat")},scope:this}]},{xtype:"fieldcontainer",fieldLabel:"Longitude",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",flex:1,name:"geolng"},{xtype:"button",text:"..",handler:function(){this.cubeSelectedHandler("geolng")},scope:this}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"fieldcontainer",flex:1},{xtype:"button",text:"GeoMapping",handler:function(){var e=new IG$.geoMapping({uid:this.uid});IG$.checkLogin(this,e)},scope:this}]}]}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){this.init_f()}}}),IG$.metricEditor.superclass.initComponent.apply(this,arguments)}});
IG$.geoMapping=$s.extend($s.window,{title:"Geo Mapping",modal:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:500,autoHeight:!0,callback:null,_confirm:function(){this.callback&&this.callback.execute([]),this.close()},in$t:function(){var e=this.down("[name=georeqtype]");ig$.geo_encoding&&0<ig$.geo_encoding.length&&e.store.loadData(ig$.geo_encoding),this.getValueList()},getValueList:function(){if(this.uid){var e,t=this,o=new IG$._rpc$;e={uid:this.uid,option:"valuelist"},o.init(t,{ack:"olapservice",payload:e,mbody:{}},t,t.rs_getValueList,null),o.send()}},rs_getValueList:function(e){var t=this.uid,o=new IG$._ICd(e,t),a=this.down("[name=grd_data]");this.pool=o.pool,a.store.loadData(o.data)},geoEncode:function(){var e=this.down("[name=georeqtype]").getValue();if(e){var t,o,a,i,n=this,l=new IG$._rpc$,d=this.down("[name=grd_data]");for(o={uid:this.uid,action:"geoencode",georeqtype:e},t={items:[]},a=0;a<d.store.data.items.length;a++)(i=d.store.data.items[a]).get("lat")&&i.get("lng")||t.items.push({code:i.get("code")});l.init(n,{ack:"geoservice",payload:o,mbody:t},n,n.rs_geoEncode,null),l.send()}},rs_geoEncode:function(e){var t,o,a,i,n,l,d=this.down("[name=georeqtype]").getValue(),s=IG$.XGetNode(e,"/smsg/results"),r=s?IG$.XGetChildNodes(s):null,c=this.down("[name=grd_data]"),g={};if(r){if(n=IG$.geocoder&&IG$.geocoder[d]?IG$.geocoder[d]:null)for(t=0;t<r.length;t++)o=IG$._I19(r[t],"code"),o=IG$.XGetTextVal(o),i=IG$._I19(r[t],"result"),i=IG$.XGetTextVal(i),i=Base64.decode(i),(l=n.getGeoCode(i)).lat&&l.lng&&(g[o]=l);for(t=0;t<c.store.data.items.length;t++)(l=g[(a=c.store.data.items[t]).get("code")])&&(a.set("lat",l.lat),a.set("lng",l.lng))}},updateGeoData:function(){var e=this,t=e.down("[name=geosql]").getValue();if(e.uid&&t&&e.pool){var o,a,i,n=this,l="",d=new IG$._rpc$,s=e.down("[name=grd_data]");for(o={uid:this.uid,action:"geoupdate",pool:this.pool},l={sql:t,items:[]},a=0;a<s.store.data.items.length;a++)(i=s.store.data.items[a]).get("lat")&&i.get("lng")&&l.items.push({lat:i.get("lat"),lng:i.get("lng"),code:i.get("code")});d.init(n,{ack:"geoservice",payload:o,mbody:l},n,n.rs_geoEncode,null),d.send()}},rs_updateGeoData:function(e){},initComponent:function(){$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"displayfield",value:"Address to geo axis values"},{xtype:"gridpanel",name:"grd_data",height:250,store:{xtype:"store",fields:["code","lat","lng"]},plugins:[{ptype:"cellediting",clicksToEdit:!1}],columns:[{xtype:"gridcolumn",text:"Address",dataIndex:"code",flex:1},{xtype:"gridcolumn",text:"Latitude",dataIndex:"lat",editor:{allowBlank:!1}},{xtype:"gridcolumn",text:"Longitude",dataIndex:"lng",editor:{allowBlank:!1}}]},{xtype:"fieldset",title:"Get GeoEncode",layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"combobox",fieldLabel:"Geo Request Type",flex:1,name:"georeqtype",queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,store:{xtype:"store",fields:["name","value"]}},{xtype:"button",text:"Update GeoCode",handler:function(){this.geoEncode()},scope:this}]},{xtype:"textarea",name:"geosql",fieldLabel:"Apply Database"},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"fieldcontainer",flex:1},{xtype:"button",text:"Run SQL",handler:function(){this.updateGeoData()},scope:this}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.in$t()}}}),IG$.geoMapping.superclass.initComponent.apply(this,arguments)}});
IG$.cubeStyle=$s.extend($s.window,{modal:!0,layout:"border",closable:!1,resizable:!0,width:720,height:500,reportoption:null,callback:null,globalstyle:null,globalstylemap:null,styleinfo:null,loadGlobalStyle:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"appoption",payload:{address:"ReportStyle"},mbody:{}},e,e.rs_loadGlobalStyle,null),t.send()},rs_loadGlobalStyle:function(e){var t,l,a,o,n,s=e.themes[0],i=[{name:"Select Item",value:""}],d=(ig$.theme_id,["default_styles","custom_styles"]);if(this.globalstyle=[],this.globalstylemap={},s){for(o=0;o<d.length;o++)if(t=s[a=d[o]])for(n=0;n<t.length;n++)l=t[n],this.globalstyle.push(l),i.push({name:l.name,value:l.name}),this.globalstylemap[l.name]=l;for(a in this.globalstylemap)(l=this.globalstylemap[a]).basestylename&&this.globalstylemap[l.basestylename]&&this.globalstylemap[l.basestylename]}this.down("[name=base_style]").store.loadData(i),this.loadLocalStyle()},loadLocalStyle:function(){var e,t,l,a,o=this,n=o.down("[name=stylelist]"),s=[];if(o.down("[name=c_cset]").setValue(o.c_cset||""),o.styleinfo){for(a={name:"LocalStyle",leaf:!1,children:[]},s.push(a),e=0;e<o.styleinfo.length;e++)l={name:(t=o.styleinfo[e]).name,leaf:!0,custom:!1},t.basestylename&&o.globalstylemap[t.basestylename]&&o.globalstylemap[t.basestylename],a.children.push(l);n.store.setRootNode({expanded:!0,text:"Style",name:"Style",title:"Style",children:s})}},editStyleItem:function(e){var t,l=this,a=l.down("[name=form_header]"),o=l.down("[name=form_data]");for(l.commitStyleItem(),t=0;t<l.styleinfo.length;t++)if(l.styleinfo[t].name==e){l._edtItem=l.styleinfo[t],l._valForm=1,l.down("[name=sname]").setValue(l.styleinfo[t].name),l.down("[name=base_style]").setValue(l.styleinfo[t].basestylename||""),a.loadStyleData.call(a,l.styleinfo[t].header),o.loadStyleData.call(o,l.styleinfo[t].data),l._valForm=0;break}},commitStyleItem:function(){var e=this,t=e.down("[name=form_header]"),l=e.down("[name=form_data]"),a=e.down("[name=sname]").getValue();nvalue=e.down("[name=base_style]").getValue(),e._edtItem&&nvalue&&a&&(e._edtItem.basestylename=nvalue,e._edtItem.name=a,l.updateStyleData.call(l),t.updateStyleData.call(t))},_confirm:function(){var e,t,l=this;for(l.commitStyleItem(),e=0;e<l.styleinfo.length;e++)(t=l.styleinfo[e]).basestylename&&l.globalstylemap[t.basestylename]&&l.globalstylemap[t.basestylename];l.c_cset=l.down("[name=c_cset]").getValue(),l.callback&&l.callback.execute(l),l.close()},toolbarHandler:function(e){var t=this;switch(e){case"cmd_add_custom":var l=new IG$.makeStyle({styleinfo:this.globalstyle,callback:new IG$.callBackObj(this,this.rs__appendCustomStyle)});IG$.checkLogin(this,l);break;case"cmd_delete":var a,o=this.down("[name=stylelist]").getSelectionModel().selected,n=o&&0<o.length?o.items[0]:null;if(n)for(a=0;a<t.styleinfo.length;a++)if(n.get("name")==t.styleinfo[a].name){t.styleinfo.splice(a,1),n.remove();break}}},rs__appendCustomStyle:function(e){var t=e[0],l=e[1];if(l&&t&&this.globalstylemap[l]){var a,o,n,s=this.down("[name=stylelist]"),i=s.store.getRootNode();n=i.childNodes[i.childNodes.length-1],o={name:t,leaf:!0,custom:!0},(a={}).name=t,a.nodename="ItemStyle",a.basestylename=l,a.header={},a.data={},this.styleinfo.push(a);var d=[s.store._record(o)];s.store._appendNode(d,n)}},initComponent:function(){var e,s=this,t=new IG$.styleEditor({title:IRm$.r1("L_STYLE_TITLE"),name:"form_header",htype:"hd"}),l=new IG$.styleEditor({title:IRm$.r1("L_STYLE_DATA"),name:"form_data",htype:"dt"}),a=[{name:"Default",value:""}],o=IG$.__chartoption.chartcolors;for(e in o)a.push({name:e,value:e});s.title=IRm$.r1("T_STYLE_WIZARD"),$s.apply(this,{defaults:{bodyStyle:"padding:3px"},items:[{xtype:"treepanel",title:"Style",name:"stylelist",preventHeader:!0,region:"west",width:160,split:!0,border:!1,rootVisible:!1,hideHeaders:!0,autoScroll:!0,store:{xtype:"treestore",fields:["name","text","type","pname","region","custom"],root:{expanded:!0,name:"Style",children:[]},folderSort:!1},useArrows:!0,dockedItems:[{xtype:"toolbar",dock:"top",plain:!0,items:[{iconCls:"icon-toolbar-add",tooltip:"Add Custom Style",text:"Add New",handler:function(){this.toolbarHandler("cmd_add_custom")},scope:this},{iconCls:"icon-grid-delete",tooltip:"Delete",handler:function(){this.toolbarHandler("cmd_delete")},scope:this}]}],columns:[{xtype:"treecolumn",text:"text",flex:2,sortable:!1,dataIndex:"name"},{xtype:"actioncolumn",width:26,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,l){e.store.getAt(t)},getClass:function(e,t,l,a,o,n){return 0==a||0==l.isLeaf()||l.data&&0==l.data.custom?"idv-hd-val":""}}]}],listeners:{afterrender:function(){},itemclick:function(e,t,l,a,o){var n=t.get("name");0==t.isRoot()&&n&&s.editStyleItem.call(s,n)}}},{xtype:"form",region:"center",layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"sname",fieldLabel:"Name"},{xtype:"combobox",fieldLabel:"Inherit",name:"base_style",displayField:"name",valueField:"value",editable:!1,queryMode:"local",store:{fields:["name","value"]},listeners:{change:function(e,t,l){var a,o=this,n=o.down("[name=base_style]").getValue(),s=o.down("[name=form_header]"),i=o.down("[name=form_data]");o._valForm||n&&(a=o.globalstylemap[n])&&(s.loadStyleData.call(s,a.header),i.loadStyleData.call(i,a.data))},scope:this}},{xtype:"combobox",fieldLabel:"Chart Style",name:"c_cset",displayField:"name",valueField:"value",editable:!1,queryMode:"local",store:{fields:["name","value"],data:a}},{xtype:"tabpanel",plain:!0,flex:1,items:[l,t]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){this.loadGlobalStyle()}}}),IG$.cubeStyle.superclass.initComponent.apply(this,arguments)}});
IG$.cube_object_select=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!0,resizable:!0,width:770,height:500,_init:function(){var e=this;e.alias_map={},e._aliasLoaded=!1,e.curnode=null,e.cursop=null,e._getDB(e.targetdb||e.dbo.uid)},_getDB:function(e){var t=this,a=new IG$._rpc$,n={uid:e},d=t.dbo;t.setLoading(!0),a.init(t,{ack:"tablecontent",payload:n,mbody:{option:"standard"}},t,function(e,t){var a,n,s=e,l=this.down("[name=fschema]"),i=[],o=d?d.username.toUpperCase():null,r="";if(s)for(a=0;a<e.schemas.length;a++)n=e.schemas[a],i.push(n),o&&n.name.toUpperCase()==o&&(r=n.name);l.store.loadData(i),l.setValue(r)},!1),a.send()},_isValid:function(e){var t=this.down("[name=fschema]");return t.clearInvalid(),t.getValue()?1:(t.markInvalid("Select Item"),0)},_searchTb:function(){var e,t,a=this,n=a.down("[name=src_keyword]"),s=a.down("[name=fschema]"),l=s.getValue();if(a._isValid()){for(e=0;e<s.store.data.items.length;e++)if(s.store.data.items[e].get("name")==l){t=s.store.data.items[e];break}a._getTable(t,null,n.getValue())}},_getTable:function(e,t,a,n){var s,l=this,i=e.get("db_uid"),o=new IG$._rpc$,r={uid:i,option:t,schema:e.get("name"),search:a,product_code:e.get("product_code")};if(n)for(s in n)r[s]=n[s];l.setLoading(!0),o.init(l,{ack:"tablecontent",payload:r,mbody:r},l,l.rs__getTable,!1,[e,t]),o.send()},rs__getTable:function(e,t){var a,n,s=this,l=t[0],i=t[1],o=e.tables||(e.length?e[0].children:null),r=[],d=!!i,c=d?s.down("[name=grid_st]"):s.down("[name=grid_sc]");if(s.setLoading(!1),o)for(a=0;a<o.length;a++)(n=d?o[a].content:o[a]).uid=n.uid||""+a,n.product_code=l.get("product_code"),n.allow_insert=n.allow_insert,n.allow_insert_desc=n.allow_insert?"Yes":"",r.push(n);c.store.loadData(r)},_regTables:function(e){var t,a,n=this,s=n.down("[name=grid_sc]"),l=n.down("[name=grid_st]"),i=(n.alias_map,{});if(0!=(a=(e?l:s).getSelectionModel().selected).length||e){if(!e)for(t=0;t<l.store.data.items.length;t++)i[l.store.data.items[t].get("external_name")]=1;for(t=0;t<a.length;t++)e?l.store.remove(a.items[t]):i[a.items[t].get("external_name")]||l.store.add(a.items[t]);e||s.getSelectionModel().clear()}else IG$.alertmsg(ig$.appname,"Search and check table to register.",null,null,0,"error")},initComponent:function(){var l=this;l.title="Select object",$s.apply(this,{padding:5,defaults:{bodyStyle:"padding:10px"},items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",queryMode:"local",fieldLabel:"Schema",name:"fschema",displayField:"name",valueField:"name",emptyText:"Select Item",typeAhead:!0,forceSelection:!1,autoSelect:!0,autoScroll:!0,store:{fields:["name","uid","db_uid","type"]}},{xtype:"panel",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",name:"grid_sc",emptyText:IRm$.r1("M_S_S1"),selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},store:{fields:["name","type","nodepath","uid","schemaname","dispname","checked"]},tbar:[{xtype:"textfield",name:"src_keyword",fieldLabel:"Search",labelWidth:60,width:160,enableKeyEvents:!0,listeners:{keyup:function(e,t,a){13==t.keyCode&&this._searchTb()},scope:this}},{xtype:"button",text:"..",handler:function(){this._searchTb()},scope:this},"->"],columns:[{text:IRm$.r1("B_TYPE"),width:60,sortable:!0,dataIndex:"object_type"},{text:IRm$.r1("B_NAME"),flex:1,sortable:!0,dataIndex:"name"},{text:IRm$.r1("B_OBJ_NAME"),flex:1,sortable:!0,dataIndex:"external_name"}],listeners:{itemdblclick:function(e,t,a,n,s){l._regTables()},scope:this}},{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:1},{xtype:"button",text:">",handler:function(){this._regTables()},scope:this},{xtype:"button",text:"<",handler:function(){this._regTables(1)},scope:this},{xtype:"container",flex:1}]},{xtype:"gridpanel",name:"grid_st",emptyText:IRm$.r1("M_S_S1"),selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},tbar:[{xtype:"textfield",name:"src_keyword",fieldLabel:"Search",labelWidth:60,width:160,enableKeyEvents:!0,listeners:{keyup:function(e,t,a){13==t.keyCode&&this._searchTb()},scope:this}},{xtype:"button",text:"..",handler:function(){this._searchTb()},scope:this}],store:{fields:["name","type","nodepath","uid","schemaname","dispname","checked"]},columns:[{text:IRm$.r1("B_TYPE"),width:60,sortable:!0,dataIndex:"object_type"},{text:IRm$.r1("B_NAME"),flex:1,sortable:!0,dataIndex:"name"},{text:IRm$.r1("B_OBJ_NAME"),flex:1,sortable:!0,dataIndex:"external_name"}],listeners:{itemdblclick:function(e,t,a,n,s){l._regTables(1)},scope:this}}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){var e,t=this.down("[name=grid_st]"),a=[];for(e=0;e<t.store.data.items.length;e++)a.push(t.store.data.items[e].data);a.length?(this.callback&&this.callback.execute(a),this.close()):IG$.alertmsg(ig$.appname,"Search and check table to register.",null,null,0,"error")},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.cube_object_select.superclass.initComponent.apply(this,arguments)}});
IG$.securityFilter=$s.extend($s.window,{title:"Security Filter Management",modal:!1,layout:"fit",closable:!1,resizable:!1,width:400,height:500,bodyPadding:10,_key:0,_addFilter:function(){var e,s=this;e=new IG$.mgrUserDuty({modal:!1,callback:new IG$.callBackObj(s,function(e){var t,i,n,a=[],l="",r=this.down("[name=gridduty]");for(t=0;t<e.length;t++){var o={sid:e[t].get("sid"),name:e[t].get("name")};a.push(o)}if(0<a.length){for((i=new IG$.clFilterGroup(null)).auth=[],t=0;t<a.length;t++)i.auth.push({name:a[t].name,sid:a[t].sid}),l+=(0<t?",":"")+a[t].name;i.active=!0,i.index=s._key++,s.securityfilter.push(i),n=r.store.add({authname:l,active:i.active,index:i.index}),s.authSet(n,"edit")}})}),IG$.checkLogin(s,e)},_confirm:function(){if(this.callback){var e,t=this.down("[name=gridduty]"),i={};for(e=0;e<t.store.data.items.length;e++)i[t.store.data.items[e].get("index")]=!0;for(e=panel.securityfilter.length-1;0<=e;e--)i[panel.securityfilter[e].index]||panel.securityfilter.splice(e,1);this.callback.execute()}this.close()},loadSecurityFilter:function(){var e,t,i,n,a=this,l=[],r=this.down("[name=gridduty]");if(a.securityfilter)for(e=0;e<a.securityfilter.length;e++){for((n=a.securityfilter[e]).auth=n.auth||[],n.index=a._key++,i="",t=0;t<n.auth.length;t++)i+=(0<t?",":"")+n.auth[t].name;l.push({authname:i,active:n.active,index:n.index})}r.store.loadData(l)},authSet:function(l,e){var t,i,n,a,r,o=this,s=o.down("[name=gridduty]"),d=l.get("index");for(n=0;n<this.securityfilter.length;n++)if(o.securityfilter[n].index==d){r=o.securityfilter[n],a=n;break}if("remove"==e)t=s.store.indexOf(l),o.securityfilter.splice(t,1),s.store.remove(l);else if("auth"==e)i=new IG$.mgrUserDuty({modal:!1,sel:r.auth,callback:new IG$.callBackObj(o,function(e){var t,i=[],n="";this.down("[name=gridduty]");for(t=0;t<e.length;t++){var a={sid:e[t].get("sid"),name:e[t].get("name")};i.push(a)}if(0<i.length){for(r.auth=[],t=0;t<i.length;t++)r.auth.push({name:i[t].name,sid:i[t].sid}),n+=(0<t?",":"")+i[t].name;l.set("authname",n)}})}),IG$.checkLogin(o,i);else{var c=new IG$.filterEditorWindow({sheetoption:{model:{filter:r},datasource:{uid:o.uid}},reportoption:{cubeuid:o.uid},callback:new IG$.callBackObj(o,function(e){this.securityfilter[a]=e.model.filter})});IG$.checkLogin(o,c)}},initComponent:function(){var a=this,e=[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},border:0,items:[{xtype:"displayfield",value:"Select user duty from list"},{xtype:"gridpanel",name:"gridduty",flex:1,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},multiSelect:!0,store:{fields:["authname","active","index"]},columns:[{header:"Auth Name",dataIndex:"authname",flex:1,sortable:!1,hideable:!1},{xtype:"actioncolumn",width:70,items:[{iconCls:"icon-grid-add",tooltip:"Edit",handler:function(e,t,i){var n=e.store.getAt(t);a.authSet.call(a,n,"edit")}},{iconCls:"icon-grid-config",tooltip:"Edit",handler:function(e,t,i){var n=e.store.getAt(t);a.authSet.call(a,n,"auth")}},{iconCls:"icon-grid-delete",tooltip:"Remove Filtering",handler:function(e,t,i){var n=e.store.getAt(t);a.authSet.call(a,n,"remove")}}]}]}]}],t=[{text:IRm$.r1("L_ADD_FILTER"),handler:function(){this._addFilter()},scope:this},"->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}];$s.apply(this,{items:e,buttons:t}),IG$.securityFilter.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(e){this.loadSecurityFilter()}}});
IG$.m$CubeModel=function(e){var o,t,i,r,n,l,b=this;if(b._mc=e=e||{},$s.defaults(e,{pool:[]}),b.zoom=1,b.groupview=!1,b.tables=[],b.relations=[],b.highlight=[],b.fixKeyMode=!1,n=e.tables)for(t=0;t<n.length;t++){if((l=new IG$.m$TblObj(n[t])).fields=[],r=l.columns)for(i=0;i<r.length;i++)r[i].seq=l.seq;b.tables.push(l)}if(n=e.joins)for(t=0;t<n.length;t++)(o=n[t]).source.seq=o.source.seq||0,o.target.seq=o.target.seq||0,b.relations.push(o);if(n=e.securityfilter,b.securityfilter=[],n)for(t=0;t<n.length;t++)o=n[t],b.securityfilter.push(o);b.highlight=e.highlight},IG$.m$TblObj=function(e){this._mc=e,this.ranged=!1},IG$.m$TblObj.prototype={stageX:function(){var e=this,o=0,t=e.bbox;return e.box&&(e.bbox={left:e.box.pobj.scrollPanel.offset().left,top:e.box.pobj.scrollPanel.offset().top},t=e.bbox,o=$(e.box.innerGrid.body.dom).offset().left-t.left),o},stageY:function(e){var o,t,i,r=this,n=0,l=r.bbox;if(r.box&&(r.bbox={left:r.box.pobj.scrollPanel.offset().left,top:r.box.pobj.scrollPanel.offset().top},l=r.bbox,o=$(r.box.innerGrid.body.dom),i=(t=r.box.innerGrid.down("[name=skey]"))&&t.body?$(t.body.dom):null,n=o.offset().top-l.top+(i&&i.height()||0),null!=e)){var b,s=r.box.innerGrid;n+=(b=s.getHeight.call(s,e)).d,r.ranged=b.ranged}return n},bodyWidth:function(){var e=0;return this.box&&(e=this.box.innerGrid.getWidth()),e},bodyHeight:function(){var e=0;return this.box&&((e=this.box.innerGrid.getHeight()).ranged||(e=e.d)),e}},IG$.m$CubeModel.prototype={getXML:function(){return this._mc}};
IG$.cubeModelViewer=function(e,t){var o=this;o.sobj=t,o.viewer=e,o.dialog=[],o.links=[],o.zoomRatio=1,o.lineMode="2"},IG$.cubeModelViewer.prototype={init:function(){var t=this;t._mouseActionPoint=null,t.container=$("<div class='igc-cubemodelviewer'></div>").css({position:"absolute",top:0,bottom:0,left:0,right:0,overflow:"auto"}).appendTo(t.viewer),t.paint=$("<div></div>"),t.paint.appendTo(t.container),t.scrollPanel=$("<div></div>").css({position:"absolute",top:0,bottom:0,width:IG$.j$ext._w(t.container),height:IG$.j$ext._h(t.container),backgroundColor:"none"}).appendTo(t.container),t.appendScrollBar(),t.container.droppable({drop:function(e,t){}}),t.allowDrop(t.scrollPanel[0]),t.container.bind("resize",function(e){t.validateSize.call(t)})},zoom:function(e){var t=this,o=t.zoomRatio+e;.3<o&&o<5&&(t.zoomRatio=o,$(t.scrollPanel).css({transform:"scale("+o+","+o+")","transform-origin":"0px 0px"}))},allowDrop:function(a){var n=this;this.dropZone=$s.create($s.dropzone,a,{ddGroup:"CubeModelDDGroup",nodeouttimer:-1,getTargetFromEvent:function(e){var t=e.browserEvent.pageX||e.browserEvent.clientX,o=e.browserEvent.pageY||e.browserEvent.clientY,i=n.getRendererByPoint(t,o);return null==i&&(i=a),i},notifyOut:function(e,t,o){var i=this;i.lastOverNode&&(i.onNodeOut(i.lastOverNode,e,t,o),i.lastOverNode=null),n.isDragging=!1,n.hideDropFeedback&&(n.hideDropFeedback.call(n,t),1==i.accept&&1==i.pivotmove&&n.sheetobj&&(-1<i.nodeouttimer&&clearTimeout(i.nodeouttimer),i.nodeouttimer=setTimeout(function(){n.hideDropFeedback.call(n,t)},100)))},onNodeEnter:function(e,t,o,i){n.isDragging=!0;var a,l=!1;i.records&&0<i.records.length?"Table"!=(a=i.records[0].get("type"))&&"InlineView"!=a&&"CubeModel"!=a||(l=!0):i.cellData&&(a=i.cellData,l=!0),this.accept=l},onNodeOut:function(e,t,o,i){},onNodeOver:function(e,t,o,i){var a,l=this;return a=window.Ext?1==l.accept?Ext.dd.DropZone.prototype.dropAllowed:Ext.dd.DropZone.prototype.dropNotAllowed:l.accept,1==l.accept&&(i.records&&0<i.records.length?i.records[0].data:i.cellData),a},onNodeDrop:function(e,t,o,i){return 1==this.accept&&(i.records&&0<i.records.length?(dt=i.records[0].data,n.sobj.onDropRecord.call(n.sobj,o,dt)):dt=i.cellData),!(this.accept=!1)}})},focusTable:function(e){var t,o,i,a=this,l=a.container,n=e.box.innerGrid,r=a.viewer;n&&(o=l.offset(),n.$ex?(a._psel&&a._psel.box&&$(a._psel.box.innerGrid.$ex.$view).removeClass("igc-f-table"),t=(i=$(n.$ex.$view)).offset(),i.addClass("igc-f-table"),l.animate({scrollTop:Math.max(t.top-o.top+l.scrollTop()-(r.height()-i.height())/2,0),scrollLeft:Math.max(t.left-o.left+l.scrollLeft()-(r.width()-i.width())/2,0)},200)):n.el&&n.el.dom&&(a._psel&&a._psel.box&&$(a._psel.box.innerGrid.el.dom).removeClass("igc-f-table"),t=(i=$(n.el.dom)).offset(),i.addClass("igc-f-table"),l.animate({scrollTop:Math.max(t.top-o.top+l.scrollTop()-(r.height()-i.height())/2,0),scrollLeft:Math.max(t.left-o.left+l.scrollLeft()-(r.width()-i.width())/2,0)},200)),a._psel=e)},getRendererByPoint:function(){return null},appendScrollBar:function(){var e=this;e.scrollbar=$("<div></div>").css({position:"absolute",top:0,bottom:0,width:IG$.j$ext._w(e.container),height:IG$.j$ext._h(e.container),backgroundColor:"none"}).appendTo(e.scrollPanel),e.rcanvas=Raphael(e.scrollbar[0],0,0,"100%","100%"),e._ca=[]},scrollHandler:function(e,t){var o=this;switch(e){case"down":o._mouseActionPoint={x:t.pageX,y:t.pageY};break;case"up":o._mouseActionPoint=null;break;case"move":var i=IG$.j$ext._w(container),a=IG$.j$ext._w(scrollPanel),l=IG$.j$ext._h(container),n=IG$.j$ext._h(scrollPanel);if(null!=o._mouseActionPoint&&(i<a||h_container<h_scrollPanel)){var r,s=o.paint,d=o.scrollPanel,c=o.scrollbar,h=o.container.offset(),f=d.offset(),p=t.pageX-o._mouseActionPoint.x,b=t.pageY-o._mouseActionPoint.y;if(r={top:f.top+b,left:f.left+p},o._mouseActionPoint={x:t.pageX,y:t.pageY},r.top<l-n||r.left<i-a||0<r.top-h.top||0<r.left-h.left)return;c.offset(r),d.offset(r),s.offset(r)}}},clearAll:function(){var e=this;e.dialog=[],e.links=[],e.rcanvas.clear(),$.each(e._ca,function(e,t){t.remove()}),e._ca=[],e.scrollPanel.empty(),e.appendScrollBar()},validateTimer:-1,validateSize:function(){var e=this;e.validateTimer&&clearTimeout(e.validateTimer),e.validateTimer=setTimeout(function(){e.validateSizeProc.call(e)},100)},validateSizeProc:function(){var e,t=this,o=(t.container.offset(),IG$.j$ext._w(t.container)),i=IG$.j$ext._h(t.container);for(e=0;e<t.dialog.length;e++)o=Math.max(o,t.dialog[e].table.stageX()+t.dialog[e].table.bodyWidth()+100),i=Math.max(i,t.dialog[e].table.stageY()+t.dialog[e].table.bodyHeight()+100);IG$.j$ext._w(t.scrollPanel,o),IG$.j$ext._h(t.scrollPanel,i),IG$.j$ext._w(t.scrollbar,o),IG$.j$ext._h(t.scrollbar,i),IG$.j$ext._w(t.paint,o),IG$.j$ext._h(t.paint,i),t.rcanvas.setViewBox(0,0,o,i,!0),t.rcanvas.setSize(o,i),t.validateLinks()},validateLinks:function(){var e,t=this;for(t.rcanvas.clear(),$.each(t._ca,function(e,t){t.remove()}),t._ca=[],e=0;e<t.links.length;e++)t.links[e].refresh.call(t.links[e],e,1==t.sobj.cubemodel.groupview)},addBox:function(e,t,o,i,a,l){var n=new IG$.tableBox(this,e,t,o,i,a);return n.main=l,n.collapsePanel.call(n),n.innerGrid.fixKeyMode.call(n.innerGrid,a._mcfixKeyMode),this.dialog.push(n),n},addLink:function(e,t,o,i){var a,l,n,r=this;for(r.relations=i,a=0;a<r.links.length;a++)if((n=r.links[a])&&(n.fromobj._mc.uid==e._mc.uid&&n.toobj._mc.uid==t._mc.uid&&n.fromobj._mc.seq==e._mc.seq&&n.toobj._mc.seq==t._mc.seq||n.fromobj._mc.uid==t._mc.uid&&n.toobj._mc.uid==e._mc.uid&&n.fromobj._mc.seq==t._mc.seq&&n.toobj._mc.seq==e._mc.seq)){l=n;break}return l?l.links.push(o):(l=new IG$.LinkField(r,e,t,o,i),r.links.push(l)),l},removeTbl:function(e){var t,o,i,a=this.sobj,l=a.cubemodel,n=this.dialog,r=this.links;for(t=0;t<l.tables.length;t++)if(e.table==l.tables[t]){l.tables.splice(t,1);break}for(t=0;t<n.length;t++)if(n[t]==e){n.splice(t,1);break}for(t=r.length-1;0<=t;t--)if(r[t].fromobj==e.table||r[t].toobj==e.table){for(i=r[t],o=l.relations.length-1;0<=o;o--)l.relations[o].bl==i&&l.relations.splice(o,1);r.splice(t,1)}a.updateUsedTable.call(a),a.validateTables.call(a),a.validateJoins.call(a)}},IG$.tableBox=function(n,e,t,o,i,c){var s=this,a=this,r=n,l=c._mc.name;a.pobj=n,(a.table=c)._mc.theight=c._mc.theight||i,c._mc.seq&&0<c._mc.seq&&(l+="("+c._mc.seq+")"),a.innerGrid=new $s.panel({renderTo:this.pobj.scrollPanel[0],table:c,autoScroll:!1,stateful:!1,draggable:!0,plain:!1,minimizable:!1,alwaysFramed:!0,closable:!0,cpa:r,title:l,x:e,border:1,y:t,width:o,height:(c._mc.theight||100)<100?100:c._mc.theight,viewmode:"physical",fixKeyVal:!1,fixKeyMode:function(e){this.fixKeyVal=e,this.g_key.setVisible(e),this.loadData()},layout:{type:"vbox",align:"stretch"},_loadModel:function(){var n=this,e=n.table._mc,t=new IG$._rpc$;e.uid&&"cubemodel"==e.type.toLowerCase()&&(t.init(n,{ack:"content",payload:{uid:e.uid,type:e.type},mbody:{}},n,function(e){var t,o,i=e.content.tables,a=n.down("[name=stables]"),l=[];for(t=0;t<i.length;t++)o={uid:i[t].uid,type:i[t].type,name:i[t].name,nodepath:i[t].nodepath},l.push(o);a.store.loadData(l)}),t.send())},_loadField:function(r){var e=this,t=new IG$._rpc$,s=e.table._mc,d=e.table._tables;if(e.table._sel_table=r,d[r]){var o=e.cpa.sobj;o.validateTables(),o.validateJoins()}else e.setLoading(!0),t.init(e,{ack:"tablecontent",payload:{uid:r,option:"StoredContent"},mbody:{option:"folder",readcontent:"T"}},e,function(e){var t,o,i,a=e.length?e[0]:null,l=(a&&a.content,[]),n=this.cpa.sobj;if(d[r]={columns:[]},a&&a.children)for(t=a.children,i=0;i<t.length;i++)(o=t[i].content).model=s.uid,o.tablename=a.name||o.tablename,o.alias=o.alias||o.name,o.iskey=o.iskey,o.leaf=!0,o.dispname=o.name,o.allowDrag=!0,o.seq=c._mc.seq,o.tableuid=a.uid,l.push(o);d[r].columns=l,n.validateTables(),n.validateJoins()},null),t.send()},loadData:function(){var e,t,o=this,i=[],a=[],l=o.table,n=o.table._mc,r=n.columns;if("cubemodel"==n.type.toLowerCase()){if(!l._sel_table||!l._tables[l._sel_table])return void o._loadModel();r=l._tables[l._sel_table].columns}if(r)for(e=0;e<r.length;e++)t=r[e],!o.fixKeyVal||1!=t.iskey&&1!=t.hasjoin?i.push(t):a.push(t);o.g_key.store.loadData(a),o.g_fields.store.loadData(i)},getHeight:function(e){var t,o,i,a,l,n={d:0,ranged:!1},r=!1,s=!1;if(this.fixKeyVal){for(l=(i=this.g_key).getHeight(),t=0;t<i.store.data.items.length;t++)if(i.store.data.items[t].get("name")==e){o=i.getView().getNode(t);break}o&&(s=!0,-1<(a=$(o).offset().top-$(i.el.dom).offset().top+$(o).height()/2)&&a<l?r=!0:(a=a<0?0:a,a=Math.min(a,l)))}if(0==s){if(l=(i=this.g_fields).getHeight(),e){for(t=0;t<i.store.data.items.length;t++)if(i.store.data.items[t].get("name")==e){o=i.getView().getNode(t);break}}else a=l;o&&(-1<(a=$(o).offset().top-$(i.el.dom).offset().top+$(o).height()/2)&&a<l?r=!0:(a=a<0?0:a,a=Math.min(a,l)))}return a&&(n.d=a),n.ranged=r,n},adjHeight:function(){var e,t,o=this,i=o.getHeight();o.fixKeyVal&&(0==(e=o.g_key.store.data.items.length)?o.g_key.setVisible(!1):(o.g_key.setVisible(!0),t=Math.min(22*e+2,.4*i),o.g_key.setHeight(t)),o.cpa.validateLinks.call(o.cpa))},searchField:function(){var e=this;e.__s&&clearTimeout(e.__s),e.__s=setTimeout(function(){e.searchFlt.call(e)},40)},searchFlt:function(){var e=this.down("[name=g_fields]").store,i=this.down("[name=skey]").getValue();i?(i=i.toLowerCase(),e.clearFilter(!0),e.filterBy(function(e){var t=e.get("name").toLowerCase(),o=e.get("alias")||"";return o=o.toLowerCase(),-1<t.indexOf(i)||-1<o.indexOf(i)})):e.clearFilter(!1)},items:[{xtype:"container",hidden:"CubeModel"!=a.table._mc.type,layout:{type:"hbox",align:"stretch"},items:[{xtype:"combobox",name:"stables",flex:1,displayField:"name",valueField:"uid",store:{},listeners:{change:function(e){e.getValue()&&(a.innerGrid.table._tables=a.innerGrid.table._tables||{},a.innerGrid._loadField(e.getValue()))},scope:this}},{xtype:"button",iconCls:"icon-refresh",tooltip:"Refresh",handler:{},scope:this}]},{xtype:"textfield",name:"skey",emptyText:"Search Items",enableKeyEvents:!0,listeners:{keyup:function(e,t,o){e.ownerCt.searchField.call(e.ownerCt)}}},{xtype:"gridpanel",name:"g_key",border:0,scroll:"vertical",autoScroll:!0,enableDragDrop:!0,enableDD:!0,useArrows:!0,header:!1,hideHeaders:!0,hidden:!0,cpa:r,ddGroup:"CubeModelFieldDDGroup",viewConfig:{emptyText:IRm$.r1("L_P_RELOAD"),plugins:{ptype:"gridviewdragdrop",ddGroup:"CubeModelFieldDDGroup"},listeners:{beforedrop:function(e,t,o,i){var a=t.records[0],l=o;return a&&l&&r.sobj.onDropField.call(r.sobj,a,l),!1},drop:function(e,t,o,i){o&&o.get("name")}}},store:{fields:["name","nodepath","datasize","datatype","tablename","type","selected","seq","alias","tableuid"]},afterScroll:function(){this.cpa.validateLinks.call(this.cpa)},columns:[{xtype:"checkcolumn",dataIndex:"selected",enableColumnHide:!1,checkedAll:!1,width:30,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"},listeners:{checkchange:function(e,t,o,i){var a,l=s.innerGrid.g_fields.store.data.items[t].get("nodepath"),n=s.table;for(a=0;a<n.fields.length;a++)if(n.fields[a].nodepath==l){n.fields[a].selected=o;break}},headerclick:function(e,t,o,i,a){var l,n=e.ownerCt,r=s.table;if("checkcolumn"==t.xtype){for(t.checkedAll=!t.checkedAll,l=0;l<n.store.data.items.length;l++)n.store.data.items[l].set("selected",t.checkedAll);for(l=0;l<r.fields.length;l++)r.fields[l].selected=t.checkedAll}}}},{header:"Name",dataIndex:"name",sortable:!0,hideable:!1,flex:1},{header:"Alias",dataIndex:"alias",sortable:!0,hideable:!1,hidden:!0,flex:1}],listeners:{afterrender:function(e){this.getView().on("bodyscroll",this.afterScroll,this)},scrollershow:function(e,t,o){}}},{xtype:"gridpanel",name:"g_fields",border:0,scroll:"vertical",autoScroll:!0,enableDragDrop:!0,enableDD:!0,useArrows:!0,header:!1,hideHeaders:!0,flex:1,cpa:r,ddGroup:"CubeModelFieldDDGroup",viewConfig:{emptyText:IRm$.r1("L_P_RELOAD"),plugins:{ptype:"gridviewdragdrop",ddGroup:"CubeModelFieldDDGroup"},listeners:{beforedrop:function(e,t,o,i){var a=t.records[0],l=o;return a&&l&&r.sobj.onDropField.call(r.sobj,a,l),!1},drop:function(e,t,o,i){o&&o.get("name")}}},store:{fields:["name","nodepath","datasize","datatype","tablename","type","selected","seq","alias","tableuid"]},afterScroll:function(){this.cpa.validateLinks.call(this.cpa)},columns:[{xtype:"checkcolumn",dataIndex:"selected",enableColumnHide:!1,checkedAll:!1,width:30,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"},listeners:{checkchange:function(e,t,o,i){var a,l=s.innerGrid.g_fields.store.data.items[t].get("nodepath"),n=s.table;for(a=0;a<n.fields.length;a++)if(n.fields[a].nodepath==l){n.fields[a].selected=o;break}},headerclick:function(e,t,o,i,a){var l,n=e.ownerCt,r=s.table;if("checkcolumn"==t.xtype){for(t.checkedAll=!t.checkedAll,l=0;l<n.store.data.items.length;l++)n.store.data.items[l].set("selected",t.checkedAll);for(l=0;l<r.fields.length;l++)r.fields[l].selected=t.checkedAll}}}},{header:"Name",dataIndex:"name",sortable:!0,hideable:!1,flex:1},{header:"Alias",dataIndex:"alias",sortable:!0,hideable:!1,hidden:!0,flex:1}],listeners:{afterrender:function(e){this.getView().on("bodyscroll",this.afterScroll,this)},scrollershow:function(e,t,o){}}}],bbar:[{xtype:"button",iconCls:"icon-tb-alias",tooltip:"Alias",handler:function(){var e=this.innerGrid,t=this.innerGrid.g_key,o=this.innerGrid.g_fields.columns,i=t.columns;switch("physical"==e.viewmode?e.viewmode="logical":"logical"==e.viewmode?e.viewmode="both":e.viewmode="physical",e.viewmode){case"physical":o[1].show(),o[2].hide(),i[1].show(),i[2].hide();break;case"logical":o[1].hide(),o[2].show(),i[1].hide(),i[2].show();break;default:o[1].show(),o[2].show(),i[1].show(),i[2].show()}},scope:s},{xtype:"button",iconCls:"icon-tb-refresh",tooltip:"Refresh",handler:function(){var e=this;e.innerGrid.g_fields;if("cubemodel"==e.table._mc.type.toLowerCase()){var t=e.innerGrid.down("[name=stables]");t.getValue()&&(e.table._tables=e.table._tables||{},e.innerGrid._loadField(t.getValue()))}else e.main.loadTableContent.call(e.main,e.table)},scope:s},{xtype:"button",iconCls:"icon-tb-preview",tooltip:"Preview",handler:function(){this.main.previewSQL.call(this.main,this.table)},scope:s},{xtype:"displayfield",value:"",name:"m_disp"}],listeners:{afterrender:function(e){var t=this;t.fixKeyVal=t.cpa.sobj.fixKeyMode,t.g_key=t.down("[name=g_key]"),t.g_fields=t.down("[name=g_fields]"),t.m_disp=t.down("[name=m_disp]"),t.loadData()},scrollershow:function(e,t,o){},resize:function(e,t,o,i,a,l){n.validateSize.call(n)},startmove:function(e){e.$ex&&(e.$ex.config.zoomRatio=n.zoomRatio)},move:function(e,t,o,i){(t<0||o<0)&&this.setPosition(t<0?0:t,o<0?0:o),n.validateSize.call(n)},close:function(e,t){r.removeTbl.call(r,s)}}})},IG$.tableBox.prototype={fixKeyMode:function(e){this.table.fixKeyMode!=e&&(this.table.fixKeyMode=e,this.innerGrid.fixKeyMode.call(this.innerGrid,e))},collapsePanel:function(e){var t,o=this.pobj;this.table._mc.width;t=((t=this.table._mc.theight)||100)<100?100:t,this.innerGrid.setVisible(!0),o.validateSize.call(o),o.validateLinks.call(o)}},IG$.LinkField=function(e,t,o,i,a){var l=this;l.pobj=e,l.fromobj=t,l.toobj=o,l.links=[i],l.relations=a,l._fromDir="",l._toDir="",l.lineMode=e.lineMode},IG$.LinkField.prototype={validateDirection:function(e){var t=$(this.fromobj.box.innerGrid.body.dom),o=t.offset(),i=$(this.toobj.box.innerGrid.body.dom),a=i.offset(),l=IG$.j$ext._w(t)*e,n=IG$.j$ext._w(i)*e;o.left+l<a.left?(this._fromDir="right",this._toDir="left"):(a.left+n<o.left?this._fromDir="left":(o.left,a.left,this._fromDir="right"),this._toDir="right")},showLinkEditor:function(e,t){new IG$.linkEditor({pobj:this.pobj,link:e,links:t,relations:this.relations,callback:new IG$.callBackObj(this,this.rs_showLinkEditor)}).show(null)},rs_showLinkEditor:function(e){var t,o=e[0];switch(e[1]){case"remove":this.pobj.sobj.updateJoinFields.call(this.pobj.sobj),this.pobj.sobj.validateLinks.call(this.pobj.sobj),this.pobj.validateLinks.call(this.pobj);break;case"confirm":for(t=0;t<this.links.length;t++)this.links[t]!=o[0]&&(this.links[t].join=o[0].join);this.pobj.validateLinks.call(this.pobj)}},refresh:function(e,d){var c,h,f,p,b,u,t,m=this,g=1,v=m.fromobj,_=m.toobj,x=m.links,y=m.pobj.rcanvas,w={stroke:"#8d8d8d","stroke-width":1,fill:"none",opacity:1},k={stroke:"#8d8d8d",fill:"#8d8d8d",opacity:1},o=m.pobj.zoomRatio,j=1/o;m.links&&1<m.links.length&&1==d&&(g=1.5*m.links.length),m.validateDirection(o),t=1==d&&0<x.length?[x[0]]:x,$.each(t,function(e,t){if(t){var o=m._fromDir,i=m._toDir;t.p1dist=void 0===t.p1dist?null:t.p1dist,t.source.tablename==_._mc.name&&t.target.tablename==v._mc.name&&t.source.seq==_._mc.seq&&t.target.seq==v._mc.seq?(v=m.toobj,_=m.fromobj,o!=i&&(o="right"==o?"left":"right",i="right"==i?"left":"right")):(v=m.fromobj,_=m.toobj),u=1==x.length||0==d?x[e].source.name:null,c={x:v.stageX()*j,y:v.stageY(u)*j},u=1==x.length||0==d?x[e].target.name:null,p={x:_.stageX()*j,y:_.stageY(u)*j},1==v.ranged&&1==_.ranged?(!0,w.stroke="#000000",w["stroke-width"]=g,k.stroke="#000000",k.fill="#000000"):1<g?(!1,w.stroke="#000000",w["stroke-width"]=g,k.stroke="#000000",k.fill="#000000"):!1,"right"==o?(c.x+=v.bodyWidth(),h={x:c.x+10,y:c.y}):"left"==o&&(h={x:c.x-10,y:c.y}),"right"==i?(p.x+=_.bodyWidth(),f={x:p.x+10,y:p.y}):"left"==i&&(f={x:p.x-10,y:p.y}),b=0<(b=IG$.lineInterpolate(h,f,3)).length?b[1]:null,x&&0<x.length&&"right outer"==x[0].join?"right"==i?y.path("M"+p.x+" "+(p.y+10)+"L"+(p.x+10)+" "+p.y+"L"+p.x+" "+(p.y-10)).attr(w):y.path("M"+p.x+" "+(p.y+10)+"L"+(p.x-10)+" "+p.y+"L"+p.x+" "+(p.y-10)).attr(w):x&&0<x.length&&"left outer"==x[0].join&&("right"==o?y.path("M"+c.x+" "+(c.y+10)+"L"+(c.x+10)+" "+c.y+"L"+c.x+" "+(c.y-10)).attr(w):y.path("M"+c.x+" "+(c.y+10)+"L"+(c.x-10)+" "+c.y+"L"+c.x+" "+(c.y-10)).attr(w)),y.path("M"+c.x+" "+c.y+"L"+h.x+" "+h.y+"L"+f.x+" "+f.y+"L"+p.x+" "+p.y).attr(w);var a,l=1==x.length||1==d?x:[x[e]],n=$("<div class='igc-cm-join'><span></span></div>").appendTo(m.pobj.scrollbar),r="",s=$("span",n);if(1==d)for(e=0;e<x.length;e++)0<e&&(r+="\n"),r+=x[e].source.name,x[e].source.name!=x[e].target.name&&(r+=" - "+x[e].target.name);else r=t.source.name+" - "+t.target.name;s.html(r),n.attr("title",r),a=Math.min(s.width()/2||30,20),n.css({left:b.x-a,top:b.y}),n.bind("click",function(e){e.preventDefault(),e.stopPropagation(),m.showLinkEditor.call(m,l,x)}),m.pobj._ca.push(n)}})}};
IG$.linkFieldEditor=$s.extend($s.window,{title:"Join (Relation) Custom Field",modal:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:420,_init:function(){var e=this,t=e._target;t&&(e.down("[name=t_disp]").setValue(t.name),e.down("[name=t_value]").setValue(e.joinobj[e.fieldname]))},_confirm:function(){var e=this;e._target&&(e.joinobj[e.fieldname]=e.down("[name=t_value]").getValue()),e.callback&&e.callback.execute(),e.close()},initComponent:function(){$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",name:"t_disp"},{xtype:"textarea",name:"t_value",height:120},{xtype:"displayfield",value:"Field in formula, Use {FIELD}. Ex: SUBSTR({FIELD}, 1, 6)"}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.linkFieldEditor.superclass.initComponent.apply(this,arguments)}}),IG$.linkEditor=$s.extend($s.window,{title:"Join (Relation) Editor",modal:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:420,autoHeight:!0,callback:null,_curLink:null,_init:function(){if(this._curLink=null,this.link&&0<this.link.length){var e,t,i=this.down("[name=selR]"),n=this.down("[name=btn_upd]"),l=[];if(1<this.link.length){for(i.setVisible(!0),n.setVisible(!0),e=0;e<this.link.length;e++)t=this.link[e],l.push({name:t.source.tablename+"."+t.source.name+" - "+t.target.tablename+"."+t.target.name,__i:e});i.store.loadData(l),i.setValue(0)}this.setFieldValue(this.link[0])}},setFieldValue:function(e){var t=this,i=t.down("[name=sfield]"),n=t.down("[name=tfield]"),l=t.down("[name=oprel]");e&&(t._curLink=e,i.setValue(t.getDispName(e.source)),n.setValue(t.getDispName(e.target)),l.setValue(e.join))},getDispName:function(e){return e.formula?e.formula.replace("{FIELD}",e.name):e.tablename+"."+e.name},removeLink:function(){var e,t,i,n=this,l=0,a=n.down("[name=selR]"),o=n.link,s=n.relations,r=n._curLink,c=n.pobj.links;if(1<o.length){for(e=0;e<s.length;e++)if(s[e]==r){s.splice(e,1);break}for(e=0;e<o.length;e++)if(o[e]==r){o.splice(e,1),l=1;break}for(e=0;e<c.length;e++){for(t=i=0;t<c[e].links.length;t++)if(c[e].links[t]==r){c[e].links.splice(t,1),i=1;break}if(i){0==c[e].length&&c.splice(e,1);break}}if(l){var d=a.getValue();for(e=0;e<a.store.data.items.length;e++)if(a.store.data.items[e].get("__i")==d){a.store.removeAt(e);break}1==a.store.data.items.length&&a.hide(),0<a.store.data.items.length&&a.setValue(a.store.data.items[0].get("__i"))}for(e=0;e<a.store.data.items.length;e++)a.store.data.items[e].set("__i",e);n.callback&&n.callback.execute([o,"remove"])}else{for(e=0;e<s.length;e++)if(s[e]==r){s.splice(e,1);break}for(e=0;e<c.length;e++){for(t=l=0;t<c[e].links.length;t++)if(c[e].links[t]==r){c[e].links.splice(t,1),l=1;break}if(l){0==c[e].length&&c.splice(e,1);break}}n.callback&&n.callback.execute([o,"remove"]),n.close()}},confirmChanges:function(){var e=this.down("[name=oprel]"),t=this._curLink;t&&(t.join=e.getValue(),t.operator="=")},_confirm:function(){var e=this;e.confirmChanges(),e.callback&&e.callback.execute([e.link,"confirm"]),e.close()},editField:function(e){var t,i=this,n=i._curLink,l=i.down("[name="+(e?"s":"t")+"field]"),a=e?n.source:n.target,o=(e?"source":"target")+"_field_formula";a&&(t=new IG$.linkFieldEditor({joinobj:n,_target:a,fieldname:o,callback:new IG$.callBackObj(i,function(){l.setValue(this.getDispName(a))})}),IG$.checkLogin(i,t))},initComponent:function(){$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"form",layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",fieldLabel:"Relation",name:"selR",hidden:!0,queryMode:"local",autoSelect:!0,autoScroll:!0,editable:!1,labelField:"name",displayField:"name",valueField:"__i",store:{fields:["name","__i"]},listeners:{change:function(e,t,i,n){var l=e.getValue();this.setFieldValue(this.link[l])},scope:this}},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},name:"sfield_cnt",items:[{xtype:"textfield",name:"sfield",fieldLabel:"Source field",readOnly:!0,flex:1},{xtype:"button",text:"..",handler:function(){this.editField(!0)},scope:this}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},name:"tfield_cnt",items:[{xtype:"textfield",name:"tfield",fieldLabel:"Target field",readOnly:!0,flex:1},{xtype:"button",text:"..",handler:function(){this.editField(!1)},scope:this}]},{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},defaults:{labelWidth:150},title:"Options",items:[{xtype:"combobox",name:"oprel",fieldLabel:"Source to Target data is",queryMode:"local",autoSelect:!0,editable:!1,valueField:"op",displayField:"name",labelField:"name",$w:390,store:{fields:["name","op","desc"],data:[{name:"Inner equal",op:"inner",desc:"Show only match values"},{name:"Left outer",op:"left outer",desc:"Show all source values even not match"},{name:"Right outer",op:"right outer",desc:"Show all target values even not match"},{name:"Auto natural",op:"natural",desc:"Automatic join with column foreign key"},{name:"Full outer",op:"full outer",desc:"Show all source and target values"}]},listeners:{change:function(e){var t,i,n,l=e.getValue(),a=this.down("[name=op_desc]");for(i=0;i<e.store.data.items.length;i++)if((n=e.store.data.items[i]).get("op")==l){t=n;break}t&&a.setValue("* "+t.get("desc"))},scope:this}},{xtype:"displayfield",name:"op_desc"}]},{xtype:"container",layout:{type:"hbox",align:"right"},items:[{xtype:"button",name:"btn_upd",text:"Confirm current",hidden:!0,handler:function(){this.confirmChanges()},scope:this},{xtype:"button",text:"Remove Relation",handler:function(){this.removeLink()},scope:this}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.linkEditor.superclass.initComponent.apply(this,arguments)}});
IG$.CubeModel=$s.extend(IG$.v$pnl,{collapseFirst:!1,bodyBorder:!1,layout:"fit",defaults:{collapsible:!1,split:!1,animFloat:!1,autoHide:!1,useSplitTips:!0},initialized:!1,closable:!0,overflowX:"hidden",overflowY:"hidden",iconCls:"icon-cubemodel",_init:function(){var t=this,e=t.down("[name=mcontainer]");t.m=new IG$.cubeModelViewer($(e.body.dom),t),t.m.init(),t.uid?(t.load_content(),t.down("[name=t_save]").setVisible(t.writable),t.writable&&IG$.checkLock(t,function(e){"unlock"!=e&&(t.writable=!1,t.down("[name=t_save]").hide())})):t._c$?t.rs_load_content(t._c$):(t.cubemodel=new IG$.m$CubeModel(null),t.loadPool())},load_content:function(){var e=this,t=new IG$._rpc$;e.setLoading(!0),t.init(e,{ack:"content",payload:{address:e.uid},mbody:{option:"diagnostics"}},e,e.rs_load_content,null),t.send()},rs_load_content:function(e){var t,i,n=this;n.cubemodel=new IG$.m$CubeModel(e.content),!(i=n.cubemodel._mc).datasource&&n.obj_uid?i.datasource={uid:n.obj_uid}:n.obj_uid&&(i.datasource.uid=n.obj_uid),n.obj_uid=i.datasource.uid,n.cubemodel.datasource={uid:i.datasource.uid||n.obj_uid},t={type:"ROOT",name:"DataSource",uid:n.obj_uid,leaf:!1,children:[{type:"load",name:"Loading..."}]},(t=n.down("[name=mtree]").setRootNode(t)).expand(),n.loadPool()},loadPool:function(){this.validateTables(),this.validateJoins()},updatePoolInfo:function(e,t){var i,n,a,o,l;for(i=0;i<e.length;i++)if((l=e[i]).dispname=l.name,17<l.dispname.length&&"_"==l.dispname.charAt(17)&&(l.dispname=l.dispname.substring(18)),l.children)for(o=l.children,n=0;n<o.length;n++)a=o[n],t.push({value:a.uid,name:l.dispname+"-"+a.name});else t.push({value:"",name:l.dispname+"-ERROR(No Schema)"})},updateUsedTable:function(){var e,t=this.down("[name=grid_st]").store,i=this.cubemodel,n={};if(t.data.items.length){for(e=0;e<i.tables.length;e++)n[i.tables[e]._mc.uid]=1;for(e=0;e<t.data.items.length;e++)t.data.items[e].set("used",n[t.data.items[e].get("uid")]?"*":"")}},loadTableContent:function(l,s,d){var e=this,t=new IG$._rpc$,i=l._mc;e.setLoading(!0),t.init(e,{ack:"tablecontent",payload:{uid:i.uid,nodepath:i.nodepath,name:i.name,option:"StoredContent"},mbody:{option:"folder",readcontent:"T"}},e,function(e){var t,i,n,a=e.length?e[0]:null,o=(a&&a.content,[]);if(a&&a.children)for(t=a.children,n=0;n<t.length;n++)(i=t[n].content).tablename=l._mc.name||i.tablename,i.alias=i.alias||i.name,i.iskey=i.iskey,i.leaf=!0,i.dispname=i.name,i.allowDrag=!0,i.seq=l._mc.seq,i.tableuid=l._mc.uid,o.push(i);l._mc.columns=o,(!s||s&&d)&&(this.validateTables(),this.validateJoins())},null),t.send()},previewSQL:function(e){var t=new IG$.dlgLoadPreview({table:e});IG$.checkLogin(this,t)},updateJoinFields:function(){var e,t,i,n,a,o,l,s,d=this.cubemodel;for(e=0;e<d.tables.length;e++){for(n=(i=d.tables[e])._mc,tname=n.name+"_"+n.seq,n.columns=n.columns||[],t=0;t<n.columns.length;t++)n.columns[t].hasjoin=!1;for(a=0;a<d.relations.length;a++)if(r=d.relations[a],o=r.source.tablename+"_"+r.source.seq,l=r.target.tablename+"_"+r.target.seq,s=o==tname?r.source.name:l==tname?r.target.name:null)for(t=0;t<n.columns.length;t++)if(n.columns[t].name==s){n.columns[t].hasjoin=!0;break}i.box&&i.fixKeyMode&&i.box.innerGrid.loadData.call(i.box.innerGrid)}},validateTables:function(a){var o,l,s,d,r,c=this,u=c.cubemodel,h=c.m;c.tablemap=c.tablemap||{},c.updateJoinFields(),$.each(u.tables,function(e,t){var i,n=t._mc;l=n.x,s=n.y,d=n.width,r=n.height,n.theight||n.height,i=n.uid+"_"+n.seq,t.box?t.box.innerGrid.loadData.call(t.box.innerGrid):(o=h.addBox.call(h,l,s,d,r,t,c),t.box=o,a&&c.loadTableContent.call(c,t,a,e==u.tables.length-1)),c.tablemap[i]=t}),h.validateSize.call(h)},validateJoins:function(){var e,t,i,n,a=this,o=a.cubemodel,l=a.m;for(e=o.relations.length-1;0<=e;e--)t=o.relations[e],i=a.tablemap[(t.source.model||t.source.tableuid)+"_"+t.source.seq],n=a.tablemap[(t.target.model||t.target.tableuid)+"_"+t.target.seq],i&&n?t.bl||(t.bl=l.addLink.call(l,i,n,t,o.relations)):o.relations.splice(e,1);a.updateJoinFields(),a.validateLinks(),l.validateLinks.call(l)},validateLinks:function(){var e,t,i,n,a=this.down("[name=mRel]"),o=[],l=this.m.relations||[];for(e=0;e<l.length;e++)i=(t=l[e]).source,n=t.target,i&&n&&o.push({s0:i.tablename,t0:n.tablename,s1:i.seq,t1:n.seq,s2:i.name,t2:n.name,r0:t.join,sdesc:i.tablename+"."+i.name,tdesc:n.tablename+"."+n.name,l:t});a.store.loadData(o)},onDropRecord:function(e,t){var i,n,a,o=t,l=this.cubemodel,s=this.m.viewer.offset();for(a=(i=new IG$.m$TblObj(null))._mc={},IG$.CopyObject(o,i._mc,"nodepath;name;type;uid;memo;schemaname;alias"),a.x=e.getX()-s.left,a.y=e.getY()-s.top,a.width=180,a.height=200,a.seq=0,i.fields=[],n=0;n<l.tables.length;n++)l.tables[n]._mc.uid==a.uid&&(a.seq=Math.max(a.seq,l.tables[n]._mc.seq+1));l.tables.push(i),this.updateUsedTable(),this.loadTableContent(i)},updateModel:function(){var e,t,i,n,a,o,l,s,d,r,c=this.m,u=c.scrollPanel.offset(),h=this.cubemodel,m=h._mc,b={},p=1/c.zoomRatio;for(m.tables=[],m.joins=[],m.securityfilter=[],e=0;e<h.relations.length;e++)d={join:(r=h.relations[e]).join,operator:r.operator,source:r.source,target:r.target,source_field_formula:r.source_field_formula,target_field_formula:r.target_field_formula},b[r.source.uid]=1,b[r.target.uid]=1,m.joins.push(d);for(e=0;e<h.tables.length;e++){if(s=(i=h.tables[e])._mc,(l=IG$.copyObject(s)).columns=[],n=i.box.innerGrid,a=(o=$(n.$ex.$view)).offset(),l.x=(a.left-u.left)*p,l.y=(a.top-u.top)*p,l.width=o.width(),l.height=o.height(),l.theight=l.height,s.columns)for(t=s.columns.length-1;0<=t;t--)(s.columns[t].iskey||b[s.columns[t].uid])&&l.columns.push(s.columns[t]);m.tables.push(l)}if(h.securityfilter)for(e=0;e<h.securityfilter.length;e++)m.securityfilter.push(h.securityfilter[e])},saveContent:function(e){var t=this;t.updateModel(),t.fireEvent("_model_updated");var i,n=t.cubemodel,a=n.getXML.call(n),o=new IG$._rpc$;t.setLoading(!0),i=e?{pid:n.item.pid,address:n.item.address,name:n.item.name,type:"CubeModel"}:{uid:t.uid},o.init(t,{ack:"writecontent",payload:i,mbody:a,meta_type:"cubemodel"},t,function(e){this.uid=e.uid,this.setTitle(e.name),IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},null),o.send()},onDropField:function(e,t){var i,n,a=this,o=a.cubemodel,l=a.m,s={join:"inner",operator:"="};s.source=e.data,s.target=t.data,o.relations.push(s),a.updateJoinFields(),i=a.tablemap[(s.source.model||s.source.tableuid)+"_"+s.source.seq],n=a.tablemap[(s.target.model||s.target.tableuid)+"_"+s.target.seq],i&&n&&(s.bl=l.addLink.call(l,i,n,s,o.relations),a.validateLinks(),l.validateLinks.call(l))},toolbarHandler:function(e){var t,i=this,n=i.m;switch(e){case"cmd_save":i.uid?i.saveContent():i.saveAsContent(!1);break;case"cmd_saveas":i.saveAsContent(!1);break;case"cmd_simple_view":i.cubemodel.groupview=!i.cubemodel.groupview,n.validateLinks.call(n);break;case"cmd_fix_key":var a=i.cubemodel;for(a.fixKeyMode=!a.fixKeyMode,t=0;t<a.tables.length;t++)a.tables[t].box.fixKeyMode.call(a.tables[t].box,a.fixKeyMode);break;case"cmd_autojoin":i.auto_join();break;case"cmd_load_fields":i.load_fields();break;case"cmd_beutify":i.beutify_diagram();break;case"cmd_table_order":new IG$.dlgTableOrder({cubemodel:i.cubemodel}).show(i);break;case"cmd_refresh_table":i.down("[name=grid_st]").store.loadData([]),i._s1&&i.loadDatabaseTable(i._s1,"StoredContent",null,{readcontent:"T"})}},load_fields:function(){var i=this,e=i.cubemodel;e.tables.length&&$.each(e.tables,function(e,t){i.loadTableContent(t)})},auto_join:function(){var e,t,i,n,a,o,l=this.cubemodel,s={},d=[];if(1<l.tables.length){for(e=0;e<l.relations.length;e++)s[(a=(n=l.relations[e]).source.tableuid+"_"+n.source.fieldname)+":"+(o=n.target.tableuid+"_"+n.target.fieldname)]=1,s[o+":"+a]=1;for(e=0;e<l.tables.length;e++)for((i=l.tables[e])._cnames={},t=0;t<i._mc.columns.length;t++)i._cnames[i._mc.columns[t].fieldname]=i._mc.columns[t];for(e=0;e<l.tables.length;e++)i=l.tables[e],this.get_auto_join(l.tables,s,d,i);if(0<d.length)new IG$.JoinRec({joins:d,callback:new IG$.callBackObj(this,function(e){var t,i,n,a,o=this.m;for(i=0;i<e.length;i++)t=e[i],l.relations.push(t),n=this.tablemap[(t.source.model||t.source.tableuid)+"_"+t.source.seq],a=this.tablemap[(t.target.model||t.target.tableuid)+"_"+t.target.seq],n&&a&&(t.bl=o.addLink.call(o,n,a,t,l.relations));this.validateLinks(),o.validateLinks.call(o)})}).show();else IG$.alertmsg(ig$.appname,"No join suggestions on this model",null,null,0,"success")}},get_auto_join:function(e,t,i,n){var a,o,l,s,d,r,c,u,h,m,b,p,f=n._mc;for(d=f.uid+"_",a=0;a<e.length;a++)if(p=e[a]._mc,f.uid!=p.uid&&(!f.external_name||f.external_name&&f.external_name!=p.external_name)){for(r=p.uid+"_",u=[],h=[],m=p.columns.length,b=!1,o=0;o<m;o++)c=p.columns[o].fieldname,n._cnames[c]&&(l=d+c,s=r+c,-1<c.indexOf("id")&&(b=!0),t[l+":"+s]||(u.push({join:"inner",operator:"=",source:n._cnames[c],target:p.columns[o]}),t[l+":"+s]=1,t[s+":"+l]=1),h.push(c));if((5<h.length&&5<m||h.length==m)&&b)for(o=u.length-1;0<=o;o--)u[o].source.fieldname.indexOf("id")<0&&u.splice(o,1);for(o=0;o<u.length;o++)i.push(u[o])}},beutify_diagram:function(){var e,t,i,n,a,o=this,l=o.cubemodel,s=[],d=[],r={},c={},u=[];if(1<l.tables.length&&1<l.relations.length){for(e=0;e<l.relations.length;e++)c[(n=l.relations[e]).source.tableuid]=c[n.source.tableuid]||[],c[n.source.tableuid].push(n),c[n.target.tableuid]=c[n.target.tableuid]||[],c[n.target.tableuid].push(n);for(e=0;e<l.tables.length;e++)(a=l.tables[e]).parent=null,a.childnodes=[],a.jointable=[],r[a._mc.uid]=a,u.push(a);for(;0<u.length;)if(c[(a=u[0])._mc.uid])for(t={fact_table:null,tables:[]},i=c[a._mc.uid],e=0;e<i.length;e++)t.tables.push(a),s.push(t),u.splice(0,1),o.gather_join_tables(u,c,r,i[e],t,a);else d.push(a),u.splice(0,1);if(0<s.length)for(e=0;e<s.length;e++)o.update_table_hierarchy(r,s[e]);var h,m=10,b=10,p=0;for(e=0;e<d.length;e++)m+=(h=o.update_position(m,b,10,d[e])).x,p=Math.max(p,h.y);for(b+=p+10,m=10,e=0;e<s.length;e++)b=(h=o.update_position(m,b,10,s[e].fact_table)).y}},update_table_hierarchy:function(e,t){var i={};t.tables.sort(function(e,t){var i=e.jointable.length;return t.jointable.length-i}),t.fact_table=t.tables[0],i[t.fact_table._mc.uid]=1,this.update_linklist(e,t.fact_table,i)},update_linklist:function(e,t,i){var n,a;for(n=0;n<t.jointable.length;n++)i[(a=t.jointable[n])._mc.uid]||(i[a._mc.uid]=1,t.childnodes.push(a),t.jointable[n].parent=t,this.update_linklist(e,a,i))},update_position:function(e,t,i,n){var a,o=e,l=t,s=0;if(n.box.innerGrid.setPosition(e,t),l+=n._mc.height,n.childnodes&&n.childnodes.length){for(l+=i,a=0;a<n.childnodes.length;a++)this.update_position(o,l,i,n.childnodes[a]),o+=n._mc.width+i,s=Math.max(s,n._mc.height);l+=s}return{x:o,y:l}},gather_join_tables:function(e,t,i,n,a,o){var l,s,d,r,c;for(d=n.source.tableuid==o._mc.uid?n.target:n.source,l=0;l<e.length;l++)if(e[l]._mc.uid==d.tableuid){if(c=e[l],a.tables.push(c),e.splice(l,1),o.jointable.push(c),c.jointable.push(o),r=t[c._mc.uid])for(s=0;s<r.length;s++)this.gather_join_tables(e,t,i,r[s],a,c);break}},loadDatabaseTable:function(e,t,i,n){var a,o=e.get("nodepath"),l=new IG$._rpc$,s={address:o,option:t,search:i,uid:e.get("uid")};if(n)for(a in n)s[a]=n[a];s.subfolder="T",this.setLoading(!0),l.init(this,{ack:"content",payload:s,mbody:s},this,this.rs_loadDatabaseTable,!1,[e,t]),l.send()},rs_loadDatabaseTable:function(e,t){t[0];var i,n,a,o=t[1],l=e.children||[],s=[],d=!!o,r=this.down("[name=grid_st]"),c=this.cubemodel,u={};if(this.setLoading(!1),l){for(c.tables=c.tables||[],i=0;i<c.tables.length;i++)u[c.tables[i]._mc.uid]=1;for(i=0;i<l.length;i++)a=(n=d?l[i].content:l[i]).type.toLowerCase(),n.uid=n.uid||""+i,n.uid!=this.uid&&(u[n.uid]&&(n.used="*"),"cubemodel"!=a&&(n.physical_name=n.attributes.attrb3),n.iconcls=IG$.get_metatype_icon(a),s.push(n))}r.store.loadData(s)},saveAsContent:function(e){var t=new IG$.metaSelectDlg({mode:"newitem",tree_options:{rootuid:this.obj_uid},callback:new IG$.callBackObj(this,this.saveNewContent,e)});IG$.checkLogin(this,t)},saveNewContent:function(e,t){this.cubemodel.item={name:e.name,address:e.nodepath+"/"+e.name,pid:e.uid},this.saveContent(!0)},_r_join:function(e){var t,i,n=this.cubemodel,a=this.m,o=n.relations;for(t=0;t<o.length;t++)if(o[t]==e){o.splice(t,1);break}for(t=0;t<a.links.length;t++){for(i=!1,j=0;j<a.links[t].links.length;j++)if(a.links[t].links[j]==e){a.links[t].links.splice(j,1),i=!0;break}if(1==i){0==a.links[t].length&&a.links.splice(t,1);break}}this.updateJoinFields(),this.validateLinks(),a.validateLinks.call(a)},searchRelationship:function(){var a=this.down("[name=txt_rel]").getValue(),e=this.down("[name=mRel]").store;e.clearFilter(),a&&(a=a.toLowerCase(),e.filterBy(function(e){var t,i=[e.get("s0"),e.get("s2"),e.get("t0"),e.get("t2")],n=!1;for(t=0;t<i.length;t++)if(i[t]&&-1<i[t].toLowerCase().indexOf(a)){n=!0;break}return n}))},rs_cellClickHandler:function(e,t,i){this._s1=e,this.toolbarHandler("cmd_refresh_table")},initComponent:function(){var a=this;$s.apply(this,{items:[{xtype:"panel",layout:"border",split:!0,items:[{xtype:"panel",region:"west",width:250,hideHeaders:!0,title:"Table Lists",layout:{type:"vbox",align:"stretch"},items:[new IG$.n$navTreeCom({name:"mtree",rootuid:this.obj_uid,visibleItems:"folder;dataset;",flex:1,showCustomMenu:function(e){var t=this.customMenu,i=e.get("type").toLowerCase(),n=e.get("name"),a=e.get("nodepath"),o=e.get("uid"),l=(e.get("type"),1==e.get("writable")||1==e.get("manage")),s=1==e.get("manage"),d=!1;return t.removeAll(),(l||s)&&(d=!0,"folder"==i&&t.add({text:IRm$.r1("B_FOLDER"),hidden:ig$.features.ig_n_f_f,handler:function(){this._createMetaObject.call(this,"Folder",o,a,e)},scope:this}),t.add({text:IRm$.r1("L_RENAME_ITEM",n),hidden:ig$.features.ig_n_ren,handler:function(){this._renameMetaObject.call(this,n,o,a,record)},scope:this}),t.add({text:IRm$.r1("L_DELETE_ITEM",n),hidden:ig$.features.ig_n_del,handler:function(){this.deleteMetaObject.call(this,o,record)},scope:this})),d},custom_expand_func:new IG$.callBackObj(a,function(e){this.rs_cellClickHandler(e,1,0)}),custom_click_func:new IG$.callBackObj(a,function(e,t){this.rs_cellClickHandler(e,0,1)})}),{xtype:"gridpanel",name:"grid_st",flex:2,title:"Registered Table",emptyText:IRm$.r1("M_S_S2"),plain:!0,store:{showcheckselect:!0,fields:["name","type","uid","nodepath","dispname","checked","allow_insert","allow_insert_desc","iconcls","physical_name"]},enableDragDrop:!0,enableDD:!0,columns:[{text:"",width:20,dataIndex:"used"},{xtype:"templatecolumn",text:IRm$.r1("B_NAME"),flex:2,sortable:!1,dataIndex:"name",tdCls:"igc-td-link",tpl:"<div class='ig-navi-itemicon-p'><div class='ig-navi-itemicon {iconcls}'></div></div><span class='ig-navi-text' title='{name} ({type})'>{name} </span>",editor:{allowBlank:!1}}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{iconCls:"icon-refresh",tooltip:"Refresh",handler:function(){this.toolbarHandler("cmd_refresh_table")},scope:this},{xtype:"textfield",flex:1,name:"_filter",enableKeyEvents:!0,listeners:{keyup:function(e,t,i){13==t.keyCode&&IG$._dofilter(this,"grid_st",["name","alias"])},scope:this}},{xtype:"button",text:"..",handler:function(){IG$._dofilter(this,"grid_st",["name","alias"])},scope:this}]}],listeners:{cellclick:function(e,t,i,n,a,o,l,s){var d,r,c=e.store.getAt(o),u=this.cubemodel;if("*"==c.get("used")){for(d=0;d<u.tables.length;d++)if(u.tables[d]._mc.uid==c.get("uid")){r=u.tables[d];break}r&&this.m.focusTable(r)}},scope:this}}]},{type:"panel",html:"",split:!0,overflowX:"hidden",overflowY:"hidden",name:"mcontainer",region:"center"},{xtype:"panel",split:!0,title:"Relations",region:"east",name:"p_joins",hidden:!0,tools:[{type:"collapse"}],width:320,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"Search",name:"txt_rel",labelWidth:40,labelAlign:"right",flex:1,enableKeyEvents:!0,listeners:{keyup:function(e,t,i){13==t.keyCode&&a.searchRelationship()},scope:this}},{xtype:"button",text:"..",handler:function(){a.searchRelationship()}}]},{xtype:"gridpanel",name:"mRel",flex:1,store:{fields:["s0","s1","s2","t0","t1","t2","r0","sdesc","tdesc","l"]},columns:[{text:"From",flex:1,dataIndex:"sdesc"},{text:"To",flex:1,dataIndex:"tdesc"},{xtype:"actioncolumn",width:45,items:[{iconCls:"icon-grid-config",tooltip:"Config item",handler:function(e,t,i){var n,a=e.store.getAt(t).get("l");a&&a.bl&&(n=a.bl).showLinkEditor.call(n,[n.links[0]],n.links)}},{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,i){var n=e.store.getAt(t);a._r_join(n.get("l"))}}]}]}]}]}],tbar:[{iconCls:"icon-toolbar-save",name:"t_save",text:"Save",tooltip:IRm$.r1("L_SAVE_REPORT"),handler:function(){this.toolbarHandler("cmd_save")},scope:this},"-",{iconCls:"icon-toolbar-simple-view",tooltip:"Simple Relation View",handler:function(){this.toolbarHandler("cmd_simple_view")},scope:this},{iconCls:"icon-toolbar-table-order",tooltip:"Table order",handler:function(){this.toolbarHandler("cmd_table_order")},scope:this},"-",{iconCls:"icon-toolbar-fixkey",text:"Fix key",tooltip:"Fix Key columns",handler:function(){this.toolbarHandler("cmd_fix_key")},scope:this},{iconCls:"icon-toolbar-autojoin",text:IRm$.r1("L_AUTO_JOIN"),tooltip:"Auto Join",handler:function(){this.toolbarHandler("cmd_autojoin")},scope:this},{iconCls:"icon-toolbar-tablesort",text:IRm$.r1("L_JOIN_BEUTIFY"),tooltip:"sort",handler:function(){this.toolbarHandler("cmd_beutify")},scope:this},{iconCls:"icon-refresh",tooltip:"Refresh",handler:function(){this.toolbarHandler("cmd_load_fields")},scope:this},"-",{iconCls:"icon-toolbar-export",tooltip:"Print",handler:function(){this.toolbarHandler("cmd_print")},scope:this},"-",{tooltip:"Zoom In",iconCls:"icon-toolbar-zoomin",handler:function(){this.m.zoom(.1)},scope:this},{tooltip:"Zoom Out",iconCls:"icon-toolbar-zoomout",handler:function(){this.m.zoom(-.1)},scope:this},"->",{iconCls:"icon-joins",tooltip:"Joins",handler:function(){var e=this.down("[name=p_joins]");e.isVisible()?e.hide():e.show()},scope:this}],listeners:{afterrender:function(e){this._init()},resize:function(e){this.m.validateSize()},beforeclose:function(e,t){var i=this;if(i.writable&&i.uid){var n=new IG$._rpc$;n.init(i,{ack:"helpcontent",payload:{uid:i.uid},mbody:{option:"lock",detail:"close"}},i,function(e){},!1),n.send()}return!0}}}),IG$.CubeModel.superclass.initComponent.call(this)}}),IG$.dlgTableOrder=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!0,resizable:!0,width:500,height:610,callback:null,_init:function(){var e,t,i,n=this.cubemodel,a=[],o=this.down("[name=grd_tables]");for(n.tables=n.tables||[],e=n.tables,t=0;t<e.length;t++)(i={uid:e[t]._mc.uid,name:e[t]._mc.name,seq:e[t]._mc.seq}).disp=i.seq?i.name+"("+i.seq+")":i.name,a.push(i);o.store.loadData(a)},confirmChanges:function(){var e,t,i,n=this.cubemodel.tables,a={},o=this.down("[name=grd_tables]");for(e=0;e<o.store.data.items.length;e++)a[(t=o.store.data.items[e]).get("uid")+"_"+t.get("seq")]=e;for(e=0;e<n.length;e++)i=n[e]._mc.uid+"_"+n[e]._mc.seq,n[e].sortindex=a[i];n.sort(function(e,t){return e.sortindex-t.sortindex}),this.close()},changeOrder:function(e){var t,i,n=this.down("[name=grd_tables]"),a=n.getSelectionModel(),o=a.selected;o&&1==o.length&&(i=o.items[0],t=n.store.indexOf(i),-1==e?0<t&&(n.store.remove(i),i=n.store.insert(t-1,i),a.select(i,!0)):t+1<n.store.data.items.length&&(n.store.remove(i),i=n.store.insert(t+1,i),a.select(i,!0)))},initComponent:function(){this.title=IRm$.r1("L_TBL_ORD"),$s.apply(this,{defaults:{padding:10},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",flex:1,name:"grd_tables",store:{xtype:"store",fields:["name","uid","seq","disp"]},columns:[{xtype:"gridcolumn",flex:1,text:IRm$.r1("B_NAME"),dataIndex:"name"}]},{xtype:"container",padding:"0 0 0 5",layout:{type:"vbox",pack:"center",align:"stretch"},items:[{xtype:"container",flex:1},{xtype:"button",iconCls:"ig-btn-up",handler:function(){this.changeOrder(-1)},scope:this},{xtype:"container",height:10},{xtype:"button",iconCls:"ig-btn-down",handler:function(){this.changeOrder(1)},scope:this},{xtype:"container",flex:1}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this.confirmChanges()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]}),IG$.dlgTableOrder.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(e){e._init.call(e)}}}),IG$.dlgLoadPreview=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!0,resizable:!0,width:950,autoHeight:!0,callback:null,_init:function(){var e=this;e.table?e.load_content():e.dataset&&e.rs_load_content(e.dataset)},load_content:function(e){var t=this,i=new IG$._rpc$,n=t.table._mc;t.setLoading(!0),i.init(t,{ack:"tablecontent",payload:{uid:n.uid,type:n.type,passwd:e,option:"preview"},mbody:{option:"preview"}},t,t.rs_load_content,t.err_load_content),i.send()},rs_load_content:function(e){var t,i,n,a,o,l,s,d=e.headers,r=e.inline_data,c=[],u=[],h=[],m=this.down("[name=dataview]"),b=this.table?this.table._mc:null,p={};if(this.setLoading(!1),d&&r){if(b&&b.columns)for(t=0;t<b.columns.length;t++)p[b.columns[t].name]=b.columns[t].alias;for(e.delimiter,t=0;t<d.length;t++)p[a=d[t].name]&&p[a]!=a&&(a=p[a]+" - "+a),o="col_"+t,u.push({xtype:"gridcolumn",width:150,text:a,dataIndex:o}),h.push({name:o,mapping:o});for(u.length,t=0;t<r.length;t++){for(n={},s=r[t],i=0;i<s.length;i++)n[o="col_"+i]=s[i];c.push(n)}}l={store:"array",fields:h,data:c},m.reconfigure(l,u)},initComponent:function(){this.title=IRm$.r1("L_PRV_DATA"),$s.apply(this,{defaults:{padding:10},layout:"fit",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:"Table data preview"},{xtype:"gridpanel",name:"dataview",height:400,columns:[]}]}],buttons:[{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.dlgLoadPreview.superclass.initComponent.apply(this,arguments)}}),IG$.JoinRec=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!0,resizable:!0,width:600,autoHeight:!0,padding:5,_init:function(){var e,t,i,n,a,o=this.down("[name=gmain]"),l=this.joins,s=[];for(e=0;e<l.length;e++)n=(i=l[e]).source,a=i.target,t={stableuid:n.tableuid,stable:n.tablename,sfield:n.fieldname,ttableuid:a.tableuid,ttable:a.tablename,tfield:a.fieldname,join:i.join},s.push(t);o.store.loadData(s)},_confirm:function(){var e,t,i,n=this,a=n.down("[name=gmain]"),o=n.joins,l=[],s={};for(t=0;t<a.store.data.items.length;t++)s[(e=a.store.data.items[t]).get("stableuid")+"_"+e.get("sfield")+":"+e.get("ttableuid")+"_"+e.get("tfield")]=1;for(t=0;t<o.length;t++)s[(i=o[t]).source.tableuid+"_"+i.source.fieldname+":"+i.target.tableuid+"_"+i.target.fieldname]&&l.push(i);n.callback&&n.callback.execute(l),n.close()},initComponent:function(){$s.apply(this,{title:"Join Recommendations",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},minHeight:400,padding:10,items:[{xtype:"gridpanel",name:"gmain",flex:1,columns:[{text:"Source Table",dataIndex:"stable"},{text:"Source Field",dataIndex:"sfield"},{text:"Target Table",dataIndex:"ttable"},{text:"Target Field",dataIndex:"tfield"},{text:"Operator",dataIndex:"join"},{xtype:"actioncolumn",width:45,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,i){e.store.getAt(t);e.store.removeAt(t)}}]}],store:{fields:["stable","sfield","ttable","tfield","join","stableuid","ttableuid"]}}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._init()}}}),IG$.JoinRec.superclass.initComponent.apply(this,arguments)}});
IG$.mgrUserDuty=$s.extend($s.window,{modal:!0,layout:"fit",closable:!1,resizable:!1,width:500,autoHeight:!0,bodyPadding:10,bodyStyle:{background:"#ffffff"},_confirm:function(){var e=this;if(e.callback){var t,o=e.down("[name=gridduty_sel]"),s=[];for(t=0;t<o.store.data.length;t++)s.push(o.store.data.items[t]);e.callback.execute(s)}e.close()},loadDutyList:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"usercontent",payload:{address:"/Auth"},mbody:{option:"select"}},e,e.rs_loadDutyList,!1),t.send()},rs_loadDutyList:function(e){var t,o,s=[],i=[],d=this.down("[name=gridduty]"),l=this.down("[name=gridduty_sel]"),a={};if(this.sel)for(t=0;t<this.sel.length;t++)a[this.sel[t].sid]=this.sel[t];if(e)for(t=0;t<e.length;t++)a[(o=e[t]).sid]?i.push(o):s.push(o);d.store.loadData(s),l.store.loadData(i)},moveDuty:function(e){var t,o=this.down("[name=gridduty"+(0==e?"_sel":"")+"]"),s=this.down("[name=gridduty"+(1==e?"_sel":"")+"]"),i=o.getSelectionModel().getSelection();if(0<i.length)for(t=0;t<i.length;t++)o.store.remove(i[t]),s.store.add(i[t])},initComponent:function(){this.title=IRm$.r1("L_MGR_UD");var e=[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},border:0,bodyPadding:5,items:[{xtype:"displayfield",value:IRm$.r1("L_UD_DESC")},{xtype:"panel",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",name:"gridduty",border:1,flex:1,height:300,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},multiSelect:!0,store:{fields:["name","dutytype","sid","status","type"]},columns:[{header:IRm$.r1("B_NAME"),dataIndex:"name",flex:1,sortable:!0,hideable:!1},{header:IRm$.r1("B_TYPE"),dataIndex:"type",flex:1,sortable:!0,hideable:!1}]},{xtype:"container",bodyPadding:"0 4 0 4",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:1},{xtype:"button",text:">>",handler:function(){this.moveDuty(!0)},scope:this},{xtype:"button",text:"<<",handler:function(){this.moveDuty(!1)},scope:this},{xtype:"container",flex:1}]},{xtype:"gridpanel",name:"gridduty_sel",flex:1,border:1,height:300,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},multiSelect:!0,store:{fields:["name","dutytype","sid","status","type"]},columns:[{header:IRm$.r1("B_NAME"),dataIndex:"name",flex:1,sortable:!0,hideable:!1},{header:IRm$.r1("B_TYPE"),dataIndex:"type",flex:1,sortable:!0,hideable:!1}]}]}]}],t=[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}];$s.apply(this,{items:e,buttons:t}),IG$.mgrUserDuty.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(e){this.loadDutyList()}}});
IG$.codemapping=$s.extend($s.window,{modal:!0,layout:"fit",closable:!1,resizable:!1,width:540,height:480,_confirm:function(){var e,t,a,i=this,o=i.down("[name=grd_data]"),n=i.down("[name=i_cset_g]"),l=i.down("[name=displabel_c]"),d=i.down("[name=p_1a]"),s=i.down("[name=p_1]"),c=i.pitem;if(IG$.checkFields(i,["p_1"])&&c){if(s.clearInvalid(),c.name=s.getValue(),c.description=i.down("[name=p_2]").getValue(),c.dtype=i.down("[name=p_3]").getValue(),c.sql_data=i.down("[name=p_4]").getValue(),c.static_data=[],c.datasource=i.down("[name=cbdatasource]").getValue(),!c.name)return void s.markInvalid();for(c.i_cdata=[],"static"==c.dtype?c.i_cset=i.down("[name=i_cset_s]").getValue():c.i_cset=i.down("[name=i_cset]").checkboxCmp.getValue(),e=0;e<o.store.data.items.length;e++)(t=o.store.data.items[e]).get("code")&&(c.static_data.push({code:t.get("code"),value:t.get("value")}),"static"==c.dtype&&t.get("color")&&c.i_cdata.push({code:t.get("code"),color:t.get("color")}));if("static"!=c.dtype)for(e=0;e<n.store.data.items.length;e++)(t=n.store.data.items[e]).get("color")&&c.i_cdata.push({code:t.get("value"),color:t.get("color")});d._confirm.call(d),"static"!=c.dtype&&"sql"!=c.dtype||(c.displabel=l.getValue()),(a=new IG$._rpc$).init(i,{ack:"writecontent",payload:{uid:i.pitem.uid,name:i.pitem.name,description:i.pitem.description},mbody:i.pitem,meta_type:"code_mapping"},i,function(e){var t=this;t.callback&&t.callback.execute(t.item),t.close()},null),a.send()}},_init:function(){this._getDsource()},_getDsource:function(){var e=new IG$._rpc$;e.init(this,{ack:"tablecontent",payload:{address:"/"},mbody:{option:"standard"}},this,function(e){var t,a,i,o=this,n=[],l=(IG$.dlgLogin.jS2,o.down("[name=cbdatasource]"));if(o.setLoading(!1),e&&e.length){for(i=e,n.push({dispname:"-- Select Pool --",uid:""}),a=0;a<i.length;a++)(t=i[a]).dispname=t.name,n.push(t);l.store.loadData(n),l.setValue("")}o._getMeta()},!1),e.send()},_getMeta:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"content",payload:{uid:e.uid,revision:e.revision},mbody:{option:"diagnostics"}},e,function(e){var a=this;a.pitem=e.content,a.pitem.get=function(e){return a.pitem[e]},a.pitem.set=function(e,t){a.pitem[e]=t},a._applyMeta()},!1),t.send()},_applyMeta:function(){var e,t=this,a=t.pitem,i=t.down("[name=p_1a]");a&&(e=[{c:"p_1",v:a.name},{c:"p_2",v:a.description},{c:"p_3",v:a.dtype},{c:"p_4",v:a.sql_data},{c:"cbdatasource",v:a.datasource},{c:"i_cset_s",v:a.i_cset}],"sqljoin"==(t.down("[name=p_1a]").rec=a).dtype&&(i.datasource=a.datasource,i.loadContent.call(i)),t._applyVal(e),t.down("[name=grd_data]").store.loadData(a.static_data),t.down("[name=i_cset_g]").store.loadData(a.i_cdata),t.down("[name=displabel_c]").setValue(a.displabel||""),a.i_cset&&t.down("[name=i_cset]").expand())},_applyVal:function(e){var t;for(t=0;t<e.length;t++)this.down("[name="+e[t].c+"]").setValue(e[t].v||"")},_moveGrdSel:function(e,t){var a=e.getSelectionModel().getSelection(),i=a&&a.length?a[0]:null;if(i){var o=e.getStore().indexOf(i);if(t<0){if(--o<0)return}else if(++o>=e.getStore().getCount())return;e.getStore().remove(i),i=e.getStore().insert(o,i),e.getSelectionModel().select(i,!0)}},initComponent:function(){this.title=IRm$.r1("T_CODE_MAPPING"),$s.apply(this,{bodyStyle:"padding:5px; background: #ffffff",items:[{xtype:"panel",padding:"5 5",border:0,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("B_NAME"),name:"p_1"},{xtype:"textarea",fieldLabel:IRm$.r1("B_DESC"),name:"p_2",height:60},{xtype:"combobox",fieldLabel:"Mapping Type",name:"p_3",store:{xtype:"store",fields:["name","value"],data:[{name:"Select",value:""},{name:"Static Values",value:"static"},{name:"SQL Query",value:"sql"},{name:"SQL Join",value:"sqljoin"}]},queryMode:"local",valueField:"value",displayField:"name",editable:!1,listeners:{change:function(e,t,a){if(t){var i=this;i.down("[name=cbdatasource]").setVisible("static"!=t),i.down("[name=lt_0]").setVisible("static"==t),i.down("[name=lt_1]").setVisible("sql"==t),i.down("[name=lt_2]").setVisible("sqljoin"==t),i.down("[name=i_cset]").setVisible("static"!=t),i.down("[name=displabel_c]").setVisible("sqljoin"!=t)}},scope:this}},{xtype:"fieldset",title:"Static Data Values",name:"lt_0",flex:1,hidden:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"checkbox",name:"i_cset_s",fieldLabel:"Use ColorSet",boxLabel:IRm$.r1("B_ENABLE"),listeners:{change:function(e){var t=e.getValue(),a=this.down("[name=grd_data]");a.columns[2].setVisible(t),a.columns[3].setVisible(t)},scope:this}},{xtype:"gridpanel",name:"grd_data",tbar:[{xtype:"toolbar",hidden:!!this.mdlgmode,items:[{text:"Add Row",xtype:"button",handler:function(){this.down("[name=grd_data]").store.add({})},scope:this},{text:"Delete Selected",xtype:"button",handler:function(){var e,t=this.down("[name=grd_data]"),a=t.getSelectionModel().selected;for(e=a.length-1;0<=e;e--)t.store.remove(a.items[e])},scope:this},"-",{xtype:"button",text:"Up",handler:function(){var e=this.down("[name=grd_data]");this._moveGrdSel(e,-1)},scope:this},{xtype:"button",text:"Down",handler:function(){var e=this.down("[name=grd_data]");this._moveGrdSel(e,1)},scope:this}]}],flex:1,store:{xtype:"store",fields:["code","value","color"]},selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{text:IRm$.r1("B_CODE"),dataIndex:"code",flex:1,editor:{xtype:"textfield",allowBlack:!0}},{text:IRm$.r1("B_TEXT"),dataIndex:"value",flex:1,editor:{xtype:"textfield",allowBlack:!1}},{xtype:"templatecolumn",text:IRm$.r1("B_COLOR"),dataIndex:"color",width:60,hidden:!0,tpl:"<div style='width: 60px; height: 20px; background-color: {color}'></div>"},{xtype:"actioncolumn",hidden:!0,width:20,items:[{iconCls:"icon-grid-config",handler:function(a,i,e){new $s.menu({items:[{xtype:"colorpicker",text:"Color",listeners:{select:function(e,t){a.store.data.items[i].set("color","#"+t),e.hide()}}}]}).show()}}]}]}]},{xtype:"combobox",name:"cbdatasource",queryMode:"local",fieldLabel:"Data Source",displayField:"dispname",valueField:"uid",editable:!1,autoSelect:!1,store:{xtype:"store",fields:["name","dispname","uid","isuserdb","savepwd"]},listeners:{select:function(e){var t=e.getValue(),a=this.down("[name=p_1a]");"sqljoin"==this.down("[name=p_3]").getValue()&&(a.datasource=t,a.loadContent.call(a))},scope:this}},{xtype:"fieldset",title:"SQL Data Values",name:"lt_1",minHeight:230,flex:1,hidden:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textarea",name:"p_4",flex:1},{xtype:"displayfield",autowidth:!1,value:"CODE, VALUE, SORT and additional fields in SELECT"}]},{xtype:"container",title:"SQL Table Join",name:"lt_2",flex:1,hidden:!0,minHeight:600,layout:"anchor",items:[new IG$.codeMappingPanel({name:"p_1a",border:0,anchor:"100%",d_m:"cmap"})]},{xtype:"combobox",fieldLabel:"Label Value",name:"displabel_c",queryMode:"local",hidden:!0,editable:!0,valueField:"value",displayField:"name",store:{xtype:"store",fields:["name","value"],data:[{name:"Mapped values",value:""},{name:"{CODE} {VALUE}",value:"{CODE} {VALUE}"},{name:"{CODE} {SORT} {VALUE}",value:"{CODE} {SORT} {VALUE}"}]}},{xtype:"fieldset",title:"ColorSet",name:"i_cset",checkboxToggle:!0,collapsed:!0,height:200,layout:"fit",items:[{xtype:"gridpanel",name:"i_cset_g",selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},store:{xtype:"store",fields:["code","color"]},columns:[{text:"Value",dataIndex:"code",flex:1},{text:"Color",dataIndex:"color",flex:1}]}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){this._init()}}}),IG$.codemapping.superclass.initComponent.apply(this,arguments)}});
IG$.multiMeasure=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",padding:5,closable:!1,resizable:!1,width:400,height:560,callback:null,_fdata:[{name:"Distinct Count",value:"COUNT DISTINCT",metric:1},{name:"Count",value:"COUNT",metric:1},{name:"Sum",value:"SUM",metric:1},{name:"Average",value:"AVG",metric:1},{name:"Max",value:"MAX",metric:1},{name:"Min",value:"MIN",metric:1},{name:"Template",value:"TMPL",metric:0}],_confirm:function(){var e=this;if(e.callback){var t,a,i,l=[],n=this.down("[name=measureview]"),s=this.down("[name=clocation]");for(t=0;t<n.store.data.items.length;t++)(a=n.store.data.items[t]).data.selected&&(i={nodepath:a.get("nodepath"),formula:a.get("formula"),type:a.get("type"),name:a.get("name"),uid:a.get("uid"),datatype:a.get("datatype"),measurename:a.get("measurename"),ctype:a.get("ctype"),clocation:a.get("clocation")},l.push(i));if(0==l.length)return void IG$.alertmsg(ig$.appname,IRm$.r1("B_SELECT_TARGET"),null,null,0,"");e.rs_reg_measures({items:l,clocation:s.getValue(),dialog:e,vmode:e.vmode,tmpl:e.tmpl})}e.close()},rs_reg_measures:function(e){var t,a,i,l,n,s,o,m,r,d,u,c=this,p=[],f={items:[]},h=(e.vmode,e.items),y=e.clocation,x=(e.dialog,c.nodepath),g=e.tmpl,b=f.items;for(c.mfolder=y,t=0;t<h.length;t++)if(l=h[t],o=e.vmode?l.clocation+"/":"{parent}"==y.substring(0,"{parent}".length)?l.nodepath.substring(0,l.nodepath.lastIndexOf("/"))+y.substring("{parent}".length)+"/":x+"/"+(y?y+"/":""),l.cloc=o,-1<(d=l.measurename).indexOf("/")&&(d=(d=d.split("/")).join("&#x2044;")),n={name:d,uid:o+d,type:l.ctype||"Measure",createstructure:"T"},c.mitem&&(n.pid=c.mitem.uid),p.push(n),u=c.mitem?c.mitem:l,"DateMetric"==l.ctype)s={cubeuid:c.uid,dateformat:"DATE",fieldid:l.uid,fieldname:d,dbtype:"auto",issql:!0,meta_type:"custom_dimension"},b.push(s);else{switch(l.formula){case"COUNT DISTINCT":case"COUNT_DISTINCT":i="COUNT(DISTINCT ["+l.name+"])";break;case"TMPL":break;default:i=l.formula+"(["+l.name+"])"}if("TMPL"==l.formula&&g){for(r=(i=g.expression).indexOf("[field]");-1<r;)r=(i=i.substring(0,r)+"["+l.name+"]"+i.substring(r+"[field]".length)).indexOf("[field]");for(s={meta_type:"measure",name:l.measurename,expression_type:g.expressiontype,calcmode:g.calcmode,expression:i,rel_items:[u]},a=0;a<g.fields.length;a++)g.fields[a].type=g.fields[a].type||g.fields[a].itemtype,s.items.push(g.fields[a]);b.push(s)}else s={meta_type:"measure",name:l.measurename,expression_type:l.formula,expression:i,rel_items:[u]},b.push(s)}c.setLoading(!0),(m=new IG$._rpc$).init(c,{ack:"batchcontent",payload:p,mbody:f},c,function(e){c.callback.execute()},null),m.send()},apply_template:function(){var e,t,a,i=this.down("[name=measureview]"),l=this.down("[name=t_format]").getValue(),n=i.getSelectionModel().selected,s=l?/(\[field\]|\[formula\])/.test(l):0;if(0==n.length&&(n=i.store.data),s){function o(e,t,a){if(a&&a.length){var i=t.indexOf(e);-1<i&&(t=t.substring(0,i)+a+t.substring(i+e.length))}return t}for(e=0;e<n.length;e++){a=o("[field]",l,a=(t=n.items[e]).get("name"));var m=t.get("formula");switch(m){case"COUNT":m="count";break;case"COUNT DISTINCT":case"COUNT_DISTINCT":m="unique count";break;case"SUM":m="Total";break;case"Min":m="Min.";break;case"MAX":r="Max.";break;case"AVG":r="Avg."}a=o("[formula]",a,m),t.set("measurename",a)}}},initComponent:function(){this.title=IRm$.r1("T_M_MEASURE"),$s.apply(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:5,items:[{xtype:"fieldset",title:"MultiMeasure",layout:{type:"vbox",align:"stretch"},flex:1,padding:5,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"Location",hidden:1==this.vmode||2==this.vmode,name:"clocation"},{xtype:"fieldcontainer",layout:"hbox",fieldLabel:"Measure Name",items:[{xtype:"textfield",name:"t_format",value:"[formula] [field]"},{xtype:"button",text:"Apply",handler:function(){var e=this;e.down("[name=t_format]").getValue()&&(ig$.measure_naming=e.down("[name=t_format]").getValue()),e.apply_template()},scope:this},{xtype:"container",flex:1}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},hidden:1==this.vmode||2==this.vmode,items:[{xtype:"displayfield",value:"Location ex: {parent}/measures"},{xtype:"container",flex:1}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"displayfield",value:"Name template ex: [formula] [field]"},{xtype:"container",flex:1}]}]},{xtype:"gridpanel",name:"measureview",collapsible:!1,stateful:!0,columnLines:!0,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell"},store:{fields:["name","uid","nodepath","type","datatype","measurename","formula","ctype","clocation"]},flex:1,initialized:!1,layout:"fit",plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{text:"Measure name",dataIndex:"measurename",flex:1,editor:{allowBlank:!1}},{text:"Fact name",dataIndex:"name",flex:1,editor:{allowBlank:!1}},{width:120,text:"Measure Type",dataIndex:"formula",editor:{xtype:"combobox",queryMode:"local",displayField:"name",valueField:"value",editable:!1,autoSelect:!0,triggerAction:"all",selectOnTab:!0,store:{xtype:"store",fields:["name","value"],data:this._fdata},lazyRender:!0,listClass:"x-combo-list-small"}}],viewConfig:{stripeRows:!0},fbar:[{xtype:"toolbar",items:[{xtype:"button",text:"Remove Selected",handler:function(){var e,t=this.down("[name=measureview]"),a=t.store,i=t.getSelectionModel().selected;for(e=i.length-1;0<=e;e--)a.remove(i.items[e])},scope:this},"->",{xtype:"button",text:"Template",handler:function(){var e,i=this,t=new IG$.measureEditor({dmode:1,cubeuid:i.pcube.uid,clItem:i.tmpl||{},callback:new IG$.callBackObj(i,function(e){i.tmpl=e?e.citem:null;var t,a=i.down("[name=measureview]").getSelectionModel().selected;for(t=0;t<a.length;t++)a.items[t].set("formula","TMPL")})}),a=i.pcube,l=a?a.customstyle:null;if(t.clItem.cubeinfo.styles=[],l)for(e=0;e<l.length;e++)t.clItem.cubeinfo.styles.push(l[e]);t.clItem.expressiontype=t.clItem.expressiontype||"SUM([field])",t.clItem.expression=t.clItem.expression||"SUM([field])",t.show()},scope:this}]}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){var e,t,a,i=this,l=i.down("[name=measureview]"),n=i.down("[name=clocation]"),s=i.mitem;if(i.down("[name=t_format]").setValue(ig$.measure_naming||"[formula] [field]"),2==i.vmode){for(e=[],t=0;t<i._fdata.length;t++)0<(a=i._fdata[t]).metric&&e.push({measurename:a.name,formula_desc:a.name,name:s.name,formula:a.value});l.store.loadData(e)}else n.setValue(null==i.mfolder?"{parent}/measures":i.mfolder),i.metaitems&&(l.store.loadData(i.metaitems),i.apply_template())}}}),IG$.multiMeasure.superclass.initComponent.apply(this,arguments)}});
IG$.d$QryTool=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!1,resizable:!1,width:700,autoHeight:!0,autoScroll:!0,updateChanges:function(){var t,e,o,a=this,l=a.down("[name=ctrlpool]"),i=a.down("[name=columngrid]");for(a.sheetoption.sqloption.dbpool=l.getValue(),l=a.down("[name=sqlquery]"),a.sheetoption.sqloption.sql=l.getValue(),a.sheetoption.sqloption.sqlquery=a.sheetoption.sqloption.sql,a.sheetoption.sqloption.columns=[],t=0;t<i.store.data.items.length;t++)(o=(e=i.store.data.items[t]).data).dataoption={},o.dataoption.data=e.get("dataoption_data"),o.dataoption.datadelimiter=e.get("dataoption_datadelimiter"),o.dataoption.coldelimiter=e.get("dataoption_coldelimiter"),o.dataoption.valuetype=e.get("dataoption_valuetype"),a.sheetoption.sqloption.columns.push(o)},confirmDialig:function(){var t=this;t.updateChanges(),t.callback&&t.callback.execute(),t.close()},loadPool:function(){var t=this,e=new IG$._rpc$;t.sheetoption.sqloption||(t.sheetoption.sqloption={}),t.down("[name=sqlquery]").setValue(t.sheetoption.sqloption.sql||t.sheetoption.sqloption.sqlquery||""),e.init(t,{ack:"tablecontent",payload:{address:""},mbody:{}},t,t.rs_loadPool,null),e.send()},rs_loadPool:function(t){var e,o,a=IG$.XGetNode(t,"/smsg/item"),l=IG$.XGetChildNodes(a),i=this.down("[name=ctrlpool]"),n=this.down("[name=ctrlquerytype]"),s=[];for(e=0;e<l.length;e++)(o=IG$.XGetAttrProp(l[e])).select=this.sheetoption.sqloption.dbpool==o.name,"MECBASE"!=o.name&&s.push(o);i.store.loadData(s),i.setValue(this.sheetoption.sqloption.dbpool),n.setValue("stmt")},getMetaInfo:function(){var t,e=this,o=new IG$._rpc$;e.down("[name=promptgrid]");e.updateChanges(),t={dbpool:e.down("[name=ctrlpool]").getValue(),method:e.down("[name=ctrlquerytype]").getValue(),sql:e.down("[name=sqlquery]").getValue()},e.setLoading(!0),o.init(e,{ack:"olapservice",payload:{uid:e.uid,option:"sqlcubedata"},mbody:t},e,e.rs_getMetaInfo,null),o.send()},rs_getMetaInfo:function(t){var e,o,a,l,i,n,s=IG$.XGetNode(t,"/smsg/columns"),d=s?IG$.XGetChildNodes(s):null,p=IG$.XGetNode(t,"/smsg/result"),r=[],u=[],m=[],c=[],h=this.down("[name=columngrid]");if(this.setLoading(!1),d){for(e=0;e<d.length;e++)o=IG$.XGetAttrProp(d[e]),r.push(o),m.push("c"+e),u.push({xtype:"gridcolumn",flex:1,text:o.fieldname,minWidth:120,dataIndex:"c"+e});if(p)for(i=IG$.XGetAttr(p,"delimiter"),l=(l=IG$.XGetTextVal(p)).split(i),a={},e=0;e<l.length&&(n=e%r.length,!(0<e&&0==n&&(c.push(a),a={},100<c.length)));e++)a["c"+n]=l[e]}var y=Ext.create("Ext.data.ArrayStore",{fields:m});h.reconfigure(y,u),h.store.loadData(c)},toolbarHandler:function(t){switch(t){case"cmd_getmeta":this.getMetaInfo()}},initComponent:function(){var t=this,e=$(document);t.maxHeight=e.height()-20,t.title=IRm$.r1("I_SQLCUBE"),t.title=IRm$.r1("I_QRY_TOOL");var o={xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:5,tbar:[{xtype:"combobox",name:"ctrlpool",queryMode:"local",displayField:"disp",valueField:"name",fieldLabel:"Database Source",editable:!1,autoSelect:!0,store:{fields:["name","disp"]}},{xtype:"combobox",name:"ctrlquerytype",queryMode:"local",displayField:"disp",valueField:"name",fieldLabel:"Query Type",editable:!1,autoSelect:!0,store:{fields:["name","disp"],data:[{disp:"Statement",name:"stmt",selected:1},{disp:"PreparedStatement",name:"pstmt"}]}}],items:[{xtype:"textarea",name:"sqlquery",fieldLabel:"SQL Query",height:160},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:IRm$.r1("L_RUN_REPORT"),width:120,handler:function(){this.toolbarHandler("cmd_getmeta")},scope:this},{xtype:"fieldcontainer",width:10},{xtype:"displayfield",value:" Click button to get result",flex:1}]},{xtype:"grid",title:"Data Results",name:"columngrid",height:250,stateful:!0,columnLines:!0,store:{xtype:"store",fields:["name","fieldname","type","datatype","tablename","dataoption_data","dataoption_valuetype","dataoption_datadelimiter","dataoption_coldelimiter","uid","mapto"]},initialized:!1,layout:"fit",columns:[]}]};Ext.apply(this,{defaults:{bodyStyle:"padding:0px"},autoScroll:!0,items:[o],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this.confirmDialig()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(t){this.loadPool()}}}),IG$.d$QryTool.superclass.initComponent.apply(this,arguments)}});
IG$.sqlcube_wizard=$s.extend($s.window,{modal:!0,region:"center",layout:"fit",closable:!1,resizable:!0,width:650,height:500,autoScroll:!1,bodyPadding:0,_confirm:function(){var e=this;e.getAllValues(e.sheetoption)||(e.callback&&e.callback.execute(e),e.close())},init:function(){new IG$._rpc$;this.setAllValues(this.sheetoption)},validateQuery:function(){var e,t=this,i=new IG$._rpc$;e={dbpool:t.sheetoption.dbpool},t.getAllValues(e)||(i.init(t,{ack:"olapservice",payload:{uid:t.sheetoption.uid,option:"sqlcubemeta"},mbody:e,meta_type:"inlineview"},t,function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_VALIDATED")+"("+(e.columns?e.columns.length:"0")+" columns)",null,null,0,"success")},null),i.send())},initComponent:function(){this.title=IRm$.r1("I_SQLCUBE"),$s.apply(this,{items:[{xtype:"panel",name:"mainpanel",layout:{type:"vbox",align:"stretch"},flex:1,autoScroll:!1,items:[{xtype:"panel",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"View name",name:"name",required:!0},{xtype:"textarea",name:"sql",fieldLabel:"SQL Query",flex:1,required:!0}]}]}],buttons:[{text:IRm$.r1("B_VALIDATE"),handler:function(){this.validateQuery()},scope:this},"->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._confirm()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this.init()}}}),IG$.sqlcube_wizard.superclass.initComponent.apply(this,arguments)}});
IG$.multimetric=$s.extend(IG$.v$pnl,{layout:"fit",uid:null,parentnodepath:null,itemtype:null,parentuid:null,callback:null,objinfo:null,seq:0,bodyPadding:10,initComponent:function(){var s=this;$s.apply(this,{items:[{xtype:"gridpanel",name:"elemtree",store:{xtype:"store",fields:["name","ukey"]},selModel:Ext.create(Ext.selection.CheckboxModel,{checkSelector:".x-grid-cell"}),tbar:[{iconCls:"icon-toolbar-save",tooltip:"Save Content",handler:function(){this.storeContent.call(this,null)},scope:this},"-",{iconCls:"icon-toolbar-add",tooltip:"Add Node",hidden:!0,handler:function(){this.appendSelection.call(this)},scope:this},{iconCls:"icon-toolbar-remove",tooltip:"Delete Node",hidden:!0,handler:function(){this.removeSelection.call(this)},scope:this}],plugins:[{ptype:"cellediting",clicksToEdit:!1}],columns:[{xtype:"gridcolumn",text:"Element name",dataIndex:"name",flex:1,editor:{allowBlank:!1}},{xtype:"gridcolumn",text:"Unique value",dataIndex:"ukey",width:80,editor:{allowBlank:!1}},{xtype:"actioncolumn",hidden:!0,width:80,items:[{iconCls:"icon-grid-config",tooltip:IRm$.r1("B_CONFIG_ITEM"),handler:function(e,t,n,i,o,l){s.updateValues(t,l,"edit")},scope:s},{iconCls:"icon-grid-delete",tooltip:IRm$.r1("B_DELETE_ITEM"),handler:function(e,t,n,i,o,l){s.updateValues(t,l,"delete")},scope:s}]}],listeners:{checkchange:function(e,t){e.set("chekced",t)}}}],storeContent:function(e){var t,n=this,i="<item uid='"+this.uid+"'>",o=n.down("[name=elemtree]").store.getRootNode();n.setLoading(!0),t=n.getElementContent(o,null),i+="<objinfo"+IG$.XUpdateInfo(n.objinfo,"cubeuid","s")+"/>",i+="<Elements lseq='"+n.seq+"'><![CDATA["+t+"]]></Elements>",i+="</item>";var l=new IG$._rpc$;l.init(n,{ack:"writecontent",payload:{uid:n.uid},mbody:i},n,n.rs_storeContent,null,e),l.send()},rs_storeContent:function(e,t){this.buildCube(t)},buildCube:function(e){var t=this,n=new IG$._rpc$;n.init(t,{ack:17,payload:{uid:t.uid,cubeuid:t.objinfo.cubeuid,action:"UpdateMetric"},mbody:{}},t,t.rs_buildCube,null,e),n.send()},rs_buildCube:function(e,t){this.setLoading(!1),t?t.close():IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},getElementContent:function(e,t){var n,i,o="";for(n=0;n<e.childNodes.length;n++)o+=(i=e.childNodes[n]).get("seq")+","+(t?t.get("seq"):"")+","+i.get("name")+"|",i.childNodes&&0<i.childNodes.length&&(o+=this.getElementContent(i,i));return o},refreshContent:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"content",payload:{uid:e.uid},mbody:{option:"diagnostics"}},e,e.rs_refreshContent,null),t.send()},rs_refreshContent:function(e){var t=this,n=(IG$.XGetNode(e,"/smsg/item"),IG$.XGetNode(e,"/smsg/item/objinfo"));n&&(t.objinfo=IG$.XGetAttrProp(n)),t.objinfo&&t.objinfo.sequence&&t.updateTreeNode([])},appendElementTree:function(e,t){for(var n=0;n<e.length;n++){var i=IG$.XGetAttr(e[n],"id"),o=IG$.XGetAttr(e[n],"text"),l=this.mtree.appendNodeElement.call(this.mtree,t,i,o),s=IG$.XGetChildNodes(e[n]);s&&0<s.length&&this.appendElementTree(s,l)}},updateValues:function(e,t,n){this.down("[name=elemtree]").store;"delete"==n&&!0!==t.get("root")&&t.remove()},updateTreeNode:function(e){var t=this,n=(this.clItem,this.objinfo);t.setLoading(!0);var i=new IG$._rpc$;i.init(t,{ack:17,payload:{uid:t.uid,sequence:n.sequence,action:"55"},mbody:{option:"standard"}},t,t.rs_updateTreeNode,null),i.send()},rs_updateTreeNode:function(e){var t,n,i=IG$.XGetNode(e,"/smsg/item"),o=i?IG$.XGetChildNodes(i):null,l=[],s=this.down("[name=elemtree]");for(this.setLoading(!1),n=0;n<o.length;n++)(t=IG$.XGetAttrProp(o[n])).name=IG$.XGetTextVal(o[n]),l.push(t);s.store.loadData(l)},rebuildTree:function(e){var t,n=[],o={};for(i=0;i<e.length;i++)o[e[i].seq]=e[i],null!=e[i].pnode&&o[e[i].pnode]?((t=o[e[i].pnode]).leaf=!1,delete t.checked,e[i].leaf=!0,e[i].checked=!1,t.children=t.children||[],t.children.push(e[i])):(e[i].leaf=!0,e[i].checked=!1,n.push(e[i]));return n},appendSelection:function(){var e,t,n,i,o,l,s,d=this.down("[name=elemtree]"),a=(d.store,d.getSelectionModel()),r=0;for(e=(n=0<a.selected.items.length?a.selected.items[0]:d.getRootNode()).get("valuedesc"),t=n.get("values"),n.set("valuedesc",""),n.set("values",""),n.set("leaf",!1),l="new item ",o=0;o<n.childNodes.length;o++)(s=n.childNodes[o].get("name")).substring(0,l.length)==l&&(s=s.substring(l.length),s=Number(s),0==isNaN(s)&&(r=Math.max(r,Number(s)+1)));r=Math.max(r,this.seq+1),i={seq:this.seq=r,name:l+=r,values:t||"",valuedesc:e||"",leaf:!0,checked:!1},n.appendChild(i),n.expand()},removeSelection:function(){var e=this.down("[name=elemtree]").store.getRootNode();this.removeSelectedRow(e)},removeSelectedRow:function(e){var t,n;for(t=e.childNodes.length-1;0<=t;t--)1==(n=e.childNodes[t]).get("checked")?e.removeChild(n):n.childNodes&&0<n.childNodes.length&&this.removeSelectedRow(n)},listeners:{afterrender:function(e){this.refreshContent()}}}),IG$.multimetric.superclass.initComponent.apply(this)}}),IG$.multiMeasureEditor=$s.extend($s.window,{modal:!0,layout:"fit",closable:!1,resizable:!1,width:500,height:400,initComponent:function(){this.title=IRm$.r1("L_MC_ELEM_EDT"),this.edt=new IG$.multimetric({uid:this.uid}),$s.apply(this,{defaults:{bodyStyle:"padding:0px"},layout:"fit",items:[this.edt],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){var e=this.edt;e.storeContent.call(e,this)},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]}),IG$.multiMeasureEditor.superclass.initComponent.apply(this,arguments)}});
function CMolapMeasure(e){this.measuretype="COUNT",this.uid=null,this.name=null,this.nodepath=null,this.baseItem=null,this.parseMeasure=function(e){var t=IG$.XGetNode(e,"/smsg/item");if(this.name=IG$.XGetAttr(t,"name"),this.nodepath=IG$.XGetAttr(t,"nodepath"),this.uid=IG$.XGetAttr(t,"uid"),this.isDisinct=!0,(t=IG$.XGetNode(e,"/smsg/item/objinfo"))&&(this.measuretype=IG$.XGetAttr(t,"measuretype")),(t=IG$.XGetNode(e,"/smsg/item/BaseItem"))&&(this.baseItem={},this.baseItem.name=IG$.XGetAttr(t,"name"),this.baseItem.uid=IG$.XGetAttr(t,"uid"),this.baseItem.nodepath=IG$.XGetAttr(t,"nodepath"),this.baseItem.itemtype=IG$.XGetAttr(t,"type")),(t=IG$.XGetNode(e,"/smsg/item/Options"))&&1==t.hasChildNodes()){var s=IG$.XGetChildNodes(t);for(i=0;i<s.length;i++){var a=s[i],n=IG$.XGetTextVal(s[i]);switch(IG$.XGetAttr(a,"name")){case"isDistinct":this.isDisinct="F"!=n}}}},this.getMeasureXML=function(){var e=this,t={uid:e.uid,name:e.name,nodepath:e.nodepath,measuretype:e.measuretype},i=e.baseItem;switch(e.measuretype){case"COUNT":t.rel_items=[],t.rel_items.push({uid:i.uid,nodepath:i.nodepath,name:i.name,type:i.itemtype}),t.options=[],t.options.push({name:"isDisinct",value:e.isDisinct?"T":"F"})}return t},e&&this.parseMeasure(e)}IG$.multimeasure=function(e){$s.apply(this,e),IG$.multimeasure.superclass.constructor.call(this,{autoScroll:!0,collapseFirst:!1,closable:!0,items:[{html:"<div class='elementeditor'></div>"}]})},IG$.multimeasure=$s.extend(IG$.v$pnl,{title:"Make item",modal:!0,region:"center",layout:"vbox",layoutConfig:{align:"stretch"},closable:!0,resizable:!1,width:400,height:500,uid:null,cubeuid:null,parentnodepath:null,itemtype:null,parentuid:null,measureObj:null,selectCombo:null,defaults:{autoHeight:!0,bodyStyle:"padding:10px"},pivotSelectionChangedHandler:function(e){this.measureObj.measuretype=e,this.resetMeasureUI()},metricSelectedHandler:function(e){this.measureObj.baseItem=e,this.baseItemField1.setValue(this.measureObj.baseItem.nodepath)},initComponent:function(){var s=this;this.baseItemField1=new Ext.form.TextField({name:"fmetric",allowBlank:!1}),this.stabcontainer=new Ext.Container({flex:3,layout:"card",items:[{layout:"fit",layoutConfig:{align:"stretch"},items:[{xtype:"fieldcontainer",fieldLabel:"Metric",items:[this.baseItemField1,{xtype:"button",text:"..",handler:function(){var e=new IG$.metaSelectDlg({tree_options:{cubebrowse:!0,rootuid:s.cubeuid}});e.callback=new IG$.callBackObj(s,s.metricSelectedHandler),IG$.checkLogin(this,e)},scope:this}]}],hidden:!1},{html:"Sum of measure type",hidden:!0},{html:"Max of measure type",hidden:!0},{html:"Date of measure type",hidden:!0}]}),$s.apply(this,{items:[{flex:1,height:40,items:[{html:'<div class="pivotSelect">Measure type:</div>',border:!1,listeners:{afterlayout:function(e){e.addPivotSelectHandler.call(e)}},selectBoxAdded:!1,addPivotSelectHandler:function(){if(0==this.selectBoxAdded){var e=$(".pivotSelect",s.body.dom),t=$('<select name="pivotSelect"><option value="COUNT">Count Metric</option><option value="SUM">Sum data</option><option value="MAX">Max data</option><option value="DATE">Date Measure</option></select>');t.change(function(){s.pivotSelectionChangedHandler.call(s,this.value)}),t.appendTo(e),this.selectBoxAdded=!0,s.selectCombo=t}}}]},this.stabcontainer],tbar:[{iconCls:"icon-expand-all",tooltip:"Save Content",handler:function(){this.storeContent.call(this)},scope:this}],storeContent:function(){var e=this,t=e.measureObj.getMeasureXML(),i=new IG$._rpc$;i.init(e,{ack:"writecontent",payload:{uid:e.uid},mbody:t},e,e.rs_storeContent,null),i.send()},rs_storeContent:function(e){IG$.alertmsg(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},refreshContent:function(){var e=this,t=new IG$._rpc$;t.init(e,{ack:"content",payload:{uid:e.uid},mbody:{}},e,e.rs_refreshContent,null),t.send()},rs_refreshContent:function(e){s.measureObj=new CMolapMeasure(e),s.resetMeasureUI.call(s)},resetMeasureUI:function(){this.selectCombo[0].value=this.measureObj.measuretype;var e=0;switch(this.measureObj.measuretype){case"COUNT":e=0,this.measureObj.baseItem&&this.baseItemField1.setValue(this.measureObj.baseItem.nodepath);break;case"SUM":e=1;break;case"MAX":e=2;break;case"DATE":e=3}var t=this.stabcontainer;for(i=0;i<t.items.items.length;i++)t.items.items[i].setVisible(i==e)}}),IG$.multimeasure.superclass.initComponent.apply(this,arguments)}});