function m$B2(t,a){var e=this;e.ind=t,e.rowdata=a,e.ellipses=[],e.label=$("<div class='bblabel'></div>"),e.html=$("<div class='bbbox'></div>"),e.ind.container.append(e.html),e.paper=new Raphael(e.html[0]),e.html.append(e.label),e.invalidate=-1,e.validateData()}function m$Bl(t){this.parent=t,this.mv=null,this.colorset=[.23,.4,.3],this.initVariables()}m$B2.prototype={validateData:function(){var t,a,e=this,l=e.ellipses,i=e.ind.colorset,n=e.rowdata;for(t=0;t<l.length;t++)l[t].html.remove();for(l=[],e.label.text(n.name),t=0;t<n.value.length;t++)(a={}).color=i[t%i.length],l.push(a);e.ellipses=l,e.validateDisplay()},validateDisplay:function(){var t=this;t.invalidate>-1&&clearTimeout(t.invalidate),setTimeout((function(){t.updateDisplay()}),100)},updateDisplay:function(){var t,a,e,l,i,n,h,o,s,r,m,c,p=this,u=p.ind,v=p.html,b=IG$.j$ext._w(v),d=IG$.j$ext._h(v),f=p.rowdata,x=p.ellipses,$=u.mcalc.max,g=null==u.mv?u.mcalc.min:u.mv>u.mcalc.min?u.mv:u.mcalc.min,y=p.label;if(b>0&&d>0){if((s=p.paper).clear(),s.setSize(b,d),x&&x.length>0){for(l=Math.min(b,d),a=$==g?$:$-g,o=0;o<x.length;o++)h=0==o?f.value[o]:h+f.value[o];for(n=(h-g)/a*(.8*l)+.1*l,o=0;o<x.length;o++)i=0==o?f.value[o]:i+f.value[o],e=Math.sqrt(n*n*i/h),(t=x[o]).x=b/2,t.y=d/2,t.radius=e/2;for(o=x.length-1;o>=0;o--)r=(t=x[o]).x,m=t.y,c=t.radius,hue=t.color,t.circle=s.set(s.ellipse(r,m+c-c/5,0,0).attr({fill:"rhsb("+hue+", 1, .25)-hsb("+hue+", 1, .25)",stroke:"none",opacity:0}).animate({rx:c,ry:c/2},400,"<"),s.ellipse(r,m,0,0).attr({fill:"r(.5,.9)hsb("+hue+", 1, .75)-hsb("+hue+", .5, .25)",stroke:"none"}).animate({rx:c,ry:c},400,"<"),s.ellipse(r,m,0,0).attr({stroke:"none",fill:"r(.5,.1)#ccc-#ccc",opacity:0}).animate({rx:c-c/5,ry:c-c/20},400,"<"))}p.label.css({top:d-y.height()-4,left:(b-IG$.j$ext._w(p.label))/2})}}},m$Bl.prototype={initVariables:function(){var t=this;t.ex=[],t.mx=[],t.bubbles=[],t.mcalc={},t.container=$("<div class='bbmain'></div>").appendTo(t.parent)},initControl:function(){var t,a=this.bubbles;for(t=0;t<a.length;t++)a[t].html.remove();a=[]},loadData:function(t){var a,e,l,i,n,h,o,s,r=this,m=r.ea,c=r.ma,p=r.mcalc;if(t&&t.length>0&&m&&m.length>0&&c&&c.length>0){for(a=0;a<c.length;a++)c[a].max=0,c[a].min=0;for(a=0;a<t.length;a++){for("col_"&a,i="",h=[],e=0;e<m.length;e++)l=m[e].i,i=0==e?t[a][l]:i+" "+t[a][l];for(e=0;e<c.length;e++)l=c[e].i,n=Number(t[a][l]),0==a?(c[e].min=n,c[e].max=n):(c[e].min=Math.min(c[e].min,n),c[e].max=Math.max(c[e].max,n)),o=0==e?n:o+n,h.push(n);0==a?(p.min=o,p.max=o):(p.min=Math.min(p.min,o),p.max=Math.max(p.max,o)),s=new m$B2(r,{name:i,value:h}),r.bubbles.push(s)}r.validateControl()}},validateControl:function(){var t,a,e,l,i,n=$(this.parent),h=IG$.j$ext._w(n),o=IG$.j$ext._h(n),s=this.bubbles;if(h>0&&o>0&&s&&s.length>0)for(i=0,e=h/s.length,l=o,a=0;a<s.length;a++)(t=s[a]).html.css({left:i,top:0,position:"absolute"}),IG$.j$ext._w(t.html,e),IG$.j$ext._h(t.html,l),t.validateDisplay.call(t),i+=e}};
IG$.m$CompMatrix=function(){var t=this;t.xField=null,t.xFieldName=null,t.yField=null,t.yFieldName=null,t.compVal,t.dataSet=null,t.toString=function(){return t.xFieldName+", "+t.yFieldName+" : "+t.compVal}},IG$.compMatrixPlotCell=function(){var t,e,i=this,a=window.bowser,l=window&&window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");i.hasCanvas=!l&&!a.msie,i.compItem,i.xMin,i.xMax,i.yMin,i.yMax,i.xRange,i.yRange,i.cr1=0,i.cr2=0,i.selected,i.width,i.height,i.html=$('<div class="matrixchart"></div>'),1==i.hasCanvas&&(i.canvas=$("<canvas></canvas>"),i.canvas.appendTo(i.html)),i.updateExtremes=function(){if(i.compItem&&i.compItem.dataSet){for(i.xMin=Number.MAX_VALUE,i.yMin=Number.MAX_VALUE,i.xMax=Number.MIN_VALUE,i.yMax=Number.MIN_VALUE,t=0;t<i.compItem.dataSet.length;t++)e=i.compItem.dataSet[t],i.xMin=Math.min(i.xMin,e[i.compItem.xField]),i.yMin=Math.min(i.yMin,e[i.compItem.yField]),i.xMax=Math.max(i.xMax,e[i.compItem.xField]),i.yMax=Math.max(i.yMax,e[i.compItem.yField]);i.xRange=i.xMax-i.xMin,i.yRange=i.yMax-i.yMin}},i.computeX=function(t){var e=t[i.compItem.xField];return 1-(i.xMax-e)/i.xRange},i.computeY=function(t){var e=t[i.compItem.yField];return 1-(i.yMax-e)/i.yRange},i.updatePlot=function(){var t,e,a,l;for(i.plotData=[],t=0;t<i.compItem.dataSet.length;t++)e=i.compItem.dataSet[t],a=i.computeX(e),l=i.computeY(e),i.plotData.push([a,l]);i.drawPlot()},i.drawPlot=function(){var e=this;e.width=e.html.innerWidth(),e.height=e.html.innerHeight();var i,a={};for(i=e.compItem.compVal>e.cr2?"rgba(0,0,255,":e.compItem.compVal>e.cr1?"rgba(150,150,150,":"rgba(255,0,0,",1==e.hasCanvas?(e.canvas.width=e.width,e.canvas.height=e.height,e.ctx=e.canvas[0].getContext("2d"),e.ctx.scale(1,1),e.ctx.fillStyle="rgb(255,255,255)",e.ctx.fillRect(0,0,e.width,e.height),e.ctx.strokeStyle="#5F5F5F",e.ctx.lineWidth=1,e.ctx.fillStyle=i+".5)"):e.paper?e.paper.clear():e.paper=Raphael(e.html[0],0,0,e.width,e.height),t=0;t<e.plotData.length;t++){var l,o=e.plotData[t],n=0==isNaN(o[0])?o[0]*e.width:0,r=0==isNaN(o[1])?(1-o[1])*e.height:e.height,c=Math.floor(n),s=Math.floor(r);a[l=(c-=c%5)+","+(s-=s%5)]||(1==e.hasCanvas?(e.ctx.beginPath(),e.ctx.arc(n,r,1,0,2*Math.PI,!0),e.ctx.closePath(),e.ctx.fill(),a[l]={obj:!0,mbody:0}):(a[l]={obj:e.paper.circle(n,r,2),mbody:0},a[l].obj.attr("fill",i+"0.5)")))}a=null},i.updateDispList=function(t,e){i.drawPlot()},i.commitProps=function(){i.updateExtremes(),i.updatePlot()}},IG$.ComparisonMatrix=function(t,e){var i,a,l=this;l.compItems=null,l.cells=[],l.parent=t,l.config=e,l.textFields=[],l.showLabels=e.showLabels||!0,l.cr1=null==e.cr1||void 0===e.cr1?0:e.cr1,l.cr2=null==e.cr2||void 0===e.cr2?0:e.cr2,l.container=$('<div class="matrixcontainer"></div>'),l.container.appendTo(l.parent),(a=l.labelhtml=$('<div class="matrixlabel"></div>')).css({position:"absolute",top:"0px",left:"0px",width:"0px",height:"0px"}),a.appendTo(l.parent),l.isDirty=!1,(i=l.detailviewer=$('<div class="detailviewer"></div>')).css({position:"absolute",top:10,left:10,width:100,height:100,margin:0,padding:0,backgroundColor:"#ececec",borderColor:"#222222",display:"none"}),i.appendTo(l.parent),i.bind("click",(function(){$(this).fadeOut()})),l.detailcontainer=$('<div class="detailmatrixplot"></div>'),l.detailcontainer.css({position:"absolute",margin:"20 0 0 0",padding:0,top:0,left:0,right:0,bottom:0}),l.uid=0,l.detailcontainer.appendTo(i);var o=$('<div class="detailmatrixclosebtn"></div>');o.css({position:"absolute",top:2,width:16,height:16,right:2}),i.append(o),o.bind({click:function(){i.fadeOut()}}),l.correlationCoefficient=function(t,e,i){var a,l,o=t.length,n=0,r=0,c=0,s=0,d=0;for(l=0;l<t.length;l++){var m=(a=t[l])[e],p=a[i];n+=m,r+=p,c+=Math.pow(m,2),s+=Math.pow(p,2),d+=m*p}return(o*d-n*r)/(Math.sqrt(o*c-Math.pow(n,2))*Math.sqrt(o*s-Math.pow(r,2)))},l.comparisonFunction=l.correlationCoefficient,l.generateComparisonStatistics=function(){if(l.compItems=[],0!=l.fields.length&&null!=l.dataSet&&0!=l.dataSet.length)for(var t=l.fields.length,e=0;e<t;e++)for(var i=0;i<e+1;i++)if(e!=i){var a=new IG$.m$CompMatrix;a.xFieldName=l.fields[e],a.xField=e,a.yFieldName=l.fields[i],a.yField=i,a.compVal=l.comparisonFunction(l.dataSet,a.xField,a.yField),l.compItems.push(a)}},l.createOrRemoveCells=function(){var t,e=this,i=e.compItems.length,a=[];for(e.matrixitems={};e.cells.length<i;){var l=new IG$.compMatrixPlotCell;l.html.css({border:"1px solid #a5a5a5",width:200,height:200,position:"absolute",padding:0}),l.html.appendTo(e.container),t="matrixplot"+e.uid,l.html[0].id=t,l.id=t,e.uid++,a.push(l),e.cells.push(l),e.matrixitems[t]=l}for($.each(a,(function(t,i){i.html.bind({click:function(){e.drawDetailPlot(i)}})}));i<e.cells.length;){e.cells.pop().remove()}},l.updateTextFields=function(){var t,e,i=this,a=i.fields.length;for(t=0;t<a;t++)i.textFields.length<t+1&&((e=$('<div class="matrixtextfield"></div>')).css({fontSize:"0.8em",padding:"0 0 0 3",margin:0,position:"absolute",width:130}),i.textFields.push(e),e.appendTo(i.labelhtml)),i.textFields[t][0].innerText=i.fields[t];for(;a<i.textFields.length;){textFields.pop();i.textFieldToRemove.remove()}},l.layoutTextFields=function(){var t,e,i,a,l,o=this,n=o.textFields.length;if(n>0)for(t=o.textFields[0].height(),e=0;e<n;e++)i=o.textFields[e],a=e*o.actualCellSize+1,l=0==e?0:e*o.actualCellSize+t-i.height(),i.css({left:a,top:l})},l.layoutCells=function(){var t=this,e=0;if(t.showLabels&&t.textFields.length>0){var i=t.textFields[0];e=i.position().top+i.height()}for(var a=t.fields.length,l=0,o=0;o<a;o++)for(var n=0;n<o+1;n++)if(o!=n){var r=t.compItems[l],c=t.cells[l];r.dataSet=t.dataSet,c.compItem=r,c.selected=r==t.selectedItem;var s;s=r.xField+"\n"+r.yField+"\n"+r.compVal,c.toolTip=s;var d=n*t.actualCellSize,m=(o-1)*t.actualCellSize+e;c.html.css({left:d,top:m,width:t.actualCellSize,height:t.actualCellSize}),c.cr1=t.cr1,c.cr2=t.cr2,1==t.isDirty?c.commitProps():c.updateDispList(),l++}},l.computeCellSize=function(t,e){var i=this,a=t,l=e;return 1==i.showLabels&&i.textFields.length>0?(a=t-i.textFields[i.textFields.length-1].width(),l=e-i.textFields[0].height()):(a=t,l=e),Math.min(a,l)/(i.fields.length-1)},l.updateDispList=function(){var t=this,e=$(t.parent),i=e.innerWidth(),a=e.innerHeight();t.container.css({width:i,height:a}),t.actualCellSize=t.computeCellSize(i,a),t.showLabels&&t.textFields.length>0&&t.layoutTextFields(),t.layoutCells()},l.commitProp=function(){var t=this;t.isDirty=!0,t.generateComparisonStatistics(),t.createOrRemoveCells(),t.updateTextFields(),t.updateDispList(),t.isDirty=!1}},IG$.ComparisonMatrix.prototype.drawDetailPlot=function(t){var e,i=this,a=i.matrixitems[t.id],l=a.compItem.compVal>i.cr2?"rgba(0,0,255,.5)":a.compItem.compVal>i.cr1?"rgba(150,150,150,.5)":"rgba(255,0,0,0.5)";if(a){e={chart:{renderTo:i.detailcontainer[0],defaultSeriesType:"scatter",zoomType:"xy",echart_theme:i.config.echart_theme},title:{text:a.compItem.xFieldName+" vs. "+a.compItem.yFieldName},xAxis:{axisLabel:{show:!0,text:a.compItem.xFieldName},name:a.compItem.xFieldName,nameLocation:"middle",nameGap:20,startOnTick:!0,endOnTick:!0,showLastLabel:!0,min:0,max:1},yAxis:{title:{text:a.compItem.yFieldName},name:a.compItem.yFieldName,nameLocation:"middle",nameGap:20,min:0,max:1},tooltip:{formatter:function(){return i.x+", "+i.y}},legend:{enabled:!1,layout:"vertical",align:"left",verticalAlign:"top",floating:!0,backgroundColor:"#FFFFFF",borderWidth:1},plotOptions:{scatter:{marker:{radius:5,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},states:{hover:{marker:{enabled:!1}}}}},series:[{type:"scatter",symbolSize:5,name:"comparison",color:l,data:a.plotData}]};var o=$(i.parent),n=o.width(),r=o.height(),c=.85*Math.min(r,n);i.detailviewer.css({left:n-c-10,top:5,width:c,height:c}),i.detailviewer.show(),i.plotdetail=echarts.init(e.chart.renderTo,e.chart.echart_theme||ig$.echarts_theme||"amplix",{renderer:"canvas"}),i.plotdetail.setOption(e)}};
